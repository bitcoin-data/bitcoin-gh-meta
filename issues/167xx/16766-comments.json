[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I added a cache which works per call/across calls, but does not store the results semi-permanently.\r\n\r\nThis should reduce DoS risk of this change.\r\n\r\nThere is no risk of _untrusted_ parents causing a resource exploitation, as we immediately return once that is detected.",
      "created_at" : "2019-08-30T20:37:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-526741579",
      "id" : 526741579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjc0MTU3OQ==",
      "updated_at" : "2019-08-30T20:37:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526741579",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15931](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15931.html) (Remove GetDepthInMainChain dependency on locked chain interface by ariard)\n* [#15729](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15729.html) (rpc: Raise error in getbalance if minconf is not zero by promag)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-30T22:33:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-526769063",
      "id" : 526769063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjc2OTA2Mw==",
      "updated_at" : "2019-11-04T02:14:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526769063",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If a parent is not trusted, then a child should not be either.\r\n\r\nWould be nice to have a test for this or update the `wallet_balance.py` script in case it is already tested there. (`wallet_balance.py` is failing)",
      "created_at" : "2019-09-03T15:48:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-527518660",
      "id" : 527518660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNzUxODY2MA==",
      "updated_at" : "2019-09-03T15:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/527518660",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I updated the tests to pass.\r\n\r\nIn the test, we  have two nodes with a balance of 50 each and then:\r\n\r\nSend 40 from node A to node B.\r\nSend 60 from node B to node A.\r\n\r\nThen we would check the balances.\r\n\r\nPreviously, we would immediately report a balance of 30 on node B as unconfirmed and trusted.\r\n\r\nNow, we show that balance as unconfirmed.\r\n\r\nThe balance is indeed \"trusted\" and \"confirmed\" insofar as removing the mempool transactions would return *at least* that much money. But the current software marks it as unconfirmed because the 'taint' tracking of transaction trust for summing balances doesn't consider which inputs belong to a user.\r\n\r\nI think the new behavior is correct; we shouldn't be treating those funds as confirmed. If you want to *rely* on that specific UTXO existing which has given you that balance, you cannot, as a third party spending the other input would destroy that unconfirmed.\r\n\r\nOverall I think that this points to a general concept worth exploring as a revision to the categories \"unconfirmed\" and \"confirmed\", to have \"free cash\", \"locked\", and \"unconfirmed\". Free cash can be spent at will, locked funds are balances that are guaranteed to exist but we don't have a confirmed UTXO for yet, and unconfirmed are funds we may or may not receive. I think this is out of scope of this PR though, but is worth further thought.",
      "created_at" : "2019-09-03T17:42:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-527563982",
      "id" : 527563982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNzU2Mzk4Mg==",
      "updated_at" : "2019-09-03T17:42:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/527563982",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r320435215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/320435215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            assert_equal(self.nodes[1].getbalance(), Decimal('0'))  # node 1's send had an unsafe input\r\n```",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-03T19:16:39Z",
      "diff_hunk" : "@@ -112,10 +112,10 @@ def run_test(self):\n         def test_balances(*, fee_node_1=0):\n             # getbalance without any arguments includes unconfirmed transactions, but not untrusted transactions\n             assert_equal(self.nodes[0].getbalance(), Decimal('9.99'))  # change from node 0's send\n-            assert_equal(self.nodes[1].getbalance(), Decimal('30') - fee_node_1)  # change from node 1's send\n+            assert_equal(self.nodes[1].getbalance(), Decimal('0'))  # change from node 1's send",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r320435215",
      "id" : 320435215,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMDQzNTIxNQ==",
      "original_commit_id" : "bee1dc9f8a5182f03979fa066dc7937fc945bf29",
      "original_position" : 5,
      "path" : "test/functional/wallet_balance.py",
      "position" : null,
      "pull_request_review_id" : 283206185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/320435215",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Test failure unrelated it seems? In assumevalid",
      "created_at" : "2019-09-05T18:47:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-528522217",
      "id" : 528522217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODUyMjIxNw==",
      "updated_at" : "2019-09-05T18:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528522217",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321529167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321529167"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With the overloaded `IsTrusted` this could be reverted? Same below.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-05T23:47:40Z",
      "diff_hunk" : "@@ -2407,10 +2421,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trustedParents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trustedParents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321529167",
      "id" : 321529167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTUyOTE2Nw==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 39,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284597322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321529167",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321529969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321529969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, join with line above - to follow correct format.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-05T23:51:38Z",
      "diff_hunk" : "@@ -2320,8 +2326,16 @@ bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n         if (parent == nullptr)\n             return false;\n         const CTxOut& parentOut = parent->tx->vout[txin.prevout.n];\n+        // Check that this specific input being spent is trusted\n         if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE)\n             return false;\n+        // If we've already trusted this parent, continue\n+        if (trustedParents.count(parent->GetHash()))\n+            continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321529969",
      "id" : 321529969,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTUyOTk2OQ==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284597322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321529969",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321529995"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321529995"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, snake case - header too.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-05T23:51:48Z",
      "diff_hunk" : "@@ -2295,6 +2295,12 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trustedParents) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321529995",
      "id" : 321529995,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTUyOTk5NQ==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284597322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321529995",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321558440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321558440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope -- because I'm caching the trust across the entire wallet (outside the loop) rather than just a single call.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T02:52:19Z",
      "diff_hunk" : "@@ -2407,10 +2421,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trustedParents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trustedParents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321558440",
      "id" : 321558440,
      "in_reply_to_id" : 321529167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTU1ODQ0MA==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 39,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284633375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321558440",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321558475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321558475"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure what you mean",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T02:52:34Z",
      "diff_hunk" : "@@ -2320,8 +2326,16 @@ bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n         if (parent == nullptr)\n             return false;\n         const CTxOut& parentOut = parent->tx->vout[txin.prevout.n];\n+        // Check that this specific input being spent is trusted\n         if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE)\n             return false;\n+        // If we've already trusted this parent, continue\n+        if (trustedParents.count(parent->GetHash()))\n+            continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321558475",
      "id" : 321558475,
      "in_reply_to_id" : 321529969,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTU1ODQ3NQ==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284633424,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321558475",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321558665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321558665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Did we change styles?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T02:53:58Z",
      "diff_hunk" : "@@ -2295,6 +2295,12 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trustedParents) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321558665",
      "id" : 321558665,
      "in_reply_to_id" : 321529995,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTU1ODY2NQ==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284633688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321558665",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321561721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321561721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We settled on a variable naming style in 2017: 47d84414662",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T03:15:17Z",
      "diff_hunk" : "@@ -2295,6 +2295,12 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trustedParents) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321561721",
      "id" : 321561721,
      "in_reply_to_id" : 321529995,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTU2MTcyMQ==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284637511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321561721",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321813286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321813286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "got it; went ahead and did this in the entire function (rather than leave it half-styled)",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T16:25:33Z",
      "diff_hunk" : "@@ -2320,8 +2326,16 @@ bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n         if (parent == nullptr)\n             return false;\n         const CTxOut& parentOut = parent->tx->vout[txin.prevout.n];\n+        // Check that this specific input being spent is trusted\n         if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE)\n             return false;\n+        // If we've already trusted this parent, continue\n+        if (trustedParents.count(parent->GetHash()))\n+            continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321813286",
      "id" : 321813286,
      "in_reply_to_id" : 321529969,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTgxMzI4Ng==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284968946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321813286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321822248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321822248"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, missed this is in a loop ð¤¦ââ",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T16:50:41Z",
      "diff_hunk" : "@@ -2407,10 +2421,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trustedParents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trustedParents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321822248",
      "id" : 321822248,
      "in_reply_to_id" : 321529167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTgyMjI0OA==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 39,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284980848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321822248",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321822360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321822360"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yup, that was the idea.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-06T16:51:05Z",
      "diff_hunk" : "@@ -2320,8 +2326,16 @@ bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n         if (parent == nullptr)\n             return false;\n         const CTxOut& parentOut = parent->tx->vout[txin.prevout.n];\n+        // Check that this specific input being spent is trusted\n         if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE)\n             return false;\n+        // If we've already trusted this parent, continue\n+        if (trustedParents.count(parent->GetHash()))\n+            continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r321822360",
      "id" : 321822360,
      "in_reply_to_id" : 321529969,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMTgyMjM2MA==",
      "original_commit_id" : "07858cc41a2f3cc74f281f4ac4331e26dffc9644",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 284981017,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/321822360",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do you expect a performance penalty for big wallets?",
      "created_at" : "2019-09-06T16:52:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-528930189",
      "id" : 528930189,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODkzMDE4OQ==",
      "updated_at" : "2019-09-06T16:52:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528930189",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes and No.\r\n\r\nYes:\r\nA properly constructed wallet, which has long-chains of unconfirmed transactions, will take longer to analyze. However, given the use of the set cache it should still be linear in the number of long-chain inputs (this could be large if there are a ton of fully independent unconfirmeds being spent).\r\n\r\nNo:\r\nA normal wallet, and normal wallet transactions (who is confirmed or whose parents are all confirmed) won't have much impact. Note we also abort as soon as we find an offending tx. It might be better to do this via BFS than DFS, but DFS is simpler to implement.\r\n\r\nNote that a third party can't force a long-chain lookup on you without your participation, because you're checking IsMine at each level. So an unconfirmed spend to you will look back only until it's a transaction with another participant that's unconfirmed.\r\n\r\nIt's also possible to use an unordered_set here -- but perhaps that's better done as something across the module (std::set/map is used extensively)",
      "created_at" : "2019-09-06T17:26:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-528941809",
      "id" : 528941809,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODk0MTgwOQ==",
      "updated_at" : "2019-09-06T17:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528941809",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324154009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324154009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe I'm missing something but I think you could avoid calling `GetDepthInMainChain` for parents if `nDepth >= 1`?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-13T11:42:07Z",
      "diff_hunk" : "@@ -2295,33 +2295,38 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const\n {\n     // Quick answer in most cases\n-    if (!locked_chain.checkFinalTx(*tx)) {\n-        return false;\n-    }\n+    if (!locked_chain.checkFinalTx(*tx)) return false;\n     int nDepth = GetDepthInMainChain(locked_chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324154009",
      "id" : 324154009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDE1NDAwOQ==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : 16,
      "pull_request_review_id" : 287964155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324154009",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324154718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324154718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, should be private?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-13T11:44:26Z",
      "diff_hunk" : "@@ -576,6 +576,7 @@ class CWalletTx\n \n     bool InMempool() const;\n     bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324154718",
      "id" : 324154718,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDE1NDcxOA==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 287964155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324154718",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324156875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324156875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You could `.insert()` here, and use the result value `.second` to know whether it was missing and then call `parent->IsTrusted`.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-13T11:51:21Z",
      "diff_hunk" : "@@ -2295,33 +2295,38 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const\n {\n     // Quick answer in most cases\n-    if (!locked_chain.checkFinalTx(*tx)) {\n-        return false;\n-    }\n+    if (!locked_chain.checkFinalTx(*tx)) return false;\n     int nDepth = GetDepthInMainChain(locked_chain);\n-    if (nDepth >= 1)\n-        return true;\n-    if (nDepth < 0)\n-        return false;\n-    if (!pwallet->m_spend_zero_conf_change || !IsFromMe(ISMINE_ALL)) // using wtx's cached debit\n-        return false;\n+    if (nDepth >= 1) return true;\n+    if (nDepth < 0) return false;\n+    // using wtx's cached debit\n+    if (!pwallet->m_spend_zero_conf_change || !IsFromMe(ISMINE_ALL)) return false;\n \n     // Don't trust unconfirmed transactions from us unless they are in the mempool.\n-    if (!InMempool())\n-        return false;\n+    if (!InMempool()) return false;\n \n     // Trusted if all inputs are from us and are in the mempool:\n     for (const CTxIn& txin : tx->vin)\n     {\n         // Transactions not sent by us: not trusted\n         const CWalletTx* parent = pwallet->GetWalletTx(txin.prevout.hash);\n-        if (parent == nullptr)\n-            return false;\n+        if (parent == nullptr) return false;\n         const CTxOut& parentOut = parent->tx->vout[txin.prevout.n];\n-        if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE)\n-            return false;\n+        // Check that this specific input being spent is trusted\n+        if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE) return false;\n+        // If we've already trusted this parent, continue\n+        if (trusted_parents.count(parent->GetHash())) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324156875",
      "id" : 324156875,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDE1Njg3NQ==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 47,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 287964155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324156875",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324414041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324414041"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm a little uncomfortable with that design because we then need to remove ourselves from the set if the recursion returns false.\r\n\r\nIt's also a bit weird because we add ourselves to the trusted set before recursion so technically there are elements not known to be trusted in the set. This is safe because the element is a child, but it's odd. ",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-14T06:16:10Z",
      "diff_hunk" : "@@ -2295,33 +2295,38 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const\n {\n     // Quick answer in most cases\n-    if (!locked_chain.checkFinalTx(*tx)) {\n-        return false;\n-    }\n+    if (!locked_chain.checkFinalTx(*tx)) return false;\n     int nDepth = GetDepthInMainChain(locked_chain);\n-    if (nDepth >= 1)\n-        return true;\n-    if (nDepth < 0)\n-        return false;\n-    if (!pwallet->m_spend_zero_conf_change || !IsFromMe(ISMINE_ALL)) // using wtx's cached debit\n-        return false;\n+    if (nDepth >= 1) return true;\n+    if (nDepth < 0) return false;\n+    // using wtx's cached debit\n+    if (!pwallet->m_spend_zero_conf_change || !IsFromMe(ISMINE_ALL)) return false;\n \n     // Don't trust unconfirmed transactions from us unless they are in the mempool.\n-    if (!InMempool())\n-        return false;\n+    if (!InMempool()) return false;\n \n     // Trusted if all inputs are from us and are in the mempool:\n     for (const CTxIn& txin : tx->vin)\n     {\n         // Transactions not sent by us: not trusted\n         const CWalletTx* parent = pwallet->GetWalletTx(txin.prevout.hash);\n-        if (parent == nullptr)\n-            return false;\n+        if (parent == nullptr) return false;\n         const CTxOut& parentOut = parent->tx->vout[txin.prevout.n];\n-        if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE)\n-            return false;\n+        // Check that this specific input being spent is trusted\n+        if (pwallet->IsMine(parentOut) != ISMINE_SPENDABLE) return false;\n+        // If we've already trusted this parent, continue\n+        if (trusted_parents.count(parent->GetHash())) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324414041",
      "id" : 324414041,
      "in_reply_to_id" : 324156875,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDQxNDA0MQ==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 47,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 288309378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324414041",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324414084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324414084"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right, but we already don't recurse on trusted parents right?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-14T06:18:01Z",
      "diff_hunk" : "@@ -2295,33 +2295,38 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const\n {\n     // Quick answer in most cases\n-    if (!locked_chain.checkFinalTx(*tx)) {\n-        return false;\n-    }\n+    if (!locked_chain.checkFinalTx(*tx)) return false;\n     int nDepth = GetDepthInMainChain(locked_chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324414084",
      "id" : 324414084,
      "in_reply_to_id" : 324154009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDQxNDA4NA==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : 16,
      "pull_request_review_id" : 288309430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324414084",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324414154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324414154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doh!",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-14T06:21:05Z",
      "diff_hunk" : "@@ -2295,33 +2295,38 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;\n+    return IsTrusted(locked_chain, s);\n+}\n+\n+bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const\n {\n     // Quick answer in most cases\n-    if (!locked_chain.checkFinalTx(*tx)) {\n-        return false;\n-    }\n+    if (!locked_chain.checkFinalTx(*tx)) return false;\n     int nDepth = GetDepthInMainChain(locked_chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r324414154",
      "id" : 324414154,
      "in_reply_to_id" : 324154009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDQxNDE1NA==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : 16,
      "pull_request_review_id" : 288309518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324414154",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r326309913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326309913"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually I'd rather just get rid of the other function as usually you'd want to share the cache across IsTrusted calls...\r\n\r\nSlightly more agressive change but maybe it's ok",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-09-19T18:02:04Z",
      "diff_hunk" : "@@ -576,6 +576,7 @@ class CWalletTx\n \n     bool InMempool() const;\n     bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r326309913",
      "id" : 326309913,
      "in_reply_to_id" : 324154718,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNjMwOTkxMw==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 290745289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326309913",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think the new behavior is correct; we shouldn't be treating those funds as confirmed. If you want to rely on that specific UTXO existing which has given you that balance, you cannot, as a third party spending the other input would destroy that unconfirmed.\r\n\r\nBut your balance isn't specific UTXOs. Users don't care about UTXOs, just total bitcoins.\r\n\r\n30 BTC should show as confirmed and trusted...",
      "created_at" : "2019-09-20T21:41:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-533717925",
      "id" : 533717925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMzcxNzkyNQ==",
      "updated_at" : "2019-09-20T21:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533717925",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Then it's a mistake to compute balance from summing IsTrusted, but we shouldn't rely on broken IsTrusted behavior to compute Balance.\r\n\r\nBear in mind for the specific situation you're thinking of, there are also edge cases where we over report correct balance. ",
      "created_at" : "2019-09-21T08:16:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-533778856",
      "id" : 533778856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMzc3ODg1Ng==",
      "updated_at" : "2019-09-21T08:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533778856",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Otherwise, it's possible that a parent is not IsTrusted but a child is.\r\n\r\nWas the test you changed a good example of how this can happen or did you have other examples in mind? Would it be worth to have an explicit test for that?",
      "created_at" : "2019-10-01T08:40:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-536933191",
      "id" : 536933191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNjkzMzE5MQ==",
      "updated_at" : "2019-10-01T08:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/536933191",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r329941238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/329941238"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I would prefer to keep using the old interface here and in 2488, 3784 until the `trusted_parents` are actually used/shared.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-01T08:43:50Z",
      "diff_hunk" : "@@ -2407,10 +2412,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trusted_parents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trusted_parents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r329941238",
      "id" : 329941238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyOTk0MTIzOA==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 63,
      "path" : "src/wallet/wallet.cpp",
      "position" : 63,
      "pull_request_review_id" : 295449381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/329941238",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330124848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330124848"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What do you mean by \"actually used/shared\"?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-01T15:30:22Z",
      "diff_hunk" : "@@ -2407,10 +2412,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trusted_parents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trusted_parents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330124848",
      "id" : 330124848,
      "in_reply_to_id" : 329941238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMDEyNDg0OA==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 63,
      "path" : "src/wallet/wallet.cpp",
      "position" : 63,
      "pull_request_review_id" : 295695132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330124848",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330131687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330131687"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I mean for now, you could leave this line unchanged since `trusted_parents` is not used outside of `IsTrusted`. I know you eventually want to share the parents for optimization but I would not change this line until that is the case.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-01T15:42:54Z",
      "diff_hunk" : "@@ -2407,10 +2412,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trusted_parents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trusted_parents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330131687",
      "id" : 330131687,
      "in_reply_to_id" : 329941238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMDEzMTY4Nw==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 63,
      "path" : "src/wallet/wallet.cpp",
      "position" : 63,
      "pull_request_review_id" : 295704005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330131687",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330147652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330147652"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure what the \"eventually\" or \"actually\" part is... this is what is done by the code already. Note that trusted_parents lives outside the for loop so is shared across calls.\r\n\r\nAnd it's less so optimization and more so anti-DoS.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-01T16:15:31Z",
      "diff_hunk" : "@@ -2407,10 +2412,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trusted_parents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trusted_parents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330147652",
      "id" : 330147652,
      "in_reply_to_id" : 329941238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMDE0NzY1Mg==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 63,
      "path" : "src/wallet/wallet.cpp",
      "position" : 63,
      "pull_request_review_id" : 295725082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330147652",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330157090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330157090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see, I misunderstood at which level the caching is happening, thanks!",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-01T16:36:46Z",
      "diff_hunk" : "@@ -2407,10 +2412,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trusted_parents;\n         for (const auto& entry : mapWallet)\n         {\n             const CWalletTx& wtx = entry.second;\n-            const bool is_trusted{wtx.IsTrusted(*locked_chain)};\n+            const bool is_trusted{wtx.IsTrusted(*locked_chain, trusted_parents)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r330157090",
      "id" : 330157090,
      "in_reply_to_id" : 329941238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMDE1NzA5MA==",
      "original_commit_id" : "58cb227cc07f7f00ce91ec2fa903c343769f5524",
      "original_position" : 63,
      "path" : "src/wallet/wallet.cpp",
      "position" : 63,
      "pull_request_review_id" : 295737428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/330157090",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r337184938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337184938"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Update wallet_balance.py test to reflect new behavior\" (bee1dc9f8a5182f03979fa066dc7937fc945bf29)\r\n\r\nYou also have a really nice description of the test setup in https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-527563982 that could be nice to incorporate as a comment or link in the `test_balances` function.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-21T18:56:50Z",
      "diff_hunk" : "@@ -112,10 +112,10 @@ def run_test(self):\n         def test_balances(*, fee_node_1=0):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r337184938",
      "id" : 337184938,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzE4NDkzOA==",
      "original_commit_id" : "bee1dc9f8a5182f03979fa066dc7937fc945bf29",
      "original_position" : 1,
      "path" : "test/functional/wallet_balance.py",
      "position" : 42,
      "pull_request_review_id" : 304779049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-21T20:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337184938",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hi @ryanofsky, thanks for the review!\r\n\r\nThis is a change that came up as a bug-fix esque change while working on OP_SECURETHEBAG. You can see the branch where this change is important here: https://github.com/bitcoin/bitcoin/compare/master...JeremyRubin:stb-with-rpc?expand=1. Essentially, without this change, we can be tricked into accepting an OP_SECURETHEBAG output because we don't properly check the parents.\r\n\r\nAs this was a change which, on its own, was not dependent on OP_SECURETHEBAG, I broke it out as I felt the change stands on its own.\r\n\r\nI'll add to the release notes and to the tests comments.",
      "created_at" : "2019-10-21T20:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-544687097",
      "id" : 544687097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NDY4NzA5Nw==",
      "updated_at" : "2019-10-21T20:11:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/544687097",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I had to rebase to clear out the release notes; code hasn't changed except the comment in wallet_balances.py. I have also updated the PR message.\r\n\r\nre-ack when you have a moment @ryanofsky!",
      "created_at" : "2019-10-21T20:51:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-544702465",
      "id" : 544702465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NDcwMjQ2NQ==",
      "updated_at" : "2019-10-21T20:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/544702465",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338789552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338789552"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm I don't know about the need of DoS protection, can't we rely on mempool DEFAULT_ANCESTOR_LIMIT there ? A transaction to be trusted has to be in-mempool (among other standards), so their unconfirmed parent too, at first parent hit which is not we should return. What's th worst complexity for a graph of 25 parents?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T21:00:42Z",
      "diff_hunk" : "@@ -2294,6 +2294,12 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338789552",
      "id" : 338789552,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc4OTU1Mg==",
      "original_commit_id" : "595f09d6de7f1b94428cdd1310777aa6a4c584e5",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 306861509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T21:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338789552",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338790225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338790225"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you go with DoS protection, can't you go further and reuse the cached set of trusted parents between WalletTxToJSON call in `listtransactions` and `listsinceblock`, they are all after chain locks so shouldn't be an issue ?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T21:02:23Z",
      "diff_hunk" : "@@ -2420,10 +2420,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trustedParents;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338790225",
      "id" : 338790225,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc5MDIyNQ==",
      "original_commit_id" : "5dd7da4ccd1354f09e2d00bab29288db0d5665d0",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306861509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T21:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338790225",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338792196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338792196"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: maybe precise how the trust computation has been changed \"to evaluate trustiness of outpoint spent by parent and so recursively\"",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T21:07:23Z",
      "diff_hunk" : "@@ -85,6 +85,7 @@ Wallet\n ------\n \n - The wallet now by default uses bech32 addresses when using RPC, and creates native segwit change outputs.\n+- The way that output trust was computed has been fixed in #16766, which impacts confirmed/unconfirmed balance status and coin selection.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338792196",
      "id" : 338792196,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc5MjE5Ng==",
      "original_commit_id" : "91f3073f08aff395dd813296bf99fd8ccc81bb27",
      "original_position" : 4,
      "path" : "doc/release-notes.md",
      "position" : 4,
      "pull_request_review_id" : 306861509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T21:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338792196",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338831279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338831279"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Even so, you can imagine a case where we have a single input single output chain of 25 taking:\r\n\r\nsum n = 0 to N n = n * (n-1) /2 = O(N^2).\r\n\r\nWhich for 25 = 625 iterations.\r\n\r\nImagine what this would be for a tree with no descendants limit!\r\n\r\n\r\nThe caching guarantees that it is O(N*log(N)) worst case (could be improved possibly by switching to unordered_set... but it's worth benchmarking since we will usually have a very small set)",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T23:19:27Z",
      "diff_hunk" : "@@ -2294,6 +2294,12 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338831279",
      "id" : 338831279,
      "in_reply_to_id" : 338789552,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODgzMTI3OQ==",
      "original_commit_id" : "595f09d6de7f1b94428cdd1310777aa6a4c584e5",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 306914396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T23:19:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338831279",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338831601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338831601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Possibly, but because it's through the interfaced call I didn't want to scope creep to include that. But it's maybe worth a follow up PR?",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T23:20:54Z",
      "diff_hunk" : "@@ -2420,10 +2420,11 @@ CWallet::Balance CWallet::GetBalance(const int min_depth, bool avoid_reuse) cons\n     {\n         auto locked_chain = chain().lock();\n         LOCK(cs_wallet);\n+        std::set<uint256> trustedParents;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338831601",
      "id" : 338831601,
      "in_reply_to_id" : 338790225,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODgzMTYwMQ==",
      "original_commit_id" : "5dd7da4ccd1354f09e2d00bab29288db0d5665d0",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306914773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T23:20:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338831601",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338831988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338831988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure what level of detail is best for the release note; will leave up to maintainer discretion. Since it can be nuanced, if someone is relying on this it's best that they read the PR.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T23:22:41Z",
      "diff_hunk" : "@@ -85,6 +85,7 @@ Wallet\n ------\n \n - The wallet now by default uses bech32 addresses when using RPC, and creates native segwit change outputs.\n+- The way that output trust was computed has been fixed in #16766, which impacts confirmed/unconfirmed balance status and coin selection.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338831988",
      "id" : 338831988,
      "in_reply_to_id" : 338792196,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODgzMTk4OA==",
      "original_commit_id" : "91f3073f08aff395dd813296bf99fd8ccc81bb27",
      "original_position" : 4,
      "path" : "doc/release-notes.md",
      "position" : 4,
      "pull_request_review_id" : 306915268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T23:22:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338831988",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338832764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338832764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe the worst case is O(a^n), where a is the number of inputs/output per transaction, and n is the ancestor limit. Simply build a tx graph where every transaction spends a outputs of the previous layer, in a different inputs.",
      "commit_id" : "4671fc3d9e669da8b8781f0cbefee43cb9acd527",
      "created_at" : "2019-10-24T23:26:28Z",
      "diff_hunk" : "@@ -2294,6 +2294,12 @@ bool CWalletTx::InMempool() const\n }\n \n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n+{\n+    std::set<uint256> s;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r338832764",
      "id" : 338832764,
      "in_reply_to_id" : 338789552,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODgzMjc2NA==",
      "original_commit_id" : "595f09d6de7f1b94428cdd1310777aa6a4c584e5",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 306916260,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-10-24T23:26:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338832764",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code Review ACK 4671fc3, maybe extend DoS protection in a follow-up PR.",
      "created_at" : "2019-10-25T17:17:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-546437942",
      "id" : 546437942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NjQzNzk0Mg==",
      "updated_at" : "2019-10-25T17:17:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/546437942",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK 4671fc3d9e669da8b8781f0cbefee43cb9acd527\r\n\r\nThanks for adding the extended description in the test. Good idea @ryanofsky !",
      "created_at" : "2019-10-30T21:24:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-548118527",
      "id" : 548118527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODExODUyNw==",
      "updated_at" : "2019-10-30T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548118527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, this looks ready with 4 review ACKs",
      "created_at" : "2019-11-05T08:59:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-549727433",
      "id" : 549727433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTcyNzQzMw==",
      "updated_at" : "2019-11-05T08:59:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549727433",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   }
]
