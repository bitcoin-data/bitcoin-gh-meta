[
   {
      "author_association" : "MEMBER",
      "body" : "ACK 9a2eee9082084dee5bf4478d8a6197184b221e3f.\r\n\r\nThe suggestion in https://github.com/bitcoin/bitcoin/issues/16886#issuecomment-533666500 makes sense but it requires a slightly larger refactor but maybe worth the effort?",
      "created_at" : "2019-09-22T09:52:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-533866357",
      "id" : 533866357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMzg2NjM1Nw==",
      "updated_at" : "2019-09-22T09:53:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533866357",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag: Thanks for the review! The suggestion by alexzk1 to make the method private and handle the empty/full flag only internally seemed good to me at first as well, but where would be appropriate places to trigger the update? As you noted, `insert()` is not an option since it is called in a loop.",
      "created_at" : "2019-09-22T18:22:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-533905527",
      "id" : 533905527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMzkwNTUyNw==",
      "updated_at" : "2019-09-22T18:22:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533905527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> (slight performance improvement)\r\n\r\nWhen claiming performance improvements, please provide a benchmark.",
      "created_at" : "2019-09-30T11:07:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-536514142",
      "id" : 536514142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNjUxNDE0Mg==",
      "updated_at" : "2019-09-30T11:07:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/536514142",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > (slight performance improvement)\r\n> \r\n> When claiming performance improvements, please provide a benchmark.\r\n\r\nOkay, will try to craft a benchmark for this within the next days.",
      "created_at" : "2019-10-06T08:15:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-538722518",
      "id" : 538722518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzODcyMjUxOA==",
      "updated_at" : "2019-10-06T08:15:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/538722518",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> \r\n> \r\n> > (slight performance improvement)\r\n> \r\n> When claiming performance improvements, please provide a benchmark.\r\n\r\nThe following benchmarks (https://github.com/theStack/bitcoin/commit/3da6aac15a91932c8d1a644e9fdf85e043e9f8ef -- not part of this PR, for convenience added to rollingbloom.cpp rather than creating a new file bloom.cpp) show how the operations to insert (method `.insert()`) and check for (method `.contains()`) elements perform for full bloom filters, once without and once with calling `.UpdateEmpyFull()` before:\r\n\r\n```\r\n$ src/bench/bench_bitcoin \"-filter=BloomFull.*\"\r\n# Benchmark, evals, iterations, total, min, max, median\r\nBloomFull_Regular_Contains, 5, 21000000, 11.1822, 1.03667e-07, 1.08973e-07, 1.06582e-07\r\nBloomFull_Regular_Insert, 5, 21000000, 11.3052, 1.05405e-07, 1.1052e-07, 1.06237e-07\r\nBloomFull_UpdateEmptyFull_Contains, 5, 21000000, 0.478308, 3.78305e-09, 5.22676e-09, 4.73157e-09\r\nBloomFull_UpdateEmptyFull_Insert, 5, 21000000, 0.386489, 3.41868e-09, 3.93211e-09, 3.71036e-09\r\n```\r\n\r\n\r\nMy wording was sloppy -- the performance improvement (or in this case, CPU waste minimizing) is actually not 'slight', but significant (20-30x), but it only applies for full filters, which is not a regular case. \r\n\r\nNote that the optimization itself is not new, it was added by gmaxwell with commit https://github.com/bitcoin/bitcoin/commit/37c6389c5a0ca63ae3573440ecdfe95d28ad8f07 (\"Performance optimization for bloom filters.\"). The point is that it was only called on receiving the `filterload` message, but not after receiving the `filteradd` message, which is fixed with this PR.",
      "created_at" : "2019-10-10T11:39:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-540531069",
      "id" : 540531069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDUzMTA2OQ==",
      "updated_at" : "2019-10-10T11:44:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540531069",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell Would you like to comment here?",
      "created_at" : "2020-01-05T03:17:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-570845213",
      "id" : 570845213,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MDg0NTIxMw==",
      "updated_at" : "2020-01-05T03:17:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570845213",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm confused why I was asked to review this as I haven't touched this code.",
      "created_at" : "2020-02-05T19:28:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-582571574",
      "id" : 582571574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjU3MTU3NA==",
      "updated_at" : "2020-02-05T19:28:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582571574",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm confused why I was asked to review this as I haven't touched this code.\r\n\r\nFor some reason you were in the list of suggested reviewers (don't know on what criteria github decides this). Feel free to ignore. ",
      "created_at" : "2020-02-05T21:54:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-582631231",
      "id" : 582631231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjYzMTIzMQ==",
      "updated_at" : "2020-02-05T21:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582631231",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "At the time of opening this PR I assumed that the reason for the introduction of the `CBloomFilter` empty/full flag was optimization, as stated in the commit message, but in fact it was a covert fix for [CVE-2013-5700](https://en.bitcoin.it/wiki/Common_Vulnerabilities_and_Exposures#CVE-2013-5700) (see gmaxwells comment about commit https://github.com/bitcoin/bitcoin/commit/37c6389c5a0ca63ae3573440ecdfe95d28ad8f07: https://github.com/bitcoin/bitcoin/issues/18483#issuecomment-608224095). Hence this PR is closed now.",
      "created_at" : "2020-04-15T18:36:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16922#issuecomment-614208643",
      "id" : 614208643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16922",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNDIwODY0Mw==",
      "updated_at" : "2020-04-15T18:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614208643",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   }
]
