[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r169968749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169968749"
         }
      },
      "author_association" : "OWNER",
      "body" : "Add `static`?",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-02-22T14:22:39Z",
      "diff_hunk" : "@@ -71,14 +71,41 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+constexpr int PermissibleMaxOpenFiles() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r169968749",
      "id" : 169968749,
      "original_commit_id" : "c1b39470cdba75f3359b12e5a47eb5af0de07615",
      "original_position" : 4,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 98580714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169968749",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r169970767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169970767"
         }
      },
      "author_association" : "OWNER",
      "body" : "I don't think this does what you expect it to. As I understand it, confirmed by the [gcc page](https://www.gnu.org/software/libc/manual/html_node/Feature-Test-Macros.html) about it, `_POSIX_C_SOURCE` is supposed to be defined explicitly at the top of the compilation unit to request certain POSIX C library features. It is not defined by the compiler. So it can't be used to detect whether the platform compiled to is POSIX.\r\n\r\nIn other place, we've just used `#if[n]def WIN32` as WIN32 is the only non-POSIX platform supported in this project.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-02-22T14:27:17Z",
      "diff_hunk" : "@@ -71,14 +71,41 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+constexpr int PermissibleMaxOpenFiles() {\n+#ifdef _POSIX_C_SOURCE",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r169970767",
      "id" : 169970767,
      "original_commit_id" : "c1b39470cdba75f3359b12e5a47eb5af0de07615",
      "original_position" : 5,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 98580714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169970767",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I measured the impact of this change, you can see a graph here: https://monad.io/max_open_files.png\r\n\r\nMethod for creating this graph:\r\n * Ran `bitcoind -reindex-chainstate` on a full node that had already been synced on mainnet\r\n * Instance is a GCP n1-standard-1 host which has one vCPU pinned to host CPU, 4 GB of RAM, and very slow virtualized disks",
      "created_at" : "2018-02-22T14:41:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-367701278",
      "id" : 367701278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-02-22T14:41:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367701278",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> I measured the impact of this change, you can see a graph here: https://monad.io/max_open_files.png\r\n\r\nNice!",
      "created_at" : "2018-02-22T14:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-367704702",
      "id" : 367704702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-02-22T14:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367704702",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r170069914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170069914"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're absolutely right, I will fix this.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-02-22T19:37:16Z",
      "diff_hunk" : "@@ -71,14 +71,41 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+constexpr int PermissibleMaxOpenFiles() {\n+#ifdef _POSIX_C_SOURCE",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r170069914",
      "id" : 170069914,
      "in_reply_to_id" : 169970767,
      "original_commit_id" : "c1b39470cdba75f3359b12e5a47eb5af0de07615",
      "original_position" : 5,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 98699976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170069914",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r170083156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170083156"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `static` specifier isn't necessary because `constexpr` functions are evaluated at compile time. I double checked that `nm ./src/bitcoind | c++filt | grep Permissible` produces no output.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-02-22T20:26:59Z",
      "diff_hunk" : "@@ -71,14 +71,41 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+constexpr int PermissibleMaxOpenFiles() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r170083156",
      "id" : 170083156,
      "in_reply_to_id" : 169968749,
      "original_commit_id" : "c1b39470cdba75f3359b12e5a47eb5af0de07615",
      "original_position" : 4,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 98715776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170083156",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The reason for this speedup isn't super obvious, and I think merits some explanation. I've spent a lot of time the last three days reading the LevelDB source code and think I understand now. It actually has nothing to do with reducing the number of open/close/mmap/munmap syscalls, as I had originally thought.\r\n\r\nThe LevelDB terminology for a `.ldb` file is a \"table\", and the tables are composed of 4 KB blocks. Each table contains a block index, which is an index that can be used to determine which block a given key will be in. The block index for a given table file is loaded into memory when that table is opened.\r\n\r\nIncreasing the `max_open_files` here forces Bitcoin to keep much more of the block index data actually loaded into memory. I think it might be worth actually increasing the internal limits of LevelDB on the number of mmap files beyond 1000 on 64-bit Unix platforms, as that would result in the entire block index being loaded into memory. However I think we should start with this, and then consider increasing the limits once I've done more investigation into what the overhead is.",
      "created_at" : "2018-02-22T20:40:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-367815005",
      "id" : 367815005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-02-22T20:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367815005",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@eklitzke Cheers for referencing #12123 . Replying here to get subscribed.\r\n\r\nI am going to do more tests on a Windows machine at the weekend with your changes here and report back my results.\r\n\r\nI am pretty familiar with Windows internals so I'll do further investigations to see if we can have similar changes on Windows.",
      "created_at" : "2018-02-22T22:00:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-367837075",
      "id" : 367837075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-02-22T22:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367837075",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I had a closer look at Windows and the way we use the win32 apis in LevelDB.\r\n\r\nObservations:\r\n\r\n1. Win32RandomAccessFile does not use memory mapped files.\r\n2. The file opening and reading is done on the Win32 API level: CreateFile, ReadFile. There is no limit to the number of files that can be opened at this level (Use Window's HANDLES rather than FDs). Limits are at the C runtime library level but this is irrelevant.\r\n\r\nI am confident that this increase to 1000 files will not affect Windows. I have already tested this but will do more tests tomorrow.\r\n\r\nThe Win32RandomAccessFile is as basic as it gets. Further optimizations can be made in this by using Memory Mapped files (Similar to the POSIX versions). The random access nature of accesses should be a win for Memory Mapped files over regular file read operations due to the kernel level caching.\r\nI will modify this and see if any significant performance improvements are achieved. I reckon it will.\r\n\r\nAs I've mentioned in #12123, we achieve optimization at CPU level also by avoiding the CRC checksum check that's performed on each file open.\r\n\r\n@eklitzke I hope you don't mind me replying on here. I'll continue to do more tests on the Windows sides of things. Any improvement to the IBD is a big win!\r\n\r\nCheers,\r\nDonal",
      "created_at" : "2018-02-24T19:23:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-368252740",
      "id" : 368252740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-02-24T19:23:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/368252740",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have a branch that measures how much extra memory this uses. On my node, the average block index size is 19797 bytes for the chainstate database. The bloom filters (which are also loaded in memory) are 6 bytes or 7 bytes depending on the file. Thus a reasonable approximation is 20 KB of data per chainstate `.ldb` file. This means on master the indexes use about 1 MB of memory, and with this branch they'll use about 20 MB of memory. If we loaded *all* of the indexes into memory (not possible right now due to the hard-coded 1000 file limit, but possible if we patched leveldb) that would be about 33 MB of memory.",
      "created_at" : "2018-02-26T22:44:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-368678039",
      "id" : 368678039,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-02-26T22:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/368678039",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I ran bitcoind -reindex-chainstate on my Windows 10 PC with the full node synced.\r\n\r\nFirst I ran using the default: `max_open_files=64` (Blue series)\r\nNext I ran using `max_open_files=1000` (Red series).\r\n\r\nThe results show a substantial difference in sync time.\r\n\r\n![image](https://user-images.githubusercontent.com/6394033/36870837-37cffa7c-1d98-11e8-84fa-507a290a89bb.png)\r\n\r\nTime to reach 100% with `max_open_files=64` was: 12h 15m\r\nTime to reach 100% with `max_open_files=1000` was: 5h 40m\r\n\r\nThat's an over 50% reduction in the time to reindex. I didn't expect such an improvement.\r\n\r\n\r\n",
      "created_at" : "2018-03-01T21:38:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-369739699",
      "id" : 369739699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-01T21:38:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369739699",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "That's a pretty big speedup! Does this only work on 64 bit systems? Would it be possible to do it for all systems?",
      "created_at" : "2018-03-01T22:10:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-369748527",
      "id" : 369748527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-01T22:10:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369748527",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "At least for POSIX systems, the issue is that LevelDB won't use `mmap()` on 32-bit systems because the virtual memory space isn't large enough. The chainstate database is larger than 4 GB. On such hosts, each open file handle really does use up a file descriptor, which can obviously lead to problems in a `select(2)` loop if the fd count exceeds 1024. I haven't posted this data yet, but I also have data showing a large speedup on POSIX hosts that have intermediate disk characteristics to what I posted earlier. That said: I really cannot imagine many users are running Bitcoin on 32-bit hosts, and it's easy enough to have conditional logic in that case anyway.\r\n\r\nI've been working on other LevelDB improvements that will result in even more significant improvements than what I've posted here, but they're more invasive changes. So I'm interested in getting this change (or a variant of it) merged before I try to go deeper into the UTXO system.\r\n\r\n@donaloconnor Can you comment on whether `select()` loops have the same 1024 fd limit on Windows?",
      "created_at" : "2018-03-02T05:03:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-369821550",
      "id" : 369821550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-02T05:04:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369821550",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Windows by default has a limit of 64 descriptors in `select()`, but:\r\n\r\n1. This is a limit on the number of descriptors added to the fd_set, not a limit on total descriptors in the process.\r\n2. We override `FD_SETSIZE` to 1024 in compat.h.\r\n\r\n(POSIX is supposed to allow changing `FD_SETSIZE` too, but this is broken in some versions of glibc)",
      "created_at" : "2018-03-02T05:11:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-369822424",
      "id" : 369822424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-02T05:11:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369822424",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Does this only work on 64 bit systems\r\n\r\nThe LevelDB's Win32 code does not use memory mapped files (Unlike the POSIX version) so this change should improve both 32/64bit versions of Windows. \r\n\r\n>@donaloconnor Can you comment on whether select() loops have the same 1024 fd limit on Windows?\r\n\r\nWhat @luke-jr said above ^. Again since the LevelDB code for Win32 is using the Win32 ReadFile/CreateFile APIs, it should not affect any POSIX functions/fd descriptors.\r\n\r\nI'm running with a limit of 64 open files again to see if I get similar results (12hour sync time). I'd be really happy if someone else can also test this on Windows. I am finding it hard to believe the 2x speed up but it does seem to be the case.\r\n",
      "created_at" : "2018-03-02T12:04:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-369903951",
      "id" : 369903951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-02T12:05:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369903951",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting stats from observing Disk I/O reported by Task Manager:\r\n\r\n`max_open_files=64` - seems to hover around 2 - 6 MB/s with bursts of 40MB/s +\r\n`max_open_files=1000` - Seemed to be consistently above 60 MB/s when ever I looked at it\r\n\r\nThis backs up the theory that since the files remain open, the file cache on Windows remains warm.\r\n\r\n*Not scientific, just observations. Can do some real disk I/O profiling later.",
      "created_at" : "2018-03-02T12:18:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-369906511",
      "id" : 369906511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-02T12:18:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369906511",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it's related to the disk cache, it's due to the increased availability of the deserialized buffer indexes (and bloom filters) in memory. At least on Unix, files being open is unrelated to the availability of their contents in the page cache. In my measurements it takes four disk seeks just to open each .ldb file (which is related to parsing out the file header, bloom filter, and the block index), and the information is stored on disk in a compressed form that has to be deserialized. But once the file is open and in the table cache all that data is right there, ready to be accessed. I started writing up a blog post about this with details about how the table format works, how the LevelDB caches interact, and what's involved during key lookup. I'll try to finish that up in case people want to learn more about the details.\r\n\r\nI'll update this PR to also increase the limit on Windows. I am interested in hearing if people would like to see any other changes. For instance, in IRC Greg asked if there's a way to tell from the LevelDB API if there's a way to find out for a given platform if the implementation is going to use up real file descriptors or not. There isn't, but I could patch LevelDB to expose that if that's something reviewers want to see.\r\n\r\n",
      "created_at" : "2018-03-03T17:47:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370166267",
      "id" : 370166267,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T17:47:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370166267",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I'm also now inclined to believe that it's probably unrelated to disk cache. Actually I've seen higher utilization of CPU in the 1000 limit case (mine was about 60-80% CPU usage, where as with the 64 limit it was just 30% mostly.\r\n\r\nAnyway, I just finished the tests again a few minutes ago:\r\n\r\n`max_open_files=64`  -reindex-chainstate time: **13h 30m**\r\n`max_open_files=1000` -reindex-chainstate time: **6h 30m**\r\n\r\nAnother 2x improvement.\r\n\r\n> I started writing up a blog post about this with details about how the table format works, how the LevelDB caches interact, and what's involved during key lookup. I'll try to finish that up in case people want to learn more about the details.\r\n\r\nLooking forward to it Ã°ÂÂÂ ",
      "created_at" : "2018-03-03T18:07:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370167628",
      "id" : 370167628,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T18:12:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370167628",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you let me know if the comment looks correct regarding Windows behavior?",
      "created_at" : "2018-03-03T18:27:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370168999",
      "id" : 370168999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T18:27:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370168999",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025190"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "max_open_files is not set explicitly before calling SetMaxOpenFiles. Probably should be set in SetMaxOpenFiles explicitly to 1000 before the #ifndef ",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-03T18:53:34Z",
      "diff_hunk" : "@@ -71,20 +71,40 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+static void SetMaxOpenFiles(leveldb::Options *options) {\n+    // On most platforms the default setting of max_open_files (which is 1000)\n+    // is optimal. On Windows using a large file count is OK because the handles\n+    // do not interfere with select() loops. On 64-bit Unix hosts this value is\n+    // also OK, because up to that amount LevelDB will use an mmap\n+    // implementation that does not use extra file descriptors (the fds are\n+    // closed after being mmaped).\n+    //\n+    // Increasing the value beyond the default is dangerous because LevelDB will\n+    // fall back to a non-mmap implementation when the file count is too large.\n+    // On 32-bit Unix host we should decrease the value because the handles use\n+    // up real fds, and we want to avoid fd exhaustion issues.\n+    //\n+    // See PR #12495 for further discussion.\n+#ifndef WIN32\n+    if (sizeof(void*) < 8)\n+        options->max_open_files = 64;\n+#endif\n+}\n+\n static leveldb::Options GetOptions(size_t nCacheSize)\n {\n     leveldb::Options options;\n     options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n     options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n     options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n     options.compression = leveldb::kNoCompression;\n-    options.max_open_files = 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025190",
      "id" : 172025190,
      "original_commit_id" : "08b132ce7a22d66452d2153375c962a87c50dd93",
      "original_position" : 31,
      "path" : "src/dbwrapper.cpp",
      "position" : 36,
      "pull_request_review_id" : 100983397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025190",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025197"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Prefer, to be safe:\r\n\r\n```C++\r\nif (sizeof(void*) < 8 || leveldb::kMajorVersion != 1 || leveldb::kMinorVersion < 3 || leveldb::kMinorVersion > 20) {\r\n    options->max_open_files = 64;\r\n}\r\n```",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-03T18:53:50Z",
      "diff_hunk" : "@@ -71,20 +71,40 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+static void SetMaxOpenFiles(leveldb::Options *options) {\n+    // On most platforms the default setting of max_open_files (which is 1000)\n+    // is optimal. On Windows using a large file count is OK because the handles\n+    // do not interfere with select() loops. On 64-bit Unix hosts this value is\n+    // also OK, because up to that amount LevelDB will use an mmap\n+    // implementation that does not use extra file descriptors (the fds are\n+    // closed after being mmaped).\n+    //\n+    // Increasing the value beyond the default is dangerous because LevelDB will\n+    // fall back to a non-mmap implementation when the file count is too large.\n+    // On 32-bit Unix host we should decrease the value because the handles use\n+    // up real fds, and we want to avoid fd exhaustion issues.\n+    //\n+    // See PR #12495 for further discussion.\n+#ifndef WIN32\n+    if (sizeof(void*) < 8)\n+        options->max_open_files = 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025197",
      "id" : 172025197,
      "original_commit_id" : "08b132ce7a22d66452d2153375c962a87c50dd93",
      "original_position" : 20,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 100983400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025197",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can you let me know if the comment looks correct regarding Windows behavior?\r\n\r\nComment LGTM!",
      "created_at" : "2018-03-03T18:55:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370170999",
      "id" : 370170999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T18:55:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370170999",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The constructor for `leveldb::Options` sets it to 1000.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-03T18:59:45Z",
      "diff_hunk" : "@@ -71,20 +71,40 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+static void SetMaxOpenFiles(leveldb::Options *options) {\n+    // On most platforms the default setting of max_open_files (which is 1000)\n+    // is optimal. On Windows using a large file count is OK because the handles\n+    // do not interfere with select() loops. On 64-bit Unix hosts this value is\n+    // also OK, because up to that amount LevelDB will use an mmap\n+    // implementation that does not use extra file descriptors (the fds are\n+    // closed after being mmaped).\n+    //\n+    // Increasing the value beyond the default is dangerous because LevelDB will\n+    // fall back to a non-mmap implementation when the file count is too large.\n+    // On 32-bit Unix host we should decrease the value because the handles use\n+    // up real fds, and we want to avoid fd exhaustion issues.\n+    //\n+    // See PR #12495 for further discussion.\n+#ifndef WIN32\n+    if (sizeof(void*) < 8)\n+        options->max_open_files = 64;\n+#endif\n+}\n+\n static leveldb::Options GetOptions(size_t nCacheSize)\n {\n     leveldb::Options options;\n     options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n     options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n     options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n     options.compression = leveldb::kNoCompression;\n-    options.max_open_files = 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025351",
      "id" : 172025351,
      "in_reply_to_id" : 172025190,
      "original_commit_id" : "08b132ce7a22d66452d2153375c962a87c50dd93",
      "original_position" : 31,
      "path" : "src/dbwrapper.cpp",
      "position" : 36,
      "pull_request_review_id" : 100983548,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025351",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't scroll far another down :) - you're right.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-03T19:03:57Z",
      "diff_hunk" : "@@ -71,20 +71,40 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+static void SetMaxOpenFiles(leveldb::Options *options) {\n+    // On most platforms the default setting of max_open_files (which is 1000)\n+    // is optimal. On Windows using a large file count is OK because the handles\n+    // do not interfere with select() loops. On 64-bit Unix hosts this value is\n+    // also OK, because up to that amount LevelDB will use an mmap\n+    // implementation that does not use extra file descriptors (the fds are\n+    // closed after being mmaped).\n+    //\n+    // Increasing the value beyond the default is dangerous because LevelDB will\n+    // fall back to a non-mmap implementation when the file count is too large.\n+    // On 32-bit Unix host we should decrease the value because the handles use\n+    // up real fds, and we want to avoid fd exhaustion issues.\n+    //\n+    // See PR #12495 for further discussion.\n+#ifndef WIN32\n+    if (sizeof(void*) < 8)\n+        options->max_open_files = 64;\n+#endif\n+}\n+\n static leveldb::Options GetOptions(size_t nCacheSize)\n {\n     leveldb::Options options;\n     options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n     options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n     options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n     options.compression = leveldb::kNoCompression;\n-    options.max_open_files = 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172025474",
      "id" : 172025474,
      "in_reply_to_id" : 172025190,
      "original_commit_id" : "08b132ce7a22d66452d2153375c962a87c50dd93",
      "original_position" : 31,
      "path" : "src/dbwrapper.cpp",
      "position" : 36,
      "pull_request_review_id" : 100983658,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172025474",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Might be good to log somewhere which limit is being used...\r\n\r\n```C++\r\n#ifndef WIN32\r\n    if (sizeof(void*) < 8 || leveldb::kMajorVersion != 1 || leveldb::kMinorVersion < 3 || leveldb::kMinorVersion > 20) {\r\n        options->max_open_files = 64;\r\n        LogPrint(BCLog::LEVELDB, \"LevelDB max_open_files=%d\\n\", options->max_open_files);\r\n    } else {\r\n        LogPrint(BCLog::LEVELDB, \"LevelDB max_open_files=%d (default)\\n\", options->max_open_files);\r\n    }\r\n#endif\r\n```",
      "created_at" : "2018-03-03T19:10:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370172051",
      "id" : 370172051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T20:06:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370172051",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added the log statement. I also added a `static_assert()` on the exact LevelDB version. That way in the future if someone upgrades LevelDB, they will be forced to check that the POSIX `RandomAccessFile` implementation hasn't changed in a way that will cause fd exhaustion issues. What do you think of this approach?",
      "created_at" : "2018-03-03T20:39:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370178046",
      "id" : 370178046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T20:39:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370178046",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's a booby trap that everyone using system LevelDB libraries will need to patch out. But maybe a good idea anyway, to re-enforce the danger of using other versions. But it should probably at least tolerate older versions back to 1.3 (which added mmap support).",
      "created_at" : "2018-03-03T20:44:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370178384",
      "id" : 370178384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T20:44:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370178384",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Booby trap is intentional. I couldn't figure out how to make `git log -GkMinorVersion src/leveldb` work correctly with merge commits/subtrees, so I did this manually. From what I can tell the update history for LevelDB in the Bitcoin source tree is:\r\n\r\n * 2012-06-25 initial import of 1.5\r\n * 2012-12-12 upgrade to 1.7\r\n * 2013-08-24 upgrade to 1.13\r\n * 2013-12-12 upgrade to 1.15\r\n * 2014-05-09 upgrade to 1.17\r\n * 2014-10-16 upgrade to 1.18\r\n * 2016-12-01 upgrade to 1.19\r\n * 2017-06-08 upgrade to 1.20\r\n\r\nGiven that we only do the update once or twice a year I think it's reasonable to keep in there and leave it as a manual step for the person doing the upgrade. On the other hand, this might be overly paranoid because:\r\n * It's unlikely that upstream would stop using mmap, given that it's the obvious way to do things for speed reasons\r\n * Since the new logic is to use the default value in most cases, it seems unlikely that upstream would make a change that cause the default LevelDB options to use drastically different resources like fds",
      "created_at" : "2018-03-03T21:33:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370181582",
      "id" : 370181582,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T21:34:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370181582",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172029575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172029575"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will log twice!",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-03T21:41:15Z",
      "diff_hunk" : "@@ -71,20 +71,45 @@ class CBitcoinLevelDBLogger : public leveldb::Logger {\n     }\n };\n \n+static void SetMaxOpenFiles(leveldb::Options *options) {\n+    // On most platforms the default setting of max_open_files (which is 1000)\n+    // is optimal. On Windows using a large file count is OK because the handles\n+    // do not interfere with select() loops. On 64-bit Unix hosts this value is\n+    // also OK, because up to that amount LevelDB will use an mmap\n+    // implementation that does not use extra file descriptors (the fds are\n+    // closed after being mmaped).\n+    //\n+    // Increasing the value beyond the default is dangerous because LevelDB will\n+    // fall back to a non-mmap implementation when the file count is too large.\n+    // On 32-bit Unix host we should decrease the value because the handles use\n+    // up real fds, and we want to avoid fd exhaustion issues.\n+    //\n+    // See PR #12495 for further discussion.\n+    static_assert(leveldb::kMajorVersion == 1 && leveldb::kMinorVersion == 20,\n+                  \"Re-check SetMaxOpenFiles() when upgrading LevelDB\");\n+#ifndef WIN32\n+    if (sizeof(void*) < 8) {\n+        options->max_open_files = 64;\n+        LogPrint(BCLog::LEVELDB, \"LevelDB max_open_files=%d\\n\", options->max_open_files);\n+    }\n+#endif\n+    LogPrint(BCLog::LEVELDB, \"LevelDB max_open_files=%d (default)\\n\", options->max_open_files);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172029575",
      "id" : 172029575,
      "original_commit_id" : "a6f5abf623ce53fdf57d0030d8ad5ad6b35e4b03",
      "original_position" : 26,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 100987689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172029575",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Considering that LevelDB upgrades already need to be checked for consensus compatibility, I guess it doesn't make sense to be stricter on this regard.\r\n\r\nPerhaps a checklist for things to check on updates should be added to `doc/developer-notes.md` instead.",
      "created_at" : "2018-03-03T21:42:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370182136",
      "id" : 370182136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-03T21:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370182136",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```C++\r\n    const char *default_indicator = \" (default)\";\r\n#ifndef WIN32\r\n    if (sizeof(void*) < 8) {\r\n        options->max_open_files = 64;\r\n        default_indicator = \"\";\r\n    }\r\n#endif\r\n    LogPrint(BCLog::LEVELDB, \"LevelDB max_open_files=%d%s\\n\", options->max_open_files, default_indicator);\r\n```",
      "created_at" : "2018-03-03T21:46:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370182392",
      "id" : 370182392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-05T15:56:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370182392",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Using system leveldb is generally discouraged, because we have our own fork of leveldb and we only test with that one. I'd say if you really, really want to use that, patching out a boobytrap is the least of worries.\r\n\r\nGood idea to log the value, but yes it will get logged twice in some cases now.\r\n",
      "created_at" : "2018-03-05T15:12:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370450357",
      "id" : 370450357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-05T15:12:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370450357",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems a bit overly complicated imo. We could just log both values (set and default):\r\n\r\n```cpp\r\nint default_max = options->max_open_files;\r\n\r\n#ifndef WIN32\r\n    if (sizeof(void*) < 8) {\r\n        options->max_open_files = 64;\r\n    } else\r\n#endif\r\n\r\nLogPrint(BCLog::LEVELDB, \"LevelDB max_open_files=%d (Default=%d)\\n\", options->max_open_files, default_max);\r\n```\r\n\r\nAlso, I feel the static_asset seems a bit intrusive . As, eklitzke pointed out, it's unlikely use of mmap will be changed and we maintain our own fork of leveldb anyway. A note in doc/developer-notes.md would be sufficient.",
      "created_at" : "2018-03-05T16:32:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370478530",
      "id" : 370478530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-05T16:36:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370478530",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought about this more and I think that a note about LevelDB upgrades in `docs/developer-notes.md` is sufficient. I've added some notes to that file in this change. We do upgrades pretty rarely and it looks like in the past it's usually been sipa who has done it. I'm interested in long-term ownership of the LevelDB code (as I mentioned, I'm working on other LevelDB changes in some other branches), so there's a good chance I'll be the one upgrading LevelDB next time anyway.\r\n\r\nThere isn't currently a configure option to build Bitcoin with the system LevelDB, so I don't think we should be worried about people building with out-of-tree LevelDB versions.\r\n\r\nI've changed the log statement to log the current and default values, as @donaloconnor suggested.",
      "created_at" : "2018-03-05T17:35:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370499445",
      "id" : 370499445,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-05T17:35:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370499445",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172268867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172268867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please add mention of the need to check for consensus-incompatible changes.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-05T17:40:26Z",
      "diff_hunk" : "@@ -530,7 +530,11 @@ its upstream repository.\n Current subtrees include:\n \n - src/leveldb\n-  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but open important PRs to Core to avoid delay\n+  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but\n+    open important PRs to Core to avoid delay.\n+  - When updating the leveldb subtree with upstream changes, please sanity check\n+    file descriptor usage; see `SetMaxOpenFiles()` in `dbwrapper.cc` for more\n+    details.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172268867",
      "id" : 172268867,
      "original_commit_id" : "07c0010a512c7dd3be653c3b5b22916adf4f656c",
      "original_position" : 9,
      "path" : "doc/developer-notes.md",
      "position" : null,
      "pull_request_review_id" : 101257421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172268867",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172270437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172270437"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm familiar with the accidental fork that was introduced in 0.8 when LevelDB was first added, but what specifically would you like me to add here? That developers should test their change (e.g. on testnet) when updating LevelDB?",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-05T17:45:33Z",
      "diff_hunk" : "@@ -530,7 +530,11 @@ its upstream repository.\n Current subtrees include:\n \n - src/leveldb\n-  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but open important PRs to Core to avoid delay\n+  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but\n+    open important PRs to Core to avoid delay.\n+  - When updating the leveldb subtree with upstream changes, please sanity check\n+    file descriptor usage; see `SetMaxOpenFiles()` in `dbwrapper.cc` for more\n+    details.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172270437",
      "id" : 172270437,
      "in_reply_to_id" : 172268867,
      "original_commit_id" : "07c0010a512c7dd3be653c3b5b22916adf4f656c",
      "original_position" : 9,
      "path" : "doc/developer-notes.md",
      "position" : null,
      "pull_request_review_id" : 101259271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172270437",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172272657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172272657"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Testing is not sufficient. The LevelDB changes need to be reviewed for consensus-compatibility. For example, if there was a bug that caused a record with a particular CRC to not be returned later on, and LevelDB fixed this bug, we would need to reject the bugfix from Bitcoin since it would be a hardfork.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-05T17:53:45Z",
      "diff_hunk" : "@@ -530,7 +530,11 @@ its upstream repository.\n Current subtrees include:\n \n - src/leveldb\n-  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but open important PRs to Core to avoid delay\n+  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but\n+    open important PRs to Core to avoid delay.\n+  - When updating the leveldb subtree with upstream changes, please sanity check\n+    file descriptor usage; see `SetMaxOpenFiles()` in `dbwrapper.cc` for more\n+    details.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172272657",
      "id" : 172272657,
      "in_reply_to_id" : 172268867,
      "original_commit_id" : "07c0010a512c7dd3be653c3b5b22916adf4f656c",
      "original_position" : 9,
      "path" : "doc/developer-notes.md",
      "position" : null,
      "pull_request_review_id" : 101262007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172272657",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172287109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172287109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated here, and you can see the GH rendering at https://github.com/eklitzke/bitcoin/blob/ldb_max_open_files/doc/developer-notes.md",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-05T18:43:02Z",
      "diff_hunk" : "@@ -530,7 +530,11 @@ its upstream repository.\n Current subtrees include:\n \n - src/leveldb\n-  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but open important PRs to Core to avoid delay\n+  - Upstream at https://github.com/google/leveldb ; Maintained by Google, but\n+    open important PRs to Core to avoid delay.\n+  - When updating the leveldb subtree with upstream changes, please sanity check\n+    file descriptor usage; see `SetMaxOpenFiles()` in `dbwrapper.cc` for more\n+    details.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172287109",
      "id" : 172287109,
      "in_reply_to_id" : 172268867,
      "original_commit_id" : "07c0010a512c7dd3be653c3b5b22916adf4f656c",
      "original_position" : 9,
      "path" : "doc/developer-notes.md",
      "position" : null,
      "pull_request_review_id" : 101278774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-05T21:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172287109",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added this to the top level comment in this PR, but adding here for visibility.\r\n\r\nFlame graph I generated of `-reindex-chainstate`:\r\n * Without this change: https://monad.io/maxopenfiles-master.svg\r\n * With this change: https://monad.io/maxopenfiles-increase.svg\r\n\r\nNote especially the time spent in `leveldb::TableCache::Get` between the two implementations",
      "created_at" : "2018-03-05T21:31:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370573179",
      "id" : 370573179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-05T21:31:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370573179",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK",
      "created_at" : "2018-03-05T22:42:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-370594015",
      "id" : 370594015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-05T22:42:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370594015",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172402200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172402200"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Eh, that's not what I meant... In this example:\r\n\r\nYou set database key ABC to DEF; you then get database key ABC, but due to a bug in LevelDB, it answers that the key doesn't exist.\r\n\r\nIf you now fix this LevelDB bug, you have broken consensus because all the other nodes expect key ABC to be non-existent.",
      "commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "created_at" : "2018-03-06T03:46:03Z",
      "diff_hunk" : "@@ -549,6 +552,47 @@ Current subtrees include:\n - src/univalue\n   - Upstream at https://github.com/jgarzik/univalue ; report important PRs to Core to avoid delay.\n \n+Upgrading LevelDB\n+---------------------\n+\n+Extra care must be taken when upgrading LevelDB. This section explains issues\n+you must be aware of.\n+\n+### File Descriptor Counts\n+\n+In most configurations we use the default LevelDB value for `max_open_files`,\n+which is 1000 at the time of this writing. If LevelDB actually uses this many\n+file descriptors it will cause problems with Bitcoin's `select()` loop, because\n+it may cause new sockets to be created where the fd value is >= 1024. For this\n+reason, on 64-bit Unix systems we rely on an internal LevelDB optimization that\n+uses `mmap()` + `close()` to open table files without actually retaining\n+references to the table file descriptors. If you are upgrading LevelDB, you must\n+sanity check the changes to make sure that this assumption remains valid.\n+\n+In addition to reviewing the upstream changes in `env_posix.cc`, you can use `lsof` to\n+check this. For example, on Linux this command will show open `.ldb` file counts:\n+\n+```bash\n+$ lsof -p $(pidof bitcoind) |\\\n+    awk 'BEGIN { fd=0; mem=0; } /ldb$/ { if ($4 == \"mem\") mem++; else fd++ } END { printf \"mem = %s, fd = %s\\n\", mem, fd}'\n+mem = 119, fd = 0\n+```\n+\n+The `mem` value shows how many files are mmap'ed, and the `fd` value shows you\n+many file descriptors these files are using. You should check that `fd` is a\n+small number (usually 0 on 64-bit hosts).\n+\n+See the notes in the `SetMaxOpenFiles()` function in `dbwrapper.cc` for more\n+details.\n+\n+### Consensus Compatibility\n+\n+It's possible for LevelDB changes to inadvertently change consensus\n+compatibility between nodes. This happened in Bitcoin 0.8 (when LevelDB was\n+first introduced). Therefore when upgrading LevelDB you should review the\n+upstream changes to check for issues affecting consensus compatibility. For\n+example, an upstream change that affects CRC handling could affect consensus for\n+Bitcoin nodes with `.ldb` files that contain CRC errors.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#discussion_r172402200",
      "id" : 172402200,
      "original_commit_id" : "32372e90ff4c1e05214831bf750f8e3bad10bf67",
      "original_position" : 56,
      "path" : "doc/developer-notes.md",
      "position" : 56,
      "pull_request_review_id" : 101411028,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495",
      "updated_at" : "2018-03-06T03:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172402200",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 32372e9\r\n\r\nTested on Linux x86_64. Reduced initial sync time on an EC2 m5.xlarge from 8:31:01 to 6:36:25.",
      "created_at" : "2018-03-09T13:14:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-371808846",
      "id" : 371808846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-09T13:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371808846",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated and rebased to reword the consensus compatibility issue that @luke-jr noted.",
      "created_at" : "2018-03-09T18:54:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-371911477",
      "id" : 371911477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-09T18:54:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371911477",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Can we change the title to include windows. Just for future reference.",
      "created_at" : "2018-03-10T19:54:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-372060643",
      "id" : 372060643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-10T19:55:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372060643",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated the title for this PR, and rewrote the pull request description to reflect the discoveries/changes made since I opened the PR.",
      "created_at" : "2018-03-10T23:41:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-372076440",
      "id" : 372076440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-10T23:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372076440",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 21e2144a3159fdadd937388be10545dccd524d0f. Only change since last review is in developer notes.",
      "created_at" : "2018-03-12T22:18:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-372481480",
      "id" : 372481480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-12T22:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372481480",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj Can you take another look at this? ",
      "created_at" : "2018-03-15T03:42:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-373251295",
      "id" : 373251295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-15T03:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373251295",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@donaloconnor As you acked this, can you change your review status? It stills shows up in GitHub as \"requested changes\".\r\n\r\n@laanwj Sorry to ping you on this again, but you requested changes on this earlier and I think this is ready to go (unless you have further objections). I'm trying to not stack PRs in the dbwrapper code, and this is preventing me from submitting further changes for review.",
      "created_at" : "2018-03-22T04:55:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-375179681",
      "id" : 375179681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-22T04:55:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/375179681",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased with master, as other dbwrapper changes have been merged since my last update.",
      "created_at" : "2018-03-29T06:20:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-377133973",
      "id" : 377133973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-29T06:20:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/377133973",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/12495/commits/ccedbafd73514e0e5b58c1a6251029e84dadaea8 - with the comment that I think relying on undocumented behavior of leveldb is risky. This is only remotely acceptable because we have our own leveldb tree (https://github.com/bitcoin-core/leveldb), and don't blindly merge changes from upstream. I also think you have properly documented this.",
      "created_at" : "2018-03-29T13:03:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495#issuecomment-377228329",
      "id" : 377228329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
      "updated_at" : "2018-03-29T13:03:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/377228329",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
