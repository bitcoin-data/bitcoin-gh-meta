[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14987](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14987.html) (RPCHelpMan: Pass through Result and Examples by MarcoFalke)\n* [#14929](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14929.html) (net: Allow connections from misbehavior banned peers by gmaxwell)\n* [#14897](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14897.html) (randomize GETDATA(tx) request order and introduce bias toward outbound by naumenkogs)\n* [#14856](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14856.html) (net: remove more CConnman globals (theuni) by dongcarl)\n* [#14464](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14464.html) (refactor: make checkqueue manage the threads by itself (also removed some boost dependencies) by ken2812221)\n* [#10785](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10785.html) (Serialization improvements by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-10-30T06:19:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-434184969",
      "id" : 434184969,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNDE4NDk2OQ==",
      "updated_at" : "2019-01-19T15:06:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/434184969",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229283979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229283979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Accidental changes in the first commit?",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T12:22:56Z",
      "diff_hunk" : "@@ -1221,16 +1221,17 @@ void RPCConsole::banSelectedNode(int bantime)\n         // Get currently selected peer address\n         NodeId id = nodes.at(i).data().toLongLong();\n \n-\t// Get currently selected peer address\n-\tint detailNodeRow = clientModel->getPeerTableModel()->getRowByNodeId(id);\n-\tif(detailNodeRow < 0)\n+    // Get currently selected peer address\n+    int detailNodeRow = clientModel->getPeerTableModel()->getRowByNodeId(id);\n+    if(detailNodeRow < 0)\n \t    return;\n \n-\t// Find possible nodes, ban it and clear the selected node\n-\tconst CNodeCombinedStats *stats = clientModel->getPeerTableModel()->getNodeStats(detailNodeRow);\n-\tif(stats) {\n+    // Find possible nodes, ban it and clear the selected node\n+    const CNodeCombinedStats *stats = clientModel->getPeerTableModel()->getNodeStats(detailNodeRow);\n+    if(stats) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229283979",
      "id" : 229283979,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTI4Mzk3OQ==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 17,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : null,
      "pull_request_review_id" : 169743898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229283979",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229330485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229330485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Sort includes :-)",
      "commit_id" : "973d78f7f0a2af27c870435752272ac1483316d0",
      "created_at" : "2018-10-30T14:31:41Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229330485",
      "id" : 229330485,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMDQ4NQ==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 11,
      "path" : "src/banman.cpp",
      "position" : 9,
      "pull_request_review_id" : 169804522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2018-10-31T04:46:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229330485",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332038"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make sure parameter name matches between declaration and definition :-)",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:35:03Z",
      "diff_hunk" : "@@ -105,9 +105,8 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n \n }\n \n-CBanDB::CBanDB()\n+CBanDB::CBanDB(fs::path ban_file) : pathBanlist(std::move(ban_file))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332038",
      "id" : 229332038,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMjAzOA==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 5,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 169806465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332038",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make sure parameter names match between:\r\n\r\n```\r\n    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\r\n    void BanMan::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\r\n```",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:35:46Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332334",
      "id" : 229332334,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMjMzNA==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 39,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 169806864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332334",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make sure these match:\r\n\r\n```\r\n    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\r\n    void BanMan::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\r\n```",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:36:09Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332503",
      "id" : 229332503,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMjUwMw==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 40,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 169807104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332503",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make sure these match:\r\n\r\n```\r\n    bool Unban(const CNetAddr &ip);\r\n    bool BanMan::Unban(const CNetAddr &addr) {\r\n```",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:36:32Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned();\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332663",
      "id" : 229332663,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMjY2Mw==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 44,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 169807309,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332663",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332746"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here:\r\n\r\n```\r\n    bool Unban(const CSubNet &ip);\r\n    bool BanMan::Unban(const CSubNet &subNet) {\r\n```",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:36:44Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned();\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332746",
      "id" : 229332746,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMjc0Ng==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 45,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 169807418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332746",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332892"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here:\r\n\r\n```\r\n    void GetBanned(banmap_t &banmap);\r\n    void BanMan::GetBanned(banmap_t &banMap)\r\n```",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:37:02Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned();\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);\n+    void GetBanned(banmap_t &banmap);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229332892",
      "id" : 229332892,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMjg5Mg==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 46,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 169807583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229332892",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229333006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229333006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "And here :-)\r\n\r\n```\r\n    void SetBanned(const banmap_t &banmap);\r\n    void BanMan::SetBanned(const banmap_t &banMap)\r\n```",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:37:19Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned();\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);\n+    void GetBanned(banmap_t &banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t &banmap);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229333006",
      "id" : 229333006,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzMzAwNg==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 50,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 169807733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229333006",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229334235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229334235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `if (m_banned.erase(subNet) == 0)` to increase readability and avoid implicit conversion?",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:40:04Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap); // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned(); // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if(m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr ip)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet subNet = it.first;\n+        CBanEntry banEntry = it.second;\n+\n+        if (subNet.Match(ip) && GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+bool BanMan::IsBanned(CSubNet subnet)\n+{\n+    LOCK(m_cs_banned);\n+    banmap_t::iterator i = m_banned.find(subnet);\n+    if (i != m_banned.end())\n+    {\n+        CBanEntry banEntry = (*i).second;\n+        if (GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+void BanMan::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CSubNet subNet(addr);\n+    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+}\n+\n+void BanMan::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CBanEntry banEntry(GetTime());\n+    banEntry.banReason = banReason;\n+    if (bantimeoffset <= 0)\n+    {\n+        bantimeoffset = m_default_ban_time;\n+        sinceUnixEpoch = false;\n+    }\n+    banEntry.nBanUntil = (sinceUnixEpoch ? 0 : GetTime() )+bantimeoffset;\n+\n+    {\n+        LOCK(m_cs_banned);\n+        if (m_banned[subNet].nBanUntil < banEntry.nBanUntil) {\n+            m_banned[subNet] = banEntry;\n+            m_is_dirty = true;\n+        }\n+        else\n+            return;\n+    }\n+    if(m_client_interface)\n+        m_client_interface->BannedListChanged();\n+\n+    if(banReason == BanReasonManuallyAdded)\n+        DumpBanlist(); //store banlist to disk immediately if user requested ban\n+}\n+\n+bool BanMan::Unban(const CNetAddr &addr) {\n+    CSubNet subNet(addr);\n+    return Unban(subNet);\n+}\n+\n+bool BanMan::Unban(const CSubNet &subNet) {\n+    {\n+        LOCK(m_cs_banned);\n+        if (!m_banned.erase(subNet))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229334235",
      "id" : 229334235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzNDIzNQ==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 139,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 169809341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229334235",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229337596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229337596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is new code - please run all new C++ files through `clang-format` (using the project local settings) to get the expected formatting.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T14:47:42Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap); // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned(); // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if(m_client_interface)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229337596",
      "id" : 229337596,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTMzNzU5Ng==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 68,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 169813779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229337596",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229482681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229482681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could this be re-formulated to avoid reassigning parameters?",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-30T20:55:33Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap); // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned(); // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if(m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr ip)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet subNet = it.first;\n+        CBanEntry banEntry = it.second;\n+\n+        if (subNet.Match(ip) && GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+bool BanMan::IsBanned(CSubNet subnet)\n+{\n+    LOCK(m_cs_banned);\n+    banmap_t::iterator i = m_banned.find(subnet);\n+    if (i != m_banned.end())\n+    {\n+        CBanEntry banEntry = (*i).second;\n+        if (GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+void BanMan::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CSubNet subNet(addr);\n+    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+}\n+\n+void BanMan::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CBanEntry banEntry(GetTime());\n+    banEntry.banReason = banReason;\n+    if (bantimeoffset <= 0)\n+    {\n+        bantimeoffset = m_default_ban_time;\n+        sinceUnixEpoch = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229482681",
      "id" : 229482681,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTQ4MjY4MQ==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 111,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 169995745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229482681",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229563039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229563039"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See: https://github.com/bitcoin/bitcoin/pull/14605/commits/5dac8bf9616749b832ce14ccace4a2ab6eaf187b",
      "commit_id" : "973d78f7f0a2af27c870435752272ac1483316d0",
      "created_at" : "2018-10-31T04:48:43Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap); // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned(); // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if(m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr ip)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet subNet = it.first;\n+        CBanEntry banEntry = it.second;\n+\n+        if (subNet.Match(ip) && GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+bool BanMan::IsBanned(CSubNet subnet)\n+{\n+    LOCK(m_cs_banned);\n+    banmap_t::iterator i = m_banned.find(subnet);\n+    if (i != m_banned.end())\n+    {\n+        CBanEntry banEntry = (*i).second;\n+        if (GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+void BanMan::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CSubNet subNet(addr);\n+    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+}\n+\n+void BanMan::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CBanEntry banEntry(GetTime());\n+    banEntry.banReason = banReason;\n+    if (bantimeoffset <= 0)\n+    {\n+        bantimeoffset = m_default_ban_time;\n+        sinceUnixEpoch = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229563039",
      "id" : 229563039,
      "in_reply_to_id" : 229482681,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTU2MzAzOQ==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 111,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 170091720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2018-10-31T04:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229563039",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "thank you for picking this up!\r\nWe welcome the Ban Man to our kingdom",
      "created_at" : "2018-10-31T17:14:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-434772194",
      "id" : 434772194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNDc3MjE5NA==",
      "updated_at" : "2018-10-31T17:21:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/434772194",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229867404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229867404"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Reformulated in https://github.com/bitcoin/bitcoin/pull/14605/commits/36e6b241d0ed6f6d6ab503d61dfd95053202ce9b, let me know if you think that's good",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-10-31T21:03:59Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap); // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned(); // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if(m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr ip)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet subNet = it.first;\n+        CBanEntry banEntry = it.second;\n+\n+        if (subNet.Match(ip) && GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+bool BanMan::IsBanned(CSubNet subnet)\n+{\n+    LOCK(m_cs_banned);\n+    banmap_t::iterator i = m_banned.find(subnet);\n+    if (i != m_banned.end())\n+    {\n+        CBanEntry banEntry = (*i).second;\n+        if (GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+void BanMan::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CSubNet subNet(addr);\n+    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+}\n+\n+void BanMan::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CBanEntry banEntry(GetTime());\n+    banEntry.banReason = banReason;\n+    if (bantimeoffset <= 0)\n+    {\n+        bantimeoffset = m_default_ban_time;\n+        sinceUnixEpoch = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r229867404",
      "id" : 229867404,
      "in_reply_to_id" : 229482681,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTg2NzQwNA==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 111,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 170471761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/229867404",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No merge conflicts, but it does need rebase [#14555]; current build fails wiith\r\n```c++\r\n/.../bitcoin/src/banman.cpp:10:10: fatal error: util.h: No such file or directory\r\n #include <util.h>\r\n          ^~~~~~~~\r\ncompilation terminated.\r\n```",
      "created_at" : "2018-11-06T13:10:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-436247077",
      "id" : 436247077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI0NzA3Nw==",
      "updated_at" : "2018-11-06T13:11:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436247077",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "created_at" : "2018-11-06T16:59:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-436327726",
      "id" : 436327726,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjMyNzcyNg==",
      "updated_at" : "2018-11-06T16:59:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436327726",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r231216991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231216991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "since it's a new class and it mostly everywhere follows `snake_case` notation, WDYS to stick to it and in a few other places?",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-11-06T17:25:03Z",
      "diff_hunk" : "@@ -0,0 +1,203 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <ui_interface.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap);        // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned();            // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if (m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr net_addr)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet sub_net = it.first;\n+        CBanEntry banEntry = it.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r231216991",
      "id" : 231216991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTIxNjk5MQ==",
      "original_commit_id" : "157684a341eb1bed3e7961b90af2cc5044ed7a17",
      "original_position" : 77,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 172137848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231216991",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/296795?v=4",
         "events_url" : "https://api.github.com/users/kostyantyn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kostyantyn/followers",
         "following_url" : "https://api.github.com/users/kostyantyn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kostyantyn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kostyantyn",
         "id" : 296795,
         "login" : "kostyantyn",
         "node_id" : "MDQ6VXNlcjI5Njc5NQ==",
         "organizations_url" : "https://api.github.com/users/kostyantyn/orgs",
         "received_events_url" : "https://api.github.com/users/kostyantyn/received_events",
         "repos_url" : "https://api.github.com/users/kostyantyn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kostyantyn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kostyantyn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kostyantyn"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r234008081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234008081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@dongcarl Nice! Thanks! :-)",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-11-15T21:07:41Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <utiltime.h>\n+#include <util.h>\n+#include <ui_interface.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap); // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned(); // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if(m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr ip)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet subNet = it.first;\n+        CBanEntry banEntry = it.second;\n+\n+        if (subNet.Match(ip) && GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+bool BanMan::IsBanned(CSubNet subnet)\n+{\n+    LOCK(m_cs_banned);\n+    banmap_t::iterator i = m_banned.find(subnet);\n+    if (i != m_banned.end())\n+    {\n+        CBanEntry banEntry = (*i).second;\n+        if (GetTime() < banEntry.nBanUntil) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n+void BanMan::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CSubNet subNet(addr);\n+    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+}\n+\n+void BanMan::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\n+    CBanEntry banEntry(GetTime());\n+    banEntry.banReason = banReason;\n+    if (bantimeoffset <= 0)\n+    {\n+        bantimeoffset = m_default_ban_time;\n+        sinceUnixEpoch = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r234008081",
      "id" : 234008081,
      "in_reply_to_id" : 229482681,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNDAwODA4MQ==",
      "original_commit_id" : "af2c6548323b8e24cabe6c1ecc8d95c1f9c336f2",
      "original_position" : 111,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 175556296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234008081",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased, and addressed casing concerns. Additional review welcome.",
      "created_at" : "2018-11-17T02:04:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-439578933",
      "id" : 439578933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzOTU3ODkzMw==",
      "updated_at" : "2018-11-17T02:04:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/439578933",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-28T16:40:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-442515721",
      "id" : 442515721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0MjUxNTcyMQ==",
      "updated_at" : "2018-11-28T16:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/442515721",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238845235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238845235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This can now use MakeUnique.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-04T21:27:28Z",
      "diff_hunk" : "@@ -1278,11 +1283,12 @@ bool AppInitMain(InitInterfaces& interfaces)\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    assert(!g_banman);\n+    g_banman = std::unique_ptr<BanMan>(new BanMan(&uiInterface));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238845235",
      "id" : 238845235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODg0NTIzNQ==",
      "original_commit_id" : "701702427e1b5463469d886025a7038d539fb8c5",
      "original_position" : 26,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 181487790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238845235",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd like to review this soon, but is there a description of what high level goal of this PR is? Is it cleanup geared towards making code maintenance easier? Or is it intended to enable a new feature? Is it cleaning up technical debt from a previously added feature? The previous PR #14605 just says it \"breaks the ban/unban functions out of CConnman and into a new class because, while logically bans are tied to connections, they're really just entries in a database,\" which I think justifies the change but doesn't really motivate it.",
      "created_at" : "2018-12-04T21:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-444267474",
      "id" : 444267474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDI2NzQ3NA==",
      "updated_at" : "2018-12-04T21:35:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444267474",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238849008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238849008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note for follow-up PR:\r\n\r\nconnman and banman pointers should be passed into NodeImpl's constructor. That would eliminate the use of globals here.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-04T21:39:02Z",
      "diff_hunk" : "@@ -120,24 +120,24 @@ class NodeImpl : public Node\n     }\n     bool getBanned(banmap_t& banmap) override\n     {\n-        if (g_connman) {\n-            g_connman->GetBanned(banmap);\n+        if (g_banman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238849008",
      "id" : 238849008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODg0OTAwOA==",
      "original_commit_id" : "701702427e1b5463469d886025a7038d539fb8c5",
      "original_position" : 6,
      "path" : "src/interfaces/node.cpp",
      "position" : 14,
      "pull_request_review_id" : 181487790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238849008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238855206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238855206"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@kostyantyn That'd be fine in a follow-up PR, but the primary interest here is renaming the member variables so that they're immediately distinguishable.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-04T21:56:54Z",
      "diff_hunk" : "@@ -0,0 +1,203 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <ui_interface.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    m_is_dirty = false;\n+    banmap_t banmap;\n+    if (m_ban_db.Read(banmap)) {\n+        SetBanned(banmap);        // thread save setter\n+        SetBannedSetDirty(false); // no need to write down, just read data\n+        SweepBanned();            // sweep out unused entries\n+\n+        LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n+            banmap.size(), GetTimeMillis() - nStart);\n+    } else {\n+        LogPrintf(\"Invalid or missing banlist.dat; recreating\\n\");\n+        SetBannedSetDirty(true); // force write\n+        DumpBanlist();\n+    }\n+}\n+\n+BanMan::~BanMan()\n+{\n+    DumpBanlist();\n+}\n+\n+void BanMan::DumpBanlist()\n+{\n+    SweepBanned(); // clean unused entries (if bantime has expired)\n+\n+    if (!BannedSetIsDirty())\n+        return;\n+\n+    int64_t nStart = GetTimeMillis();\n+\n+    banmap_t banmap;\n+    GetBanned(banmap);\n+    if (m_ban_db.Write(banmap)) {\n+        SetBannedSetDirty(false);\n+    }\n+\n+    LogPrint(BCLog::NET, \"Flushed %d banned node ips/subnets to banlist.dat  %dms\\n\",\n+        banmap.size(), GetTimeMillis() - nStart);\n+}\n+\n+void BanMan::ClearBanned()\n+{\n+    {\n+        LOCK(m_cs_banned);\n+        m_banned.clear();\n+        m_is_dirty = true;\n+    }\n+    DumpBanlist(); //store banlist to disk\n+    if (m_client_interface)\n+        m_client_interface->BannedListChanged();\n+}\n+\n+bool BanMan::IsBanned(CNetAddr net_addr)\n+{\n+    LOCK(m_cs_banned);\n+    for (const auto& it : m_banned) {\n+        CSubNet sub_net = it.first;\n+        CBanEntry banEntry = it.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238855206",
      "id" : 238855206,
      "in_reply_to_id" : 231216991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODg1NTIwNg==",
      "original_commit_id" : "157684a341eb1bed3e7961b90af2cc5044ed7a17",
      "original_position" : 77,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 181487790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238855206",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238863651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238863651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "normalized_sinceUnixEpoch should be a bool.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-04T22:25:34Z",
      "diff_hunk" : "@@ -106,11 +106,14 @@ void BanMan::Ban(const CSubNet& subNet, const BanReason& banReason, int64_t bant\n {\n     CBanEntry banEntry(GetTime());\n     banEntry.banReason = banReason;\n+\n+    int64_t normalized_bantimeoffset = bantimeoffset;\n+    int64_t normalized_sinceUnixEpoch = sinceUnixEpoch;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238863651",
      "id" : 238863651,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODg2MzY1MQ==",
      "original_commit_id" : "5090c8c9fd967c066c7bb8aa4170c1f5b0d9cbf3",
      "original_position" : 6,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 181487790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238863651",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238864267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238864267"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hungarian or snake_case, pick one :)",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-04T22:27:36Z",
      "diff_hunk" : "@@ -25,7 +25,7 @@ BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t\n         SweepBanned();            // sweep out unused entries\n \n         LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n-            banmap.size(), GetTimeMillis() - nStart);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238864267",
      "id" : 238864267,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODg2NDI2Nw==",
      "original_commit_id" : "9bad9fa1168ec53e92bb8b2df0b5e9d578344a2f",
      "original_position" : 13,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 181487790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238864267",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238867453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238867453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please don't use special-cases in scripted-diffs to negate part of a change, as that means that manual review is required.\r\n\r\nInstead, please add a commit before the scripted-diff which renames any necessary conflicts.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-04T22:38:24Z",
      "diff_hunk" : "@@ -69,78 +69,78 @@ void BanMan::ClearBanned()\n         m_client_interface->BannedListChanged();\n }\n \n-bool BanMan::IsBanned(CNetAddr netAddr)\n+bool BanMan::IsBanned(CNetAddr net_addr)\n {\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n-        CSubNet subNet = it.first;\n-        CBanEntry banEntry = it.second;\n+        CSubNet sub_net = it.first;\n+        CBanEntry ban_entry = it.second;\n \n-        if (subNet.Match(netAddr) && GetTime() < banEntry.nBanUntil) {\n+        if (sub_net.Match(net_addr) && GetTime() < ban_entry.nBanUntil) {\n             return true;\n         }\n     }\n     return false;\n }\n \n-bool BanMan::IsBanned(CSubNet subNet)\n+bool BanMan::IsBanned(CSubNet sub_net)\n {\n     LOCK(m_cs_banned);\n-    banmap_t::iterator i = m_banned.find(subNet);\n+    banmap_t::iterator i = m_banned.find(sub_net);\n     if (i != m_banned.end()) {\n-        CBanEntry banEntry = (*i).second;\n-        if (GetTime() < banEntry.nBanUntil) {\n+        CBanEntry ban_entry = (*i).second;\n+        if (GetTime() < ban_entry.nBanUntil) {\n             return true;\n         }\n     }\n     return false;\n }\n \n-void BanMan::Ban(const CNetAddr& netAddr, const BanReason& banReason, int64_t bantimeoffset, bool sinceUnixEpoch)\n+void BanMan::Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset, bool since_unix_epoch)\n {\n-    CSubNet subNet(netAddr);\n-    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+    CSubNet sub_net(net_addr);\n+    Ban(sub_net, ban_reason, ban_time_offset, since_unix_epoch);\n }\n \n-void BanMan::Ban(const CSubNet& subNet, const BanReason& banReason, int64_t bantimeoffset, bool sinceUnixEpoch)\n+void BanMan::Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset, bool since_unix_epoch)\n {\n-    CBanEntry banEntry(GetTime());\n-    banEntry.banReason = banReason;\n-\n-    int64_t normalized_bantimeoffset = bantimeoffset;\n-    int64_t normalized_sinceUnixEpoch = sinceUnixEpoch;\n-    if (bantimeoffset <= 0) {\n-        normalized_bantimeoffset = m_default_ban_time;\n-        normalized_sinceUnixEpoch = false;\n+    CBanEntry ban_entry(GetTime());\n+    ban_entry.banReason = ban_reason;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238867453",
      "id" : 238867453,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODg2NzQ1Mw==",
      "original_commit_id" : "9bad9fa1168ec53e92bb8b2df0b5e9d578344a2f",
      "original_position" : 96,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 181487790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238867453",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky This is one step (one of the big ones) closer to instantiated CConnman (self-contained and no-globals), which would allow for all kinds of cool things, primarily running separate net instances against each-other.\r\n\r\nAnother nice side-effect of the above is that once self-contained, bitcoind could be run (or even compiled!) without net support.\r\n\r\nEdit: See my comment here as an example of next steps: https://github.com/bitcoin/bitcoin/pull/14605#discussion_r238849008",
      "created_at" : "2018-12-04T22:49:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-444289739",
      "id" : 444289739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDI4OTczOQ==",
      "updated_at" : "2018-12-04T22:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444289739",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r239071958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239071958"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do you mean rename `CBanEntry.banReason` to `CBanEntry.m_ban_reason` before the scripted diff?",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-05T13:54:41Z",
      "diff_hunk" : "@@ -69,78 +69,78 @@ void BanMan::ClearBanned()\n         m_client_interface->BannedListChanged();\n }\n \n-bool BanMan::IsBanned(CNetAddr netAddr)\n+bool BanMan::IsBanned(CNetAddr net_addr)\n {\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n-        CSubNet subNet = it.first;\n-        CBanEntry banEntry = it.second;\n+        CSubNet sub_net = it.first;\n+        CBanEntry ban_entry = it.second;\n \n-        if (subNet.Match(netAddr) && GetTime() < banEntry.nBanUntil) {\n+        if (sub_net.Match(net_addr) && GetTime() < ban_entry.nBanUntil) {\n             return true;\n         }\n     }\n     return false;\n }\n \n-bool BanMan::IsBanned(CSubNet subNet)\n+bool BanMan::IsBanned(CSubNet sub_net)\n {\n     LOCK(m_cs_banned);\n-    banmap_t::iterator i = m_banned.find(subNet);\n+    banmap_t::iterator i = m_banned.find(sub_net);\n     if (i != m_banned.end()) {\n-        CBanEntry banEntry = (*i).second;\n-        if (GetTime() < banEntry.nBanUntil) {\n+        CBanEntry ban_entry = (*i).second;\n+        if (GetTime() < ban_entry.nBanUntil) {\n             return true;\n         }\n     }\n     return false;\n }\n \n-void BanMan::Ban(const CNetAddr& netAddr, const BanReason& banReason, int64_t bantimeoffset, bool sinceUnixEpoch)\n+void BanMan::Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset, bool since_unix_epoch)\n {\n-    CSubNet subNet(netAddr);\n-    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+    CSubNet sub_net(net_addr);\n+    Ban(sub_net, ban_reason, ban_time_offset, since_unix_epoch);\n }\n \n-void BanMan::Ban(const CSubNet& subNet, const BanReason& banReason, int64_t bantimeoffset, bool sinceUnixEpoch)\n+void BanMan::Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset, bool since_unix_epoch)\n {\n-    CBanEntry banEntry(GetTime());\n-    banEntry.banReason = banReason;\n-\n-    int64_t normalized_bantimeoffset = bantimeoffset;\n-    int64_t normalized_sinceUnixEpoch = sinceUnixEpoch;\n-    if (bantimeoffset <= 0) {\n-        normalized_bantimeoffset = m_default_ban_time;\n-        normalized_sinceUnixEpoch = false;\n+    CBanEntry ban_entry(GetTime());\n+    ban_entry.banReason = ban_reason;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r239071958",
      "id" : 239071958,
      "in_reply_to_id" : 238867453,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzOTA3MTk1OA==",
      "original_commit_id" : "9bad9fa1168ec53e92bb8b2df0b5e9d578344a2f",
      "original_position" : 96,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 181765187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239071958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r239072804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239072804"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed in 9bad9fa1168ec53e92bb8b2df0b5e9d578344a2f, unless this should be squashed in",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-05T13:56:45Z",
      "diff_hunk" : "@@ -25,7 +25,7 @@ BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t\n         SweepBanned();            // sweep out unused entries\n \n         LogPrint(BCLog::NET, \"Loaded %d banned node ips/subnets from banlist.dat  %dms\\n\",\n-            banmap.size(), GetTimeMillis() - nStart);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r239072804",
      "id" : 239072804,
      "in_reply_to_id" : 238864267,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzOTA3MjgwNA==",
      "original_commit_id" : "9bad9fa1168ec53e92bb8b2df0b5e9d578344a2f",
      "original_position" : 13,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 181766249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239072804",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r239638482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239638482"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How about just first adding a commit to hack around it so that we don't have to use the var by name?\r\n```patch\r\ndiff --git a/src/addrdb.h b/src/addrdb.h\r\nindex 90eca44..f50442f 100644\r\n--- a/src/addrdb.h\r\n+++ b/src/addrdb.h\r\n@@ -43,6 +43,11 @@ public:\r\n         nCreateTime = nCreateTimeIn;\r\n     }\r\n\r\n+    explicit CBanEntry(int64_t nCreateTimeIn, BanReason banReasonIn) : CBanEntry(nCreateTimeIn)\r\n+    {\r\n+        banReason = banReasonIn;\r\n+    }\r\n+\r\n     ADD_SERIALIZE_METHODS;\r\n\r\n     template <typename Stream, typename Operation>\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex fde85b0..db97ae8 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -540,8 +540,7 @@ void CConnman::Ban(const CNetAddr& addr, const BanReason &banReason, int64_t ban\r\n }\r\n\r\n void CConnman::Ban(const CSubNet& subNet, const BanReason &banReason, int64_t bantimeoffset, bool sinceUnixEpoch) {\r\n-    CBanEntry banEntry(GetTime());\r\n-    banEntry.banReason = banReason;\r\n+    CBanEntry banEntry(GetTime(), banReason);\r\n     if (bantimeoffset <= 0)\r\n     {\r\n         bantimeoffset = gArgs.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME);\r\n```\r\n\r\nAfter that, I believe the scripted diff should work without hacks.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2018-12-06T22:27:37Z",
      "diff_hunk" : "@@ -69,78 +69,78 @@ void BanMan::ClearBanned()\n         m_client_interface->BannedListChanged();\n }\n \n-bool BanMan::IsBanned(CNetAddr netAddr)\n+bool BanMan::IsBanned(CNetAddr net_addr)\n {\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n-        CSubNet subNet = it.first;\n-        CBanEntry banEntry = it.second;\n+        CSubNet sub_net = it.first;\n+        CBanEntry ban_entry = it.second;\n \n-        if (subNet.Match(netAddr) && GetTime() < banEntry.nBanUntil) {\n+        if (sub_net.Match(net_addr) && GetTime() < ban_entry.nBanUntil) {\n             return true;\n         }\n     }\n     return false;\n }\n \n-bool BanMan::IsBanned(CSubNet subNet)\n+bool BanMan::IsBanned(CSubNet sub_net)\n {\n     LOCK(m_cs_banned);\n-    banmap_t::iterator i = m_banned.find(subNet);\n+    banmap_t::iterator i = m_banned.find(sub_net);\n     if (i != m_banned.end()) {\n-        CBanEntry banEntry = (*i).second;\n-        if (GetTime() < banEntry.nBanUntil) {\n+        CBanEntry ban_entry = (*i).second;\n+        if (GetTime() < ban_entry.nBanUntil) {\n             return true;\n         }\n     }\n     return false;\n }\n \n-void BanMan::Ban(const CNetAddr& netAddr, const BanReason& banReason, int64_t bantimeoffset, bool sinceUnixEpoch)\n+void BanMan::Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset, bool since_unix_epoch)\n {\n-    CSubNet subNet(netAddr);\n-    Ban(subNet, banReason, bantimeoffset, sinceUnixEpoch);\n+    CSubNet sub_net(net_addr);\n+    Ban(sub_net, ban_reason, ban_time_offset, since_unix_epoch);\n }\n \n-void BanMan::Ban(const CSubNet& subNet, const BanReason& banReason, int64_t bantimeoffset, bool sinceUnixEpoch)\n+void BanMan::Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset, bool since_unix_epoch)\n {\n-    CBanEntry banEntry(GetTime());\n-    banEntry.banReason = banReason;\n-\n-    int64_t normalized_bantimeoffset = bantimeoffset;\n-    int64_t normalized_sinceUnixEpoch = sinceUnixEpoch;\n-    if (bantimeoffset <= 0) {\n-        normalized_bantimeoffset = m_default_ban_time;\n-        normalized_sinceUnixEpoch = false;\n+    CBanEntry ban_entry(GetTime());\n+    ban_entry.banReason = ban_reason;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r239638482",
      "id" : 239638482,
      "in_reply_to_id" : 238867453,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzOTYzODQ4Mg==",
      "original_commit_id" : "9bad9fa1168ec53e92bb8b2df0b5e9d578344a2f",
      "original_position" : 96,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 182478518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239638482",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-12-13T14:02:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-446978508",
      "id" : 446978508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0Njk3ODUwOA==",
      "updated_at" : "2018-12-13T14:02:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446978508",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and addressed reviews!",
      "created_at" : "2019-01-03T15:19:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-451174048",
      "id" : 451174048,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MTE3NDA0OA==",
      "updated_at" : "2019-01-03T15:19:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/451174048",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246336778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246336778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could be initializer",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T10:48:10Z",
      "diff_hunk" : "@@ -43,6 +43,11 @@ class CBanEntry\n         nCreateTime = nCreateTimeIn;\n     }\n \n+    explicit CBanEntry(int64_t n_create_time_in, BanReason ban_reason_in) : CBanEntry(n_create_time_in)\n+    {\n+        banReason = ban_reason_in;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246336778",
      "id" : 246336778,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjMzNjc3OA==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 6,
      "path" : "src/addrdb.h",
      "position" : 6,
      "pull_request_review_id" : 190668251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246336778",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246337055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246337055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could be const",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T10:48:58Z",
      "diff_hunk" : "@@ -92,9 +97,9 @@ class CAddrDB\n class CBanDB\n {\n private:\n-    fs::path pathBanlist;\n+    fs::path m_ban_list_path;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246337055",
      "id" : 246337055,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjMzNzA1NQ==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 17,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 190668582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246337055",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246337237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246337237"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could wrap this line",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T10:49:31Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <ui_interface.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246337237",
      "id" : 246337237,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjMzNzIzNw==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 14,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 190668793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246337237",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246337519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246337519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: one line or braces, here and a few other places",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T10:50:22Z",
      "diff_hunk" : "@@ -0,0 +1,202 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+\n+#include <netaddress.h>\n+#include <ui_interface.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+\n+BanMan::BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time) : m_client_interface(client_interface), m_ban_db(std::move(ban_file)), m_default_ban_time(default_ban_time)\n+{\n+    if (m_client_interface)\n+        m_client_interface->InitMessage(_(\"Loading banlist...\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246337519",
      "id" : 246337519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjMzNzUxOQ==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 17,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 190669120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246337519",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246341755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246341755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `#include <cstdint>`",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T11:04:14Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24; // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void ClearBanned();\n+    bool IsBanned(CNetAddr net_addr);\n+    bool IsBanned(CSubNet sub_net);\n+    bool Unban(const CNetAddr& net_addr);\n+    bool Unban(const CSubNet& sub_net);\n+    void GetBanned(banmap_t& banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t& banmap);\n+    bool BannedSetIsDirty();\n+    //!set the \"dirty\" flag for the banlist\n+    void SetBannedSetDirty(bool dirty = true);\n+    //!clean unused entries (if bantime has expired)\n+    void SweepBanned();\n+\n+    CCriticalSection m_cs_banned;\n+    banmap_t m_banned GUARDED_BY(m_cs_banned);\n+    bool m_is_dirty GUARDED_BY(m_cs_banned);\n+    CClientUIInterface* m_client_interface = nullptr;\n+    CBanDB m_ban_db;\n+    const int64_t m_default_ban_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246341755",
      "id" : 246341755,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjM0MTc1NQ==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 62,
      "path" : "src/banman.h",
      "position" : 65,
      "pull_request_review_id" : 190674248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246341755",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246341868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246341868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `#include <memory>`",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T11:04:38Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include <addrdb.h>\n+#include <fs.h>\n+#include <sync.h>\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24; // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void ClearBanned();\n+    bool IsBanned(CNetAddr net_addr);\n+    bool IsBanned(CSubNet sub_net);\n+    bool Unban(const CNetAddr& net_addr);\n+    bool Unban(const CSubNet& sub_net);\n+    void GetBanned(banmap_t& banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t& banmap);\n+    bool BannedSetIsDirty();\n+    //!set the \"dirty\" flag for the banlist\n+    void SetBannedSetDirty(bool dirty = true);\n+    //!clean unused entries (if bantime has expired)\n+    void SweepBanned();\n+\n+    CCriticalSection m_cs_banned;\n+    banmap_t m_banned GUARDED_BY(m_cs_banned);\n+    bool m_is_dirty GUARDED_BY(m_cs_banned);\n+    CClientUIInterface* m_client_interface = nullptr;\n+    CBanDB m_ban_db;\n+    const int64_t m_default_ban_time;\n+};\n+\n+extern std::unique_ptr<BanMan> g_banman;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246341868",
      "id" : 246341868,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjM0MTg2OA==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 65,
      "path" : "src/banman.h",
      "position" : 68,
      "pull_request_review_id" : 190674422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246341868",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246344474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246344474"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems `dynamic_cast` would be more appropriate here, given the cast to base class.\r\n\r\nEdit: maybe not:\r\n> A downcast can also be performed with static_cast, which avoids the cost of the runtime check, but it's only safe if the program can guarantee (through some other logic) that the object pointed to by expression is definitely Derived.\r\nhttps://en.cppreference.com/w/cpp/language/dynamic_cast\r\n\r\nMaybe a `static_assert` is in order to enforce?",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T11:14:24Z",
      "diff_hunk" : "@@ -2668,6 +2473,25 @@ bool CConnman::DisconnectNode(const std::string& strNode)\n     }\n     return false;\n }\n+\n+bool CConnman::DisconnectNode(const CSubNet& subnet)\n+{\n+    bool disconnected = false;\n+    LOCK(cs_vNodes);\n+    for (CNode* pnode : vNodes) {\n+        if (subnet.Match(static_cast<CNetAddr>(pnode->addr))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246344474",
      "id" : 246344474,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjM0NDQ3NA==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 296,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 190677722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246344474",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246346939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246346939"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could have a `CNode*` version of `DisconnectNode` to avoid the lookup",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-09T11:23:37Z",
      "diff_hunk" : "@@ -2961,14 +2961,16 @@ static bool SendRejectsAndCheckIfBanned(CNode* pnode, CConnman* connman, bool en\n             LogPrintf(\"Warning: not punishing whitelisted peer %s!\\n\", pnode->addr.ToString());\n         else if (pnode->m_manual_connection)\n             LogPrintf(\"Warning: not punishing manually-connected peer %s!\\n\", pnode->addr.ToString());\n-        else {\n-            pnode->fDisconnect = true;\n-            if (pnode->addr.IsLocal())\n-                LogPrintf(\"Warning: not banning local peer %s!\\n\", pnode->addr.ToString());\n-            else\n-            {\n-                connman->Ban(pnode->addr, BanReasonNodeMisbehaving);\n+        else if (pnode->addr.IsLocal()) {\n+            // Disconnect but don't ban _this_ local node\n+            LogPrintf(\"Warning: disconnecting but not banning local peer %s!\\n\", pnode->addr.ToString());\n+            connman->DisconnectNode(pnode->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r246346939",
      "id" : 246346939,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjM0NjkzOQ==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 43,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 190680749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246346939",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-01-09T11:28:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-452664289",
      "id" : 452664289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjY2NDI4OQ==",
      "updated_at" : "2019-01-09T11:28:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452664289",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-01-09T22:44:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-452897541",
      "id" : 452897541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1Mjg5NzU0MQ==",
      "updated_at" : "2019-01-09T22:44:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452897541",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We want to have this in for 0.18.0, there's not *that* much time anymore.\r\nThis has had a fair amount of review.\r\nLet's rebase, address the nits, do a last review round, and merge it.",
      "created_at" : "2019-01-15T14:53:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-454419225",
      "id" : 454419225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDQxOTIyNQ==",
      "updated_at" : "2019-01-15T14:53:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454419225",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj Yes. I will make it happen this week.",
      "created_at" : "2019-01-15T18:35:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-454501673",
      "id" : 454501673,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDUwMTY3Mw==",
      "updated_at" : "2019-01-15T18:35:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454501673",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248036863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248036863"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think this can be initializer as we need to `SetNull()`, the current one does the delegation thing.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-15T19:43:51Z",
      "diff_hunk" : "@@ -43,6 +43,11 @@ class CBanEntry\n         nCreateTime = nCreateTimeIn;\n     }\n \n+    explicit CBanEntry(int64_t n_create_time_in, BanReason ban_reason_in) : CBanEntry(n_create_time_in)\n+    {\n+        banReason = ban_reason_in;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248036863",
      "id" : 248036863,
      "in_reply_to_id" : 246336778,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODAzNjg2Mw==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 6,
      "path" : "src/addrdb.h",
      "position" : 6,
      "pull_request_review_id" : 192829949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248036863",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248050771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248050771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We are upcasting from CAddress to its base class of CNetAddr here, so it wouldn't need a `static_assert` I believe.\r\n\r\nSince we are just upcasting, we don't even need casting here, so I'll just remove it unless there are obscure C++ reasons for doing so.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-15T20:28:30Z",
      "diff_hunk" : "@@ -2668,6 +2473,25 @@ bool CConnman::DisconnectNode(const std::string& strNode)\n     }\n     return false;\n }\n+\n+bool CConnman::DisconnectNode(const CSubNet& subnet)\n+{\n+    bool disconnected = false;\n+    LOCK(cs_vNodes);\n+    for (CNode* pnode : vNodes) {\n+        if (subnet.Match(static_cast<CNetAddr>(pnode->addr))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248050771",
      "id" : 248050771,
      "in_reply_to_id" : 246344474,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODA1MDc3MQ==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 296,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 192848140,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248050771",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248065847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248065847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm going to revert to doing\r\n```\r\npnode->fDisconnect = true;\r\n```\r\nso as to avoid the lookup, then in a followup PR we can make `fDisconnect` private, and have a `Disconnect` method on `CNode`.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-15T21:17:13Z",
      "diff_hunk" : "@@ -2961,14 +2961,16 @@ static bool SendRejectsAndCheckIfBanned(CNode* pnode, CConnman* connman, bool en\n             LogPrintf(\"Warning: not punishing whitelisted peer %s!\\n\", pnode->addr.ToString());\n         else if (pnode->m_manual_connection)\n             LogPrintf(\"Warning: not punishing manually-connected peer %s!\\n\", pnode->addr.ToString());\n-        else {\n-            pnode->fDisconnect = true;\n-            if (pnode->addr.IsLocal())\n-                LogPrintf(\"Warning: not banning local peer %s!\\n\", pnode->addr.ToString());\n-            else\n-            {\n-                connman->Ban(pnode->addr, BanReasonNodeMisbehaving);\n+        else if (pnode->addr.IsLocal()) {\n+            // Disconnect but don't ban _this_ local node\n+            LogPrintf(\"Warning: disconnecting but not banning local peer %s!\\n\", pnode->addr.ToString());\n+            connman->DisconnectNode(pnode->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248065847",
      "id" : 248065847,
      "in_reply_to_id" : 246346939,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODA2NTg0Nw==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 43,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 192867740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248065847",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and addressed nits.",
      "created_at" : "2019-01-15T22:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-454583285",
      "id" : 454583285,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDU4MzI4NQ==",
      "updated_at" : "2019-01-15T22:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454583285",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you @dongkarl!",
      "created_at" : "2019-01-16T12:52:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-454768278",
      "id" : 454768278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDc2ODI3OA==",
      "updated_at" : "2019-01-16T12:52:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454768278",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK cb1ee04b6a7d56834a6447711ca5500fc8bd83cd\r\n\r\nOriginal PR had utACKs by me, @ryanofsky, @jimpo. Please re-review so that we can merge this!",
      "created_at" : "2019-01-16T13:04:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-454771602",
      "id" : 454771602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDc3MTYwMg==",
      "updated_at" : "2019-01-16T13:28:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454771602",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248322599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248322599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd advise against using `dynamic_cast`. It's not used anywhere else in the code and it relies on C++ run-time type information which has at least historically a large overhead. I'm also fairly sure it's unnecessary here.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T15:18:01Z",
      "diff_hunk" : "@@ -2668,6 +2473,25 @@ bool CConnman::DisconnectNode(const std::string& strNode)\n     }\n     return false;\n }\n+\n+bool CConnman::DisconnectNode(const CSubNet& subnet)\n+{\n+    bool disconnected = false;\n+    LOCK(cs_vNodes);\n+    for (CNode* pnode : vNodes) {\n+        if (subnet.Match(static_cast<CNetAddr>(pnode->addr))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248322599",
      "id" : 248322599,
      "in_reply_to_id" : 246344474,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODMyMjU5OQ==",
      "original_commit_id" : "bc526e9e982f68e63f00c2a7cc83eaf2ee3a6497",
      "original_position" : 296,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 193188616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248322599",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248362793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248362793"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit b4ca7e2\r\n\r\nDiscussed with @dongcarl about not changing behavior in this commit, the conclusion is to call `conman->DisconnectNode(pnode->addr)` here and add `pnode->fDisconnect = true;` above.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T16:50:01Z",
      "diff_hunk" : "@@ -2962,13 +2962,14 @@ static bool SendRejectsAndCheckIfBanned(CNode* pnode, CConnman* connman, bool en\n         else if (pnode->m_manual_connection)\n             LogPrintf(\"Warning: not punishing manually-connected peer %s!\\n\", pnode->addr.ToString());\n         else {\n-            pnode->fDisconnect = true;\n-            if (pnode->addr.IsLocal())\n-                LogPrintf(\"Warning: not banning local peer %s!\\n\", pnode->addr.ToString());\n-            else\n-            {\n+            if (pnode->addr.IsLocal()) {\n+                // Disconnect but don't ban _this_ local node\n+                LogPrintf(\"Warning: disconnecting but not banning local peer %s!\\n\", pnode->addr.ToString());\n+            } else {\n+                // Disconnect and ban all nodes sharing the address\n                 connman->Ban(pnode->addr, BanReasonNodeMisbehaving);\n             }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248362793",
      "id" : 248362793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODM2Mjc5Mw==",
      "original_commit_id" : "b4ca7e2933d9325728cee97f3de1438f330b124b",
      "original_position" : 15,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 193240376,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248362793",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248384309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248384309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe add a comment to `std::atomic_bool fDisconnect` in `net.h` that setting this to true will cause the node to be disconnected the next time `DisconnectNodes()` runs.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T17:45:38Z",
      "diff_hunk" : "@@ -2643,6 +2636,25 @@ bool CConnman::DisconnectNode(const std::string& strNode)\n     }\n     return false;\n }\n+\n+bool CConnman::DisconnectNode(const CSubNet& subnet)\n+{\n+    bool disconnected = false;\n+    LOCK(cs_vNodes);\n+    for (CNode* pnode : vNodes) {\n+        if (subnet.Match(pnode->addr)) {\n+            pnode->fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248384309",
      "id" : 248384309,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODM4NDMwOQ==",
      "original_commit_id" : "7cc2b9f6786f9bc33853220551eed33ca6b7b7b2",
      "original_position" : 25,
      "path" : "src/net.cpp",
      "position" : 289,
      "pull_request_review_id" : 193267118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248384309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248390091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248390091"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `15 * 60` to be consistent with other `_INTERVAL` constants.",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T18:01:15Z",
      "diff_hunk" : "@@ -41,8 +41,11 @@\n \n #include <math.h>\n \n-// Dump addresses to peers.dat and banlist.dat every 15 minutes (900s)\n-#define DUMP_ADDRESSES_INTERVAL 900\n+// Dump addresses to peers.dat every 15 minutes (900s)\n+static constexpr int DUMP_PEERS_INTERVAL = 60 * 15;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248390091",
      "id" : 248390091,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODM5MDA5MQ==",
      "original_commit_id" : "9db3a772fc3880fc5eb96cb90dc8af2c23bbf782",
      "original_position" : 7,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 193267118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248390091",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248391935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248391935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "cc @ryanofsky",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T18:06:51Z",
      "diff_hunk" : "@@ -120,24 +120,24 @@ class NodeImpl : public Node\n     }\n     bool getBanned(banmap_t& banmap) override\n     {\n-        if (g_connman) {\n-            g_connman->GetBanned(banmap);\n+        if (g_banman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248391935",
      "id" : 248391935,
      "in_reply_to_id" : 238849008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODM5MTkzNQ==",
      "original_commit_id" : "701702427e1b5463469d886025a7038d539fb8c5",
      "original_position" : 6,
      "path" : "src/interfaces/node.cpp",
      "position" : 14,
      "pull_request_review_id" : 193267118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248391935",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248408710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248408710"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this belongs in another PR, but happy to do that PR :-)",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T18:54:26Z",
      "diff_hunk" : "@@ -2643,6 +2636,25 @@ bool CConnman::DisconnectNode(const std::string& strNode)\n     }\n     return false;\n }\n+\n+bool CConnman::DisconnectNode(const CSubNet& subnet)\n+{\n+    bool disconnected = false;\n+    LOCK(cs_vNodes);\n+    for (CNode* pnode : vNodes) {\n+        if (subnet.Match(pnode->addr)) {\n+            pnode->fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248408710",
      "id" : 248408710,
      "in_reply_to_id" : 248384309,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODQwODcxMA==",
      "original_commit_id" : "7cc2b9f6786f9bc33853220551eed33ca6b7b7b2",
      "original_position" : 25,
      "path" : "src/net.cpp",
      "position" : 289,
      "pull_request_review_id" : 193297438,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248408710",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248409096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248409096"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done!",
      "commit_id" : "18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-16T18:55:28Z",
      "diff_hunk" : "@@ -41,8 +41,11 @@\n \n #include <math.h>\n \n-// Dump addresses to peers.dat and banlist.dat every 15 minutes (900s)\n-#define DUMP_ADDRESSES_INTERVAL 900\n+// Dump addresses to peers.dat every 15 minutes (900s)\n+static constexpr int DUMP_PEERS_INTERVAL = 60 * 15;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#discussion_r248409096",
      "id" : 248409096,
      "in_reply_to_id" : 248390091,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODQwOTA5Ng==",
      "original_commit_id" : "9db3a772fc3880fc5eb96cb90dc8af2c23bbf782",
      "original_position" : 7,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 193297908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14605",
      "updated_at" : "2019-01-16T18:55:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248409096",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-tACK 18185b57",
      "created_at" : "2019-01-16T19:10:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-454901942",
      "id" : 454901942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDkwMTk0Mg==",
      "updated_at" : "2019-01-16T19:10:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454901942",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 18185b57c32d0a43afeca4c125b9352c692923e9",
      "created_at" : "2019-01-21T17:58:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14605#issuecomment-456156363",
      "id" : 456156363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NjE1NjM2Mw==",
      "updated_at" : "2019-01-21T17:58:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456156363",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
