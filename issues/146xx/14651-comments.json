[
   {
      "author_association" : "MEMBER",
      "body" : "Please send the leveldb changes [upstream](https://github.com/bitcoin-core/leveldb).",
      "created_at" : "2018-11-04T03:41:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435639527",
      "id" : 435639527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTYzOTUyNw==",
      "updated_at" : "2018-11-04T03:41:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435639527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Please send the leveldb changes [upstream](https://github.com/bitcoin-core/leveldb).\r\n\r\nleveldb changes sent upstream. Rebased to only include the non-leveldb patch.",
      "created_at" : "2018-11-04T03:59:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435640163",
      "id" : 435640163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTY0MDE2Mw==",
      "updated_at" : "2018-11-04T03:59:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435640163",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/639247?v=4",
         "events_url" : "https://api.github.com/users/ldm5180/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ldm5180/followers",
         "following_url" : "https://api.github.com/users/ldm5180/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ldm5180/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ldm5180",
         "id" : 639247,
         "login" : "ldm5180",
         "node_id" : "MDQ6VXNlcjYzOTI0Nw==",
         "organizations_url" : "https://api.github.com/users/ldm5180/orgs",
         "received_events_url" : "https://api.github.com/users/ldm5180/received_events",
         "repos_url" : "https://api.github.com/users/ldm5180/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ldm5180/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ldm5180/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ldm5180"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14224](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14224.html) (Document intentional and unintentional unsigned integer overflows (wraparounds) using annotations by practicalswift)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-04T04:29:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435641326",
      "id" : 435641326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTY0MTMyNg==",
      "updated_at" : "2018-11-06T17:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435641326",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ldm5180 Can you post the warnings emitted? What gcc version are you using?",
      "created_at" : "2018-11-04T21:44:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435710774",
      "id" : 435710774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTcxMDc3NA==",
      "updated_at" : "2018-11-04T21:44:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435710774",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What are the performance impacts of this change?",
      "created_at" : "2018-11-04T22:17:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435713300",
      "id" : 435713300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTcxMzMwMA==",
      "updated_at" : "2018-11-04T22:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435713300",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @ldm5180 Can you post the warnings emitted? What gcc version are you using?\r\n\r\ngcc version 8.2.0 (Ubuntu 8.2.0-7ubuntu1)\r\n\r\n```\r\nIn file included from bench/prevector.cpp:6:\r\n./prevector.h: In instantiation of Ã¢ÂÂvoid prevector<N, T, Size, Diff>::fill(T*, ptrdiff_t) [with unsigned int N = 28; T = nontrivial_t; Size = unsigned int; Diff = int; ptrdiff_t = long int]Ã¢ÂÂ:                                                                                \r\n./prevector.h:340:9:   required from Ã¢ÂÂvoid prevector<N, T, Size, Diff>::resize(prevector<N, T, Size, Diff>::size_type) [with unsigned int N = 28; T = nontrivial_t; Size = unsigned int; Diff = int; prevector<N, T, Size, Diff>::size_type = unsigned int]Ã¢ÂÂ                   \r\nbench/prevector.cpp:47:13:   required from Ã¢ÂÂvoid PrevectorClear(benchmark::State&) [with T = nontrivial_t]Ã¢ÂÂ\r\nbench/prevector.cpp:102:1:   required from here\r\n./prevector.h:205:21: warning: Ã¢ÂÂvoid* memset(void*, int, size_t)Ã¢ÂÂ clearing an object of non-trivial type Ã¢ÂÂstruct nontrivial_tÃ¢ÂÂ; use assignment or value-initialization instead [-Wclass-memaccess]                                                                             \r\n             ::memset(dst, 0, count * sizeof(T));\r\n             ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nbench/prevector.cpp:12:8: note: Ã¢ÂÂstruct nontrivial_tÃ¢ÂÂ declared here\r\n struct nontrivial_t {\r\n        ^~~~~~~~~~~~\r\n```",
      "created_at" : "2018-11-04T23:06:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435717239",
      "id" : 435717239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTcxNzIzOQ==",
      "updated_at" : "2018-11-04T23:08:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435717239",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/639247?v=4",
         "events_url" : "https://api.github.com/users/ldm5180/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ldm5180/followers",
         "following_url" : "https://api.github.com/users/ldm5180/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ldm5180/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ldm5180",
         "id" : 639247,
         "login" : "ldm5180",
         "node_id" : "MDQ6VXNlcjYzOTI0Nw==",
         "organizations_url" : "https://api.github.com/users/ldm5180/orgs",
         "received_events_url" : "https://api.github.com/users/ldm5180/received_events",
         "repos_url" : "https://api.github.com/users/ldm5180/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ldm5180/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ldm5180/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ldm5180"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> What are the performance impacts of this change?\r\n\r\nExpect, no impact. Is there a performance analysis test suite?\r\n\r\nThere are a few different cases. Here are them shown in the Compiler Explorer:\r\n1. Default fill w/ trivial type: https://gcc.godbolt.org/z/qzIKUJ (no difference)\r\n2. Default fill w/ nontrivial type: https://gcc.godbolt.org/z/h38Swd (difference discussed below)\r\n3. Copy fill w/ trivial type: https://gcc.godbolt.org/z/a2z3MJ (possibly better w/ std::fill)\r\n4. Copy fill w/ nontrivial type: https://gcc.godbolt.org/z/gB50DT (difference discussed below)\r\n\r\nIn both functions, when a trivial type is used there is no difference or the `std::fill` version is slightly better.\r\n\r\nIn both functions, when a nontrivial type is used, it gets better optimized with the `std::fill` version. You can see this by changing the optimization level from `-O2` to `-O3` and notice them both turn into almost the same code, but with the `std::fill` version still being about 10 instructions shorter. Without diving deeper into this, my estimation is that the `std::fill` version can be \"seen\" more clearly by the optimizer which is why it results in the same code with fewer optimizers enabled. ",
      "created_at" : "2018-11-04T23:46:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435720118",
      "id" : 435720118,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTcyMDExOA==",
      "updated_at" : "2018-11-04T23:46:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435720118",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/639247?v=4",
         "events_url" : "https://api.github.com/users/ldm5180/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ldm5180/followers",
         "following_url" : "https://api.github.com/users/ldm5180/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ldm5180/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ldm5180",
         "id" : 639247,
         "login" : "ldm5180",
         "node_id" : "MDQ6VXNlcjYzOTI0Nw==",
         "organizations_url" : "https://api.github.com/users/ldm5180/orgs",
         "received_events_url" : "https://api.github.com/users/ldm5180/received_events",
         "repos_url" : "https://api.github.com/users/ldm5180/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ldm5180/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ldm5180/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ldm5180"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK; from what I read is that for character types `std::fill` is generally compiled similar to `memset` would, so I expect no performance regression here.",
      "created_at" : "2018-11-04T23:52:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-435720604",
      "id" : 435720604,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTcyMDYwNA==",
      "updated_at" : "2018-11-04T23:52:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435720604",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14651#discussion_r230623457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230623457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: please follow the style guide (4 space indendation, here and elsewhere).",
      "commit_id" : "76e13b586ff690dd3312f719f305c0d1021cd505",
      "created_at" : "2018-11-05T02:53:34Z",
      "diff_hunk" : "@@ -198,22 +199,11 @@ class prevector {\n     const T* item_ptr(difference_type pos) const { return is_direct() ? direct_ptr(pos) : indirect_ptr(pos); }\n \n     void fill(T* dst, ptrdiff_t count) {\n-        if (IS_TRIVIALLY_CONSTRUCTIBLE<T>::value) {\n-            // The most common use of prevector is where T=unsigned char. For\n-            // trivially constructible types, we can use memset() to avoid\n-            // looping.\n-            ::memset(dst, 0, count * sizeof(T));\n-        } else {\n-            for (auto i = 0; i < count; ++i) {\n-                new(static_cast<void*>(dst + i)) T();\n-            }\n-        }\n+      std::fill_n(dst, count, T{});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#discussion_r230623457",
      "id" : 230623457,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDYyMzQ1Nw==",
      "original_commit_id" : "aa6f3d7db443c1154eda78f6fb006a69aa20ce3a",
      "original_position" : 22,
      "path" : "src/prevector.h",
      "position" : null,
      "pull_request_review_id" : 171400896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14651",
      "updated_at" : "2018-11-05T03:51:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230623457",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14651#discussion_r230628947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230628947"
         }
      },
      "author_association" : "NONE",
      "body" : "Oops. Fixed.",
      "commit_id" : "76e13b586ff690dd3312f719f305c0d1021cd505",
      "created_at" : "2018-11-05T03:51:27Z",
      "diff_hunk" : "@@ -198,22 +199,11 @@ class prevector {\n     const T* item_ptr(difference_type pos) const { return is_direct() ? direct_ptr(pos) : indirect_ptr(pos); }\n \n     void fill(T* dst, ptrdiff_t count) {\n-        if (IS_TRIVIALLY_CONSTRUCTIBLE<T>::value) {\n-            // The most common use of prevector is where T=unsigned char. For\n-            // trivially constructible types, we can use memset() to avoid\n-            // looping.\n-            ::memset(dst, 0, count * sizeof(T));\n-        } else {\n-            for (auto i = 0; i < count; ++i) {\n-                new(static_cast<void*>(dst + i)) T();\n-            }\n-        }\n+      std::fill_n(dst, count, T{});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#discussion_r230628947",
      "id" : 230628947,
      "in_reply_to_id" : 230623457,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDYyODk0Nw==",
      "original_commit_id" : "aa6f3d7db443c1154eda78f6fb006a69aa20ce3a",
      "original_position" : 22,
      "path" : "src/prevector.h",
      "position" : null,
      "pull_request_review_id" : 171407353,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14651",
      "updated_at" : "2018-11-05T03:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230628947",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/639247?v=4",
         "events_url" : "https://api.github.com/users/ldm5180/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ldm5180/followers",
         "following_url" : "https://api.github.com/users/ldm5180/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ldm5180/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ldm5180",
         "id" : 639247,
         "login" : "ldm5180",
         "node_id" : "MDQ6VXNlcjYzOTI0Nw==",
         "organizations_url" : "https://api.github.com/users/ldm5180/orgs",
         "received_events_url" : "https://api.github.com/users/ldm5180/received_events",
         "repos_url" : "https://api.github.com/users/ldm5180/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ldm5180/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ldm5180/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ldm5180"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Expect, no impact. Is there a performance analysis test suite?\r\n\r\nYes, there is `src/bench/bench_bitcoin`.\r\nAs the whole point of prevector is to be an optimization, I'd really prefer to see benchmarks here (if possible, both of gcc's and clang's standard library) and not make guesses.\r\n",
      "created_at" : "2018-11-06T16:20:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-436313217",
      "id" : 436313217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjMxMzIxNw==",
      "updated_at" : "2018-11-06T16:20:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436313217",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ldm5180 Very nice first time contribution! Hope to see more contributions from you!\r\n\r\nEchoing @laanwj - I'd also be interested in benchmark results.",
      "created_at" : "2018-11-06T16:37:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-436319760",
      "id" : 436319760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjMxOTc2MA==",
      "updated_at" : "2018-11-06T16:38:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436319760",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I think the important benchmarks are the `PrevectorResize*`, but I just included all the `Prevector` tests.\r\n\r\nThe differences between g++ and clang++ are pretty stark, but the numbers within each version are very similar. Running them several times shows that they are not super stable number (at least on my machine). I don't know what your target is for acceptable, but here are some results:\r\nPrevectorResizeNontrivial: clang gets ~4.8% faster, gcc gets ~0.4% slower\r\nPrevectorResizeTrivial: clang gets ~3.7% slower, gcc gets ~0.1% slower\r\n\r\nFor clang, these might be outside the margin of error. For gcc, I don't think it is.\r\n\r\nBaseline GCC:\r\n```\r\n# Benchmark, evals, iterations, total, min, max, median\r\nPrevectorClearNontrivial, 10, 28300, 11.1891, 3.92909e-05, 4.03267e-05, 3.94721e-05\r\nPrevectorClearTrivial, 10, 88600, 12.7673, 1.43817e-05, 1.44577e-05, 1.44081e-05\r\nPrevectorDeserializeNontrivial, 10, 6800, 4.29737, 6.28875e-05, 6.33766e-05, 6.32723e-05\r\nPrevectorDeserializeTrivial, 10, 52000, 4.91249, 9.38555e-06, 9.63038e-06, 9.44697e-06\r\nPrevectorDestructorNontrivial, 10, 28800, 11.379, 3.93948e-05, 3.99467e-05, 3.94788e-05\r\nPrevectorDestructorTrivial, 10, 88900, 12.5935, 1.41116e-05, 1.42736e-05, 1.41555e-05\r\nPrevectorResizeNontrivial, 10, 28900, 7.21061, 2.46638e-05, 2.51662e-05, 2.49783e-05\r\nPrevectorResizeTrivial, 10, 90300, 8.14905, 8.97413e-06, 9.25092e-06, 9.00301e-06\r\n```\r\n\r\nNew version GCC:\r\n```\r\n# Benchmark, evals, iterations, total, min, max, median\r\nPrevectorClearNontrivial, 10, 28300, 11.1975, 3.94149e-05, 3.97891e-05, 3.95875e-05\r\nPrevectorClearTrivial, 10, 88600, 12.814, 1.43741e-05, 1.46315e-05, 1.4468e-05\r\nPrevectorDeserializeNontrivial, 10, 6800, 4.3056, 6.29083e-05, 6.38494e-05, 6.33461e-05\r\nPrevectorDeserializeTrivial, 10, 52000, 4.93494, 9.41098e-06, 9.55156e-06, 9.50646e-06\r\nPrevectorDestructorNontrivial, 10, 28800, 11.3737, 3.92276e-05, 4.03218e-05, 3.93623e-05\r\nPrevectorDestructorTrivial, 10, 88900, 12.5981, 1.41316e-05, 1.42107e-05, 1.41824e-05\r\nPrevectorResizeNontrivial, 10, 28900, 7.25885, 2.47887e-05, 2.59588e-05, 2.50821e-05\r\nPrevectorResizeTrivial, 10, 90300, 8.1371, 8.97296e-06, 9.07207e-06, 9.01449e-06\r\n```\r\n\r\nBaseline Clang:\r\n```\r\n# Benchmark, evals, iterations, total, min, max, median\r\nPrevectorClearNontrivial, 10, 28300, 0.000571983, 2.00424e-09, 2.0771e-09, 2.0183e-09\r\nPrevectorClearTrivial, 10, 88600, 0.00176638, 1.9287e-09, 2.15058e-09, 2.00778e-09\r\nPrevectorDeserializeNontrivial, 10, 6800, 10.3682, 0.000151424, 0.000155099, 0.00015202\r\nPrevectorDeserializeTrivial, 10, 52000, 7.87747, 1.50409e-05, 1.55236e-05, 1.51269e-05\r\nPrevectorDestructorNontrivial, 10, 28800, 0.000430928, 1.25281e-09, 2.40497e-09, 1.27898e-09\r\nPrevectorDestructorTrivial, 10, 88900, 0.00119125, 1.26731e-09, 1.63589e-09, 1.26902e-09\r\nPrevectorResizeNontrivial, 10, 28900, 2.05184, 7.05283e-06, 7.19934e-06, 7.09096e-06\r\nPrevectorResizeTrivial, 10, 90300, 6.48936, 7.11218e-06, 7.44356e-06, 7.17658e-06\r\n```\r\n\r\nNew version Clang:\r\n```\r\n# Benchmark, evals, iterations, total, min, max, median                                     \r\nPrevectorClearNontrivial, 10, 28300, 0.000853285, 2.86014e-09, 3.48901e-09, 3.00078e-09     \r\nPrevectorClearTrivial, 10, 88600, 0.00264027, 2.52998e-09, 3.13509e-09, 3.02476e-09         \r\nPrevectorDeserializeNontrivial, 10, 6800, 10.4545, 0.000152216, 0.000155233, 0.000153983    \r\nPrevectorDeserializeTrivial, 10, 52000, 9.68222, 1.85139e-05, 1.89764e-05, 1.85454e-05      \r\nPrevectorDestructorNontrivial, 10, 28800, 0.000431799, 1.25712e-09, 2.39365e-09, 1.27613e-09\r\nPrevectorDestructorTrivial, 10, 88900, 0.00118995, 1.25501e-09, 1.64991e-09, 1.27141e-09    \r\nPrevectorResizeNontrivial, 10, 28900, 1.95072, 6.57969e-06, 7.14017e-06, 6.75173e-06        \r\nPrevectorResizeTrivial, 10, 90300, 6.70796, 7.38159e-06, 7.47863e-06, 7.44035e-06           \r\n```\r\n",
      "created_at" : "2018-11-12T00:19:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-437719570",
      "id" : 437719570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzcxOTU3MA==",
      "updated_at" : "2018-11-12T00:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437719570",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/639247?v=4",
         "events_url" : "https://api.github.com/users/ldm5180/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ldm5180/followers",
         "following_url" : "https://api.github.com/users/ldm5180/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ldm5180/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ldm5180",
         "id" : 639247,
         "login" : "ldm5180",
         "node_id" : "MDQ6VXNlcjYzOTI0Nw==",
         "organizations_url" : "https://api.github.com/users/ldm5180/orgs",
         "received_events_url" : "https://api.github.com/users/ldm5180/received_events",
         "repos_url" : "https://api.github.com/users/ldm5180/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ldm5180/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ldm5180/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ldm5180"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ldm5180 thank you for doing benchmarks; so it's not significantly slower with gcc, surprisingly even faster with clang, looks good to me!\r\n\r\nutACK https://github.com/bitcoin/bitcoin/pull/14651/commits/76e13b586ff690dd3312f719f305c0d1021cd505",
      "created_at" : "2018-11-12T09:35:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-437814662",
      "id" : 437814662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzgxNDY2Mg==",
      "updated_at" : "2018-11-12T09:35:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437814662",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 76e13b5, nice code simplification and tiny performance bonus (with clang).",
      "created_at" : "2018-11-12T11:19:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14651#issuecomment-437844485",
      "id" : 437844485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzg0NDQ4NQ==",
      "updated_at" : "2018-11-12T11:21:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437844485",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
