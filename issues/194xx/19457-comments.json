[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19619 (Remove wallet.dat path handling from wallet.cpp, rpcwallet.cpp by ryanofsky)\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19077 (wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-06T19:24:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-654421452",
      "id" : 654421452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19457",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NDQyMTQ1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-07T22:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/654421452",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r450736655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450736655"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to ask translators to waste effort when these were previously untranslated and the new translations are unused?",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-07T09:37:22Z",
      "diff_hunk" : "@@ -15,13 +16,13 @@ static const char *HEADER_END = \"HEADER=END\";\n static const char *DATA_END = \"DATA=END\";\n typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n \n-bool RecoverDatabaseFile(const fs::path& file_path)\n+bool RecoverDatabaseFile(const fs::path& file_path, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n     if (!env->Open(true /* retry */)) {\n-        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        error = strprintf(_(\"Error initializing wallet database environment %s!\"), env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r450736655",
      "id" : 450736655,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczNjY1NQ==",
      "original_commit_id" : "e3243b232aade4b9615db247762d20b0d8d88c4a",
      "original_line" : 25,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 443726292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450736655",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r450918303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450918303"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since these are utility functions, we might add them to the gui in the future. Or maybe add a gui to the wallettool to make it more user friendly. I wanted to make sure that we could use these in the gui if we wanted to.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-07T14:42:13Z",
      "diff_hunk" : "@@ -15,13 +16,13 @@ static const char *HEADER_END = \"HEADER=END\";\n static const char *DATA_END = \"DATA=END\";\n typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n \n-bool RecoverDatabaseFile(const fs::path& file_path)\n+bool RecoverDatabaseFile(const fs::path& file_path, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n     if (!env->Open(true /* retry */)) {\n-        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        error = strprintf(_(\"Error initializing wallet database environment %s!\"), env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r450918303",
      "id" : 450918303,
      "in_reply_to_id" : 450736655,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxODMwMw==",
      "original_commit_id" : "e3243b232aade4b9615db247762d20b0d8d88c4a",
      "original_line" : 25,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 443960697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450918303",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r455038868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/455038868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd prefer to err on the side of not adding a translation message if it's not currently used. This can always be done when necessary.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-15T13:11:26Z",
      "diff_hunk" : "@@ -15,13 +16,13 @@ static const char *HEADER_END = \"HEADER=END\";\n static const char *DATA_END = \"DATA=END\";\n typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n \n-bool RecoverDatabaseFile(const fs::path& file_path)\n+bool RecoverDatabaseFile(const fs::path& file_path, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n     if (!env->Open(true /* retry */)) {\n-        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        error = strprintf(_(\"Error initializing wallet database environment %s!\"), env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r455038868",
      "id" : 455038868,
      "in_reply_to_id" : 450736655,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzODg2OA==",
      "original_commit_id" : "e3243b232aade4b9615db247762d20b0d8d88c4a",
      "original_line" : 25,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 448936992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/455038868",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r455146536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/455146536"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've changed these to use `Untranslated`.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-15T15:36:35Z",
      "diff_hunk" : "@@ -15,13 +16,13 @@ static const char *HEADER_END = \"HEADER=END\";\n static const char *DATA_END = \"DATA=END\";\n typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n \n-bool RecoverDatabaseFile(const fs::path& file_path)\n+bool RecoverDatabaseFile(const fs::path& file_path, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n     if (!env->Open(true /* retry */)) {\n-        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        error = strprintf(_(\"Error initializing wallet database environment %s!\"), env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r455146536",
      "id" : 455146536,
      "in_reply_to_id" : 450736655,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0NjUzNg==",
      "original_commit_id" : "e3243b232aade4b9615db247762d20b0d8d88c4a",
      "original_line" : 25,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 449079160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/455146536",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r458546966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458546966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style nit in commit \"wallettool: ...\"\r\n\r\nA range based for loop does not need to be guarded by a size check, so you can remove the `if (warnings.size() > 0)`",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-22T05:41:22Z",
      "diff_hunk" : "@@ -147,7 +126,20 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Flush(true);\n         } else if (command == \"salvage\") {\n-            return SalvageWallet(path);\n+            bilingual_str error;\n+            std::vector<bilingual_str> warnings;\n+            bool ret = RecoverDatabaseFile(path, error, warnings);\n+            if (!ret) {\n+                if (warnings.size() > 0) {\n+                    for (const auto warning : warnings) {\n+                        tfm::format(std::cerr, \"%s\\n\", warning.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r458546966",
      "id" : 458546966,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0Njk2Ng==",
      "original_commit_id" : "7dcb47bf89729d3959efd18a9d6808175b6b85ca",
      "original_line" : 135,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 453008867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458546966",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-22T07:38:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-662296098",
      "id" : 662296098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19457",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MjI5NjA5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-22T07:38:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662296098",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r458928962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458928962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-22T16:34:42Z",
      "diff_hunk" : "@@ -147,7 +126,20 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Flush(true);\n         } else if (command == \"salvage\") {\n-            return SalvageWallet(path);\n+            bilingual_str error;\n+            std::vector<bilingual_str> warnings;\n+            bool ret = RecoverDatabaseFile(path, error, warnings);\n+            if (!ret) {\n+                if (warnings.size() > 0) {\n+                    for (const auto warning : warnings) {\n+                        tfm::format(std::cerr, \"%s\\n\", warning.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r458928962",
      "id" : 458928962,
      "in_reply_to_id" : 458546966,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyODk2Mg==",
      "original_commit_id" : "7dcb47bf89729d3959efd18a9d6808175b6b85ca",
      "original_line" : 135,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 453492506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458928962",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. I've also added a commit that fixes the first error in #19078",
      "created_at" : "2020-07-22T16:35:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-662557978",
      "id" : 662557978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19457",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MjU1Nzk3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-22T16:35:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662557978",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460241977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460241977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Return false instead of asserting when a loaded tx isn't new\" (21349ec568abd5b25b6ca722aa6a9df3037fa4e8)\r\n\r\nThis definitely needs a comment. I don't understand when this condition happens. Does it indicate corruption or is it a thing expected to happen in certain cases? Comment doesn't need to be involved but should give a clue about what is happening here, since by itself this is enigmatic.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-24T19:17:06Z",
      "diff_hunk" : "@@ -286,7 +286,9 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             // LoadToWallet call below creates a new CWalletTx that fill_wtx\n             // callback fills with transaction metadata.\n             auto fill_wtx = [&](CWalletTx& wtx, bool new_tx) {\n-                assert(new_tx);\n+                if (!new_tx) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460241977",
      "id" : 460241977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI0MTk3Nw==",
      "original_commit_id" : "21349ec568abd5b25b6ca722aa6a9df3037fa4e8",
      "original_line" : 292,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 455127951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460241977",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460376597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460376597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The assert has been added in https://github.com/bitcoin/bitcoin/commit/65b9d8f8ddb5a838454efc8bdd6576f0deb65f6d?w=1 , assuming that adding it does not change behavior. Making it a `return false` would restore the previous behavior instead of crashing.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-25T07:24:17Z",
      "diff_hunk" : "@@ -286,7 +286,9 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             // LoadToWallet call below creates a new CWalletTx that fill_wtx\n             // callback fills with transaction metadata.\n             auto fill_wtx = [&](CWalletTx& wtx, bool new_tx) {\n-                assert(new_tx);\n+                if (!new_tx) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460376597",
      "id" : 460376597,
      "in_reply_to_id" : 460241977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3NjU5Nw==",
      "original_commit_id" : "21349ec568abd5b25b6ca722aa6a9df3037fa4e8",
      "original_line" : 292,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 455268211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460376597",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460376896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460376896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit b27b5f7307:\r\n\r\nwhy is open_error ignored and overwritten?",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-25T07:28:02Z",
      "diff_hunk" : "@@ -16,14 +16,14 @@ static const char *HEADER_END = \"HEADER=END\";\n static const char *DATA_END = \"DATA=END\";\n typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n \n-bool RecoverDatabaseFile(const fs::path& file_path)\n+bool RecoverDatabaseFile(const fs::path& file_path, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n     bilingual_str open_err;\n     if (!env->Open(open_err)) {\n-        tfm::format(std::cerr, \"%s\\n\", open_err.original);\n+        error = strprintf(Untranslated(\"Error initializing wallet database environment %s!\"), env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460376896",
      "id" : 460376896,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3Njg5Ng==",
      "original_commit_id" : "b27b5f73072e1ecbd4de79361fc5609274ed78c2",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 455268378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460376896",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460593044"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460593044"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dunno. I've restored the previous behavior.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-27T00:23:05Z",
      "diff_hunk" : "@@ -16,14 +16,14 @@ static const char *HEADER_END = \"HEADER=END\";\n static const char *DATA_END = \"DATA=END\";\n typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n \n-bool RecoverDatabaseFile(const fs::path& file_path)\n+bool RecoverDatabaseFile(const fs::path& file_path, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n     bilingual_str open_err;\n     if (!env->Open(open_err)) {\n-        tfm::format(std::cerr, \"%s\\n\", open_err.original);\n+        error = strprintf(Untranslated(\"Error initializing wallet database environment %s!\"), env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460593044",
      "id" : 460593044,
      "in_reply_to_id" : 460376896,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU5MzA0NA==",
      "original_commit_id" : "b27b5f73072e1ecbd4de79361fc5609274ed78c2",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 455410089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460593044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460593506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460593506"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This condition can happen with corruption. It means that the db has the same tx in multiple records which shouldn't happen. However this isn't something we should be asserting for because it isn't a critical error where money can be lost. It should be recoverable with rescan, else zapwallettxs will fix it.\r\n\r\nI've added a comment indicating this.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-27T00:26:47Z",
      "diff_hunk" : "@@ -286,7 +286,9 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             // LoadToWallet call below creates a new CWalletTx that fill_wtx\n             // callback fills with transaction metadata.\n             auto fill_wtx = [&](CWalletTx& wtx, bool new_tx) {\n-                assert(new_tx);\n+                if (!new_tx) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460593506",
      "id" : 460593506,
      "in_reply_to_id" : 460241977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU5MzUwNg==",
      "original_commit_id" : "21349ec568abd5b25b6ca722aa6a9df3037fa4e8",
      "original_line" : 292,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 455410550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460593506",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460653761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460653761"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This shouldn't be corruption, or at least it seems to happen in normal operation. All that the test in #19078 does is call `getnewaddress` and `sendmany`",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-27T05:27:09Z",
      "diff_hunk" : "@@ -286,7 +286,9 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             // LoadToWallet call below creates a new CWalletTx that fill_wtx\n             // callback fills with transaction metadata.\n             auto fill_wtx = [&](CWalletTx& wtx, bool new_tx) {\n-                assert(new_tx);\n+                if (!new_tx) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460653761",
      "id" : 460653761,
      "in_reply_to_id" : 460241977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY1Mzc2MQ==",
      "original_commit_id" : "21349ec568abd5b25b6ca722aa6a9df3037fa4e8",
      "original_line" : 292,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 455479333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460653761",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460973647"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460973647"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The fact that #19078 is hitting this is probably a result of the aggressive salvage which, afaik, sometimes creates corruption when there isn't corruption. It's probably from BDB shuffling data around (as part of the normal btree operations) and leaving behind records that are marked as deleted but not actually deleted. So the aggressive salvage still finds these \"deleted\" records.",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-07-27T15:25:33Z",
      "diff_hunk" : "@@ -286,7 +286,9 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             // LoadToWallet call below creates a new CWalletTx that fill_wtx\n             // callback fills with transaction metadata.\n             auto fill_wtx = [&](CWalletTx& wtx, bool new_tx) {\n-                assert(new_tx);\n+                if (!new_tx) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460973647",
      "id" : 460973647,
      "in_reply_to_id" : 460241977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3MzY0Nw==",
      "original_commit_id" : "21349ec568abd5b25b6ca722aa6a9df3037fa4e8",
      "original_line" : 292,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 455889760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460973647",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469510175"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Return false instead of asserting when a loaded tx isn't new\" (fbe8816f1a95e266b59b39327da4374a0442e279)\r\n\r\n> The fact that #19078 is hitting this is probably a result of the aggressive salvage\r\n\r\nMaybe this change is ultimately the right one, but until we clearly understand what is happening I think it would be better to either drop this commit and follow up in a separate PR, or  update the commit to ensure the error is not ignored like:\r\n\r\n```diff\r\n--- a/src/wallet/walletdb.cpp\r\n+++ b/src/wallet/walletdb.cpp\r\n@@ -256,6 +256,7 @@ public:\r\n     std::map<std::pair<uint256, CKeyID>, CKey> m_descriptor_keys;\r\n     std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>> m_descriptor_crypt_keys;\r\n     std::map<uint160, CHDChain> m_hd_chains;\r\n+    bool corrupt = false;\r\n \r\n     CWalletScanState() {\r\n     }\r\n@@ -289,6 +290,7 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\r\n                 if (!new_tx) {\r\n                     // There's probably some corruption here since the tx we just tried to load was already in the wallet\r\n                     // This error is recoverable with zapwallettxs and is not a major failure\r\n+                    wss.corrupt = true;\r\n                     return false;\r\n                 }\r\n                 ssValue >> wtx;\r\n@@ -730,7 +732,7 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\r\n             {\r\n                 // losing keys is considered a catastrophic error, anything else\r\n                 // we assume the user can live with:\r\n-                if (IsKeyType(strType) || strType == DBKeys::DEFAULTKEY) {\r\n+                if (IsKeyType(strType) || strType == DBKeys::DEFAULTKEY || wss.corrupt) {\r\n                     result = DBErrors::CORRUPT;\r\n                 } else if (strType == DBKeys::FLAGS) {\r\n                     // reading the wallet flags can only fail if unknown flags are present\r\n```\r\n",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-08-12T20:07:15Z",
      "diff_hunk" : "@@ -286,7 +286,9 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             // LoadToWallet call below creates a new CWalletTx that fill_wtx\n             // callback fills with transaction metadata.\n             auto fill_wtx = [&](CWalletTx& wtx, bool new_tx) {\n-                assert(new_tx);\n+                if (!new_tx) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175",
      "id" : 469510175,
      "in_reply_to_id" : 460241977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUxMDE3NQ==",
      "original_commit_id" : "21349ec568abd5b25b6ca722aa6a9df3037fa4e8",
      "original_line" : 292,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 466234730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-13T00:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469510175",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've dropped the last commit. I agree it doesn't fit well here and can be for a followup.",
      "created_at" : "2020-08-13T00:12:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-673170794",
      "id" : 673170794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19457",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzE3MDc5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T00:12:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673170794",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r470453427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470453427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Are there any followups queued for this file, or did you want to fix this now?\r\n\r\n```bash\r\nwallet/wallettool.cpp:133:33: warning: loop variable 'warning' of type 'const bilingual_str' creates a copy from type 'const bilingual_str' [-Wrange-loop-analysis]\r\n                for (const auto warning : warnings) {\r\n                                ^\r\nwallet/wallettool.cpp:133:22: note: use reference type 'const bilingual_str &' to prevent copying\r\n                for (const auto warning : warnings) {\r\n                     ^~~~~~~~~~~~~~~~~~~~\r\n1 warning generated.\r\n```",
      "commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "created_at" : "2020-08-14T07:20:23Z",
      "diff_hunk" : "@@ -147,7 +126,18 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Flush(true);\n         } else if (command == \"salvage\") {\n-            return SalvageWallet(path);\n+            bilingual_str error;\n+            std::vector<bilingual_str> warnings;\n+            bool ret = RecoverDatabaseFile(path, error, warnings);\n+            if (!ret) {\n+                for (const auto warning : warnings) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#discussion_r470453427",
      "id" : 470453427,
      "line" : 133,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ1MzQyNw==",
      "original_commit_id" : "0e279fe4899beae8630264ef1fe420dd71f29d5d",
      "original_line" : 133,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 37,
      "pull_request_review_id" : 467358101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19457",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-14T07:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470453427",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky Are you going to submit this patch as a pull: https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175 ?",
      "created_at" : "2020-08-14T13:25:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-674073384",
      "id" : 674073384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19457",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDA3MzM4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T13:25:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674073384",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky Are you going to submit this patch as a pull: [#19457 (comment)](https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175) ?\r\n\r\nSure, created #19793",
      "created_at" : "2020-08-24T20:08:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-679339437",
      "id" : 679339437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19457",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3OTMzOTQzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-24T20:08:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/679339437",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
