{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "**Is your feature request related to a problem? Please describe.**\r\n\r\nCurrently the streams (e.g. `CDataStream`, `CVectorWriter`) classes use a \"protocol version\" which defines how something should be written to or read from the stream.\r\n\r\nThis is not flexible enough because in some cases the content does not depend on the protocol, but depends on other things. In order to workaround this limitation the code is sneaking some constants into the \"protocol version\" to tune the (un)serialize behavior. Two examples:\r\n\r\n1. `SERIALIZE_TRANSACTION_NO_WITNESS` - to control whether witnesses should be present or not.\r\n\r\n2. `ADDRv2_FORMAT` (from https://github.com/bitcoin/bitcoin/pull/19031, not yet merged at the time of writing) to control whether addresses should be (un)serialized in ADDRv2/[BIP155](https://github.com/bitcoin/bips/blob/master/bip-0155.mediawiki) format.\r\n\r\nThis is problematic because once such a constant is bitwise-OR-ed into the protocol version then code that checks for a particular version becomes invalid, e.g. `version == SENDHEADERS_VERSION` or `version > CADDR_TIME_VERSION`. Also, it is outright [confusing](https://github.com/bitcoin/bitcoin/pull/19031#discussion_r450941410).\r\n\r\n**Describe the solution you'd like**\r\n\r\nIntroduce \"flags\" to the streams, mimicking [iostream::setf()](http://www.cplusplus.com/reference/ios/ios_base/setf/), independent from the \"protocol version\". And manipulate them like:\r\n\r\n```cpp\r\ns.SetFlag(SERIALIZE_TRANSACTION_NO_WITNESS)\r\ns.RemoveFlag(SERIALIZE_TRANSACTION_NO_WITNESS)\r\ns.IsFlagSet(SERIALIZE_TRANSACTION_NO_WITNESS)\r\n```",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19477/comments",
   "created_at" : "2020-07-09T19:43:45Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19477/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/19477",
   "id" : 654304466,
   "labels" : [
      {
         "color" : "7cf575",
         "default" : false,
         "description" : null,
         "id" : 64583,
         "name" : "Feature",
         "node_id" : "MDU6TGFiZWw2NDU4Mw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19477/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU2NTQzMDQ0NjY=",
   "number" : 19477,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Add \"flags\" capability to streams",
   "updated_at" : "2020-07-09T20:20:12Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19477",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
      "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
      "followers_url" : "https://api.github.com/users/vasild/followers",
      "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/vasild",
      "id" : 266751,
      "login" : "vasild",
      "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
      "organizations_url" : "https://api.github.com/users/vasild/orgs",
      "received_events_url" : "https://api.github.com/users/vasild/received_events",
      "repos_url" : "https://api.github.com/users/vasild/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/vasild"
   }
}
