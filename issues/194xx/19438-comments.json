[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22371 by MarcoFalke\n* #22242 by MarcoFalke\n* #21702 by JeremyRubin\n* #21430 by hebasto\n* #21090 by dhruv\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-03T19:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-653660370",
      "id" : 653660370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MzY2MDM3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T01:51:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653660370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695222"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "prefer enum class to prevent leaking names.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T20:10:16Z",
      "diff_hunk" : "@@ -11,6 +11,15 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695222",
      "id" : 449695222,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTIyMg==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 14,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 442550162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also helps with avoiding overlap with SignalledDeployment.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T20:10:55Z",
      "diff_hunk" : "@@ -11,6 +11,15 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695331",
      "id" : 449695331,
      "in_reply_to_id" : 449695222,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTMzMQ==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 14,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 442550162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695480"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "prefer explicitly numbering these.\r\n\r\n-255 is an extremely odd number, can you clarify why you picked it? It doesn't fit in a signed byte.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T20:11:55Z",
      "diff_hunk" : "@@ -11,6 +11,15 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment\n+{\n+    // buried deployments get negative values to avoid overlap with SignalledDeployment\n+    DEPLOYMENT_CLTV = -255,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695480",
      "id" : 449695480,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTQ4MA==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 21,
      "original_position" : 10,
      "original_start_line" : 17,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 442550162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695754"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe tighter to make this a templated function as we're never calling DeploymentHeight with a variable, only literal.\r\n\r\nThen we get not just a warning, but a compiler error.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T20:13:43Z",
      "diff_hunk" : "@@ -80,7 +89,19 @@ struct Params {\n     int64_t DifficultyAdjustmentInterval() const { return nPowTargetTimespan / nPowTargetSpacing; }\n     uint256 nMinimumChainWork;\n     uint256 defaultAssumeValid;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695754",
      "id" : 449695754,
      "line" : 116,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTc1NA==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 116,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 33,
      "pull_request_review_id" : 442550162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "dates",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T20:15:11Z",
      "diff_hunk" : "@@ -0,0 +1,53 @@\n+// Copyright (c) 2016-2019 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449695981",
      "id" : 449695981,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTk4MQ==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 442550162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449695981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449696529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449696529"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This dispatch scares me a bit unless we use enum class -- enums could coerce poorly right?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T20:18:25Z",
      "diff_hunk" : "@@ -0,0 +1,53 @@\n+// Copyright (c) 2016-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+#include <sync.h>\n+#include <versionbits.h>\n+\n+#include <limits>\n+\n+extern RecursiveMutex cs_main;\n+\n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache GUARDED_BY(cs_main);\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449696529",
      "id" : 449696529,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NjUyOQ==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 17,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 17,
      "pull_request_review_id" : 442550162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449696529",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449704885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449704885"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Leaking the names is the point -- otherwise you'd need to change every use from `Consensus::DeploymentPos::SEGWIT` to `Consensus::BuriedDeployment::SEGWIT`. With C++20, you will be able to specify `enum class DeploymentPos { .. }; using enum DeploymentPos;` but that's a while away.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T21:14:10Z",
      "diff_hunk" : "@@ -11,6 +11,15 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449704885",
      "id" : 449704885,
      "in_reply_to_id" : 449695222,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwNDg4NQ==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 14,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 442560869,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449704885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449707076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449707076"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I had tried that, but thought that it might be useful to be able to do `for (dep = 0; dep < MAX_VERSIONBITS_DEPLOYMENTS; ++dep) { ... DeploymentActiveAt(pindex, consParams, dep) .. }`. I think in all the cases where that currently comes up you want to know more fine grained details though. (Changing `BuriedForkDescPushBack` to take a BuriedDeployment instead of a height would make use of that, eg)\r\n\r\nI don't think the type checking is any better with the template though, as unfortunately you can invoke `DeploymentHeight<(BuriedDeployment)9000>()` just as easily as `DeploymentHeight((BuriedDeployment)9000)` with both g++ and clang++.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T21:29:49Z",
      "diff_hunk" : "@@ -80,7 +89,19 @@ struct Params {\n     int64_t DifficultyAdjustmentInterval() const { return nPowTargetTimespan / nPowTargetSpacing; }\n     uint256 nMinimumChainWork;\n     uint256 defaultAssumeValid;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449707076",
      "id" : 449707076,
      "in_reply_to_id" : 449695754,
      "line" : 116,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwNzA3Ng==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 116,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 33,
      "pull_request_review_id" : 442563065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449707076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449708147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449708147"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope; int (and the like) won't automatically coerce to enum, so with `int x = Consensus::DEPLOYMENT_SEGWIT; return DeploymentActiveAt(pindex, params, x)` you get errors:\r\n\r\n```\r\nvalidation.cpp:1921:12: error: no matching function for call to 'DeploymentActiveAt'\r\n    return DeploymentActiveAt(pindex, consensusparams, x);\r\n           ^~~~~~~~~~~~~~~~~~\r\n./deploymentstatus.h:32:13: note: candidate function not viable: no known conversion from 'int' to 'Consensus::BuriedDeployment' for 3rd argument\r\ninline bool DeploymentActiveAt(const CBlockIndex* pindex, const Consensus::Params& params, Consensus::BuriedDeployment dep)\r\n            ^\r\n./deploymentstatus.h:37:13: note: candidate function not viable: no known conversion from 'int' to 'Consensus::DeploymentPos' for 3rd argument\r\ninline bool DeploymentActiveAt(const CBlockIndex* pindex, const Consensus::Params& params, Consensus::DeploymentPos dep) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n            ^\r\n```\r\n\r\n(even if it did, which enum it coerced to is ambiguous between the two types, resulting in a failure like `error: call to 'DeploymentActiveAt' is ambiguous`)",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T21:38:43Z",
      "diff_hunk" : "@@ -0,0 +1,53 @@\n+// Copyright (c) 2016-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+#include <sync.h>\n+#include <versionbits.h>\n+\n+#include <limits>\n+\n+extern RecursiveMutex cs_main;\n+\n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache GUARDED_BY(cs_main);\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449708147",
      "id" : 449708147,
      "in_reply_to_id" : 449696529,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwODE0Nw==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 17,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 17,
      "pull_request_review_id" : 442564187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449708147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449712349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449712349"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Explicitly numbering them risks accidentally repeating a number. No particular objection to a different starting point. Could perhaps make it `enum DeploymentPos : uint8_t` and `enum BuriedDeployment : int16_t { DEPLOYMENT_CLTV = 256, // larger than largest possible DeploymentPos value`.\r\n\r\n(I guess `2**n` is an \"extremely even\" number, so calling  `+/- 2**n-1` \"extremely odd\" makes a lot of sense...)",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-07-03T22:16:14Z",
      "diff_hunk" : "@@ -11,6 +11,15 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment\n+{\n+    // buried deployments get negative values to avoid overlap with SignalledDeployment\n+    DEPLOYMENT_CLTV = -255,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r449712349",
      "id" : 449712349,
      "in_reply_to_id" : 449695480,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcxMjM0OQ==",
      "original_commit_id" : "5834cc86540f9854736f6e0478e1348ca3b4290c",
      "original_line" : 21,
      "original_position" : 10,
      "original_start_line" : 17,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 442568351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449712349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T17:40:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-688451949",
      "id" : 688451949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODQ1MTk0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T17:40:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688451949",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-08T20:46:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-689126846",
      "id" : 689126846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTEyNjg0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-08T20:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689126846",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-21T22:20:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-696409373",
      "id" : 696409373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NjQwOTM3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-21T22:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/696409373",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-10-15T11:09:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-709204291",
      "id" : 709204291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTIwNDI5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-15T11:09:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709204291",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549065742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549065742"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any chance of just introducing a new lock for the versionbitscache, to avoid this semantically-cyclic dependency between validation and deploymentstatus?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-12-27T05:00:49Z",
      "diff_hunk" : "@@ -0,0 +1,52 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+#include <sync.h>\n+#include <versionbits.h>\n+\n+#include <limits>\n+\n+extern RecursiveMutex cs_main;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549065742",
      "id" : 549065742,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA2NTc0Mg==",
      "original_commit_id" : "60de491a030011f3caeb42f0b650a1028905c54d",
      "original_line" : 14,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 558903894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549065742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549898915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549898915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, can make `VersionBitsCache` be natively threadsafe, rather than having the caller manage a mutex (which should help if it ever ends up having some sort of shared lock too). I've done that, though I've added the lock as the first commit, since I think that makes the impact of the change clearer.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-12-30T00:45:03Z",
      "diff_hunk" : "@@ -0,0 +1,52 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+#include <sync.h>\n+#include <versionbits.h>\n+\n+#include <limits>\n+\n+extern RecursiveMutex cs_main;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549898915",
      "id" : 549898915,
      "in_reply_to_id" : 549065742,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg5ODkxNQ==",
      "original_commit_id" : "60de491a030011f3caeb42f0b650a1028905c54d",
      "original_line" : 14,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 559748619,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549898915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549976688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549976688"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"[refactor] Add deploymentstatus.h\":\r\n\r\nYUUUUGE nit: missing parenthesis in comment",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-12-30T07:16:59Z",
      "diff_hunk" : "@@ -0,0 +1,30 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+\n+#include <limits>\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n+}\n+\n+/** Determine if a deployment is active for this block */\n+inline bool DeploymentActiveAt(const CBlockIndex* pindex, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    return pindex->nHeight >= params.DeploymentHeight(dep);\n+}\n+\n+/** Determine if a deployment is enabled (can ever be active */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549976688",
      "id" : 549976688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk3NjY4OA==",
      "original_commit_id" : "318370aa0e5b08c157c95ffda3d18906468c4ff7",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 559933443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549976688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549979188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549979188"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"[refactor] Add deploymentstatus.h\":\r\n\r\nIs this \"EXCLUSIVE_LOCKS_REQUIRED(cs_main)\" still needed?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-12-30T07:20:36Z",
      "diff_hunk" : "@@ -3461,13 +3448,13 @@ static bool ContextualCheckBlockHeader(const CBlockHeader& block, BlockValidatio\n  *  in ConnectBlock().\n  *  Note that -reindex-chainstate skips the validation that happens here!\n  */\n-static bool ContextualCheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev)\n+static bool ContextualCheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549979188",
      "id" : 549979188,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk3OTE4OA==",
      "original_commit_id" : "318370aa0e5b08c157c95ffda3d18906468c4ff7",
      "original_line" : 3451,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 559933443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549979188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549983058"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549983058"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"[refactor] Add versionbits deployments to deploymentstatus.h\":\r\n\r\nPerhaps assert that dep >= 0 in these functions (and dep < 0 for the buried ones)?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2020-12-30T07:25:47Z",
      "diff_hunk" : "@@ -6,25 +6,44 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r549983058",
      "id" : 549983058,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk4MzA1OA==",
      "original_commit_id" : "a323cdf30e05d2a3d853a342aeddb271dbe490cf",
      "original_line" : 24,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 559933443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549983058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@JeremyRubin Have your comments been addressed?",
      "created_at" : "2020-12-30T20:55:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-752755310",
      "id" : 752755310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1Mjc1NTMxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-30T20:55:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752755310",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-31T17:59:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-753016995",
      "id" : 753016995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MzAxNjk5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-31T17:59:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753016995",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r550856669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550856669"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added a `ValidDeployment()` function for checking this with a bit more precision.\r\n\r\nMight be worth revisiting @JeremyRubin's suggestion of using templated functions so it can be a static assertion that's resolved at compile-time? Having looked at it again, I think the only thing that would really end up making awkward is the rpc/blockchain.cpp stuff (ie, it would mean templating the `SoftForkPushBack` function and having the compiler duplicate the code and possibly not de-duplicate it when optimising) but that's not necessarily a big deal.\r\n\r\nI've added a draft commit that switches to templated functions and static_asserts to see what that's like. It does make rpc/blockchain a bit bigger (after compiling with clang) so might need be worth some tweaking to avoid that, and the syntax is a bit clunky, but it seems plausible. Thoughts?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-01-02T07:58:35Z",
      "diff_hunk" : "@@ -6,25 +6,44 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r550856669",
      "id" : 550856669,
      "in_reply_to_id" : 549983058,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDg1NjY2OQ==",
      "original_commit_id" : "a323cdf30e05d2a3d853a342aeddb271dbe490cf",
      "original_line" : 24,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 560625538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550856669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r550856694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550856694"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, don't think so. Removed.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-01-02T07:58:50Z",
      "diff_hunk" : "@@ -3461,13 +3448,13 @@ static bool ContextualCheckBlockHeader(const CBlockHeader& block, BlockValidatio\n  *  in ConnectBlock().\n  *  Note that -reindex-chainstate skips the validation that happens here!\n  */\n-static bool ContextualCheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev)\n+static bool ContextualCheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r550856694",
      "id" : 550856694,
      "in_reply_to_id" : 549979188,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDg1NjY5NA==",
      "original_commit_id" : "318370aa0e5b08c157c95ffda3d18906468c4ff7",
      "original_line" : 3451,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 560625545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550856694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased to after the copyright bump, addressed comments, added a draft commit that switches from runtime to static checks.",
      "created_at" : "2021-01-02T08:07:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-753445789",
      "id" : 753445789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MzQ0NTc4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-02T08:07:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753445789",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Dropped draft commit that made the ValidDeployment checks static_asserts.",
      "created_at" : "2021-01-11T03:41:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-757608615",
      "id" : 757608615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NzYwODYxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-11T03:41:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/757608615",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r554675546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/554675546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Okay, dropped the templated approach as too unwieldy for not enough benefit, so think this is resolved via `ValidDeployment()`.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-01-11T03:42:03Z",
      "diff_hunk" : "@@ -6,25 +6,44 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r554675546",
      "id" : 554675546,
      "in_reply_to_id" : 549983058,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDY3NTU0Ng==",
      "original_commit_id" : "a323cdf30e05d2a3d853a342aeddb271dbe490cf",
      "original_line" : 24,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 565047777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/554675546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-01T13:10:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-770845886",
      "id" : 770845886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDg0NTg4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T13:10:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770845886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on top of #20749 due to conflict from both PRs changing nearby sections of validation.h",
      "created_at" : "2021-02-02T09:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-771486762",
      "id" : 771486762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTQ4Njc2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-02T09:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771486762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-18T07:57:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-781132485",
      "id" : 781132485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MTEzMjQ4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-18T07:57:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/781132485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r589867085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589867085"
         }
      },
      "author_association" : "MEMBER",
      "body" : "typo: `BuridedDeployment`",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-09T01:15:56Z",
      "diff_hunk" : "@@ -0,0 +1,17 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <deploymentstatus.h>\n+#include <versionbits.h>\n+\n+#include <consensus/params.h>\n+\n+VersionBitsCache versionbitscache;\n+\n+/* Basic sanity checking for BuriedDeployment/DeploymentPos enums and\n+ * ValidDeployment check */\n+\n+static_assert(ValidDeployment(Consensus::DEPLOYMENT_TESTDUMMY), \"sanity check of DeploymentPos failed (TESTDUMMY not valid)\");\n+static_assert(!ValidDeployment(Consensus::MAX_VERSION_BITS_DEPLOYMENTS), \"sanity check of DeploymentPos failed (MAX value considered valid)\");\n+static_assert(!ValidDeployment(static_cast<Consensus::BuriedDeployment>(Consensus::DEPLOYMENT_TESTDUMMY)), \"sanity check of BuridedDeployment failed (overlaps with DeploymentPos)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r589867085",
      "id" : 589867085,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTg2NzA4NQ==",
      "original_commit_id" : "073ae5b33c51fe66800c364830f0b645046150d7",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.cpp",
      "position" : null,
      "pull_request_review_id" : 606850272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589867085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I really like that deployments can be changed from versionbits to buried without any changes to the code in validation and other places.",
      "created_at" : "2021-03-09T18:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-794266520",
      "id" : 794266520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NDI2NjUyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-09T18:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/794266520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r591903943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591903943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "SignalledDeployment == DeploymentPos? \r\n\r\nalthough, I'd probably be down for a rename. I've been wondering what Pos stands for? position? ",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-10T22:01:18Z",
      "diff_hunk" : "@@ -11,13 +11,25 @@\n \n namespace Consensus {\n \n-enum DeploymentPos\n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with SignalledDeployment",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r591903943",
      "id" : 591903943,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkwMzk0Mw==",
      "original_commit_id" : "3a32ec4a0562a009c65182071e822bf556be01a8",
      "original_line" : 16,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 609207081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591903943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r591909479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591909479"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this comment was previously incorrect (`VersionBitsDeploymentInfo` was in `versionbitsinfo.cpp`), but should definitely be updated since as of this PR it is defined in `deploymentinfo.cpp` ",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-10T22:11:18Z",
      "diff_hunk" : "@@ -11,13 +11,25 @@\n \n namespace Consensus {\n \n-enum DeploymentPos\n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with SignalledDeployment\n+    DEPLOYMENT_HEIGHTINCB = std::numeric_limits<int16_t>::min(),\n+    DEPLOYMENT_CLTV,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,\n+};\n+constexpr bool ValidDeployment(BuriedDeployment dep) { return DEPLOYMENT_HEIGHTINCB <= dep && dep <= DEPLOYMENT_SEGWIT; }\n+\n+enum DeploymentPos : uint16_t\n {\n     DEPLOYMENT_TESTDUMMY,\n     DEPLOYMENT_TAPROOT, // Deployment of Schnorr/Taproot (BIPs 340-342)\n     // NOTE: Also add new deployments to VersionBitsDeploymentInfo in versionbits.cpp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r591909479",
      "id" : 591909479,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkwOTQ3OQ==",
      "original_commit_id" : "3a32ec4a0562a009c65182071e822bf556be01a8",
      "original_line" : 29,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 609207081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591909479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r591968358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591968358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"position in the vDeployments\" array, I presume. Yeah, I think I changed it to \"SignalledDeployment\" at some point then dropped it as being too annoying to keep rebasing",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-11T00:02:08Z",
      "diff_hunk" : "@@ -11,13 +11,25 @@\n \n namespace Consensus {\n \n-enum DeploymentPos\n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with SignalledDeployment",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r591968358",
      "id" : 591968358,
      "in_reply_to_id" : 591903943,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTk2ODM1OA==",
      "original_commit_id" : "3a32ec4a0562a009c65182071e822bf556be01a8",
      "original_line" : 16,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 609283968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591968358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Probably a good idea to review #21380 (Fuzzing harness for versionbits) before this one -- ~it has some refactors that will cause this to get rebased, and both the \"speedy trial\" implementations are based on it.~",
      "created_at" : "2021-03-11T04:09:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-796432157",
      "id" : 796432157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NjQzMjE1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-17T05:24:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796432157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Split deploymentinfo rename, DeploymentName and SoftForkPushBack into separate commits. (EDIT: and fix the comments amiti noted)",
      "created_at" : "2021-03-11T06:21:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-796491653",
      "id" : 796491653,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NjQ5MTY1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-11T06:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796491653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594201846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594201846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems a bit strange for this interface to be called 'cache'. I'd say this _has_ a cache, not _is_ a cache.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T10:08:02Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594201846",
      "id" : 594201846,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDIwMTg0Ng==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 78,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 18,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594201846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594204760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594204760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Couple of suggested changes:\r\n\r\n- use `m_` naming convention (and cs -> mutex)\r\n- mark these mutable so the functions can all be `const`\r\n\r\n```suggestion\r\n    mutable Mutex m_mutex;\r\n    mutable ThresholdConditionCache m_caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS] GUARDED_BY(cs);\r\n```",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T10:12:25Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache\n {\n-    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+private:\n+    Mutex cs;\n+    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS] GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594204760",
      "id" : 594204760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDIwNDc2MA==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 82,
      "original_position" : 24,
      "original_start_line" : 81,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594204760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594206873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594206873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What's the benefit of specifically these two functions being `static`? There will only ever be one instance of `VersionBitsCache` so theoretically everything here could be static. I'd suggest just dropping the `static` here.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T10:15:37Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache\n {\n-    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+private:\n+    Mutex cs;\n+    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS] GUARDED_BY(cs);\n+\n+public:\n+    /** Get the numerical statistics for the BIP9 state for a given deployment as at pindexPrev. */\n+    static BIP9Stats Statistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos);\n+\n+    static uint32_t Mask(const Consensus::Params& params, Consensus::DeploymentPos pos);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594206873",
      "id" : 594206873,
      "line" : 88,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDIwNjg3Mw==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 88,
      "original_position" : 30,
      "original_start_line" : 86,
      "path" : "src/versionbits.h",
      "position" : 29,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : 86,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594206873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594226697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594226697"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can use the underlying type of the enum rather than casting it to an int:\r\n\r\n```suggestion\r\n    for (std::underlying_type<Consensus::DeploymentPos>::type i = 0; i < Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {\r\n```",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T10:44:10Z",
      "diff_hunk" : "@@ -185,28 +185,47 @@ class VersionBitsConditionChecker : public AbstractThresholdConditionChecker {\n \n } // namespace\n \n-ThresholdState VersionBitsState(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache)\n+ThresholdState VersionBitsCache::State(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n-    return VersionBitsConditionChecker(pos).GetStateFor(pindexPrev, params, cache.caches[pos]);\n+    LOCK(cs);\n+    return VersionBitsConditionChecker(pos).GetStateFor(pindexPrev, params, caches[pos]);\n }\n \n-BIP9Stats VersionBitsStatistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n+BIP9Stats VersionBitsCache::Statistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n     return VersionBitsConditionChecker(pos).GetStateStatisticsFor(pindexPrev, params);\n }\n \n-int VersionBitsStateSinceHeight(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache)\n+int VersionBitsCache::StateSinceHeight(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n-    return VersionBitsConditionChecker(pos).GetStateSinceHeightFor(pindexPrev, params, cache.caches[pos]);\n+    LOCK(cs);\n+    return VersionBitsConditionChecker(pos).GetStateSinceHeightFor(pindexPrev, params, caches[pos]);\n }\n \n-uint32_t VersionBitsMask(const Consensus::Params& params, Consensus::DeploymentPos pos)\n+uint32_t VersionBitsCache::Mask(const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n     return VersionBitsConditionChecker(pos).Mask(params);\n }\n \n+int32_t VersionBitsCache::ComputeBlockVersion(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    LOCK(cs);\n+    int32_t nVersion = VERSIONBITS_TOP_BITS;\n+\n+    for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594226697",
      "id" : 594226697,
      "line" : 220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDIyNjY5Nw==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 220,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 37,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594226697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594230875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594230875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment can be removed. We're no longer interested in the activation method now that these deployments are buried.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T10:49:55Z",
      "diff_hunk" : "@@ -3491,11 +3458,12 @@ static bool ContextualCheckBlockHeader(const CBlockHeader& block, BlockValidatio\n \n     // Reject outdated version blocks when 95% (75% on testnet) of the network has upgraded:\n     // check for version 2, 3 and 4 upgrades",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594230875",
      "id" : 594230875,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDIzMDg3NQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 3460,
      "original_position" : 160,
      "original_start_line" : 3459,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594230875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594231581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594231581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    // Start enforcing Taproot.\r\n```\r\n\r\nActually, all of these comments can have s/Start enforcing/Enforce/.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T10:50:49Z",
      "diff_hunk" : "@@ -1881,32 +1854,32 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n \n     // Enforce WITNESS rules whenever P2SH is in effect (and the segwit\n     // deployment is defined).\n-    if (flags & SCRIPT_VERIFY_P2SH && IsScriptWitnessEnabled(consensusparams)) {\n+    if (flags & SCRIPT_VERIFY_P2SH && DeploymentEnabled(consensusparams, Consensus::DEPLOYMENT_SEGWIT)) {\n         flags |= SCRIPT_VERIFY_WITNESS;\n     }\n \n     // Start enforcing the DERSIG (BIP66) rule\n-    if (pindex->nHeight >= consensusparams.BIP66Height) {\n+    if (DeploymentActiveAt(pindex, consensusparams, Consensus::DEPLOYMENT_DERSIG)) {\n         flags |= SCRIPT_VERIFY_DERSIG;\n     }\n \n     // Start enforcing CHECKLOCKTIMEVERIFY (BIP65) rule\n-    if (pindex->nHeight >= consensusparams.BIP65Height) {\n+    if (DeploymentActiveAt(pindex, consensusparams, Consensus::DEPLOYMENT_CLTV)) {\n         flags |= SCRIPT_VERIFY_CHECKLOCKTIMEVERIFY;\n     }\n \n     // Start enforcing BIP112 (CHECKSEQUENCEVERIFY)\n-    if (pindex->nHeight >= consensusparams.CSVHeight) {\n+    if (DeploymentActiveAt(pindex, consensusparams, Consensus::DEPLOYMENT_CSV)) {\n         flags |= SCRIPT_VERIFY_CHECKSEQUENCEVERIFY;\n     }\n \n     // Start enforcing Taproot using versionbits logic.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594231581",
      "id" : 594231581,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDIzMTU4MQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 1876,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594231581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594255146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594255146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n\r\n#include <consensus/params.h>\r\n#include <versionbits.h>\r\n```",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T11:27:35Z",
      "diff_hunk" : "@@ -0,0 +1,17 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <deploymentstatus.h>\n+#include <versionbits.h>\n+\n+#include <consensus/params.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594255146",
      "id" : 594255146,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDI1NTE0Ng==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 7,
      "original_position" : 8,
      "original_start_line" : 6,
      "path" : "src/deploymentstatus.cpp",
      "position" : null,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594255146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594258168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594258168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n#include <string>\r\n```\r\n\r\n(string.h is the c string library: https://en.cppreference.com/w/cpp/header/cstring)",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-15T11:32:16Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2016-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTINFO_H\n+#define BITCOIN_DEPLOYMENTINFO_H\n+\n+#include <consensus/params.h>\n+\n+#include <string.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594258168",
      "id" : 594258168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDI1ODE2OA==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.h",
      "position" : null,
      "pull_request_review_id" : 612017175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/594258168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "approach ACK, I like the strategy of using enums with safety checks + overloaded functions to abstract buried vs future deployments ",
      "created_at" : "2021-03-16T20:27:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-800581046",
      "id" : 800581046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMDU4MTA0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-16T20:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/800581046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595599351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595599351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In \"versionbits: correct doxygen comments\"\r\n\r\nNit: perhaps it's worth stopping using `pindexPrev` here if it's giving statistics for the specified block rather than its successor?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-16T23:04:33Z",
      "diff_hunk" : "@@ -79,11 +79,11 @@ struct VersionBitsCache\n     void Clear();\n };\n \n-/** Get the BIP9 state for a given deployment at the current tip. */\n+/** Get the BIP9 state for a given deployment for the block after pindexPrev. */\n ThresholdState VersionBitsState(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache);\n-/** Get the numerical statistics for the BIP9 state for a given deployment at the current tip. */\n+/** Get the numerical statistics for the BIP9 state for a given deployment as at pindexPrev. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595599351",
      "id" : 595599351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5OTM1MQ==",
      "original_commit_id" : "898d54177d364a8120c2fcd4cfeaa831121062fd",
      "original_line" : 84,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 613795309,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595599351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595610191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595610191"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jnewbery The class does have members variables, and the non-static member function do access them, so unless those variables become static too (which would be rather ugly), the other member functions can't be.\r\n\r\nI think it doesn't hurt to mark the function that don't need state static.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-16T23:32:50Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache\n {\n-    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+private:\n+    Mutex cs;\n+    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS] GUARDED_BY(cs);\n+\n+public:\n+    /** Get the numerical statistics for the BIP9 state for a given deployment as at pindexPrev. */\n+    static BIP9Stats Statistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos);\n+\n+    static uint32_t Mask(const Consensus::Params& params, Consensus::DeploymentPos pos);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595610191",
      "id" : 595610191,
      "in_reply_to_id" : 594206873,
      "line" : 88,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYxMDE5MQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 88,
      "original_position" : 30,
      "original_start_line" : 86,
      "path" : "src/versionbits.h",
      "position" : 29,
      "pull_request_review_id" : 613795309,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : 86,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595610191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595618136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595618136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's giving the statistics for the retarget period that includes `pindexPrev`'s successor, up to and including `pindexPrev` if `pindexPrev` is in the same retarget period, but not if `pindexPrev` was the last block in the previous retarget period. (That means you can't actually query the statistics for a fully completed retarget period -- you'll always get statistics for between 0 and 2015 blocks worth of signalling, never the full 2016 blocks. Or whatever the period is)\r\n\r\nI've been confused about this until recently, so not sure how to describe it well",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-16T23:55:22Z",
      "diff_hunk" : "@@ -79,11 +79,11 @@ struct VersionBitsCache\n     void Clear();\n };\n \n-/** Get the BIP9 state for a given deployment at the current tip. */\n+/** Get the BIP9 state for a given deployment for the block after pindexPrev. */\n ThresholdState VersionBitsState(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache);\n-/** Get the numerical statistics for the BIP9 state for a given deployment at the current tip. */\n+/** Get the numerical statistics for the BIP9 state for a given deployment as at pindexPrev. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595618136",
      "id" : 595618136,
      "in_reply_to_id" : 595599351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYxODEzNg==",
      "original_commit_id" : "898d54177d364a8120c2fcd4cfeaa831121062fd",
      "original_line" : 84,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 613816703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595618136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595702589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595702589"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think I agree -- if there wasn't a cache, there would be no need for an object, these things would just be standalone functions, so calling the object a cache makes sense to me.\r\n\r\nThere's some impedence mismatch though -- apart from having to have the object, the api is otherwise pretty independent of whether there's a cache or not.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T04:22:05Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595702589",
      "id" : 595702589,
      "in_reply_to_id" : 594201846,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTcwMjU4OQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 78,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 18,
      "pull_request_review_id" : 613909603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595702589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595704637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595704637"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It could just say \"Get statistics for the BIP9 state for the measuring window that inlcudes pindexPrev's successor.\" ?\r\n\r\nFeel free to disregard this.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T04:29:10Z",
      "diff_hunk" : "@@ -79,11 +79,11 @@ struct VersionBitsCache\n     void Clear();\n };\n \n-/** Get the BIP9 state for a given deployment at the current tip. */\n+/** Get the BIP9 state for a given deployment for the block after pindexPrev. */\n ThresholdState VersionBitsState(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache);\n-/** Get the numerical statistics for the BIP9 state for a given deployment at the current tip. */\n+/** Get the numerical statistics for the BIP9 state for a given deployment as at pindexPrev. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595704637",
      "id" : 595704637,
      "in_reply_to_id" : 595599351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTcwNDYzNw==",
      "original_commit_id" : "898d54177d364a8120c2fcd4cfeaa831121062fd",
      "original_line" : 84,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 613911903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595704637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595711135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595711135"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We cast to an int to iterate in a few places, and changing them feels gratuitous -- we can't make the underlying type something that won't fit in an int because the fixed arrays we index into via the enum value would break too.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T04:50:27Z",
      "diff_hunk" : "@@ -185,28 +185,47 @@ class VersionBitsConditionChecker : public AbstractThresholdConditionChecker {\n \n } // namespace\n \n-ThresholdState VersionBitsState(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache)\n+ThresholdState VersionBitsCache::State(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n-    return VersionBitsConditionChecker(pos).GetStateFor(pindexPrev, params, cache.caches[pos]);\n+    LOCK(cs);\n+    return VersionBitsConditionChecker(pos).GetStateFor(pindexPrev, params, caches[pos]);\n }\n \n-BIP9Stats VersionBitsStatistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n+BIP9Stats VersionBitsCache::Statistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n     return VersionBitsConditionChecker(pos).GetStateStatisticsFor(pindexPrev, params);\n }\n \n-int VersionBitsStateSinceHeight(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache)\n+int VersionBitsCache::StateSinceHeight(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n-    return VersionBitsConditionChecker(pos).GetStateSinceHeightFor(pindexPrev, params, cache.caches[pos]);\n+    LOCK(cs);\n+    return VersionBitsConditionChecker(pos).GetStateSinceHeightFor(pindexPrev, params, caches[pos]);\n }\n \n-uint32_t VersionBitsMask(const Consensus::Params& params, Consensus::DeploymentPos pos)\n+uint32_t VersionBitsCache::Mask(const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n     return VersionBitsConditionChecker(pos).Mask(params);\n }\n \n+int32_t VersionBitsCache::ComputeBlockVersion(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    LOCK(cs);\n+    int32_t nVersion = VERSIONBITS_TOP_BITS;\n+\n+    for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595711135",
      "id" : 595711135,
      "in_reply_to_id" : 594226697,
      "line" : 220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTcxMTEzNQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 220,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 37,
      "pull_request_review_id" : 613919126,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595711135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595721593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595721593"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is the same impedence mismatch as \"calling it a cache\" -- they're static because they don't use the cache.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T05:26:05Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache\n {\n-    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+private:\n+    Mutex cs;\n+    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS] GUARDED_BY(cs);\n+\n+public:\n+    /** Get the numerical statistics for the BIP9 state for a given deployment as at pindexPrev. */\n+    static BIP9Stats Statistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos);\n+\n+    static uint32_t Mask(const Consensus::Params& params, Consensus::DeploymentPos pos);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595721593",
      "id" : 595721593,
      "in_reply_to_id" : 594206873,
      "line" : 88,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTcyMTU5Mw==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 88,
      "original_position" : 30,
      "original_start_line" : 86,
      "path" : "src/versionbits.h",
      "position" : 29,
      "pull_request_review_id" : 613931247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : 86,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595721593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nits picked.",
      "created_at" : "2021-03-17T05:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-800811067",
      "id" : 800811067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMDgxMTA2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-17T05:41:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/800811067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595727074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595727074"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Names changed; left as non-mutable and non-const.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T05:42:59Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache\n {\n-    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+private:\n+    Mutex cs;\n+    ThresholdConditionCache caches[Consensus::MAX_VERSION_BITS_DEPLOYMENTS] GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595727074",
      "id" : 595727074,
      "in_reply_to_id" : 594204760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTcyNzA3NA==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 82,
      "original_position" : 24,
      "original_start_line" : 81,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 613937551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595727074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595841030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595841030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T09:21:20Z",
      "diff_hunk" : "@@ -185,28 +185,47 @@ class VersionBitsConditionChecker : public AbstractThresholdConditionChecker {\n \n } // namespace\n \n-ThresholdState VersionBitsState(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache)\n+ThresholdState VersionBitsCache::State(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n-    return VersionBitsConditionChecker(pos).GetStateFor(pindexPrev, params, cache.caches[pos]);\n+    LOCK(cs);\n+    return VersionBitsConditionChecker(pos).GetStateFor(pindexPrev, params, caches[pos]);\n }\n \n-BIP9Stats VersionBitsStatistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n+BIP9Stats VersionBitsCache::Statistics(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n     return VersionBitsConditionChecker(pos).GetStateStatisticsFor(pindexPrev, params);\n }\n \n-int VersionBitsStateSinceHeight(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos, VersionBitsCache& cache)\n+int VersionBitsCache::StateSinceHeight(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n-    return VersionBitsConditionChecker(pos).GetStateSinceHeightFor(pindexPrev, params, cache.caches[pos]);\n+    LOCK(cs);\n+    return VersionBitsConditionChecker(pos).GetStateSinceHeightFor(pindexPrev, params, caches[pos]);\n }\n \n-uint32_t VersionBitsMask(const Consensus::Params& params, Consensus::DeploymentPos pos)\n+uint32_t VersionBitsCache::Mask(const Consensus::Params& params, Consensus::DeploymentPos pos)\n {\n     return VersionBitsConditionChecker(pos).Mask(params);\n }\n \n+int32_t VersionBitsCache::ComputeBlockVersion(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    LOCK(cs);\n+    int32_t nVersion = VERSIONBITS_TOP_BITS;\n+\n+    for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595841030",
      "id" : 595841030,
      "in_reply_to_id" : 594226697,
      "line" : 220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0MTAzMA==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 220,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 37,
      "pull_request_review_id" : 614078407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595841030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595842651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595842651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> apart from having to have the object, the api is otherwise pretty independent of whether there's a cache or not.\r\n\r\nIndeed. The client doesn't care whether there's a cache or not (and for the static functions, there isn't even a cache). Generally, I think interfaces should be named according to the client usage, not the implementation specifics. Not a big deal, and shouldn't hold up this PR.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T09:23:30Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595842651",
      "id" : 595842651,
      "in_reply_to_id" : 594201846,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0MjY1MQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 78,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 18,
      "pull_request_review_id" : 614080482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595842651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review ACK e72e062e5a8279864d746776dc9072c112ddc014",
      "created_at" : "2021-03-17T09:24:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-800930430",
      "id" : 800930430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMDkzMDQzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-17T09:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/800930430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595859319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595859319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The client does care a little about whether there's a cache -- without it, checking the state is potentially linear in the height of the block being tested, with it, it's amortized constant. Particularly for deployments with short periods (like bip91) that could be prohibitive.\r\n\r\nPerhaps it's worth considering renaming it to `SignalledDeploymentManager` or similar along with renaming from `BIP9` to `VBits` or renaming `DeploymentPos` or a deeper refactoring of `AbstractThresholdConditionChecker` etc.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T09:45:25Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595859319",
      "id" : 595859319,
      "in_reply_to_id" : 594201846,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1OTMxOQ==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 78,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 18,
      "pull_request_review_id" : 614101719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595859319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595865800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595865800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd prefer a generic name like `SignalledDeploymentManager`, but it definitely shouldn't hold up this PR.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T09:53:51Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595865800",
      "id" : 595865800,
      "in_reply_to_id" : 594201846,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NTgwMA==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 78,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 18,
      "pull_request_review_id" : 614109794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595865800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595866714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595866714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> The client does care a little about whether there's a cache\r\n\r\nSorry, I meant in terms of correctness/observability. Of course a cache has implications for computational complexity.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-17T09:55:05Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+\n+class VersionBitsCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r595866714",
      "id" : 595866714,
      "in_reply_to_id" : 594201846,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NjcxNA==",
      "original_commit_id" : "eb211ea0af0ba683ff1f77b576f33b651eab8cff",
      "original_line" : 78,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 18,
      "pull_request_review_id" : 614110978,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595866714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r598387676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598387676"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: With all these new functions taking a `const CBlockIndex* ...` argument, maybe use a `const CBlockIndex& ...` instead. Safer API, and can still use `&pindexPrev` to get a pointer (if needed).",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-22T02:22:03Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+#include <versionbits.h>\n+\n+#include <limits>\n+\n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n+}\n+\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r598387676",
      "id" : 598387676,
      "line" : 23,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODM4NzY3Ng==",
      "original_commit_id" : "e72e062e5a8279864d746776dc9072c112ddc014",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 23,
      "pull_request_review_id" : 617108154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598387676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/80422284?v=4",
         "events_url" : "https://api.github.com/users/GeneFerneau/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GeneFerneau/followers",
         "following_url" : "https://api.github.com/users/GeneFerneau/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GeneFerneau/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GeneFerneau",
         "id" : 80422284,
         "login" : "GeneFerneau",
         "node_id" : "MDQ6VXNlcjgwNDIyMjg0",
         "organizations_url" : "https://api.github.com/users/GeneFerneau/orgs",
         "received_events_url" : "https://api.github.com/users/GeneFerneau/received_events",
         "repos_url" : "https://api.github.com/users/GeneFerneau/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GeneFerneau/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GeneFerneau/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GeneFerneau"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r598406329"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598406329"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could make sense to have `DeploymentActiveAt(const CBlockIndex&, ...)` but `DeploymentActiveAfter` can be called with nullptr, so can't be a reference.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-22T03:38:32Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+#include <versionbits.h>\n+\n+#include <limits>\n+\n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n+}\n+\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r598406329",
      "id" : 598406329,
      "in_reply_to_id" : 598387676,
      "line" : 23,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODQwNjMyOQ==",
      "original_commit_id" : "e72e062e5a8279864d746776dc9072c112ddc014",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 23,
      "pull_request_review_id" : 617128855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598406329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Started reviewing ",
      "created_at" : "2021-03-22T17:23:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-804249778",
      "id" : 804249778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNDI0OTc3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-22T17:23:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/804249778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r600402619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600402619"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 8b2aa89f9f6366cfd3a3dfccf2f7678740b4d0ea\r\n\r\nnit: couldn't this be `< MAX_VERSION_BITS_DEPLOYMENTS` to avoid changing this line when adding/burring a deployment?\r\n\r\n```suggestion\r\nconstexpr bool ValidDeployment(DeploymentPos dep) { return DEPLOYMENT_TESTDUMMY <= dep && dep < MAX_VERSION_BITS_DEPLOYMENTS; }\r\n```",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-03-24T11:44:31Z",
      "diff_hunk" : "@@ -22,13 +22,14 @@ enum BuriedDeployment : int16_t\n };\n constexpr bool ValidDeployment(BuriedDeployment dep) { return DEPLOYMENT_HEIGHTINCB <= dep && dep <= DEPLOYMENT_SEGWIT; }\n \n-enum DeploymentPos\n+enum DeploymentPos : uint16_t\n {\n     DEPLOYMENT_TESTDUMMY,\n     DEPLOYMENT_TAPROOT, // Deployment of Schnorr/Taproot (BIPs 340-342)\n     // NOTE: Also add new deployments to VersionBitsDeploymentInfo in versionbits.cpp\n     MAX_VERSION_BITS_DEPLOYMENTS\n };\n+constexpr bool ValidDeployment(DeploymentPos dep) { return DEPLOYMENT_TESTDUMMY <= dep && dep <= DEPLOYMENT_TAPROOT; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r600402619",
      "id" : 600402619,
      "line" : 32,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDQwMjYxOQ==",
      "original_commit_id" : "8b2aa89f9f6366cfd3a3dfccf2f7678740b4d0ea",
      "original_line" : 32,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 24,
      "pull_request_review_id" : 619619356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600402619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606681109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606681109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "very minor nit: If you add a `DEPLOYMENT_BURIED_MAX` and then use `dep < DEPLOYMENT_BURIED_MAX` instead of `dep <= DEPLOYMENT_SEGWIT` then this line wouldn't need to change when something is buried. But I am not sure if it's an improvement overall.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-03T16:09:57Z",
      "diff_hunk" : "@@ -11,6 +11,17 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with DeploymentPos\n+    DEPLOYMENT_HEIGHTINCB = std::numeric_limits<int16_t>::min(),\n+    DEPLOYMENT_CLTV,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,\n+};\n+constexpr bool ValidDeployment(BuriedDeployment dep) { return DEPLOYMENT_HEIGHTINCB <= dep && dep <= DEPLOYMENT_SEGWIT; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606681109",
      "id" : 606681109,
      "line" : 23,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjY4MTEwOQ==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 23,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 14,
      "pull_request_review_id" : 627453646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606681109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606682906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606682906"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: You could do `!pindexPrev` instead of `== nullptr` I think",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-03T16:28:35Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+\n+#include <limits>\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606682906",
      "id" : 606682906,
      "line" : 20,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjY4MjkwNg==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 20,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 20,
      "pull_request_review_id" : 627453646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606682906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606683378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606683378"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Could use an optional as return value instead of this to signal if no height was found?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-03T16:34:05Z",
      "diff_hunk" : "@@ -90,7 +101,25 @@ struct Params {\n      */\n     bool signet_blocks{false};\n     std::vector<uint8_t> signet_challenge;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const\n+    {\n+        switch (dep) {\n+        case DEPLOYMENT_HEIGHTINCB:\n+            return BIP34Height;\n+        case DEPLOYMENT_CLTV:\n+            return BIP65Height;\n+        case DEPLOYMENT_DERSIG:\n+            return BIP66Height;\n+        case DEPLOYMENT_CSV:\n+            return CSVHeight;\n+        case DEPLOYMENT_SEGWIT:\n+            return SegwitHeight;\n+        } // no default case, so the compiler can warn about missing cases\n+        return std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606683378",
      "id" : 606683378,
      "line" : 130,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjY4MzM3OA==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 130,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 47,
      "pull_request_review_id" : 627453646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606683378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606683621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606683621"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: This check is repeated three times only to protect `DeploymentHeight()` afaict, maybe move it into `DeploymentHeight()`?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-03T16:36:33Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+\n+#include <limits>\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n+}\n+\n+/** Determine if a deployment is active for this block */\n+inline bool DeploymentActiveAt(const CBlockIndex* pindex, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return pindex->nHeight >= params.DeploymentHeight(dep);\n+}\n+\n+/** Determine if a deployment is enabled (can ever be active) */\n+inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606683621",
      "id" : 606683621,
      "line" : 45,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjY4MzYyMQ==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 45,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 45,
      "pull_request_review_id" : 627453646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606683621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606685946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606685946"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: accidental empty line?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-03T16:59:02Z",
      "diff_hunk" : "@@ -70,21 +72,32 @@ class AbstractThresholdConditionChecker {\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev, const Consensus::Params& params, ThresholdConditionCache& cache) const;\n };\n \n-/** BIP 9 allows multiple softforks to be deployed in parallel. We cache per-period state for every one of them\n- *  keyed by the bit position used to signal support. */\n-struct VersionBitsCache\n+/** BIP 9 allows multiple softforks to be deployed in parallel. We cache\n+ *  per-period state for every one of them. */\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r606685946",
      "id" : 606685946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjY4NTk0Ng==",
      "original_commit_id" : "e72e062e5a8279864d746776dc9072c112ddc014",
      "original_line" : 78,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 627453646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606685946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r607013194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607013194"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That would mean checking and dereferencing the optional at every call site, which doesn't seem useful.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-05T09:56:51Z",
      "diff_hunk" : "@@ -90,7 +101,25 @@ struct Params {\n      */\n     bool signet_blocks{false};\n     std::vector<uint8_t> signet_challenge;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const\n+    {\n+        switch (dep) {\n+        case DEPLOYMENT_HEIGHTINCB:\n+            return BIP34Height;\n+        case DEPLOYMENT_CLTV:\n+            return BIP65Height;\n+        case DEPLOYMENT_DERSIG:\n+            return BIP66Height;\n+        case DEPLOYMENT_CSV:\n+            return CSVHeight;\n+        case DEPLOYMENT_SEGWIT:\n+            return SegwitHeight;\n+        } // no default case, so the compiler can warn about missing cases\n+        return std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r607013194",
      "id" : 607013194,
      "in_reply_to_id" : 606683378,
      "line" : 130,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzAxMzE5NA==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 130,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 47,
      "pull_request_review_id" : 627748098,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607013194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105596"
         }
      },
      "author_association" : "NONE",
      "body" : "#21EA80DB",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-10T23:31:32Z",
      "diff_hunk" : "@@ -90,7 +101,25 @@ struct Params {\n      */\n     bool signet_blocks{false};\n     std::vector<uint8_t> signet_challenge;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const\n+    {\n+        switch (dep) {\n+        case DEPLOYMENT_HEIGHTINCB:\n+            return BIP34Height;\n+        case DEPLOYMENT_CLTV:\n+            return BIP65Height;\n+        case DEPLOYMENT_DERSIG:\n+            return BIP66Height;\n+        case DEPLOYMENT_CSV:\n+            return CSVHeight;\n+        case DEPLOYMENT_SEGWIT:\n+            return SegwitHeight;\n+        } // no default case, so the compiler can warn about missing cases\n+        return std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105596",
      "id" : 611105596,
      "in_reply_to_id" : 606683378,
      "line" : 130,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTEwNTU5Ng==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 130,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 47,
      "pull_request_review_id" : 632959904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/57122455?v=4",
         "events_url" : "https://api.github.com/users/hamedtayeban/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamedtayeban/followers",
         "following_url" : "https://api.github.com/users/hamedtayeban/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamedtayeban/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamedtayeban",
         "id" : 57122455,
         "login" : "hamedtayeban",
         "node_id" : "MDQ6VXNlcjU3MTIyNDU1",
         "organizations_url" : "https://api.github.com/users/hamedtayeban/orgs",
         "received_events_url" : "https://api.github.com/users/hamedtayeban/received_events",
         "repos_url" : "https://api.github.com/users/hamedtayeban/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamedtayeban/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamedtayeban/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamedtayeban"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105604"
         }
      },
      "author_association" : "NONE",
      "body" : "> very minor nit: If you add a `DEPLOYMENT_BURIED_MAX` and then use `dep < DEPLOYMENT_BURIED_MAX` instead of `dep <= DEPLOYMENT_SEGWIT` then this line wouldn't need to change when something is buried. But I am not sure if it's an improvement overall.\n\n",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-10T23:31:43Z",
      "diff_hunk" : "@@ -11,6 +11,17 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with DeploymentPos\n+    DEPLOYMENT_HEIGHTINCB = std::numeric_limits<int16_t>::min(),\n+    DEPLOYMENT_CLTV,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,\n+};\n+constexpr bool ValidDeployment(BuriedDeployment dep) { return DEPLOYMENT_HEIGHTINCB <= dep && dep <= DEPLOYMENT_SEGWIT; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105604",
      "id" : 611105604,
      "in_reply_to_id" : 606681109,
      "line" : 23,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTEwNTYwNA==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 23,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 14,
      "pull_request_review_id" : 632959914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/57122455?v=4",
         "events_url" : "https://api.github.com/users/hamedtayeban/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamedtayeban/followers",
         "following_url" : "https://api.github.com/users/hamedtayeban/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamedtayeban/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamedtayeban",
         "id" : 57122455,
         "login" : "hamedtayeban",
         "node_id" : "MDQ6VXNlcjU3MTIyNDU1",
         "organizations_url" : "https://api.github.com/users/hamedtayeban/orgs",
         "received_events_url" : "https://api.github.com/users/hamedtayeban/received_events",
         "repos_url" : "https://api.github.com/users/hamedtayeban/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamedtayeban/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamedtayeban/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamedtayeban"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105608"
         }
      },
      "author_association" : "NONE",
      "body" : "> nit: You could do `!pindexPrev` instead of `== nullptr` I think\n\n",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-10T23:31:51Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+\n+#include <limits>\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105608",
      "id" : 611105608,
      "in_reply_to_id" : 606682906,
      "line" : 20,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTEwNTYwOA==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 20,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 20,
      "pull_request_review_id" : 632959920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/57122455?v=4",
         "events_url" : "https://api.github.com/users/hamedtayeban/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamedtayeban/followers",
         "following_url" : "https://api.github.com/users/hamedtayeban/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamedtayeban/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamedtayeban",
         "id" : 57122455,
         "login" : "hamedtayeban",
         "node_id" : "MDQ6VXNlcjU3MTIyNDU1",
         "organizations_url" : "https://api.github.com/users/hamedtayeban/orgs",
         "received_events_url" : "https://api.github.com/users/hamedtayeban/received_events",
         "repos_url" : "https://api.github.com/users/hamedtayeban/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamedtayeban/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamedtayeban/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamedtayeban"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105614"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105614"
         }
      },
      "author_association" : "NONE",
      "body" : "> nit: You could do `!pindexPrev` instead of `== nullptr` I think\n\n",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-10T23:31:59Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+\n+#include <limits>\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105614",
      "id" : 611105614,
      "in_reply_to_id" : 606682906,
      "line" : 20,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTEwNTYxNA==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 20,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 20,
      "pull_request_review_id" : 632959926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105614",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/57122455?v=4",
         "events_url" : "https://api.github.com/users/hamedtayeban/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamedtayeban/followers",
         "following_url" : "https://api.github.com/users/hamedtayeban/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamedtayeban/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamedtayeban",
         "id" : 57122455,
         "login" : "hamedtayeban",
         "node_id" : "MDQ6VXNlcjU3MTIyNDU1",
         "organizations_url" : "https://api.github.com/users/hamedtayeban/orgs",
         "received_events_url" : "https://api.github.com/users/hamedtayeban/received_events",
         "repos_url" : "https://api.github.com/users/hamedtayeban/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamedtayeban/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamedtayeban/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamedtayeban"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105617"
         }
      },
      "author_association" : "NONE",
      "body" : "> nit: You could do `!pindexPrev` instead of `== nullptr` I think\n\n",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-10T23:32:07Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTSTATUS_H\n+#define BITCOIN_DEPLOYMENTSTATUS_H\n+\n+#include <chain.h>\n+\n+#include <limits>\n+\n+/** Determine if a deployment is active for the next block */\n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105617",
      "id" : 611105617,
      "in_reply_to_id" : 606682906,
      "line" : 20,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTEwNTYxNw==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 20,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 20,
      "pull_request_review_id" : 632959928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/57122455?v=4",
         "events_url" : "https://api.github.com/users/hamedtayeban/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamedtayeban/followers",
         "following_url" : "https://api.github.com/users/hamedtayeban/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamedtayeban/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamedtayeban",
         "id" : 57122455,
         "login" : "hamedtayeban",
         "node_id" : "MDQ6VXNlcjU3MTIyNDU1",
         "organizations_url" : "https://api.github.com/users/hamedtayeban/orgs",
         "received_events_url" : "https://api.github.com/users/hamedtayeban/received_events",
         "repos_url" : "https://api.github.com/users/hamedtayeban/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamedtayeban/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamedtayeban/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamedtayeban"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105639"
         }
      },
      "author_association" : "NONE",
      "body" : "> > very minor nit: If you add a `DEPLOYMENT_BURIED_MAX` and then use `dep < DEPLOYMENT_BURIED_MAX` instead of `dep <= DEPLOYMENT_SEGWIT` then this line wouldn't need to change when something is buried. But I am not sure if it's an improvement overall.\n> \n> \n\n",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-10T23:32:15Z",
      "diff_hunk" : "@@ -11,6 +11,17 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with DeploymentPos\n+    DEPLOYMENT_HEIGHTINCB = std::numeric_limits<int16_t>::min(),\n+    DEPLOYMENT_CLTV,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,\n+};\n+constexpr bool ValidDeployment(BuriedDeployment dep) { return DEPLOYMENT_HEIGHTINCB <= dep && dep <= DEPLOYMENT_SEGWIT; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r611105639",
      "id" : 611105639,
      "in_reply_to_id" : 606681109,
      "line" : 23,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTEwNTYzOQ==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 23,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 14,
      "pull_request_review_id" : 632959934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611105639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/57122455?v=4",
         "events_url" : "https://api.github.com/users/hamedtayeban/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamedtayeban/followers",
         "following_url" : "https://api.github.com/users/hamedtayeban/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamedtayeban/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamedtayeban",
         "id" : 57122455,
         "login" : "hamedtayeban",
         "node_id" : "MDQ6VXNlcjU3MTIyNDU1",
         "organizations_url" : "https://api.github.com/users/hamedtayeban/orgs",
         "received_events_url" : "https://api.github.com/users/hamedtayeban/received_events",
         "repos_url" : "https://api.github.com/users/hamedtayeban/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamedtayeban/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamedtayeban/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamedtayeban"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-13T08:06:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-818535853",
      "id" : 818535853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODUzNTg1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T08:06:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818535853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on top of #21666 (neighbouring line changed) and the ComputeBlockVersion tests in #21377. Changed `DeploymentActiveAt()` to take a reference to a block rather than a pointer, since nullptr isn't valid. Also split the move of ComputeBlockVersion into two steps, one for the move-only part and the other for the refactoring, since that seems a bit easier to review.",
      "created_at" : "2021-04-16T09:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-821051366",
      "id" : 821051366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMTA1MTM2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T09:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821051366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r614703141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614703141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Didn't want to add a `DEPLOYMENT_BURIED_MAX` since that would then need to be included in any `switch` statements.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-16T09:36:07Z",
      "diff_hunk" : "@@ -11,6 +11,17 @@\n \n namespace Consensus {\n \n+enum BuriedDeployment : int16_t\n+{\n+    // buried deployments get negative values to avoid overlap with DeploymentPos\n+    DEPLOYMENT_HEIGHTINCB = std::numeric_limits<int16_t>::min(),\n+    DEPLOYMENT_CLTV,\n+    DEPLOYMENT_DERSIG,\n+    DEPLOYMENT_CSV,\n+    DEPLOYMENT_SEGWIT,\n+};\n+constexpr bool ValidDeployment(BuriedDeployment dep) { return DEPLOYMENT_HEIGHTINCB <= dep && dep <= DEPLOYMENT_SEGWIT; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r614703141",
      "id" : 614703141,
      "in_reply_to_id" : 606681109,
      "line" : 23,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDcwMzE0MQ==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 23,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 14,
      "pull_request_review_id" : 637516018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614703141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-17T16:27:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-821849428",
      "id" : 821849428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMTg0OTQyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-17T16:27:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821849428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on top of #21391 due to `ChainActive().Tip()` changes.\r\n\r\n(Maybe consider reviewing conflicting pr #21691 first, since it's easy)",
      "created_at" : "2021-04-19T03:00:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-822133296",
      "id" : 822133296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjEzMzI5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T03:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822133296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-20T06:43:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-823017505",
      "id" : 823017505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzAxNzUwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T06:43:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823017505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r620215571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620215571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider using `std::array` and `at()` for bounds checking.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-26T11:39:12Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2016-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTINFO_H\n+#define BITCOIN_DEPLOYMENTINFO_H\n+\n+#include <consensus/params.h>\n+\n+#include <string>\n+\n+struct VBDeploymentInfo {\n+    /** Deployment name */\n+    const char *name;\n+    /** Whether GBT clients can safely ignore this rule in simplified usage */\n+    bool gbt_force;\n+};\n+\n+extern const struct VBDeploymentInfo VersionBitsDeploymentInfo[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+\n+std::string DeploymentName(Consensus::BuriedDeployment dep);\n+\n+inline std::string DeploymentName(Consensus::DeploymentPos pos)\n+{\n+    assert(Consensus::ValidDeployment(pos));\n+    return VersionBitsDeploymentInfo[pos].name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r620215571",
      "id" : 620215571,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDIxNTU3MQ==",
      "original_commit_id" : "37458fdd1033cb30ec0591d0932e7d6a6b0dee32",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.h",
      "position" : 26,
      "pull_request_review_id" : 644568911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620215571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-27T09:12:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-827451156",
      "id" : 827451156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNzQ1MTE1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-27T09:12:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/827451156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r623714315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623714315"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same could be said for `vDeployments` in `Consensus::Params`; think both are better left for some other refactoring.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-30T08:41:33Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2016-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_DEPLOYMENTINFO_H\n+#define BITCOIN_DEPLOYMENTINFO_H\n+\n+#include <consensus/params.h>\n+\n+#include <string>\n+\n+struct VBDeploymentInfo {\n+    /** Deployment name */\n+    const char *name;\n+    /** Whether GBT clients can safely ignore this rule in simplified usage */\n+    bool gbt_force;\n+};\n+\n+extern const struct VBDeploymentInfo VersionBitsDeploymentInfo[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];\n+\n+std::string DeploymentName(Consensus::BuriedDeployment dep);\n+\n+inline std::string DeploymentName(Consensus::DeploymentPos pos)\n+{\n+    assert(Consensus::ValidDeployment(pos));\n+    return VersionBitsDeploymentInfo[pos].name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r623714315",
      "id" : 623714315,
      "in_reply_to_id" : 620215571,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzcxNDMxNQ==",
      "original_commit_id" : "37458fdd1033cb30ec0591d0932e7d6a6b0dee32",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.h",
      "position" : 26,
      "pull_request_review_id" : 649005747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623714315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased past #21009 ~(and added some comment updates to reflect that Rewind is gone now)~",
      "created_at" : "2021-04-30T08:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-829943576",
      "id" : 829943576,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyOTk0MzU3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-30T09:42:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/829943576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r623727210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623727210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How is this change different from  fa49430914fd16fbc34078bd8929b6ef635a8c42 in #21789 ?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-30T09:02:11Z",
      "diff_hunk" : "@@ -182,7 +182,7 @@ class CBlockIndex\n     //!\n     //! Note: this value is modified to show BLOCK_OPT_WITNESS during UTXO snapshot\n     //! load to avoid the block index being spuriously rewound.\n-    //! @sa RewindBlockIndex\n+    //! @sa NeedsRedownload",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r623727210",
      "id" : 623727210,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzcyNzIxMA==",
      "original_commit_id" : "b24e85139ee44097ba92a0c70ff6e6f5e1222d13",
      "original_line" : 185,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : null,
      "pull_request_review_id" : 649021911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623727210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r623751005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623751005"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ":eyes: What change? There's no change here... No change at all...",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-04-30T09:42:37Z",
      "diff_hunk" : "@@ -182,7 +182,7 @@ class CBlockIndex\n     //!\n     //! Note: this value is modified to show BLOCK_OPT_WITNESS during UTXO snapshot\n     //! load to avoid the block index being spuriously rewound.\n-    //! @sa RewindBlockIndex\n+    //! @sa NeedsRedownload",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r623751005",
      "id" : 623751005,
      "in_reply_to_id" : 623727210,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzc1MTAwNQ==",
      "original_commit_id" : "b24e85139ee44097ba92a0c70ff6e6f5e1222d13",
      "original_line" : 185,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : null,
      "pull_request_review_id" : 649052690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T14:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623751005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-05T15:50:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-832805089",
      "id" : 832805089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMjgwNTA4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-05T15:50:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/832805089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased past #21727.\r\n\r\n> I'm not convinced that a `VersionBitsCache` class is necessary.\r\n\r\n@jnewbery - You're right it's not necessary; but I think minimising the number of globals and keeping the lock and the things the lock is guarding together (which then allows stronger locking assertions, see https://github.com/bitcoin/bitcoin/pull/20272#issuecomment-720755781) is worthwhile enough. If you're implying the `ComputeBlockVersion` to `versionbits.ComputeBlockVersion` change is a bit ugly, that could be fixed just by adding an `inline int32_t ComputeBlockVersion(pindexPrev, params) { return versionbits.ComputeBlockVersion(pindexPrev, params); }` in deploymentstatus.h (where the `versionbits` global is declared).",
      "created_at" : "2021-05-06T14:43:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-833580443",
      "id" : 833580443,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMzU4MDQ0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-06T14:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/833580443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "See https://github.com/jnewbery/bitcoin/commit/000899c6753b69f141ffa07f7d2a12bd235824e3#diff-73b381667b1bb315180fc7e7a66992e79ad742972de5d0d2c1b8404d3d67e1b0 for the proposed changes in versionbits.h. The benefit is not exposing anything about the internal implementation outside of the .cpp file.\r\n\r\n> I think minimising the number of globals and keeping the lock and the things the lock is guarding together (which then allows stronger locking assertions [...]\r\n\r\nI think it's fine to have a global with internal linkage in a single implementation file. The problems with globals all come when they're externally linked and accessed from many places in the code. The point about locking assertions also isn't relevant here since we're not using `EXCLUSIVE_LOCKS_REQUIRED(!) ` or `LOCKS_EXCLUDED()` for this mutex.",
      "created_at" : "2021-05-10T07:47:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-836315455",
      "id" : 836315455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNjMxNTQ1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T07:47:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/836315455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 63a6f6e5e695ca18c78a0dfb4d2261d1eb15ef4d.\r\n\r\nVerified `git range-diff master 37458fdd10 HEAD`. Only difference is resolving the merge conflict with #21009.",
      "created_at" : "2021-05-10T07:53:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-836321732",
      "id" : 836321732,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNjMyMTczMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T07:53:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/836321732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-04T13:25:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-854722586",
      "id" : 854722586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NDcyMjU4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-04T13:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/854722586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased past #22121 ; split the last commit to reduce the `ComputeBlockVersion` to `versionbits.ComputeBlockVersion` noise.",
      "created_at" : "2021-06-08T04:17:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-856425957",
      "id" : 856425957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NjQyNTk1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-08T04:17:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/856425957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 3696abb45e\r\n\r\nVerified the rebase using `git range-diff`.",
      "created_at" : "2021-06-08T08:45:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-856582569",
      "id" : 856582569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NjU4MjU2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-08T08:45:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/856582569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647392871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647392871"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8695986585d8717a9ab484877d25325fbe78a3e8: The compiler already knows this is `inline` because the member function has a definition. Thus, the `inline` can be removed for brevity.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T12:31:50Z",
      "diff_hunk" : "@@ -100,7 +111,25 @@ struct Params {\n      */\n     bool signet_blocks{false};\n     std::vector<uint8_t> signet_challenge;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647392871",
      "id" : 647392871,
      "line" : 116,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzM5Mjg3MQ==",
      "original_commit_id" : "8695986585d8717a9ab484877d25325fbe78a3e8",
      "original_line" : 115,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 33,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647392871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647444475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647444475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "97735795048b999acf5c79085ecdeb5df0413532: Any reason to not use `::versionbitscache`? Especially since the `g_` prefix is missing?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T13:32:19Z",
      "diff_hunk" : "@@ -6,28 +6,50 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647444475",
      "id" : 647444475,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ0NDQ3NQ==",
      "original_commit_id" : "97735795048b999acf5c79085ecdeb5df0413532",
      "original_line" : 26,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : null,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647444475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647448426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647448426"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0529efe7ce918e564672a77da891d5e7a3c9657f: The compiler already knows that `VBDeploymentInfo` is a struct, so while touching this line it would be nice to remove this confusing extraneous keyword.",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T13:36:30Z",
      "diff_hunk" : "@@ -5,13 +5,25 @@\n #ifndef BITCOIN_DEPLOYMENTINFO_H\n #define BITCOIN_DEPLOYMENTINFO_H\n \n+#include <consensus/params.h>\n+\n+#include <string>\n+\n struct VBDeploymentInfo {\n     /** Deployment name */\n     const char *name;\n     /** Whether GBT clients can safely ignore this rule in simplified usage */\n     bool gbt_force;\n };\n \n-extern const struct VBDeploymentInfo VersionBitsDeploymentInfo[];\n+extern const struct VBDeploymentInfo VersionBitsDeploymentInfo[Consensus::MAX_VERSION_BITS_DEPLOYMENTS];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647448426",
      "id" : 647448426,
      "line" : 19,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ0ODQyNg==",
      "original_commit_id" : "0529efe7ce918e564672a77da891d5e7a3c9657f",
      "original_line" : 19,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.h",
      "position" : 19,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647448426",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647457805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647457805"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5eecf966664df05afb8bb8ea9d5a18c7f9d13acf: Maybe add the `::` now, if editing previous commits would be too much rebase hassle?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T13:46:42Z",
      "diff_hunk" : "@@ -23,7 +23,7 @@ inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n-    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);\n+    return ThresholdState::ACTIVE == versionbitscache.State(pindexPrev, params, dep);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647457805",
      "id" : 647457805,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ1NzgwNQ==",
      "original_commit_id" : "5eecf966664df05afb8bb8ea9d5a18c7f9d13acf",
      "original_line" : 26,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 26,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647457805",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647465051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647465051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0967181ee84d6c0f1a5c07d6e366d2a48c548bde: `::` :smile_cat: ",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T13:54:12Z",
      "diff_hunk" : "@@ -130,7 +130,7 @@ std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& sc\n     assert(pindexPrev != nullptr);\n     nHeight = pindexPrev->nHeight + 1;\n \n-    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    pblock->nVersion = versionbitscache.ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647465051",
      "id" : 647465051,
      "line" : 133,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ2NTA1MQ==",
      "original_commit_id" : "0967181ee84d6c0f1a5c07d6e366d2a48c548bde",
      "original_line" : 133,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 13,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647465051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647474155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647474155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691: Could add `::` and apply clang-format-diff to the touched lines?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T14:03:30Z",
      "diff_hunk" : "@@ -391,30 +386,30 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n     lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+    BOOST_CHECK((versionbitscache.ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n     lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+    BOOST_CHECK((versionbitscache.ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n     lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    BOOST_CHECK((versionbitscache.ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n     lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n \n     if (lastBlock->nHeight + 1 < min_activation_height) {\n         // check signalling continues while min_activation_height is not reached\n         lastBlock = secondChain.Mine(min_activation_height - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+        BOOST_CHECK((versionbitscache.ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n         // then reach min_activation_height, which was already REQUIRE'd to start a new period\n         lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n     }\n \n     // Check that we don't signal after activation\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+    BOOST_CHECK_EQUAL(versionbitscache.ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647474155",
      "id" : 647474155,
      "line" : 412,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ3NDE1NQ==",
      "original_commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "original_line" : 412,
      "original_position" : 134,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 139,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647474155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647476352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647476352"
         }
      },
      "author_association" : "MEMBER",
      "body" : "32cf12a89619688182fcb175a63ba0356f170d9c: When removing the lock annotation here, maybe add a comment to `LOCK(cs_main)`, that it must be held while all soft forks are pushed back even though there is no annotation requiring that. Otherwise the rpc might be racy.\r\n\r\nAlternatively keep the annotation?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-08T14:05:52Z",
      "diff_hunk" : "@@ -1345,25 +1348,25 @@ static RPCHelpMan verifychain()\n     };\n }\n \n-static void BuriedForkDescPushBack(UniValue& softforks, const std::string &name, int softfork_height, int tip_height) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r647476352",
      "id" : 647476352,
      "line" : 1347,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ3NjM1Mg==",
      "original_commit_id" : "32cf12a89619688182fcb175a63ba0356f170d9c",
      "original_line" : 1348,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 24,
      "pull_request_review_id" : 678453249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T14:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647476352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-10T15:14:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-858709728",
      "id" : 858709728,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1ODcwOTcyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-10T15:14:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858709728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r649637264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649637264"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it should be racy? The versionbits structures are protected by `VersionBitsCache::m_mutex` and should be stable when provided a particular block, even if it's no longer the tip or a reorg is currently happening?",
      "commit_id" : "3696abb45e3d9b09d027fffd3fc9f19a15e21691",
      "created_at" : "2021-06-11T01:56:15Z",
      "diff_hunk" : "@@ -1345,25 +1348,25 @@ static RPCHelpMan verifychain()\n     };\n }\n \n-static void BuriedForkDescPushBack(UniValue& softforks, const std::string &name, int softfork_height, int tip_height) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r649637264",
      "id" : 649637264,
      "in_reply_to_id" : 647476352,
      "line" : 1347,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTYzNzI2NA==",
      "original_commit_id" : "32cf12a89619688182fcb175a63ba0356f170d9c",
      "original_line" : 1348,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 24,
      "pull_request_review_id" : 681386163,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-11T01:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649637264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased past #22141 ; renamed `versionbitscache` to `g_versionbitscache` ; addressed @MarcoFalke's comments",
      "created_at" : "2021-06-11T02:27:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-859215923",
      "id" : 859215923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1OTIxNTkyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-11T02:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/859215923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r649728355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649728355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh correct. `active_chain_tip` is kept unchanged while pushing back all soft forks.",
      "commit_id" : "f41c075cd2b1f0a38e645b58615d5f8a1bb8af71",
      "created_at" : "2021-06-11T06:41:38Z",
      "diff_hunk" : "@@ -1345,25 +1348,25 @@ static RPCHelpMan verifychain()\n     };\n }\n \n-static void BuriedForkDescPushBack(UniValue& softforks, const std::string &name, int softfork_height, int tip_height) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r649728355",
      "id" : 649728355,
      "in_reply_to_id" : 647476352,
      "line" : 1347,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTcyODM1NQ==",
      "original_commit_id" : "32cf12a89619688182fcb175a63ba0356f170d9c",
      "original_line" : 1347,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 24,
      "pull_request_review_id" : 681497120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-11T06:41:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649728355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK f41c075cd2b1f0a38e645b58615d5f8a1bb8af71",
      "created_at" : "2021-06-11T16:10:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-859687478",
      "id" : 859687478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1OTY4NzQ3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-11T16:10:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/859687478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-12T04:42:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-859997449",
      "id" : 859997449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1OTk5NzQ0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-12T04:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/859997449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased past #21866",
      "created_at" : "2021-06-12T09:09:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-860025678",
      "id" : 860025678,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDAyNTY3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-12T09:09:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860025678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 01c156677e34e21591e71fb979a041f19c060018 ðµ\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK 01c156677e34e21591e71fb979a041f19c060018 ðµ\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUimtAwAxwW2oHhca0vBquCwKsoXJ1HPQCWPUS0yXCXiKL8J/5ojI8gXEw7Pv1Ug\r\nyzYIlNsr30ixEWXZCOZ4O+aRW8E9WvDy4JKesZ/xrBt37I66JLnOu95futuAcIfG\r\n6+L4rMRTqPnX+6wHx5WzVfBFhwN7eVjQbhu/Mia7FJsXHjeiPs6mjKYXUQzx7Ipi\r\nxYy2UxRfLBk98vABaw3969QTytAKxxwln8w3plPV6HVqonroUjGKQqlWsmFkPn9C\r\nyXFJwwWSsJQhJZgbyayhujK2HPaGIIO4pN2lrTdk5CnHS8vaA6b06OAvLhTNKtSA\r\nl+IRRHwtRToIp8/bngTkTB4vvccB2o50/ty+aVk7mlP4FmMCHxfXAa7o7g6WykQW\r\nefobheQdOAhpC1aV5EtlvCnQYlD3BMB806fxRQCzCa1FDJnG6jmH7+zkmKUbD9dx\r\n0+b6xQIY1ROnz9cHqT1K+0w/9S2X4O4GBJn27TE4lCfuTwfoE/tkQI1xbGgaNN/t\r\nYKXw60G8\r\n=L+EA\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `3467c5ea999c8549d102168d19450d004f51c5fbdba853fb143538b01ab1893c  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401083467c5ea999c8549d102168d19450d004f51c5fbdba853fb143538b01ab1893cf0107c9a30bfcd9ad505e94840d59de1edb208fff0107735b827043f6df6980fd2bb48bf5e1808f10460c62bb2f008449493566d2352620083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff010d00189cd52c937373c90472aff5463b008f10460c62bb2f008c900e16106e23d700083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010d86a7dbe7dece7e846baa2c280f6a0dc08f12060b180c8a645b00e1dc68d6ec19d3af379cbe69d4c4d60b7424e5815735b6a2d08f0206fb342579057ff9eb64df720ec066e214e94f3252190c948cedc5021f70bce9f08f0204a37dee32cd75e5cb10ba3276ea858360f2065982fd1b56848e8a5d1f0067f6408f10460c62bb2f00862ff09f6e466e4500083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df010debe99f6993477acbb4e857160f7a1b408f020d07b0b19d248d3f4920a765f803bb53f4e41f1a4dddec7a0a2c18e44a1657c0008f0200c4549574bed13bfc8bea0b23a68d11e9fd0ef583eddad8ad1951e4e19a58b0708f10460c62bb2f008d938465a8bc46b360083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2021-06-13T16:01:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-860233771",
      "id" : 860233771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDIzMzc3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-13T16:01:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860233771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r650687320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650687320"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e3a93b5095522f9315942600cbeb394a902bc5ce: This is currently unused, so there are no bugs. However, I am wondering if the implementation is the most meaningful. This is the first place where a magic value of `0` for the timeout is defined. Be aware that nTimeout is mostly an unsanitized [1] \"don't care value\", as the enabled status is read from nStartTime (NEVER_ACTIVE).\r\n\r\nFinally, I am wondering what the use of this helper might be. Maybe delete the function until there is a use case?\r\n\r\n```cpp\r\ntemplate <class> inline constexpr bool ALWAYS_FALSE{false};\r\ntemplate <class Dep> bool DeploymentEnabled(const Consensus::Params& params, Dep dep)\r\n{\r\nstatic_assert(ALWAYS_FALSE<Dep>, \"DeploymentEnabled only meaningful for buried deployments\");\r\n```\r\n\r\n[1] There was a favour to not sanitize this value across all ST implementations. https://github.com/bitcoin/bitcoin/pull/21392#discussion_r600435983\r\n\r\n(Obviously non-blocking nit, can be fixed up later)",
      "commit_id" : "01c156677e34e21591e71fb979a041f19c060018",
      "created_at" : "2021-06-14T06:53:12Z",
      "diff_hunk" : "@@ -6,28 +6,50 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);\n+}\n+\n /** Determine if a deployment is active for this block */\n inline bool DeploymentActiveAt(const CBlockIndex& index, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return index.nHeight >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAt(const CBlockIndex& index, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return DeploymentActiveAfter(index.pprev, params, dep);\n+}\n+\n /** Determine if a deployment is enabled (can ever be active) */\n inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return params.DeploymentHeight(dep) != std::numeric_limits<int>::max();\n }\n \n+inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return params.vDeployments[dep].nTimeout != 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r650687320",
      "id" : 650687320,
      "line" : 52,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDY4NzMyMA==",
      "original_commit_id" : "e3a93b5095522f9315942600cbeb394a902bc5ce",
      "original_line" : 52,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 52,
      "pull_request_review_id" : 682563553,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-14T19:58:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650687320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 01c156677e",
      "created_at" : "2021-06-14T08:29:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-860496227",
      "id" : 860496227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDQ5NjIyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-14T08:29:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860496227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r651439406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651439406"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is the first place where a magic value of `0` for the timeout is defined.\r\n\r\n`!= 0` matches the behaviour used for `IsScriptWitnessEnabled` prior to 0328dcdcfcb56dc8918697716d7686be048ad0b3 \r\n\r\n> Finally, I am wondering what the use of this helper might be. Maybe delete the function until there is a use case?\r\n\r\nHaving it defined makes it (relatively) easy to switch `DEPLOYMENT_SEGWIT` back to a signaled deployment (ie updating consensus/params.h and chainparams.cpp) and checking that the change does what it's supposed to (ie not require updating validation.cpp etc).\r\n\r\n> the enabled status is read from nStartTime (NEVER_ACTIVE).\r\n\r\nI think it would make sense to switch it to this -- should be possible to have a \"fake\" NEVER_ACTIVE that still passes DeploymentEnabled by setting the starttime to greater than `uint32_t::max()`. (Might do it if there's another rebase needed, otherwise will leave for a later PR)",
      "commit_id" : "01c156677e34e21591e71fb979a041f19c060018",
      "created_at" : "2021-06-15T04:30:33Z",
      "diff_hunk" : "@@ -6,28 +6,50 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);\n+}\n+\n /** Determine if a deployment is active for this block */\n inline bool DeploymentActiveAt(const CBlockIndex& index, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return index.nHeight >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAt(const CBlockIndex& index, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return DeploymentActiveAfter(index.pprev, params, dep);\n+}\n+\n /** Determine if a deployment is enabled (can ever be active) */\n inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return params.DeploymentHeight(dep) != std::numeric_limits<int>::max();\n }\n \n+inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return params.vDeployments[dep].nTimeout != 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r651439406",
      "id" : 651439406,
      "in_reply_to_id" : 650687320,
      "line" : 52,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MTQzOTQwNg==",
      "original_commit_id" : "e3a93b5095522f9315942600cbeb394a902bc5ce",
      "original_line" : 52,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 52,
      "pull_request_review_id" : 683546955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-15T04:30:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651439406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, Approach ACK. \r\n\r\nLooked at this at the PR review club [session](https://bitcoincore.reviews/19438) back in March 2021 and changes since then appear to be minimal. This PR doesn't appear to be urgent for 22.0 as Taproot deployment won't be buried anytime soon but this PR has been open for a while so it would definitely be nice to get it in.",
      "created_at" : "2021-06-21T11:38:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-864964479",
      "id" : 864964479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDk2NDQ3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-21T11:38:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864964479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Including this in 22.0 makes it easier to switch taproot to being a buried deployment, which would allow removing the speedy trial code, which in turn may make it easier to backport new activation code for any new soft forks that may be ready for deployment prior to version 22 reaching end-of-life (perhaps some of the consensus cleanup ideas eg).",
      "created_at" : "2021-06-23T06:49:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-866576554",
      "id" : 866576554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjU3NjU1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T06:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866576554",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> backport new activation code for any new soft forks that may be ready for deployment prior to version 22 reaching end-of-life\r\n\r\nI think generally we only backport soft-forks to the previous major version. Though I have a slight preference to merge this for 22 to minimize potential conflicts when backporting (other) consensus changes.",
      "created_at" : "2021-06-23T07:07:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-866587331",
      "id" : 866587331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjU4NzMzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T07:07:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866587331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659181813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659181813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Could have given a default that provides more context like \"unknown\"",
      "commit_id" : "01c156677e34e21591e71fb979a041f19c060018",
      "created_at" : "2021-06-26T15:40:36Z",
      "diff_hunk" : "@@ -16,3 +16,21 @@ const struct VBDeploymentInfo VersionBitsDeploymentInfo[Consensus::MAX_VERSION_B\n         /*.gbt_force =*/ true,\n     },\n };\n+\n+std::string DeploymentName(Consensus::BuriedDeployment dep)\n+{\n+    assert(ValidDeployment(dep));\n+    switch (dep) {\n+    case Consensus::DEPLOYMENT_HEIGHTINCB:\n+        return \"bip34\";\n+    case Consensus::DEPLOYMENT_CLTV:\n+        return \"bip65\";\n+    case Consensus::DEPLOYMENT_DERSIG:\n+        return \"bip66\";\n+    case Consensus::DEPLOYMENT_CSV:\n+        return \"csv\";\n+    case Consensus::DEPLOYMENT_SEGWIT:\n+        return \"segwit\";\n+    } // no default case, so the compiler can warn about missing cases\n+    return \"\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659181813",
      "id" : 659181813,
      "line" : 35,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTE4MTgxMw==",
      "original_commit_id" : "80b5b91752f2df9fb5bfdcaa16728ddc959223b1",
      "original_line" : 35,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.cpp",
      "position" : 35,
      "pull_request_review_id" : 693317561,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-26T17:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659181813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659183724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659183724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could have upgraded to `static_cast<int>(Consensus::MAX_VERSION_BITS_DEPLOYMENTS)`",
      "commit_id" : "01c156677e34e21591e71fb979a041f19c060018",
      "created_at" : "2021-06-26T15:57:15Z",
      "diff_hunk" : "@@ -212,6 +212,22 @@ uint32_t VersionBitsCache::Mask(const Consensus::Params& params, Consensus::Depl\n     return VersionBitsConditionChecker(pos).Mask(params);\n }\n \n+extern VersionBitsCache g_versionbitscache; // removed in next commit\n+\n+int32_t ComputeBlockVersion(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    int32_t nVersion = VERSIONBITS_TOP_BITS;\n+\n+    for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659183724",
      "id" : 659183724,
      "line" : 220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTE4MzcyNA==",
      "original_commit_id" : "0802af87b7bf3d69f882b77a90bcf3915dc6b2e3",
      "original_line" : 221,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 37,
      "pull_request_review_id" : 693317561,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-26T17:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659183724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659195240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659195240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't matter too much, as it is dead code. Empty string might even make it easier to run `CHECK_NONFATAL(!name.empty());` in rpc code.",
      "commit_id" : "01c156677e34e21591e71fb979a041f19c060018",
      "created_at" : "2021-06-26T17:23:41Z",
      "diff_hunk" : "@@ -16,3 +16,21 @@ const struct VBDeploymentInfo VersionBitsDeploymentInfo[Consensus::MAX_VERSION_B\n         /*.gbt_force =*/ true,\n     },\n };\n+\n+std::string DeploymentName(Consensus::BuriedDeployment dep)\n+{\n+    assert(ValidDeployment(dep));\n+    switch (dep) {\n+    case Consensus::DEPLOYMENT_HEIGHTINCB:\n+        return \"bip34\";\n+    case Consensus::DEPLOYMENT_CLTV:\n+        return \"bip65\";\n+    case Consensus::DEPLOYMENT_DERSIG:\n+        return \"bip66\";\n+    case Consensus::DEPLOYMENT_CSV:\n+        return \"csv\";\n+    case Consensus::DEPLOYMENT_SEGWIT:\n+        return \"segwit\";\n+    } // no default case, so the compiler can warn about missing cases\n+    return \"\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659195240",
      "id" : 659195240,
      "in_reply_to_id" : 659181813,
      "line" : 35,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTE5NTI0MA==",
      "original_commit_id" : "80b5b91752f2df9fb5bfdcaa16728ddc959223b1",
      "original_line" : 35,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.cpp",
      "position" : 35,
      "pull_request_review_id" : 693331037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-26T17:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659195240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659195358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659195358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`u{Consensus::MAX_VERSION_BITS_DEPLOYMENTS}` is even more preferable when this is changed. (with `u` being the underlying type)",
      "commit_id" : "01c156677e34e21591e71fb979a041f19c060018",
      "created_at" : "2021-06-26T17:25:08Z",
      "diff_hunk" : "@@ -212,6 +212,22 @@ uint32_t VersionBitsCache::Mask(const Consensus::Params& params, Consensus::Depl\n     return VersionBitsConditionChecker(pos).Mask(params);\n }\n \n+extern VersionBitsCache g_versionbitscache; // removed in next commit\n+\n+int32_t ComputeBlockVersion(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    int32_t nVersion = VERSIONBITS_TOP_BITS;\n+\n+    for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659195358",
      "id" : 659195358,
      "in_reply_to_id" : 659183724,
      "line" : 220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTE5NTM1OA==",
      "original_commit_id" : "0802af87b7bf3d69f882b77a90bcf3915dc6b2e3",
      "original_line" : 221,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 37,
      "pull_request_review_id" : 693332635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-26T17:25:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659195358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase.\r\n\r\nFeedback can be ignored or done in a follow-up if needed, to simplify re-review.",
      "created_at" : "2021-06-27T09:08:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-869129098",
      "id" : 869129098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2OTEyOTA5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-27T09:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869129098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @MarcoFalke ; rebased past #22156 ; leaving nit fixing 'til post 22.0",
      "created_at" : "2021-06-28T03:19:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-869317232",
      "id" : 869317232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2OTMxNzIzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-28T03:19:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869317232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659551891"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659551891"
         }
      },
      "author_association" : "MEMBER",
      "body" : "24972d9f49:\r\n\r\nShouldn't this say:\r\n\r\n```cpp\r\nconst bool taproot_active{DeploymentActiveAfter(m_active_chainstate.m_chain.Tip(), args.m_chainparams.GetConsensus(), Consensus::DEPLOYMENT_TAPROOT)};",
      "commit_id" : "e14966ee31f02e359896dbb72e2627b3ae12a314",
      "created_at" : "2021-06-28T07:42:46Z",
      "diff_hunk" : "@@ -684,9 +684,8 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     }\n \n     // Check for non-standard pay-to-script-hash in inputs\n-    const auto& params = args.m_chainparams.GetConsensus();\n-    auto taproot_state = VersionBitsState(m_active_chainstate.m_chain.Tip(), params, Consensus::DEPLOYMENT_TAPROOT, versionbitscache);\n-    if (fRequireStandard && !AreInputsStandard(tx, m_view, taproot_state == ThresholdState::ACTIVE)) {\n+    const bool taproot_active = DeploymentActiveAt(*m_active_chainstate.m_chain.Tip(), args.m_chainparams.GetConsensus(), Consensus::DEPLOYMENT_TAPROOT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659551891",
      "id" : 659551891,
      "line" : 687,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTU1MTg5MQ==",
      "original_commit_id" : "24972d9f4934ee34aa11564d89cf2ad1e9edbffd",
      "original_line" : 687,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 693646799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-28T07:43:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659551891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659552743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659552743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See also https://github.com/bitcoin/bitcoin/pull/19438#discussion_r594226697",
      "commit_id" : "e14966ee31f02e359896dbb72e2627b3ae12a314",
      "created_at" : "2021-06-28T07:44:03Z",
      "diff_hunk" : "@@ -212,6 +212,22 @@ uint32_t VersionBitsCache::Mask(const Consensus::Params& params, Consensus::Depl\n     return VersionBitsConditionChecker(pos).Mask(params);\n }\n \n+extern VersionBitsCache g_versionbitscache; // removed in next commit\n+\n+int32_t ComputeBlockVersion(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    int32_t nVersion = VERSIONBITS_TOP_BITS;\n+\n+    for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r659552743",
      "id" : 659552743,
      "in_reply_to_id" : 659183724,
      "line" : 220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTU1Mjc0Mw==",
      "original_commit_id" : "0802af87b7bf3d69f882b77a90bcf3915dc6b2e3",
      "original_line" : 220,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 37,
      "pull_request_review_id" : 693647904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-28T07:44:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/659552743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-29T04:22:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-870220280",
      "id" : 870220280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MDIyMDI4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-29T04:22:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/870220280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased past #21789",
      "created_at" : "2021-06-29T22:04:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-870949651",
      "id" : 870949651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MDk0OTY1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-29T22:04:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/870949651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r661065481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661065481"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, it should, fixed.",
      "commit_id" : "e48826ad87b4f92261f7433e84f48dac9bd9e5c3",
      "created_at" : "2021-06-30T01:25:08Z",
      "diff_hunk" : "@@ -684,9 +684,8 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     }\n \n     // Check for non-standard pay-to-script-hash in inputs\n-    const auto& params = args.m_chainparams.GetConsensus();\n-    auto taproot_state = VersionBitsState(m_active_chainstate.m_chain.Tip(), params, Consensus::DEPLOYMENT_TAPROOT, versionbitscache);\n-    if (fRequireStandard && !AreInputsStandard(tx, m_view, taproot_state == ThresholdState::ACTIVE)) {\n+    const bool taproot_active = DeploymentActiveAt(*m_active_chainstate.m_chain.Tip(), args.m_chainparams.GetConsensus(), Consensus::DEPLOYMENT_TAPROOT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r661065481",
      "id" : 661065481,
      "in_reply_to_id" : 659551891,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTA2NTQ4MQ==",
      "original_commit_id" : "24972d9f4934ee34aa11564d89cf2ad1e9edbffd",
      "original_line" : 687,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 695621473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-30T01:25:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661065481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r661202215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661202215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Or just `assert(false)` for symmetry with the assert at the beginning of the function?",
      "commit_id" : "e48826ad87b4f92261f7433e84f48dac9bd9e5c3",
      "created_at" : "2021-06-30T07:29:11Z",
      "diff_hunk" : "@@ -16,3 +16,21 @@ const struct VBDeploymentInfo VersionBitsDeploymentInfo[Consensus::MAX_VERSION_B\n         /*.gbt_force =*/ true,\n     },\n };\n+\n+std::string DeploymentName(Consensus::BuriedDeployment dep)\n+{\n+    assert(ValidDeployment(dep));\n+    switch (dep) {\n+    case Consensus::DEPLOYMENT_HEIGHTINCB:\n+        return \"bip34\";\n+    case Consensus::DEPLOYMENT_CLTV:\n+        return \"bip65\";\n+    case Consensus::DEPLOYMENT_DERSIG:\n+        return \"bip66\";\n+    case Consensus::DEPLOYMENT_CSV:\n+        return \"csv\";\n+    case Consensus::DEPLOYMENT_SEGWIT:\n+        return \"segwit\";\n+    } // no default case, so the compiler can warn about missing cases\n+    return \"\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r661202215",
      "id" : 661202215,
      "in_reply_to_id" : 659181813,
      "line" : 35,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTIwMjIxNQ==",
      "original_commit_id" : "80b5b91752f2df9fb5bfdcaa16728ddc959223b1",
      "original_line" : 35,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/deploymentinfo.cpp",
      "position" : 35,
      "pull_request_review_id" : 695785044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-30T07:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661202215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK e48826ad87b4f92261f7433e84f48dac9bd9e5c3",
      "created_at" : "2021-06-30T15:50:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-871521183",
      "id" : 871521183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MTUyMTE4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-30T15:50:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/871521183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/19438/commits/e48826ad87b4f92261f7433e84f48dac9bd9e5c3",
      "created_at" : "2021-07-01T14:10:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#issuecomment-872280918",
      "id" : 872280918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19438",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MjI4MDkxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T14:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872280918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11212268?v=4",
         "events_url" : "https://api.github.com/users/gruve-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gruve-p/followers",
         "following_url" : "https://api.github.com/users/gruve-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gruve-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gruve-p",
         "id" : 11212268,
         "login" : "gruve-p",
         "node_id" : "MDQ6VXNlcjExMjEyMjY4",
         "organizations_url" : "https://api.github.com/users/gruve-p/orgs",
         "received_events_url" : "https://api.github.com/users/gruve-p/received_events",
         "repos_url" : "https://api.github.com/users/gruve-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gruve-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gruve-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gruve-p"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r662494456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662494456"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Or maybe turn this dead code into an `assert(false)`? Crashing the node should be preferred over a consensus failure.",
      "commit_id" : "e48826ad87b4f92261f7433e84f48dac9bd9e5c3",
      "created_at" : "2021-07-01T18:06:12Z",
      "diff_hunk" : "@@ -90,7 +101,25 @@ struct Params {\n      */\n     bool signet_blocks{false};\n     std::vector<uint8_t> signet_challenge;\n+\n+    inline int DeploymentHeight(BuriedDeployment dep) const\n+    {\n+        switch (dep) {\n+        case DEPLOYMENT_HEIGHTINCB:\n+            return BIP34Height;\n+        case DEPLOYMENT_CLTV:\n+            return BIP65Height;\n+        case DEPLOYMENT_DERSIG:\n+            return BIP66Height;\n+        case DEPLOYMENT_CSV:\n+            return CSVHeight;\n+        case DEPLOYMENT_SEGWIT:\n+            return SegwitHeight;\n+        } // no default case, so the compiler can warn about missing cases\n+        return std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r662494456",
      "id" : 662494456,
      "in_reply_to_id" : 606683378,
      "line" : 130,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjQ5NDQ1Ng==",
      "original_commit_id" : "994b0ce58f832da28adf90ab08ce2a7d6886cdae",
      "original_line" : 130,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 47,
      "pull_request_review_id" : 697526525,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-01T18:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662494456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r662496706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662496706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed in https://github.com/bitcoin/bitcoin/pull/22385",
      "commit_id" : "e48826ad87b4f92261f7433e84f48dac9bd9e5c3",
      "created_at" : "2021-07-01T18:09:20Z",
      "diff_hunk" : "@@ -6,28 +6,50 @@\n #define BITCOIN_DEPLOYMENTSTATUS_H\n \n #include <chain.h>\n+#include <versionbits.h>\n \n #include <limits>\n \n+/** Global cache for versionbits deployment status */\n+extern VersionBitsCache versionbitscache;\n+\n /** Determine if a deployment is active for the next block */\n inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return (pindexPrev == nullptr ? 0 : pindexPrev->nHeight + 1) >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAfter(const CBlockIndex* pindexPrev, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return ThresholdState::ACTIVE == VersionBitsState(pindexPrev, params, dep, versionbitscache);\n+}\n+\n /** Determine if a deployment is active for this block */\n inline bool DeploymentActiveAt(const CBlockIndex& index, const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return index.nHeight >= params.DeploymentHeight(dep);\n }\n \n+inline bool DeploymentActiveAt(const CBlockIndex& index, const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return DeploymentActiveAfter(index.pprev, params, dep);\n+}\n+\n /** Determine if a deployment is enabled (can ever be active) */\n inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::BuriedDeployment dep)\n {\n     assert(Consensus::ValidDeployment(dep));\n     return params.DeploymentHeight(dep) != std::numeric_limits<int>::max();\n }\n \n+inline bool DeploymentEnabled(const Consensus::Params& params, Consensus::DeploymentPos dep)\n+{\n+    assert(Consensus::ValidDeployment(dep));\n+    return params.vDeployments[dep].nTimeout != 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19438#discussion_r662496706",
      "id" : 662496706,
      "in_reply_to_id" : 650687320,
      "line" : 52,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjQ5NjcwNg==",
      "original_commit_id" : "e3a93b5095522f9315942600cbeb394a902bc5ce",
      "original_line" : 52,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/deploymentstatus.h",
      "position" : 52,
      "pull_request_review_id" : 697530526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19438",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-01T18:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662496706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
