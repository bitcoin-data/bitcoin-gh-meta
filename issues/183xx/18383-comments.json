[
   {
      "author_association" : "MEMBER",
      "body" : "What is the concrete effect of this? Does this affect validation?\r\n\r\nCan you please add a test that fails without this change?",
      "created_at" : "2020-03-19T14:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601199068",
      "id" : 601199068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTE5OTA2OA==",
      "updated_at" : "2020-03-19T14:09:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601199068",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What is the concrete effect of this? Does this affect validation?\r\n\r\nGood question. technically this code is part of validation, it's called from `tx_verify.cpp`\r\nI do not know if validation can ever execute this with an overflowing value, if so it's a real problem which is why I assume it probably can't. (i'll try writing a test now)\r\nso if it can't happen and assuming this change is correct then this shouldn't affect validation itself\r\n\r\nEDIT: Ok, testing it is a bit more complex, because this is only called on ConnectBlock or in mempool, so might take me some time, no rush.",
      "created_at" : "2020-03-19T14:12:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601201327",
      "id" : 601201327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTIwMTMyNw==",
      "updated_at" : "2020-03-19T14:37:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601201327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is not possible to trigger from a network node or RPC, because `CheckTransaction` is called before `CheckInputs` is called. (This call order is also a requirement for other reasons)",
      "created_at" : "2020-03-19T14:38:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601215527",
      "id" : 601215527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTIxNTUyNw==",
      "updated_at" : "2020-03-19T14:38:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601215527",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This was fixed in `CVE-2010-5139`",
      "created_at" : "2020-03-19T14:38:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601216050",
      "id" : 601216050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTIxNjA1MA==",
      "updated_at" : "2020-03-19T14:38:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601216050",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I am pretty sure the compiler will optimize out the unused result anyway (and thus the overflow), but if you strongly feel like this needs to be fixed, then you could reorder the code, so that the overflow in the unused result never happens:\r\n* First check the output value with MoneyRange\r\n* Calculate the result\r\n* Check the result with MoneyRange",
      "created_at" : "2020-03-19T14:41:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601217595",
      "id" : 601217595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTIxNzU5NQ==",
      "updated_at" : "2020-03-19T14:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601217595",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "How could it overflow, given that `CAmount` is `int64_t`. Expressed in satoshi - about 4000 times more than the total supply of bitcoin?",
      "created_at" : "2020-03-19T14:44:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601219117",
      "id" : 601219117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTIxOTExNw==",
      "updated_at" : "2020-03-19T14:44:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601219117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild  `CAmount` can be `std::numeric_limits<CAmount>::max()` or any other value in range for a serialized transaction. The deserialization code does not check for consensus rules.",
      "created_at" : "2020-03-19T14:49:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601221905",
      "id" : 601221905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTIyMTkwNQ==",
      "updated_at" : "2020-03-19T14:49:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601221905",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK: `CTransaction::GetValueOut()` should handle crazy amounts by throwing the expected exception. I think that was the intention behind the current code, so this is simply a bug AFAICT. (Luckily only reachable by the fuzzers at the moment (AFAICT).)\r\n\r\nHowever, I think your fix can be simplified :)\r\n\r\nNote that `a + b` cannot overflow if `MoneyRange(a) == true` and `MoneyRange(b) == true`. Where `a` and `b` are of type `CAmount`.\r\n\r\nIn other words, simply do `if (!MoneyRange(a) || !MoneyRange(b)) { throw std::runtime_error(â¦); }` and you should be safe to proceed with `a += b`? :)\r\n\r\nNote that the `MoneyRange(a + b)` must obviously be checked too to make sure it is within the money bounds :)\r\n\r\nPerhaps something along the lines of:\r\n\r\n```\r\n    if (!MoneyRange(a) || !MoneyRange(b) || !MoneyRange(a + b)) {\r\n        throw std::runtime_error(â¦);\r\n    }\r\n    a += b;\r\n```",
      "created_at" : "2020-03-19T15:46:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601253642",
      "id" : 601253642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTI1MzY0Mg==",
      "updated_at" : "2020-03-19T15:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601253642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@elichai \r\n\r\nThis is the fix I've used in my local fuzzing tree to avoid hitting this signed integer overflow over and over :)\r\n\r\n```patch\r\ndiff --git a/src/primitives/transaction.cpp b/src/primitives/transaction.cpp\r\nindex 28c145f71..a1567e805 100644\r\n--- a/src/primitives/transaction.cpp\r\n+++ b/src/primitives/transaction.cpp\r\n@@ -84,9 +84,10 @@ CAmount CTransaction::GetValueOut() const\r\n {\r\n     CAmount nValueOut = 0;\r\n     for (const auto& tx_out : vout) {\r\n-        nValueOut += tx_out.nValue;\r\n-        if (!MoneyRange(tx_out.nValue) || !MoneyRange(nValueOut))\r\n+        if (!MoneyRange(nValueOut) || !MoneyRange(tx_out.nValue) || !MoneyRange(nValueOut + tx_out.nValue)) {\r\n             throw std::runtime_error(std::string(__func__) + \": value out of range\");\r\n+        }\r\n+        nValueOut += tx_out.nValue;\r\n     }\r\n     return nValueOut;\r\n }\r\n```\r\n\r\nWould love to see it upstreamed -- that would simplify my fuzzing setup :)\r\n\r\nI agree with @laanwj that a test case which fails under UBSan prior to this PR should be included :)",
      "created_at" : "2020-03-19T16:05:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601265341",
      "id" : 601265341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTI2NTM0MQ==",
      "updated_at" : "2020-03-19T16:18:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601265341",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n\r\n> I am pretty sure the compiler will optimize out the unused result anyway (and thus the overflow)\r\n\r\nWhat unused result are you referring to? :)",
      "created_at" : "2020-03-19T16:20:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601273661",
      "id" : 601273661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTI3MzY2MQ==",
      "updated_at" : "2020-03-19T16:20:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601273661",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift nValueOut is computed but never inspected in case tx_out.nValue is out of range.",
      "created_at" : "2020-03-19T16:25:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601276141",
      "id" : 601276141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTI3NjE0MQ==",
      "updated_at" : "2020-03-19T16:25:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601276141",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa \r\n\r\nAh, in @elichai's suggested fix. I thought @MarcoFalke  meant in current `master` :)\r\n\r\nThe patch I'm suggesting in the comment above looks robust and correct?",
      "created_at" : "2020-03-19T16:43:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601285912",
      "id" : 601285912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTI4NTkxMg==",
      "updated_at" : "2020-03-19T16:43:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601285912",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The patch I'm suggesting in the comment above looks robust and correct?\r\n\r\nYes, and also more readable than the one in this PR (c5dd8eb625).",
      "created_at" : "2020-03-20T14:05:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601718245",
      "id" : 601718245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTcxODI0NQ==",
      "updated_at" : "2020-03-20T14:05:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601718245",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I thought @MarcoFalke meant in current master :)\r\n\r\nI do mean current master :)\r\n\r\nas pointed out by pieter: \"nValueOut is computed but never inspected in case tx_out.nValue is out of range.\" So I think the compiler will likely never produce a binary that computes nValueOut in the first place, or even if it did, it wouldn't matter because it is never read.",
      "created_at" : "2020-03-20T14:11:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601720857",
      "id" : 601720857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTcyMDg1Nw==",
      "updated_at" : "2020-03-21T14:24:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601720857",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "An even simpler patch which also tests the post-condition:\r\n\r\n```diff\r\ndiff --git a/src/primitives/transaction.cpp b/src/primitives/transaction.cpp\r\nindex 28c145f71..76acb08b0 100644\r\n--- a/src/primitives/transaction.cpp\r\n+++ b/src/primitives/transaction.cpp\r\n@@ -9,6 +9,8 @@\r\n #include <tinyformat.h>\r\n #include <util/strencodings.h>\r\n\r\n+#include <cassert>\r\n+\r\n std::string COutPoint::ToString() const\r\n {\r\n     return strprintf(\"COutPoint(%s, %u)\", hash.ToString().substr(0,10), n);\r\n@@ -84,10 +86,11 @@ CAmount CTransaction::GetValueOut() const\r\n {\r\n     CAmount nValueOut = 0;\r\n     for (const auto& tx_out : vout) {\r\n-        nValueOut += tx_out.nValue;\r\n-        if (!MoneyRange(tx_out.nValue) || !MoneyRange(nValueOut))\r\n+        if (!MoneyRange(tx_out.nValue) || !MoneyRange(nValueOut + tx_out.nValue))\r\n             throw std::runtime_error(std::string(__func__) + \": value out of range\");\r\n+        nValueOut += tx_out.nValue;\r\n     }\r\n+    assert(MoneyRange(nValueOut));\r\n     return nValueOut;\r\n }\r\n```\r\n",
      "created_at" : "2020-03-20T15:25:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601757891",
      "id" : 601757891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTc1Nzg5MQ==",
      "updated_at" : "2020-03-20T15:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601757891",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I prefer @practicalswift solution above",
      "created_at" : "2020-03-20T18:12:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601842791",
      "id" : 601842791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTg0Mjc5MQ==",
      "updated_at" : "2020-03-20T18:12:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601842791",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> as pointed out by pieter: \"nValueOut is computed but never inspected in case tx_out.nValue is out of range.\" So I think the compiler will likely never compute nValueOut in the first place, or even if it did, it wouldn't matter because it is never read.\r\n\r\nI honestly don't know if it's a problem overflowing without reading the value, probably isn't as you said.\r\n\r\n\r\n> An even simpler patch which also tests the post-condition:\r\n\r\nIt is a somewhat nicer fix :)\r\n\r\n",
      "created_at" : "2020-03-21T14:21:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602050022",
      "id" : 602050022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjA1MDAyMg==",
      "updated_at" : "2020-03-21T14:21:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602050022",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I also prefer https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-601757891.",
      "created_at" : "2020-03-23T11:56:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602547832",
      "id" : 602547832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjU0NzgzMg==",
      "updated_at" : "2020-03-23T11:56:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602547832",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@practicalswift do you wan to open a new PR with your suggestion? or should I replace my diff here with yours?",
      "created_at" : "2020-03-23T12:05:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602551300",
      "id" : 602551300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjU1MTMwMA==",
      "updated_at" : "2020-03-23T12:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602551300",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@elichai Feel free to use the patch I suggested. That way we'll keep the review to this PR and I can keep my work-in-progress PR count down :)",
      "created_at" : "2020-03-23T12:35:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602563659",
      "id" : 602563659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjU2MzY1OQ==",
      "updated_at" : "2020-03-23T13:16:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602563659",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK a4c79f8cf6e0407f7e937fb41c73127f630231fa",
      "created_at" : "2020-03-23T13:15:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602582090",
      "id" : 602582090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjU4MjA5MA==",
      "updated_at" : "2020-03-23T13:15:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602582090",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/18383/commits/a4c79f8cf6e0407f7e937fb41c73127f630231fa",
      "created_at" : "2020-03-23T13:22:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602585646",
      "id" : 602585646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjU4NTY0Ng==",
      "updated_at" : "2020-03-23T13:22:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602585646",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18383#discussion_r396532249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396532249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `#include <assert.h>` is deprecated in C++. Use the idiomatic form `#include <cassert>` :)",
      "commit_id" : "f65c9ad40f2f5cdc581bdaf72e7dc68e9d7f7a80",
      "created_at" : "2020-03-23T15:21:26Z",
      "diff_hunk" : "@@ -9,6 +9,8 @@\n #include <tinyformat.h>\n #include <util/strencodings.h>\n \n+#include <assert.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#discussion_r396532249",
      "id" : 396532249,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzMjI0OQ==",
      "original_commit_id" : "f65c9ad40f2f5cdc581bdaf72e7dc68e9d7f7a80",
      "original_position" : 4,
      "path" : "src/primitives/transaction.cpp",
      "position" : 4,
      "pull_request_review_id" : 379534050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18383",
      "updated_at" : "2020-03-23T15:21:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396532249",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As pointed out earlier, this indeed is not an issue, because gcc will produce identical binaries for before this PR and after this PR. The overflow never happens.\r\n\r\nACK f65c9ad40f2f5cdc581bdaf72e7dc68e9d7f7a80, checked that clang with O2 produces identical binaries ð\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK f65c9ad40f2f5cdc581bdaf72e7dc68e9d7f7a80, checked that gcc with O2 produces identical binaries ð\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUj+xQv/d/bubEHp/tcMadyZVysqF3siEHt78ZoTKQRhFP5lw4uXb6ovzfzBja/a\r\nkvrU8JXI9uhrb5crSgHSG7usI7c1hNh0dIN0xttD114U3irQJYdNkXT6OdJvwXMx\r\nJ+FB/95iD3SRz/WnDW1HI8s7D3eDRsPi66g+i/qVtiACuZnH0v8upNplGExv+IHF\r\nZDQrdNeTvwSXogBGmzNmNAXKI8YRXW2rqM+anQCPQPCLiSckitQoo7R8MffLkQWn\r\n5czTy4+DOaz7iydxwDvEavu0MQ/VboC3pv8QzdD+Hna6in2kHAZ0b95DC73Xo123\r\nGp/LlwaYdkIWLgl15HUOGp0WZ0M8btc1yFFt69XhdS82gV0/AT+MWgDVLsZiCVnc\r\nhcjvFFmxlv1Kx7HtOYWdkIwXSX9etJkbVcbi0nWn+8lIjhqI4K6FPeZmUkO8VxgZ\r\n3ixw0PthqJD8R43kCLBy/W7JqFwRLYjE952d4Zwbu5Ub5ZAXzHS+pEiexn1rFRA/\r\nEjBVwzaq\r\n=5AXK\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `25065ff511c22aa1d923f7b1fe85f03fe3fe6ee9ddaa063d16dd44d09119c844  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e89294010825065ff511c22aa1d923f7b1fe85f03fe3fe6ee9ddaa063d16dd44d09119c844f0105d89befb29ea41dff1dd1e9cd0de55ee08fff0101600f6d2444670e6d174f44491b68e6908f1045e78d83af0087a01e9d5cfd0cda60083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff0103626e24464ae84f1e5fdbc1819c7345708f020f4bcbc793bffc0578896ea7a98f58d42548b148ccd43a7d78ddf4f4503f4a9d308f1045e78d83af00823726eb1f66ae8c30083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff0105c152abffa2e2e236af0ee6cc6ae0c1808f1045e78d83af008eb04782dd564b3350083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010cd9fe1eee0877e851b17c28e06cd5b3008f1045e78d83af0087b14d0bdaa969e090083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2020-03-23T15:41:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602682370",
      "id" : 602682370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjY4MjM3MA==",
      "updated_at" : "2020-03-23T19:58:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602682370",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK f65c9ad40f2f5cdc581bdaf72e7dc68e9d7f7a80",
      "created_at" : "2020-03-23T21:46:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602873788",
      "id" : 602873788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjg3Mzc4OA==",
      "updated_at" : "2020-03-23T21:46:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602873788",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n\r\n> As pointed out earlier, this indeed is not an issue, because gcc will produce identical binaries for before this PR and after this PR. The overflow never happens.\r\n\r\nI'm not sure I follow your reasoning here TBH.\r\n\r\n\"`gcc` will produce identical binaries for before this PR and after this PR\" does not necessarily imply anything about the behaviour of other compilers we care about, no?\r\n\r\nTest case compiled with `clang` as shown in https://github.com/bitcoin/bitcoin/issues/18046:\r\n\r\n```\r\n$ xxd -p -r <<< \"fb67656c70000000000200ff0000ff0000000000000000ffffff7f0000000000\" > crash-transaction\r\n$ src/test/fuzz/transaction crash-transaction\r\nprimitives/transaction.cpp:87:19: runtime error: signed integer overflow: 1095216725760 + 9223372032559808512 cannot be represented in type 'long'\r\n    #0 0x5574b725f6c1 in CTransaction::GetValueOut() const src/primitives/transaction.cpp:87:19\r\n    #1 0x5574b611e5bb in test_one_input(std::vector<unsigned char, std::allocator<unsigned char> > const&) src/test/fuzz/transaction.cpp:71:18\r\n```\r\n\r\nOverflow never happens? :)",
      "created_at" : "2020-03-23T23:06:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-602905163",
      "id" : 602905163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjkwNTE2Mw==",
      "updated_at" : "2020-03-23T23:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602905163",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke Friendly ping: can you clarify? :)",
      "created_at" : "2020-04-01T05:07:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-607035059",
      "id" : 607035059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzAzNTA1OQ==",
      "updated_at" : "2020-04-01T05:07:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607035059",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@instagibbs You reviewed a previous version of this PR -- would you mind re-reviewing the current version? :)",
      "created_at" : "2020-04-01T05:22:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-607038869",
      "id" : 607038869,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzAzODg2OQ==",
      "updated_at" : "2020-04-01T05:22:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607038869",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW.\r\nYou can see that before: https://godbolt.org/z/wHZVFr \r\nThe logic was first add then compare:\r\n```\r\n        mov     rcx, QWORD PTR [rax]\r\n        add     r8, rcx\r\n        cmp     rcx, rsi\r\n        ja      .L3\r\n        cmp     r8, rsi\r\n        ja      .L3\r\n        add     rax, 8\r\n        cmp     rdx, rax\r\n        jne     .L6\r\n```\r\n\r\nBut now: https://godbolt.org/z/oT7RJb it's first compare then add\r\n```\r\n        mov     rcx, QWORD PTR [rax]\r\n        cmp     rcx, rsi\r\n        ja      .L3\r\n        add     r8, rcx\r\n        cmp     r8, rsi\r\n        jg      .L3\r\n        add     rax, 8\r\n        cmp     rdx, rax\r\n        jne     .L6\r\n```",
      "created_at" : "2020-04-01T07:33:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-607084455",
      "id" : 607084455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzA4NDQ1NQ==",
      "updated_at" : "2020-04-01T07:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607084455",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I used clang, not gcc. Anyway, I didn't say it is wrong to fix this ;)",
      "created_at" : "2020-04-01T15:53:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-607333388",
      "id" : 607333388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzMzMzM4OA==",
      "updated_at" : "2020-04-01T15:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607333388",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/18383/commits/f65c9ad40f2f5cdc581bdaf72e7dc68e9d7f7a80",
      "created_at" : "2020-04-01T16:10:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18383#issuecomment-607343234",
      "id" : 607343234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzM0MzIzNA==",
      "updated_at" : "2020-04-01T16:10:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607343234",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   }
]
