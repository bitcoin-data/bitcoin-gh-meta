[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #16546 (External signer support - Wallet Box edition by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-02T01:16:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-637210666",
      "id" : 637210666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzIxMDY2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T05:44:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637210666",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-06-02T06:40:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-637311651",
      "id" : 637311651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzMxMTY1MQ==",
      "updated_at" : "2020-06-02T06:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637311651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-02T16:09:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-637654808",
      "id" : 637654808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzY1NDgwOA==",
      "updated_at" : "2020-06-02T16:09:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637654808",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Can you add a sanity check to the test? E.g. a `getaddressinfo` call.",
      "created_at" : "2020-06-08T11:24:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-640543096",
      "id" : 640543096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDU0MzA5Ng==",
      "updated_at" : "2020-06-08T11:24:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640543096",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-17T10:01:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-645279086",
      "id" : 645279086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI3OTA4Ng==",
      "updated_at" : "2020-06-17T10:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645279086",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-18T15:24:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-646094428",
      "id" : 646094428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA5NDQyOA==",
      "updated_at" : "2020-06-18T15:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646094428",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442510191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442510191"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (7ea3df8ccd13096088538fb4602208eae0831c13)\r\n\r\nWould suggest moving this to src/wallet/dump.cpp similar to src/wallet/salvage.cpp so the dump /load functionality be accessed other places outside the wallet tool, like by RPCs, the GUI, and c++ unit tests. Way arguments passed and errors are returned might have to change a little, though",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-18T21:22:48Z",
      "diff_hunk" : "@@ -183,6 +183,79 @@ static bool DumpWallet(std::shared_ptr<CWallet> wallet)\n     return ret;\n }\n \n+static bool CreateFromDump(const std::string& name, const fs::path& wallet_path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442510191",
      "id" : 442510191,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUxMDE5MQ==",
      "original_commit_id" : "7ea3df8ccd13096088538fb4602208eae0831c13",
      "original_line" : 186,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433656956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442510191",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442574059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442574059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've moved it to a new file.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-19T00:46:50Z",
      "diff_hunk" : "@@ -183,6 +183,79 @@ static bool DumpWallet(std::shared_ptr<CWallet> wallet)\n     return ret;\n }\n \n+static bool CreateFromDump(const std::string& name, const fs::path& wallet_path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442574059",
      "id" : 442574059,
      "in_reply_to_id" : 442510191,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU3NDA1OQ==",
      "original_commit_id" : "7ea3df8ccd13096088538fb4602208eae0831c13",
      "original_line" : 186,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433734927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442574059",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443120133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443120133"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there any reason to support stdout?\r\n\r\nI'd find it easier to force this setting for both settings and it would simplify reasoning about arbitrary code execution. IIRC in bash simply catting a file can execute arbitrary commands.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-20T10:27:10Z",
      "diff_hunk" : "@@ -26,12 +26,15 @@ static void SetupWalletToolArgs()\n \n     gArgs.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     gArgs.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    gArgs.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file instead of printing to stdout. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443120133",
      "id" : 443120133,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEyMDEzMw==",
      "original_commit_id" : "348be8dafe6642ff2084f8ebfd3471b7c4ed7508",
      "original_line" : 29,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 434419042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443120133",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443777592"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443777592"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed the output to stdout.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-22T19:27:23Z",
      "diff_hunk" : "@@ -26,12 +26,15 @@ static void SetupWalletToolArgs()\n \n     gArgs.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     gArgs.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    gArgs.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file instead of printing to stdout. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443777592",
      "id" : 443777592,
      "in_reply_to_id" : 443120133,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzU5Mg==",
      "original_commit_id" : "348be8dafe6642ff2084f8ebfd3471b7c4ed7508",
      "original_line" : 29,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 435211281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443777592",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Maybe there should be a checksum at the end of the file to detect corruption.\r\n\r\nI'm not sure if that's really useful or practical. We are writing to the wallet file as we read the records so a checksum wouldn't be able to be computed until all records have been read and written to the file, at which point it's too late for a checksum to be useful.\r\n\r\n> Maybe there should be a magic string or version number at the beginning in case we want to extend the format in the future and prevent current parsing function from trying to read it\r\n\r\nI've added a line at the beginning to identify the file with the magic string `BITCOIN_CORE_WALLET_DUMP` and a version number.",
      "created_at" : "2020-06-22T19:29:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-647727895",
      "id" : 647727895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzcyNzg5NQ==",
      "updated_at" : "2020-06-22T19:29:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647727895",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447154380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447154380"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove `;` at end of line.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-29T18:02:14Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447154380",
      "id" : 447154380,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE1NDM4MA==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439379277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447154380",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447155606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447155606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is getting caught in lint-python-utf8-encoding for not specifying `encoding=\"utf8\"`.\r\n```suggestion\r\n        with open(wallet_dump, 'r', encoding=\"utf8\") as f:\r\n```\r\n\r\nSame with the other `with open`s below (lines 244, 250, 255, and 260).",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-29T18:04:28Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r') as f:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447155606",
      "id" : 447155606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE1NTYwNg==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 225,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439379277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447155606",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447166733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447166733"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "not your line but, s/wheter/whether/ if you have to touch-up",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-29T18:24:52Z",
      "diff_hunk" : "@@ -93,53 +93,66 @@ std::shared_ptr<BerkeleyEnvironment> GetWalletEnv(const fs::path& wallet_path, s\n /** Return wheter a BDB wallet database is currently loaded. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447166733",
      "id" : 447166733,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE2NjczMw==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 93,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.h",
      "position" : null,
      "pull_request_review_id" : 439394340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447166733",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-29T20:56:38Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249011",
      "id" : 447249011,
      "in_reply_to_id" : 447154380,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0OTAxMQ==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439494256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249011",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-29T20:56:46Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r') as f:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249073",
      "id" : 447249073,
      "in_reply_to_id" : 447155606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0OTA3Mw==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 225,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439494344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249073",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that'd be better to fix in one of the prerequisite PRs or a followup to this whole PR stack.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-06-29T20:57:20Z",
      "diff_hunk" : "@@ -93,53 +93,66 @@ std::shared_ptr<BerkeleyEnvironment> GetWalletEnv(const fs::path& wallet_path, s\n /** Return wheter a BDB wallet database is currently loaded. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249331",
      "id" : 447249331,
      "in_reply_to_id" : 447166733,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0OTMzMQ==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 93,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.h",
      "position" : null,
      "pull_request_review_id" : 439494708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249331",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-01T14:25:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-652450661",
      "id" : 652450661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjQ1MDY2MQ==",
      "updated_at" : "2020-07-01T14:25:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652450661",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-05T22:38:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-653947745",
      "id" : 653947745,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1Mzk0Nzc0NQ==",
      "updated_at" : "2020-07-05T22:38:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653947745",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-08T23:41:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-655813093",
      "id" : 655813093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTgxMzA5Mw==",
      "updated_at" : "2020-07-08T23:41:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655813093",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452388016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452388016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4d7d60a710f38a7bd2d9b8fb5da92186f2ad64ee: `ret` is already `false`",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-07-09T17:47:22Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);\n+\n+    if (ret) {\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                ret = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452388016",
      "id" : 452388016,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM4ODAxNg==",
      "original_commit_id" : "4d7d60a710f38a7bd2d9b8fb5da92186f2ad64ee",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 445837897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452388016",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452399561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452399561"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm. That should be a break. Fixed.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-07-09T18:08:54Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);\n+\n+    if (ret) {\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                ret = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452399561",
      "id" : 452399561,
      "in_reply_to_id" : 452388016,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM5OTU2MQ==",
      "original_commit_id" : "4d7d60a710f38a7bd2d9b8fb5da92186f2ad64ee",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 445852958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452399561",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure about the path issue. I just use our fs module to try to get the absolute path.\r\n\r\nAlso updated the OP.",
      "created_at" : "2020-07-09T18:09:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-656274176",
      "id" : 656274176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjI3NDE3Ng==",
      "updated_at" : "2020-07-09T18:09:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656274176",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T16:25:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-666505782",
      "id" : 666505782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjUwNTc4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T16:25:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666505782",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-14T15:03:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-674117865",
      "id" : 674117865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDExNzg2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T15:03:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674117865",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480299273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480299273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `DUMP_VERSION`",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-08-31T18:08:38Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480299273",
      "id" : 480299273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5OTI3Mw==",
      "original_commit_id" : "4e631d278abec3801ddf245450cb8b362d4d2607",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 478830735,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480299273",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I wonder if we should include a warning either in the output or in the dumpfile itself that the file should not be shared.\r\n\r\nI suppose we should. I would prefer to just output it on stdout rather than put it in the file.",
      "created_at" : "2020-08-31T23:14:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684090845",
      "id" : 684090845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDA5MDg0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:14:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684090845",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 that sounds fine. Can you quickly add that in before I merge please.",
      "created_at" : "2020-08-31T23:33:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684101944",
      "id" : 684101944,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDEwMTk0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684101944",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag do you have a proposed use-case for piping a wallet dump? That seems a little dangerous to me.",
      "created_at" : "2020-08-31T23:46:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684105921",
      "id" : 684105921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDEwNTkyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:46:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684105921",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Compress or encrypt or grep ð ",
      "created_at" : "2020-08-31T23:49:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684106734",
      "id" : 684106734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDEwNjczNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684106734",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it should be left for a followup but in that case I think it should be done in a way that you have to explicitly choose to pass to stdout. I think many users may accidentally type \"dump\" without realizing they need to configure -dumpfile, and have their whole wallet just dumped to their terminal.",
      "created_at" : "2020-09-01T00:04:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684111211",
      "id" : 684111211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDExMTIxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T00:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684111211",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yeah that's fine, like `-dumpfile -` or something.",
      "created_at" : "2020-09-01T00:09:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684112844",
      "id" : 684112844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDExMjg0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T00:09:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684112844",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480632428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480632428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-09-01T02:38:26Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480632428",
      "id" : 480632428,
      "in_reply_to_id" : 480299273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDYzMjQyOA==",
      "original_commit_id" : "4e631d278abec3801ddf245450cb8b362d4d2607",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 479361570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480632428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added the warning and a checksum to the dumpfile.",
      "created_at" : "2020-09-01T02:38:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684158119",
      "id" : 684158119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDE1ODExOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T02:38:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684158119",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-utACK 7e845b87c18719274c1db3c9d04fbf99407716c0",
      "created_at" : "2020-09-01T10:44:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684761162",
      "id" : 684761162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDc2MTE2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T10:44:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684761162",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Spurious Travis failure reported in #19853 and intentionally not restarted.\r\n\r\nAlso:\r\n```\r\nwallet/wallettool.cpp:134:33: warning: loop variable 'warning' of type 'const bilingual_str' creates a copy from type 'const bilingual_str' [-Wrange-loop-analysis]\r\n                for (const auto warning : warnings) {\r\n                                ^\r\nwallet/wallettool.cpp:134:22: note: use reference type 'const bilingual_str &' to prevent copying\r\n                for (const auto warning : warnings) {\r\n                     ^~~~~~~~~~~~~~~~~~~~\r\n1 warning generated.\r\n```",
      "created_at" : "2020-09-01T12:31:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684818114",
      "id" : 684818114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDgxODExNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T12:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684818114",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sjors I don't think that was caused by this PR.",
      "created_at" : "2020-09-01T16:15:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684973008",
      "id" : 684973008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDk3MzAwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T16:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684973008",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482009780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482009780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could check if open is successful and add corresponding test.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-09-02T11:52:09Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482009780",
      "id" : 482009780,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAwOTc4MA==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 29,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 29,
      "pull_request_review_id" : 480742588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482009780",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482228428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482228428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure how that would be tested. The `open` occurs after file existence has been checked for, so the only thing it would error on is some system thing.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-09-02T17:07:30Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482228428",
      "id" : 482228428,
      "in_reply_to_id" : 482009780,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyODQyOA==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 29,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 29,
      "pull_request_review_id" : 481029049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482228428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482243457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482243457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a check that `open` doesn't fail.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-09-02T17:27:35Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482243457",
      "id" : 482243457,
      "in_reply_to_id" : 482009780,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI0MzQ1Nw==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 29,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 29,
      "pull_request_review_id" : 481044114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482243457",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482266130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482266130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can test by creating a directory and removing write access, then try to create the dump there.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-09-02T18:06:49Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482266130",
      "id" : 482266130,
      "in_reply_to_id" : 482009780,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2NjEzMA==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 29,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 29,
      "pull_request_review_id" : 481125569,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482266130",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482614513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482614513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Like\r\n```py\r\nself.assert_raises_tool_error('Unable to open /root/cant_write for writing', '-wallet=todump', '-dumpfile=/root/cant_write', 'dump')\r\n```",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-09-03T00:24:09Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482614513",
      "id" : 482614513,
      "in_reply_to_id" : 482009780,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjYxNDUxMw==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 29,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 29,
      "pull_request_review_id" : 481398822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482614513",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wonder if the content should have the dump timestamp, at the end like `timestamp,...`?",
      "created_at" : "2020-09-03T00:26:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-686156813",
      "id" : 686156813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NjE1NjgxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-03T00:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686156813",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I wonder if the content should have the dump timestamp, at the end like `timestamp,...`?\r\n\r\nI don't think that's necessary. The file itself will have a creation timestamp and I think that's good enough.\r\n\r\nIf we do want this, we can add it later. Records can be added after the checksum and `createfromdump` will ignore them.",
      "created_at" : "2020-09-03T15:51:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-686585184",
      "id" : 686585184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NjU4NTE4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-03T15:51:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686585184",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T00:50:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-687954412",
      "id" : 687954412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzk1NDQxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T00:50:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687954412",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This will need to have a format option to specify bdb or sqlite. I'll work on that next week.",
      "created_at" : "2020-10-15T22:22:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-709620942",
      "id" : 709620942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTYyMDk0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-15T22:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709620942",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Great, I'll try migrating some BDB descriptor wallets to Sqlite once that's ready.",
      "created_at" : "2020-10-16T09:14:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-709928840",
      "id" : 709928840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTkyODg0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T09:14:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709928840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated with a `-format` option added to `createfromdump`",
      "created_at" : "2020-10-18T18:49:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-711371247",
      "id" : 711371247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMTM3MTI0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-18T18:49:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711371247",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Apparently this fails to dump/restore the wallet unique id.\r\n\r\nThe wallet id is not something we are actually using and supporting. It is a byproduct of BDB. Instead of forcing this wallet logic and database type agnostic tool to have to understand BDB, we should make the wallet id actually supported with #20205. I'm not adding BDB id stuff to this PR, it's out of scope and a layer violation.",
      "created_at" : "2020-10-21T16:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-713689400",
      "id" : 713689400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMzY4OTQwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-21T16:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/713689400",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"tests: Test bitcoin-wallet dump and createfromdump\" (35442fa568583c0da2c687966e49b3742f403870)\r\n\r\nLooking at the `CreateFromDump` implementation it seems like the wallet will be created but empty if there is a checksum error or other import error. It would be good if there was a check at this point to verify if the created wallets are loadable if they are supposed to be loadable or not loadable if they are not supposed be loadable.\r\n\r\n",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-21T23:27:23Z",
      "diff_hunk" : "@@ -212,6 +212,92 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump')\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            dump_data = f.read()\n+        # Check the dump magic\n+        assert dump_data.startswith('BITCOIN_CORE_WALLET_DUMP,1')\n+\n+        self.log.info('Checking that a dumpfile cannot be overwritten')\n+        self.assert_raises_tool_error('File {} already exists. If you are sure this is what you want, move it out of the way first.'.format(wallet_dump),  '-wallet=todump2', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        self.log.info('Checking createfromdump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'createfromdump')\n+        non_exist_dump = os.path.join(self.nodes[0].datadir, \"wallet.nodump\")\n+        self.assert_raises_tool_error('No wallet file format provided. To use createfromdump, -format=<format> must be provided.', '-wallet=todump', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Unknown wallet file format \"notaformat\" provided. Please provide one of \"bdb\" or \"sqlite\".', '-wallet=todump', '-format=notaformat', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Dump file {} does not exist.'.format(non_exist_dump), '-wallet=todump', '-format=bdb', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        wallet_path = os.path.join(self.nodes[0].datadir, 'regtest/wallets/todump2')\n+        self.assert_raises_tool_error('Error: Wallet File {} exists already'.format(wallet_path), '-wallet=todump2', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump')\n+        self.assert_tool_output('', '-wallet=load', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        orig_dump = dump_data\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            f.seek(12, 0)\n+            file_magic = f.read(4)\n+            assert file_magic == b'\\x00\\x05\\x31\\x62' or file_magic == b'\\x62\\x31\\x05\\x00'\n+        self.assert_tool_output('', '-wallet=load-sqlite', '-format=sqlite', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt-sqlite.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load-sqlite', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load-sqlite\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            file_magic = f.read(16)\n+            assert file_magic == b'SQLite format 3\\x00'\n+\n+        self.log.info('Checking createfromdump handling of magic and versions')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver1.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,0\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 0', '-wallet=load1', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver2.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,2\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 2', '-wallet=load2', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_magic_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_magic.dump\")\n+        dump_data = 'not_the_right_magic,1\\n' + dump_data[27:]\n+        with open(bad_magic_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile identifier record is incorrect. Got \"not_the_right_magic\", expected \"BITCOIN_CORE_WALLET_DUMP\".', '-wallet=load3', '-format=bdb', '-dumpfile={}'.format(bad_magic_wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump handling of checksums')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum1.dump\")\n+        checksum = dump_data[-65:-1]\n+        dump_data = orig_dump[:-65] + \"1\" * 64 + \"\\n\"\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}'.format(checksum, \"1\" * 64), '-wallet=load4', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum2.dump\")\n+        dump_data = orig_dump[:-75]\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Missing checksum', '-wallet=load5', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum3.dump\")\n+        dump_data = orig_dump[:-65] + \"2\" * 10\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}{}'.format(checksum, \"2\" * 10, \"0\" * 54), '-wallet=load6', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792246",
      "id" : 509792246,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5MjI0Ng==",
      "original_commit_id" : "35442fa568583c0da2c687966e49b3742f403870",
      "original_line" : 298,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 514259089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792246",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792748"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (6137750082dd28bf38bbb2922d6d040d4e854643)\r\n\r\n`ret` should be set to false if the Write call fails",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-21T23:28:58Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792748",
      "id" : 509792748,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5Mjc0OA==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 218,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514259089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792748",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509794068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509794068"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (6137750082dd28bf38bbb2922d6d040d4e854643)\r\n\r\nIdeally, it would probably be preferable to delete the half created wallet than to just leave it behind. \r\n\r\nI think you could add `if (!ret) wallet->Delete()` after `Wallet->Close()` below with Delete method implementations that just delete the main datafile after the database is closed.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-21T23:33:22Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509794068",
      "id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NDA2OA==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514259089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509794068",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509797552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509797552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be preferable to do that but deleting things was non-trivial enough that I didn't want to spend the effort to figure it out.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-21T23:45:08Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509797552",
      "id" : 509797552,
      "in_reply_to_id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzU1Mg==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514265298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509797552",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509803825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509803825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> It would be preferable to do that but deleting things was non-trivial enough that I didn't want to spend the effort to figure it out.\r\n\r\nSure. I don't know, but I'd expect a simple implementation like the following to be adequate and safe:\r\n\r\n```c++\r\nassert(!m_db);\r\nfs::remove(m_file_path);\r\nfs::remove(m_dir_path);\r\n```",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T00:05:49Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509803825",
      "id" : 509803825,
      "in_reply_to_id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMzgyNQ==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514272411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509803825",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854140"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a check that the file exists (or doesn't for failure cases).",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T03:13:00Z",
      "diff_hunk" : "@@ -212,6 +212,92 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump')\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            dump_data = f.read()\n+        # Check the dump magic\n+        assert dump_data.startswith('BITCOIN_CORE_WALLET_DUMP,1')\n+\n+        self.log.info('Checking that a dumpfile cannot be overwritten')\n+        self.assert_raises_tool_error('File {} already exists. If you are sure this is what you want, move it out of the way first.'.format(wallet_dump),  '-wallet=todump2', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        self.log.info('Checking createfromdump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'createfromdump')\n+        non_exist_dump = os.path.join(self.nodes[0].datadir, \"wallet.nodump\")\n+        self.assert_raises_tool_error('No wallet file format provided. To use createfromdump, -format=<format> must be provided.', '-wallet=todump', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Unknown wallet file format \"notaformat\" provided. Please provide one of \"bdb\" or \"sqlite\".', '-wallet=todump', '-format=notaformat', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Dump file {} does not exist.'.format(non_exist_dump), '-wallet=todump', '-format=bdb', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        wallet_path = os.path.join(self.nodes[0].datadir, 'regtest/wallets/todump2')\n+        self.assert_raises_tool_error('Error: Wallet File {} exists already'.format(wallet_path), '-wallet=todump2', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump')\n+        self.assert_tool_output('', '-wallet=load', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        orig_dump = dump_data\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            f.seek(12, 0)\n+            file_magic = f.read(4)\n+            assert file_magic == b'\\x00\\x05\\x31\\x62' or file_magic == b'\\x62\\x31\\x05\\x00'\n+        self.assert_tool_output('', '-wallet=load-sqlite', '-format=sqlite', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt-sqlite.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load-sqlite', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load-sqlite\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            file_magic = f.read(16)\n+            assert file_magic == b'SQLite format 3\\x00'\n+\n+        self.log.info('Checking createfromdump handling of magic and versions')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver1.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,0\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 0', '-wallet=load1', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver2.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,2\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 2', '-wallet=load2', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_magic_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_magic.dump\")\n+        dump_data = 'not_the_right_magic,1\\n' + dump_data[27:]\n+        with open(bad_magic_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile identifier record is incorrect. Got \"not_the_right_magic\", expected \"BITCOIN_CORE_WALLET_DUMP\".', '-wallet=load3', '-format=bdb', '-dumpfile={}'.format(bad_magic_wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump handling of checksums')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum1.dump\")\n+        checksum = dump_data[-65:-1]\n+        dump_data = orig_dump[:-65] + \"1\" * 64 + \"\\n\"\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}'.format(checksum, \"1\" * 64), '-wallet=load4', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum2.dump\")\n+        dump_data = orig_dump[:-75]\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Missing checksum', '-wallet=load5', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum3.dump\")\n+        dump_data = orig_dump[:-65] + \"2\" * 10\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}{}'.format(checksum, \"2\" * 10, \"0\" * 54), '-wallet=load6', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854140",
      "id" : 509854140,
      "in_reply_to_id" : 509792246,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1NDE0MA==",
      "original_commit_id" : "35442fa568583c0da2c687966e49b3742f403870",
      "original_line" : 298,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 514329903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854162"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T03:13:06Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854162",
      "id" : 509854162,
      "in_reply_to_id" : 509792748,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1NDE2Mg==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 218,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514329928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854162",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854321"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added wallet removal.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T03:13:48Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854321",
      "id" : 509854321,
      "in_reply_to_id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1NDMyMQ==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514330123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854321",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509868556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509868556"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "1) Because `ret` overshadows another variable in the parent scope the function will return `true` and the error won't be shown to the user.\r\n\r\n2) even if we return `false` and show an error the dumpfile is still not complete, which could lead to broken backups if user misses an error. I suggest we remove the file if something goes wrong. So if the dumpfile exists it's always a complete dump.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T04:10:29Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509868556",
      "id" : 509868556,
      "line" : 69,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg2ODU1Ng==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 69,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 69,
      "pull_request_review_id" : 514345983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509868556",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509869271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509869271"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: What's similar about `info`, `salvage` and `dump`? Can we make it a one-level switch instead?\r\n",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T04:14:06Z",
      "diff_hunk" : "@@ -112,7 +113,7 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Close();\n         }\n-    } else if (command == \"info\" || command == \"salvage\") {\n+    } else if (command == \"info\" || command == \"salvage\" || command == \"dump\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509869271",
      "id" : 509869271,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg2OTI3MQ==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 116,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 514345983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509869271",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509876468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509876468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: not necessary as `MakeDatabase` with `options.require_create = true` will guarantee it doesn't exist.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T04:44:43Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;\n+            }\n+            std::string key_str = HexStr(ss_key);\n+            std::string value_str = HexStr(ss_value);\n+            line = strprintf(\"%s,%s\\n\", key_str, value_str);\n+            dump_file.write(line.data(), line.size());\n+            hasher.write(line.data(), line.size());\n+        }\n+    }\n+\n+    // Write the hash\n+    tfm::format(dump_file, \"checksum,%s\\n\", HexStr(hasher.GetHash()));\n+\n+    batch->CloseCursor();\n+    batch.reset();\n+\n+    // Close the wallet after we're done with it. The caller won't be doing this\n+    wallet->Close();\n+    return ret;\n+}\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509876468",
      "id" : 509876468,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg3NjQ2OA==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 125,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514345983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509876468",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. Stopped shadowing.\r\n2. Removing the dump file if `!ret`.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T05:26:02Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887594",
      "id" : 509887594,
      "in_reply_to_id" : 509868556,
      "line" : 69,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg4NzU5NA==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 69,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 69,
      "pull_request_review_id" : 514368898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887594",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed this `else if`. I think this is a left over of when `info` and `salvage` shared wallet opening code.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T05:26:35Z",
      "diff_hunk" : "@@ -112,7 +113,7 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Close();\n         }\n-    } else if (command == \"info\" || command == \"salvage\") {\n+    } else if (command == \"info\" || command == \"salvage\" || command == \"dump\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887762",
      "id" : 509887762,
      "in_reply_to_id" : 509869271,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg4Nzc2Mg==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 116,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 514369103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887762",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887805"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-22T05:26:43Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;\n+            }\n+            std::string key_str = HexStr(ss_key);\n+            std::string value_str = HexStr(ss_value);\n+            line = strprintf(\"%s,%s\\n\", key_str, value_str);\n+            dump_file.write(line.data(), line.size());\n+            hasher.write(line.data(), line.size());\n+        }\n+    }\n+\n+    // Write the hash\n+    tfm::format(dump_file, \"checksum,%s\\n\", HexStr(hasher.GetHash()));\n+\n+    batch->CloseCursor();\n+    batch.reset();\n+\n+    // Close the wallet after we're done with it. The caller won't be doing this\n+    wallet->Close();\n+    return ret;\n+}\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887805",
      "id" : 509887805,
      "in_reply_to_id" : 509876468,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg4NzgwNQ==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 125,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514369144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887805",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK 225cfa9f0c44798ab42c27d161670c5ee74902a3\r\nCI failure seems unrelated",
      "created_at" : "2020-10-23T03:49:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-714891534",
      "id" : 714891534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNDg5MTUzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-23T03:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/714891534",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r510719813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510719813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't seem to affect the `create` command, but the `createfromdump` command? Should that be mentioned?",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-23T08:27:01Z",
      "diff_hunk" : "@@ -26,12 +26,16 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n \n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-format=<format>\", \"The format of the wallet file to create. Either \\\"bdb\\\" or \\\"sqlite\\\".\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r510719813",
      "id" : 510719813,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxOTgxMw==",
      "original_commit_id" : "225cfa9f0c44798ab42c27d161670c5ee74902a3",
      "original_line" : 31,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 515449842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510719813",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r511007422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511007422"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a mention.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-10-23T16:39:52Z",
      "diff_hunk" : "@@ -26,12 +26,16 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n \n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-format=<format>\", \"The format of the wallet file to create. Either \\\"bdb\\\" or \\\"sqlite\\\".\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r511007422",
      "id" : 511007422,
      "in_reply_to_id" : 510719813,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwNzQyMg==",
      "original_commit_id" : "225cfa9f0c44798ab42c27d161670c5ee74902a3",
      "original_line" : 31,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 515833612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511007422",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK eff678b",
      "created_at" : "2020-10-26T11:07:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-716477601",
      "id" : 716477601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjQ3NzYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T11:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716477601",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-01T23:57:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-720173054",
      "id" : 720173054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDE3MzA1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-01T23:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720173054",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516779603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516779603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (fd1f2380cf736df25a27c2607f745ae248c73933)\r\n\r\nThis seems all right for now, but we should think about how to improve usability in the future because this is inconsistent with other ways wallets are created. Other ways to create wallets either default to BDB format or choose format based on a _descriptors/no descriptors_ option, not a _BDB/SQLite_ format option. Also, dumping and recreating a wallet in the original format may be a challenge here, since both wallet formats look like directories with `wallet.dat` files, and you can't tell them apart without opening them or looking for external clues. This `-format` option could also lead to creation of less well tested BDB+descriptor or SQLite+no-descriptor wallet types.\r\n\r\nI think:\r\n\r\n- Ideally best format would be detected automatically and there should be no need to have a `-format` option.\r\n- If `-format` option is kept it should give either a warning or an error if an unusual BDB+descriptor or SQLite+no-descriptor wallet is created.\r\n- If `-format` option is kept, wallet `wallet-tool create` command should either respect it or explicitly disallow it, not ignore it. More ideally a `-descriptors`/-`nodescriptors` option would be used to choose the format, so `wallet-tool create` command would be consistent with other ways wallets are created",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-03T16:03:57Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516779603",
      "id" : 516779603,
      "line" : 167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc3OTYwMw==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 167,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 167,
      "pull_request_review_id" : 522647530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516779603",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516795262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516795262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (fd1f2380cf736df25a27c2607f745ae248c73933)\r\n\r\n- I think code probably should call wallet.reset() before this point. `wallet->Close` is called above, but it seems like Close for BDB only flushes the database, so the environment might not get freed until after fs::remove_all, and lead to later attempted writes.\r\n- Alternately this could use a different approach and call a WalletDatabase::Remove method that just removes the known wallet files and empty directory (https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509803825) instead of calling `fs::remove_all`. Even though `remove_all` should be safe because of the `options.require_create = true` line above, a selective remove would seem more safe than a recursive one",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-03T16:26:11Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        if (!batch->Write(ss_key, ss_value)) {\n+            error = strprintf(_(\"Error: Unable to write record to new wallet\"));\n+            ret = false;\n+            break;\n+        }\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();\n+    }\n+\n+    batch.reset();\n+\n+    dump_file.close();\n+    wallet->Close();\n+\n+    // Remove the wallet dir if we have a failure\n+    if (!ret) {\n+        fs::remove_all(wallet_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516795262",
      "id" : 516795262,
      "line" : 278,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc5NTI2Mg==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 278,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 278,
      "pull_request_review_id" : 522647530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516795262",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516863717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516863717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a reset.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-03T18:12:05Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        if (!batch->Write(ss_key, ss_value)) {\n+            error = strprintf(_(\"Error: Unable to write record to new wallet\"));\n+            ret = false;\n+            break;\n+        }\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();\n+    }\n+\n+    batch.reset();\n+\n+    dump_file.close();\n+    wallet->Close();\n+\n+    // Remove the wallet dir if we have a failure\n+    if (!ret) {\n+        fs::remove_all(wallet_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516863717",
      "id" : 516863717,
      "in_reply_to_id" : 516795262,
      "line" : 278,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2MzcxNw==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 278,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 278,
      "pull_request_review_id" : 522758585,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516863717",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and updated the tests.",
      "created_at" : "2020-11-03T18:12:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-721294197",
      "id" : 721294197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTI5NDE5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-03T18:12:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721294197",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526240887"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe it should be included in the dump? (Can allow overriding still if user desires to do so)",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-18T16:47:12Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887",
      "id" : 526240887,
      "in_reply_to_id" : 516779603,
      "line" : 167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MDg4Nw==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 167,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 167,
      "pull_request_review_id" : 533647214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526240887",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526319192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526319192"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887\r\n\r\n> Maybe it should be included in the dump? (Can allow overriding still if user desires to do so)\r\n\r\n:+1:\r\n\r\nLike that idea",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-18T18:18:41Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526319192",
      "id" : 526319192,
      "in_reply_to_id" : 516779603,
      "line" : 167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxOTE5Mg==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 167,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 167,
      "pull_request_review_id" : 533747927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526319192",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527092004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527092004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Given that this tool is supposed to operate at the database level, I don't think it makes sense to have a `-descriptors`/`-nodescriptors` option for it. Additionally, because this tool doesn't have application level logic, I don't think it should be able to do any introspection of the wallet it creates in order to warn about unusual format and wallet type combinations.\r\n\r\nI would prefer that we keep `-format` but make it directly an option of `createfromdump`. It would be better if our args system had something like Python Argparse's subcommands. But I don't think that is currently possible to do with our args system.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-19T18:04:44Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527092004",
      "id" : 527092004,
      "in_reply_to_id" : 516779603,
      "line" : 167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5MjAwNA==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 167,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 167,
      "pull_request_review_id" : 534714357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527092004",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527167792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527167792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've limited `-format` to only `createfromdump`. I've also added a `format` line to the dump which is used to determine the database format if `-format` isn't provided. This required shuffling around some of the code in `createfromdump`. Tests have also been updated and partially refactored to make them a bit more readable.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-19T20:11:23Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527167792",
      "id" : 527167792,
      "in_reply_to_id" : 516779603,
      "line" : 167,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2Nzc5Mg==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 167,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 167,
      "pull_request_review_id" : 534811295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527167792",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Any reason to disallow dumping to stdout and creating from stdin?",
      "created_at" : "2020-11-19T22:33:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-730679352",
      "id" : 730679352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMDY3OTM1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-19T22:33:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730679352",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527251029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527251029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Warnings should typically go to stderr.",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-19T22:38:03Z",
      "diff_hunk" : "@@ -109,32 +110,63 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n {\n     fs::path path = fs::absolute(name, GetWalletDir());\n \n+    // -format is only allowed with createfromdump. Disallow it for all other commands.\n+    if (gArgs.IsArgSet(\"-format\") && command != \"createfromdump\") {\n+        tfm::format(std::cerr, \"The -format option can only be used with the \\\"createfromdump\\\" command.\\n\");\n+        return false;\n+    }\n+    // -dumpfile is only allowed with dump and createfromdump. Disallow it for all other commands.\n+    if (gArgs.IsArgSet(\"-dumpfile\") && command != \"dump\" && command != \"createfromdump\") {\n+        tfm::format(std::cerr, \"The -dumpfile option can only be used with the \\\"dump\\\" and \\\"createfromdump\\\" commands.\\n\");\n+        return false;\n+    }\n+\n     if (command == \"create\") {\n         std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ true);\n         if (wallet_instance) {\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Close();\n         }\n-    } else if (command == \"info\" || command == \"salvage\") {\n-        if (command == \"info\") {\n-            std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\n-            if (!wallet_instance) return false;\n-            WalletShowInfo(wallet_instance.get());\n-            wallet_instance->Close();\n-        } else if (command == \"salvage\") {\n-            bilingual_str error;\n-            std::vector<bilingual_str> warnings;\n-            bool ret = RecoverDatabaseFile(path, error, warnings);\n-            if (!ret) {\n-                for (const auto& warning : warnings) {\n-                    tfm::format(std::cerr, \"%s\\n\", warning.original);\n-                }\n-                if (!error.empty()) {\n-                    tfm::format(std::cerr, \"%s\\n\", error.original);\n-                }\n+    } else if (command == \"info\") {\n+        std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\n+        if (!wallet_instance) return false;\n+        WalletShowInfo(wallet_instance.get());\n+        wallet_instance->Close();\n+    } else if (command == \"salvage\") {\n+        bilingual_str error;\n+        std::vector<bilingual_str> warnings;\n+        bool ret = RecoverDatabaseFile(path, error, warnings);\n+        if (!ret) {\n+            for (const auto& warning : warnings) {\n+                tfm::format(std::cerr, \"%s\\n\", warning.original);\n+            }\n+            if (!error.empty()) {\n+                tfm::format(std::cerr, \"%s\\n\", error.original);\n             }\n+        }\n+        return ret;\n+    } else if (command == \"dump\") {\n+        std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\n+        if (!wallet_instance) return false;\n+        bilingual_str error;\n+        bool ret = DumpWallet(wallet_instance, error);\n+        if (!ret && !error.empty()) {\n+            tfm::format(std::cerr, \"%s\\n\", error.original);\n             return ret;\n         }\n+        tfm::format(std::cout, \"The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n\");\n+        return ret;\n+    } else if (command == \"createfromdump\") {\n+        bilingual_str error;\n+        std::vector<bilingual_str> warnings;\n+        bool ret = CreateFromDump(name, path, error, warnings);\n+        for (const auto& warning : warnings) {\n+            tfm::format(std::cout, \"%s\\n\", warning.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527251029",
      "id" : 527251029,
      "line" : 177,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI1MTAyOQ==",
      "original_commit_id" : "47b4599b7b1483c1523588e47989eae6369fb0b5",
      "original_line" : 177,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 95,
      "pull_request_review_id" : 534915275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527251029",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527251531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527251531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Better to send this to stderr too, in case dumping to stdout (which can always be done with `-dumpfile /dev/stdout` even if not explicitly supported)",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-11-19T22:39:11Z",
      "diff_hunk" : "@@ -109,32 +110,63 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n {\n     fs::path path = fs::absolute(name, GetWalletDir());\n \n+    // -format is only allowed with createfromdump. Disallow it for all other commands.\n+    if (gArgs.IsArgSet(\"-format\") && command != \"createfromdump\") {\n+        tfm::format(std::cerr, \"The -format option can only be used with the \\\"createfromdump\\\" command.\\n\");\n+        return false;\n+    }\n+    // -dumpfile is only allowed with dump and createfromdump. Disallow it for all other commands.\n+    if (gArgs.IsArgSet(\"-dumpfile\") && command != \"dump\" && command != \"createfromdump\") {\n+        tfm::format(std::cerr, \"The -dumpfile option can only be used with the \\\"dump\\\" and \\\"createfromdump\\\" commands.\\n\");\n+        return false;\n+    }\n+\n     if (command == \"create\") {\n         std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ true);\n         if (wallet_instance) {\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Close();\n         }\n-    } else if (command == \"info\" || command == \"salvage\") {\n-        if (command == \"info\") {\n-            std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\n-            if (!wallet_instance) return false;\n-            WalletShowInfo(wallet_instance.get());\n-            wallet_instance->Close();\n-        } else if (command == \"salvage\") {\n-            bilingual_str error;\n-            std::vector<bilingual_str> warnings;\n-            bool ret = RecoverDatabaseFile(path, error, warnings);\n-            if (!ret) {\n-                for (const auto& warning : warnings) {\n-                    tfm::format(std::cerr, \"%s\\n\", warning.original);\n-                }\n-                if (!error.empty()) {\n-                    tfm::format(std::cerr, \"%s\\n\", error.original);\n-                }\n+    } else if (command == \"info\") {\n+        std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\n+        if (!wallet_instance) return false;\n+        WalletShowInfo(wallet_instance.get());\n+        wallet_instance->Close();\n+    } else if (command == \"salvage\") {\n+        bilingual_str error;\n+        std::vector<bilingual_str> warnings;\n+        bool ret = RecoverDatabaseFile(path, error, warnings);\n+        if (!ret) {\n+            for (const auto& warning : warnings) {\n+                tfm::format(std::cerr, \"%s\\n\", warning.original);\n+            }\n+            if (!error.empty()) {\n+                tfm::format(std::cerr, \"%s\\n\", error.original);\n             }\n+        }\n+        return ret;\n+    } else if (command == \"dump\") {\n+        std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\n+        if (!wallet_instance) return false;\n+        bilingual_str error;\n+        bool ret = DumpWallet(wallet_instance, error);\n+        if (!ret && !error.empty()) {\n+            tfm::format(std::cerr, \"%s\\n\", error.original);\n             return ret;\n         }\n+        tfm::format(std::cout, \"The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r527251531",
      "id" : 527251531,
      "line" : 170,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI1MTUzMQ==",
      "original_commit_id" : "47b4599b7b1483c1523588e47989eae6369fb0b5",
      "original_line" : 170,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 88,
      "pull_request_review_id" : 534915921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527251531",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-23T10:42:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-732077346",
      "id" : 732077346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMjA3NzM0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-23T10:42:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/732077346",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a somewhat complicated change but it only affects wallet tool and has had ACKs at different points from me https://github.com/bitcoin/bitcoin/pull/19137#pullrequestreview-543253329, Sjors https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-716477601, Ivan https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-714891534, promag https://github.com/bitcoin/bitcoin/pull/19137#pullrequestreview-483101258, meshcollider https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684761162 and some review suggestions implemented from Luke https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887.\r\n\r\nIt seems about ready for merge to me. Does it need more reviewers or reacks?",
      "created_at" : "2020-12-11T15:26:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-743258945",
      "id" : 743258945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzI1ODk0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-11T15:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743258945",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-tACK 19b2f4d\r\n\r\nMore appropriate use of stdout and stderr would be nice, but can wait for a followup.",
      "created_at" : "2020-12-15T12:18:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-745252814",
      "id" : 745252814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTI1MjgxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-15T12:18:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745252814",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "NACK until this can handle dumping/restoring the wallet id. (Or alternatively simply refuse to dump/restore BDB wallets until this is fixed)",
      "created_at" : "2020-12-15T17:18:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-745437684",
      "id" : 745437684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTQzNzY4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-15T17:18:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745437684",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> NACK until this can handle dumping/restoring the wallet id. (Or alternatively simply refuse to dump/restore BDB wallets until this is fixed)\r\n\r\nWhat are the negative consequences of merging the PR without this feature? The [only place wallet ids are used](https://github.com/bitcoin/bitcoin/blob/8bb40d5f56c8e46f12786da0b6444cdde3b6f7c8/src/wallet/bdb.cpp#L356-L359) is to forbid opening an older type of wallet that we don't create anymore to avoid runtime data corruption (#11429). This isn't relevant to dump/createfromdump because createfromdump doesn't create the type of wallet that would have this corruption (a BDB wallet sharing an BDB environment with another wallet that has the same fileid), and even if it did you'd think choosing a new id would actually be more helpful than choosing a duplicate id.\r\n\r\nI know there are future PRs and maybe forks that envision using unique ids for new purposes, but if this PR causes a problem for them, I think a substantive NACK would explain specifically how the problem arises and what the consequences are.",
      "created_at" : "2020-12-15T18:58:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-745497062",
      "id" : 745497062,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTQ5NzA2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-15T18:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745497062",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">What are the negative consequences of merging the PR without this feature?\r\n\r\nA user might think they've created an identical clone of a wallet that is in fact different.\r\n\r\n>an older type of wallet that we don't create anymore\r\n\r\nInteresting, I didn't realise the dedicated db environments fixed that. But ultimately not relevant.\r\n\r\n> I know there are future PRs and maybe forks that envision using unique ids for new purposes, but if this PR causes a problem for them, I think a substantive NACK would explain specifically how the problem arises and what the consequences are.\r\n\r\nAnything that uses wallet ids (eg, pruning locks that persist even when the wallet is unloaded, across renames/moves/etc) would treat these \"clones\" as independent/unrelated wallets.",
      "created_at" : "2020-12-15T19:30:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-745515785",
      "id" : 745515785,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTUxNTc4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-15T19:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745515785",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > What are the negative consequences of merging the PR without this feature?\r\n> \r\n> A user might think they've created an identical clone of a wallet that is in fact different.\r\n\r\nAs I explained, we don't have any code that treats these wallets as different. So the NACK above is based on other code which isn't part of the software and hasn't been described in any detail, which makes it not seem very substantive. If there is a legitimate objection, it should be possible to describe a scenario where createfromdump interacts badly with prunelocks or another feature in some other code where not merging this PR somehow makes things better.\r\n\r\n(For prunelocks, it would seem like the safest thing would be to treat different wallet files as different and not automatically delete locks, but you would be the expert there so please fill me in!)",
      "created_at" : "2020-12-15T20:14:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-745540605",
      "id" : 745540605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTU0MDYwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-15T20:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745540605",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It is already possible with RPCs to create an \"identical clone of a wallet that is in fact different\", so I think the NACK describes something unrelated to this pull and should thus be filed as an issue.\r\n\r\nEven if the NACK applied to this pull, instead of wholesale rejecting it, a simple documentation fixup can be applied to document the shortcomings and dangers, if there are any.",
      "created_at" : "2020-12-16T06:49:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-745804532",
      "id" : 745804532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTgwNDUzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-16T06:49:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745804532",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r544126240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/544126240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n./wallet/dump.h:12:17: error: use of undeclared identifier 'std'\r\nbool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error);\r\n                ^\r\n",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-12-16T09:03:57Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_DUMP_H\n+#define BITCOIN_WALLET_DUMP_H\n+\n+class CWallet;\n+\n+struct bilingual_str;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r544126240",
      "id" : 544126240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNjI0MA==",
      "original_commit_id" : "75ac0ad9ac664d50a779ba9e8fdffb1371997046",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/dump.h",
      "position" : null,
      "pull_request_review_id" : 553480028,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/544126240",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r544132696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/544132696"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, is there any reason to pass a shared_ptr, when a reference suffices?\r\n\r\nSuggested diff for first commit:\r\n\r\n```diff\r\ndiff --git a/src/wallet/dump.cpp b/src/wallet/dump.cpp\r\nindex 242d8dc31c..2e366b2a19 100644\r\n--- a/src/wallet/dump.cpp\r\n+++ b/src/wallet/dump.cpp\r\n@@ -2,13 +2,15 @@\r\n // Distributed under the MIT software license, see the accompanying\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n \r\n+#include <wallet/dump.h>\r\n+\r\n #include <util/translation.h>\r\n #include <wallet/wallet.h>\r\n \r\n static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\r\n uint32_t DUMP_VERSION = 1;\r\n \r\n-bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\r\n+bool DumpWallet(CWallet& wallet, bilingual_str& error)\r\n {\r\n     // Get the dumpfile\r\n     std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\r\n@@ -32,7 +34,7 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\r\n \r\n     CHashWriter hasher(0, 0);\r\n \r\n-    WalletDatabase& db = wallet->GetDatabase();\r\n+    WalletDatabase& db = wallet.GetDatabase();\r\n     std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\r\n \r\n     bool ret = true;\r\n@@ -52,7 +54,6 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\r\n     hasher.write(line.data(), line.size());\r\n \r\n     if (ret) {\r\n-\r\n         // Read the records\r\n         while (true) {\r\n             CDataStream ss_key(SER_DISK, CLIENT_VERSION);\r\n@@ -78,7 +79,7 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\r\n     batch.reset();\r\n \r\n     // Close the wallet after we're done with it. The caller won't be doing this\r\n-    wallet->Close();\r\n+    wallet.Close();\r\n \r\n     if (ret) {\r\n         // Write the hash\r\ndiff --git a/src/wallet/dump.h b/src/wallet/dump.h\r\nindex a62c388b72..0f17ee1d0d 100644\r\n--- a/src/wallet/dump.h\r\n+++ b/src/wallet/dump.h\r\n@@ -9,6 +9,6 @@ class CWallet;\r\n \r\n struct bilingual_str;\r\n \r\n-bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error);\r\n+bool DumpWallet(CWallet& wallet, bilingual_str& error);\r\n \r\n #endif // BITCOIN_WALLET_DUMP_H\r\ndiff --git a/src/wallet/wallettool.cpp b/src/wallet/wallettool.cpp\r\nindex 1fed63b755..f78ebd4376 100644\r\n--- a/src/wallet/wallettool.cpp\r\n+++ b/src/wallet/wallettool.cpp\r\n@@ -149,7 +149,7 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\r\n         std::shared_ptr<CWallet> wallet_instance = MakeWallet(name, path, /* create= */ false);\r\n         if (!wallet_instance) return false;\r\n         bilingual_str error;\r\n-        bool ret = DumpWallet(wallet_instance, error);\r\n+        bool ret = DumpWallet(*wallet_instance, error);\r\n         if (!ret && !error.empty()) {\r\n             tfm::format(std::cerr, \"%s\\n\", error.original);\r\n             return ret;\r\n",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-12-16T09:13:54Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_DUMP_H\n+#define BITCOIN_WALLET_DUMP_H\n+\n+class CWallet;\n+\n+struct bilingual_str;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r544132696",
      "id" : 544132696,
      "in_reply_to_id" : 544126240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEzMjY5Ng==",
      "original_commit_id" : "75ac0ad9ac664d50a779ba9e8fdffb1371997046",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/dump.h",
      "position" : null,
      "pull_request_review_id" : 553480028,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/544132696",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> More appropriate use of stdout and stderr would be nice, but can wait for a followup.\r\n\r\nSorry, this has been removed based on my feedback, because I missed that all strings written are hex-encoded (or ascii). See https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443120133",
      "created_at" : "2020-12-16T09:46:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-746001910",
      "id" : 746001910,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NjAwMTkxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-16T09:46:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/746001910",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 Let me know if you want this merged or want to address the style nits",
      "created_at" : "2020-12-16T09:46:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-746002518",
      "id" : 746002518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NjAwMjUxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-16T09:46:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/746002518",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seeing as this now needs rebase, I guess I'll address the style nits.",
      "created_at" : "2020-12-16T17:13:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-746658980",
      "id" : 746658980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NjY1ODk4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-16T17:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/746658980",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r544492574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/544492574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-12-16T17:37:44Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_DUMP_H\n+#define BITCOIN_WALLET_DUMP_H\n+\n+class CWallet;\n+\n+struct bilingual_str;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r544492574",
      "id" : 544492574,
      "in_reply_to_id" : 544126240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ5MjU3NA==",
      "original_commit_id" : "75ac0ad9ac664d50a779ba9e8fdffb1371997046",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/dump.h",
      "position" : null,
      "pull_request_review_id" : 553927955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-16T17:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/544492574",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In my experience treating wallets created from a dump as unique is a feature, not a bug. By definition the dump no longer gets updated, while the original does. And when you load from a dump, any rescan has to start where the dump left off, rather than whenever you closed the original wallet. In fact I like to keep both Sqlite and BDB versions around, and open, while testing these features (though that's not a common use case).\r\n\r\nA followup could add an option to reuse the same wallet id.\r\n\r\nre-utACK 23cac24",
      "created_at" : "2020-12-17T12:27:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-747409722",
      "id" : 747409722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NzQwOTcyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T12:33:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/747409722",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re review ACK 23cac24dd3f2aaf88aab978e7ef4905772815cd2 only change is rebase and removing useless shared_ptr wrapper ð¼\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre review ACK 23cac24dd3f2aaf88aab978e7ef4905772815cd2 only change is rebase and removing useless shared_ptr wrapper ð¼\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjHkwv/YsYYRt14UrM5EcbCKReDDt9Ul4OE3P6iwjGU7ztOmfpT4yvDVwxvs6N4\r\nx2YVIkLx7tCJSZagdgg3aJY5P4g7GLzFRtR4Gpz6iLRD3Q4BXvKgRlYqpbWfVY0Z\r\nFypJn0duhvB6GT6YlduyaZlqzepPmDo9RNMxsZJ0DsU9dSwP498LfDnpPPxI4Cu2\r\nZ7XGrNRRPPRlBPpD88ZNCC3NxAfjcmpecbfv3aAKwUuWdw7H1ksNiDZeYXuBtw9I\r\n9XdwJhzzVxyj+8uhwqTljUVBIp+kDnhCqZCZeaEVNx66aG/2YdkBinY3D5Z+rpSd\r\ndB6b22W2S3TnbUrjCiz/bF7NxaZxbsGms3hXG332+VKSQR+/6PSVh33VGK7woHDM\r\nTQ/cwmw7xCHeVVtwhsbpUFiAzSh+Hen89jsXNM0PlB8n1rhO2T/DufYFeQyNskhi\r\nWjglPPQTcugCpRZo/TLYEuZ1WrcrtzaATNI+ROpcDCsA16WaSKG5XLO/4QwhLUsF\r\nrcaeEhD0\r\n=Do37\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `82f548fd46541ccebb08bdfe077afdd42eda0b903148cceba0f7b365cebec1ab  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e89294010882f548fd46541ccebb08bdfe077afdd42eda0b903148cceba0f7b365cebec1abf01097204261420549d81a1ba64a723f5c1b08fff0102005acb45201b9cbdf358595063b8a0008f0204db9ea1d46f74672c55f46664a71c8d2a24e0f0374f869395852e330522070ef08f1045fdb4ff1f00847c98eae014ca9f10083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff0103d4a28dae7fe3335941252098b9ea7de08f020aad417580f89f07d3317038ff7143252df45bbf6df739daad38f60d2b70b3ed608f1045fdb4ff0f008ac0a626f49be08a20083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010838a7ea3479451be743c922fa27e321508f02024c53517479b0fc0fd040ade91501c76b4ca77ddcc312c7c5606dd0a3112b12a08f1045fdb4ff0f008f6bdefa20f4f93330083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6df010e204d7d7db8fe728f3544b7f20740b3e08f12002b60d9927e27228e9941c2b86acd76347e7d91bbfc567ccf261f669623b36d908f1045fdb4ff0f0085e18e9a90290cf280083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2020-12-17T12:33:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-747412246",
      "id" : 747412246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NzQxMjI0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T12:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/747412246",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r545091767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545091767"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add dump command\" (e1e7a90d5f0616a46ffadd62a9f1c65406cca6b4)\r\n\r\nFor a followup, it would be good to print an error in the `if (gArgs.IsArgSet(\"-descriptors\") && command != \"create\")` case so there is an explicit error if someone tries to pass `-descriptors`/`-nodescriptors` to `createfromdump`. (Suggested originally in S3RK's PR https://github.com/bitcoin/bitcoin/pull/20365#discussion_r534395176)",
      "commit_id" : "23cac24dd3f2aaf88aab978e7ef4905772815cd2",
      "created_at" : "2020-12-17T13:32:17Z",
      "diff_hunk" : "@@ -106,6 +107,12 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n {\n     fs::path path = fs::absolute(name, GetWalletDir());\n \n+    // -dumpfile is only allowed with dump and createfromdump. Disallow it for all other commands.\n+    if (gArgs.IsArgSet(\"-dumpfile\") && command != \"dump\" && command != \"createfromdump\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r545091767",
      "id" : 545091767,
      "line" : 116,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA5MTc2Nw==",
      "original_commit_id" : "e1e7a90d5f0616a46ffadd62a9f1c65406cca6b4",
      "original_line" : 111,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 18,
      "pull_request_review_id" : 554605202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-17T13:34:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545091767",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
