[
   {
      "author_association" : "MEMBER",
      "body" : "As far as we are concerned, this is just a stylistic issue. Even with the fix, anyone with access to the rpc interface can still shut down the node (either by directly calling `stop` or #15017 or #14376 or ...)",
      "created_at" : "2019-12-13T16:45:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17742#issuecomment-565514184",
      "id" : 565514184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17742",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NTUxNDE4NA==",
      "updated_at" : "2019-12-13T16:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/565514184",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n\r\n> As far as we are concerned, this is just a stylistic issue. \r\n\r\nIt would be silly for me to try to oversell this relatively small issue, but calling it \"just a stylistic issue\" from a Bitcoin Core perspective does not feel like an accurate description TBH :)\r\n\r\n**Point 1. RPC user whitelisting** \r\n\r\nWith the merge of RPC user whitelisting (PR #12763) we now effectively have \"not-as-trusted-as-the-node-operator\" RPC consumers whether we like it or not. Any such not fully trusted RPC consumer can trivially trigger this UniValue bug as demonstrated by the `curl` example above and shut down the node that he or she has been given supposedly locked down RPC access to.\r\n\r\nI don't think that is behaviour that our users expect.\r\n\r\n**Point 2. Partial control over JSON payload when Bitcoin Core is used as a service backend**\r\n\r\nIt sounds like you're assuming that access to the RPC interface is either full access (full control over the entire JSON payload sent to the node) or no access (no control over the JSON payload).\r\n\r\nFrom a \"`bitcoin-cli` perspective\" it is easy to get the impression that access is always binary and that the node operator is the only person being able to control the JSON payload.\r\n\r\nIn practice the RPC is interface is often used as a backend to various services (such as web interfaces, etc.). By interacting with these services an attacker can influence gain **partial** control over the JSON payload sent to the node.\r\n\r\nThis is a typical Bitcoin Core RPC JSON payload:\r\n\r\n```\r\n{\r\n   \"id\" : 1,\r\n   \"params\" : [â¦ some object structure â¦],\r\n   \"method\" : \"method_to_call\"\r\n}\r\n```\r\n\r\nIn a typical RPC-used-from-a-web-application the attacker is probably not being able to influence which method to call (`\"method\" : \"method_to_call\"` in the example above), but it is not unreasonable to assume that he/she may be able to influence at least a subset of the object structure that is sent as parameters to the RPC method (`\"params\" : [â¦ some object structure â¦]`) by legitimate interaction with the service.\r\n\r\nSo while an attacker is likely not be able to change the \"method\" field from say `help` to `stop` it is not unthinkable that he or she might be able to cause some part of the `params` structure to be of excessively high object depth and thus triggering this UniValue issue and shuts down the backend Bitcoin Core node.\r\n\r\nAnd even in the case that such high object depth would be due to lacking validation on the part of the application developer I think the expectation of our users would be that Bitcoin Core should return a parsing error and not die as it currently does :)\r\n\r\nGiven this clarification, can you see why calling this \"just a stylistic issue\" does not feel entirely accurate? :)",
      "created_at" : "2019-12-13T22:27:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17742#issuecomment-565632396",
      "id" : 565632396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17742",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NTYzMjM5Ng==",
      "updated_at" : "2019-12-14T18:21:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/565632396",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Demonstration of a locked down RPC user with supposedly only access to the `help` command (`-rpcwhitelist=u:help`) segfaulting the node via a single `curl` command:\r\n\r\n```\r\n$ share/rpcauth/rpcauth.py u p\r\nString to be appended to bitcoin.conf:\r\nrpcauth=u:d7ca300b5aeceb73e9825068fc4496ef$166cbdedfe11c30a95c28d13b3383682825308d1069d347f9705b8cf922637c5\r\nYour password:\r\np\r\n$ src/bitcoind -regtest -rpcwhitelist=u:help '-rpcauth=u:d7ca300b5aeceb73e9825068fc4496ef$166cbdedfe11c30a95c28d13b3383682825308d1069d347f9705b8cf922637c5' &\r\n$ src/bitcoin-cli -regtest -rpcuser=u -rpcpassword=p help | head -1\r\n== Blockchain ==\r\n$ src/bitcoin-cli -regtest -rpcuser=u -rpcpassword=p getnetworkinfo\r\n2019-12-13T02:01:37Z RPC User u not allowed to call method getnetworkinfo\r\nerror: server returned HTTP error 403\r\n$ curl -u u:p --request POST \\\r\n     --data $(python -c 'print(50000 * \"[\");') http://127.0.0.1:18443\r\ncurl: (52) Empty reply from server\r\n[1]+  Segmentation fault      (core dumped) src/bitcoind -regtest -rpcwhitelist=u:help '-rpcauth=u:d7ca300b5aeceb73e9825068fc4496ef$166cbdedfe11c30a95c28d13b3383682825308d1069d347f9705b8cf922637c5'\r\n```\r\n\r\nAm I the only one thinking that this might not be the behaviour our users expect when using `-rpcwhitelist`, and thus not just being a \"stylistic issue\"? :)",
      "created_at" : "2019-12-14T17:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17742#issuecomment-565736432",
      "id" : 565736432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17742",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NTczNjQzMg==",
      "updated_at" : "2019-12-14T17:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/565736432",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's a bug and should be fixed like any otherâ¦\r\n\r\nSo to be concrete and make progress here:\r\n\r\n- The fix needs to end up in our [univalue repo](https://github.com/bitcoin-core/univalue) first (filed a PR bitcoin-core/univalue#22)\r\n- Then a subtree pull from there can be done into this repo\r\n- Then this can be PRed here\r\n",
      "created_at" : "2019-12-15T10:07:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17742#issuecomment-565794953",
      "id" : 565794953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17742",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NTc5NDk1Mw==",
      "updated_at" : "2019-12-15T10:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/565794953",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The UniValue PR has been merged, so subtree update is the next step.",
      "created_at" : "2020-01-04T11:26:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17742#issuecomment-570777531",
      "id" : 570777531,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17742",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MDc3NzUzMQ==",
      "updated_at" : "2020-01-04T11:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570777531",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As we bump anyway, we might as well merge those stylistic changes from upstream: https://github.com/bitcoin-core/univalue/pull/23",
      "created_at" : "2020-01-04T13:57:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17742#issuecomment-570787588",
      "id" : 570787588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17742",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MDc4NzU4OA==",
      "updated_at" : "2020-01-04T13:57:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570787588",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
