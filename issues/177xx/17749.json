{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Testing with Bitcoin Core msvc builds against Qt5.12.6 has revealed a new library dependency on `Wstapi32.lib` which is part of the [Remote Desktop Services](https://docs.microsoft.com/en-us/windows/win32/api/_termserv/index).\r\n\r\nThere are only two undefined symbols when `Wstapi32.lib` is not set as a dependency:\r\n\r\n  - [WTSQuerySessionInformationW](https://docs.microsoft.com/en-us/windows/win32/api/wtsapi32/nf-wtsapi32-wtsquerysessioninformationw)\r\n\r\n  - [WTSFreeMemory](https://docs.microsoft.com/en-us/windows/win32/api/wtsapi32/nf-wtsapi32-wtsfreememory) \r\n\r\nThese two calls look safe. Despite that the linking of a remote desktop library to Bitcoin Core is not ideal and has already raised concerns.\r\n\r\nIdeally a way will be found to set a Qt configuration parameter so the library is not required. I have posted a [question](https://forum.qt.io/topic/109777/configure-option-for-qt5-12-6-to-avoid-dependency-on-wtsapi32-lib) on the Qt forum to that effect.\r\n\r\nThe Qt build configuration options below DO NOT work. They come from disabling all features and directories that don't look related to Bitcoin Core and are also from looking at #17736 \r\n\r\n````\r\n..\\configure -debug-and-release -opensource -platform win32-msvc -opengl desktop -no-shared -no-static-runtime -mp -c++std c++11 -confirm-license -ltcg -static -make libs -make tools  -optimized-tools -pch -qt-libpng -qt-pcre -qt-harfbuzz -system-zlib -no-compile-examples -no-angle -no-cups -no-dbus -no-egl -no-eglfs -no-freetype -no-gif -no-glib -no-gtk -no-icu -no-ico -no-iconv -no-kms -no-linuxfb -no-libjpeg -no-libproxy -no-libudev -no-mtdev -no-opengles3 -no-openssl -no-openvg -no-reduce-relocations -no-sctp -no-sql-db2 -no-sql-ibase -no-sql-oci -no-sql-tds -no-sql-mysql -no-sql-odbc -no-sql-psql -no-sql-sqlite -no-sql-sqlite2 -no-sqlite -no-system-proxies -no-use-gold-linker -nomake examples -nomake tests -no-feature-bearermanagement -no-feature-colordialog -no-feature-commandlineparser -no-feature-concurrent -no-feature-dial -no-feature-dtls -no-feature-ftp -no-feature-http -no-feature-image_heuristic_mask -no-feature-keysequenceedit -no-feature-lcdnumber -no-feature-networkdiskcache -no-feature-networkproxy -no-feature-pdf -no-feature-printdialog -no-feature-printer -no-feature-printpreviewdialog -no-feature-printpreviewwidget  -no-feature-sessionmanager -no-feature-socks5 -no-feature-sqlmodel -no-feature-statemachine -no-feature-syntaxhighlighter -no-feature-textedit -no-feature-texthtmlparser -no-feature-textodfwriter -no-feature-topleveldomain -no-feature-udpsocket -no-feature-undocommand -no-feature-undogroup -no-feature-undostack -no-feature-undoview -no-feature-vnc -no-feature-whatsthis -no-feature-wizard -no-feature-xml -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtcharts -skip qtconnectivity -skip qtdatavis3d -skip qtdeclarative -skip qtdoc -skip qtgamepad -skip qtgraphicaleffects -skip qtimageformats -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtnetworkauth -skip qtpurchasing -skip qtquickcontrols -skip qtquickcontrols2 -skip qtscript -skip qtscxml -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtspeech -skip qtvirtualkeyboard -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebglplugin -skip qtwebsockets -skip qtwebview -skip qtx11extras -skip qtxmlpatterns -IC:\\tools\\vcpkg\\installed\\x64-windows-static\\include -LC:\\tools\\vcpkg\\installed\\x64-windows-static\\lib -prefix C:\\Qt5.12.6_x64_static_vs2019\r\n````\r\n\r\nA substantial number (20 to 30) of trial and error iterations later a set of successful configure options is below. Unfortunately this still results in a build that requires Wtsapi32.lib.\r\n\r\n````\r\n..\\configure -debug-and-release -opensource -platform win32-msvc -opengl desktop -no-shared -no-static-runtime -mp -c++std c++11 -confirm-license -ltcg -static -make libs -make tools  -optimized-tools -pch -qt-libpng -qt-pcre -qt-harfbuzz -system-zlib -no-compile-examples -no-angle -no-cups -no-dbus -no-egl -no-eglfs -no-freetype -no-gif -no-glib -no-gtk -no-icu -no-ico -no-iconv -no-kms -no-linuxfb -no-libjpeg -no-libproxy -no-libudev -no-mtdev -no-opengles3 -no-openssl -no-openvg -no-reduce-relocations -no-sctp -no-sql-db2 -no-sql-ibase -no-sql-oci -no-sql-tds -no-sql-mysql -no-sql-odbc -no-sql-psql -no-sql-sqlite -no-sql-sqlite2 -no-sqlite -no-system-proxies -no-use-gold-linker -nomake examples -nomake tests -no-feature-bearermanagement -no-feature-concurrent -no-feature-dial -no-feature-dtls -no-feature-ftp -no-feature-http -no-feature-lcdnumber -no-feature-networkdiskcache -no-feature-networkproxy  -no-feature-sessionmanager -no-feature-socks5 -no-feature-sqlmodel -no-feature-topleveldomain -no-feature-udpsocket -no-feature-vnc -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtcharts -skip qtconnectivity -skip qtdatavis3d -skip qtdeclarative -skip qtdoc -skip qtgamepad -skip qtgraphicaleffects -skip qtimageformats -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtnetworkauth -skip qtpurchasing -skip qtscript -skip qtscxml -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtspeech -skip qtvirtualkeyboard -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebglplugin -skip qtwebsockets -skip qtwebview -skip qtx11extras -IC:\\tools\\vcpkg\\installed\\x64-windows-static\\include -LC:\\tools\\vcpkg\\installed\\x64-windows-static\\lib -prefix C:\\Qt5.12.6_x64_static_vs2019\r\n````",
   "closed_at" : "2019-12-17T08:10:33Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
      "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipsorcery/followers",
      "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipsorcery",
      "id" : 197660,
      "login" : "sipsorcery",
      "node_id" : "MDQ6VXNlcjE5NzY2MA==",
      "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
      "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
      "repos_url" : "https://api.github.com/users/sipsorcery/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipsorcery"
   },
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17749/comments",
   "created_at" : "2019-12-15T12:10:24Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17749/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/17749",
   "id" : 538042276,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "description" : null,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      },
      {
         "color" : "bfd4f2",
         "default" : false,
         "description" : null,
         "id" : 159815356,
         "name" : "Upstream",
         "node_id" : "MDU6TGFiZWwxNTk4MTUzNTY=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Upstream"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17749/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1MzgwNDIyNzY=",
   "number" : 17749,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Qt5.12.6 on Windows introduces dependency on Wtsapi32.lib",
   "updated_at" : "2019-12-17T08:10:34Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17749",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
      "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipsorcery/followers",
      "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipsorcery",
      "id" : 197660,
      "login" : "sipsorcery",
      "node_id" : "MDQ6VXNlcjE5NzY2MA==",
      "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
      "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
      "repos_url" : "https://api.github.com/users/sipsorcery/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipsorcery"
   }
}
