{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "<!-- Describe the issue -->\r\n\r\nRunning the RPC call `importmulti` with a xpub key with very large range results in a timeout error and seems to ultimately fail to import all addresses. Re-running the same RPC line may succeed in importing the missing addresses but not always.\r\n\r\n**Expected behavior**\r\n\r\nI run this RPC `$ bitcoin-cli -rpcwallet=wallet-my-test-wallet.dat importmulti '[{\"desc\": \"sh(wpkh(xpub6EcgD73U5aQe8F9k1VQmz3bDdnMmgNAouVixdsKVC9YTJb1BNPPq9jSCuDArzxzj2JAWcGyL9sJofgLQHAYovQqCibh3ovuWVtwiagp1x7d/*))#9fdjk2ls\", \"range\": [0, 999999], \"timestamp\": \"now\", \"watchonly\": true}]' '{\"rescan\": false}'`\r\n\r\nI'd expect it to return nothing and import all those addresses.\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\n**Actual behavior**\r\n\r\nThe RPC call runs for a couple of minutes and fails with the follow error:\r\n\r\n```\r\nerror: Could not connect to the server 127.0.0.1:8332 (error code 0 - \"timeout reached\")\r\n\r\nMake sure the bitcoind server is running and that you are connecting to the correct RPC port.\r\n```\r\n\r\nIf I re-run the same RPC call then the call may return without the error message.\r\n\r\nOther RPC calls (e.g. `getbestblockhash`) work as normal.\r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\n**To reproduce**\r\n\r\nThe issue is reproducible every time. With a new empty wallet file (`my-test-wallet.dat`), run this:\r\n\r\n`$ bitcoin-cli -rpcwallet=wallet-my-test-wallet.dat importmulti '[{\"desc\": \"sh(wpkh(xpub6EcgD73U5aQe8F9k1VQmz3bDdnMmgNAouVixdsKVC9YTJb1BNPPq9jSCuDArzxzj2JAWcGyL9sJofgLQHAYovQqCibh3ovuWVtwiagp1x7d/*))#9fdjk2ls\", \"range\": [0, 999999], \"timestamp\": \"now\", \"watchonly\": true}]' '{\"rescan\": false}'`\r\n\r\nWarning: this will make the wallet file become about 1GB in size.\r\n\r\nImporting 999999 addresses seems to never succeed no matter how many times its retried. Importing 500000 addresses seems to succeed after re-running the command once.\r\n\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\n**System information**\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\nBitcoin Core 0.19.0.1, binary downloaded from bitcoincore.org\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\n```\r\n$ uname -a\r\nLinux hostname 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\nUsing internal hard disk\r\n\r\n<!-- GUI-related issue? What is your operating system and its version? If Linux, what is your desktop environment and graphical shell? -->\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17797/comments",
   "created_at" : "2019-12-24T00:41:20Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17797/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/17797",
   "id" : 541945312,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "0052cc",
         "default" : false,
         "description" : null,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17797/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1NDE5NDUzMTI=",
   "number" : 17797,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Running RPC call importmulti with a xpub key with very large range results in a timeout error",
   "updated_at" : "2019-12-24T00:43:14Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17797",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/8398185?v=4",
      "events_url" : "https://api.github.com/users/chris-belcher/events{/privacy}",
      "followers_url" : "https://api.github.com/users/chris-belcher/followers",
      "following_url" : "https://api.github.com/users/chris-belcher/following{/other_user}",
      "gists_url" : "https://api.github.com/users/chris-belcher/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/chris-belcher",
      "id" : 8398185,
      "login" : "chris-belcher",
      "node_id" : "MDQ6VXNlcjgzOTgxODU=",
      "organizations_url" : "https://api.github.com/users/chris-belcher/orgs",
      "received_events_url" : "https://api.github.com/users/chris-belcher/received_events",
      "repos_url" : "https://api.github.com/users/chris-belcher/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/chris-belcher/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/chris-belcher/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/chris-belcher"
   }
}
