[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some of this sounds like it could be broken or unintential. Having balances updated multiple times a second is by design, but could I think could easily improved by only repeating computation when contents of mapWallet changes. (I'd like to see this because the polling causes a ridculous amount of spam in #10102 IPC logs.)\r\n\r\nThe trace showing lots of calls to LookupBlockIndex is suprising to me because generally balances are cached, so I'm not sure why they aren't being cached in this case. It could be interesting to look into. Also #15931 will prevent the repeated LookupBlockIndex calls regardless of other things.",
      "created_at" : "2019-09-06T16:17:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-528918855",
      "id" : 528918855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODkxODg1NQ==",
      "updated_at" : "2019-09-06T16:17:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528918855",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> generally balances are cached\r\n\r\nI just tried running `bitcoin-cli getbalance` 10 times in a row quickly. It looped through all my transactions and summed them 10 times.\r\n\r\nDo you have an example of an operation that uses a cached balance instead of recalculating it every time please? I'd like to look into this and see why the cache isn't being used, but I'm not having any success finding the cache!",
      "created_at" : "2019-09-07T01:24:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529059251",
      "id" : 529059251,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTA1OTI1MQ==",
      "updated_at" : "2019-09-07T01:24:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529059251",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The balances are cached per transaction, AFAIK, not at the wallet level.",
      "created_at" : "2019-09-07T01:36:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529060275",
      "id" : 529060275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTA2MDI3NQ==",
      "updated_at" : "2019-09-07T01:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529060275",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Even when the balances are cached, the block is looked up multiple times via GetDepthInMainChain, see also https://dev.visucore.com/bitcoin/doxygen/group___actions.html#ga67f3c4f8a18222d1a091ac946725b0c7",
      "created_at" : "2019-09-07T07:32:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529082689",
      "id" : 529082689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTA4MjY4OQ==",
      "updated_at" : "2019-09-07T07:32:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529082689",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re. the title change. I'm not sure the wallet uses any CPU when idle. It's the Qt application that is checking the balance every 250 ms not the wallet itself.",
      "created_at" : "2019-09-08T15:03:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529211200",
      "id" : 529211200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTIxMTIwMA==",
      "updated_at" : "2019-09-08T15:03:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529211200",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think you report several issues:\r\n* `GetBalance()` is slow for various reasons ( repeated calls to `LookupBlockIndex()`, loop over the map every time instead of using a cache).\r\n* The gui polls the balance every 250ms and is thus using a lot of cpu\r\n\r\nProbably both issues should be fixed",
      "created_at" : "2019-09-08T15:32:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529213771",
      "id" : 529213771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTIxMzc3MQ==",
      "updated_at" : "2019-09-08T15:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529213771",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Related #10251.\r\n\r\n> Probably both issues should be fixed\r\n\r\nI'd say remove polling first. Is it subject to 0.19 feature freeze or accepted after that?\r\n",
      "created_at" : "2019-09-08T23:22:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529253035",
      "id" : 529253035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTI1MzAzNQ==",
      "updated_at" : "2019-09-08T23:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529253035",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe also related: #13612?",
      "created_at" : "2019-09-09T11:17:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-529423561",
      "id" : 529423561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyOTQyMzU2MQ==",
      "updated_at" : "2019-09-09T11:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/529423561",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Related #16874.\r\n\r\nFWIW when idle polling period could be increased, going to push a suggestion.",
      "created_at" : "2020-02-05T15:55:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16815#issuecomment-582475531",
      "id" : 582475531,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16815",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjQ3NTUzMQ==",
      "updated_at" : "2020-02-05T15:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582475531",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
