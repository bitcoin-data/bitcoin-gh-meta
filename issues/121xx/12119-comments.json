[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Does it forces bech32 addresses in the wallet without consent?\r\n\r\n\r\n",
      "created_at" : "2018-01-08T23:44:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356132774",
      "id" : 356132774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-08T23:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356132774",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag for change addresses yes, so that could be an objection.\r\n\r\nMore conservative approaches could be:\r\n1) have another UI check box to send change to a bech32 address; this could be checked by default if all destinations are bech32. This won't work for RPC users, but those can be expected to use the `-changeaddress` flag.\r\n\r\n2) add an additional constraint that at least one of the the from addresses is bech32.",
      "created_at" : "2018-01-09T10:05:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356238217",
      "id" : 356238217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-09T10:05:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356238217",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Creating a change output AFAIK does not add any address to the wallet.",
      "created_at" : "2018-01-09T10:07:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356238760",
      "id" : 356238760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-09T10:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356238760",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa they are listed in `listunspent` right?",
      "created_at" : "2018-01-09T10:09:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356239182",
      "id" : 356239182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-09T10:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356239182",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors IMO the `-changetype` is enough, eventually it will default to bech32 I guess.",
      "created_at" : "2018-01-09T10:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356239905",
      "id" : 356239905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-09T10:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356239905",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "General concept ACK-- but I would suggest that it only do this if the change type is at least p2sh segwit:  There might be some compatibility reason that someone is avoiding creating segwit outputs for some reason.  That doesn't hold if they're already asking for p2sh output...  privacy was the major reason the sw wallet support didn't go 100% native change from the start... but that is even more an argument for this.  In fact, I think it's an argument that we should use native change if any (or no more strict than 'most') outputs are native and not just require all.",
      "created_at" : "2018-01-11T07:08:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356845504",
      "id" : 356845504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T07:08:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356845504",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell it now uses a bech32 change address if change type is p2sh-segwit and any of the outputs are bech32.",
      "created_at" : "2018-01-11T09:45:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356881113",
      "id" : 356881113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T09:45:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356881113",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems to me if the user is explicitly setting a change type, we should respect that.\r\n\r\nInstead, I suggest turning OUTPUT_TYPE_DEFAULT into a real value, and handling it specially for change here. Eg, https://github.com/luke-jr/bitcoin/commits/bech32-change",
      "created_at" : "2018-01-11T10:25:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356891888",
      "id" : 356891888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T10:25:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356891888",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr I like the idea of having OUTPUT_TYPE_DEFAULT so we can distinguish between `-changetype` being absent or set to `p2sh-segwit`. Can you make d4e51351 a PR that I can rebase this on? ",
      "created_at" : "2018-01-11T10:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356895800",
      "id" : 356895800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T10:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356895800",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seems a bit pointless to stand on its own in a PR. It would be better to just include it as a separate commit here (and in another PR I'm about to open).\r\n\r\nTo get it in your own branch as-is, switch to it and do:\r\n```\r\ngit fetch git://github.com/luke-jr/bitcoin bech32-change && git reset --hard 5efd54745c34ff329d9c75f2f5ee852930b21231\r\n```",
      "created_at" : "2018-01-11T10:43:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356896373",
      "id" : 356896373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T10:43:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356896373",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr I'll wait a little bit to see if your commit needs more changes.\r\n\r\nI do think it's worth it's own PR, but applied to all launch flags where absence or presence can cause ambiguity about user intention. I've run into this general problem several times now, e.g. with #9527. ",
      "created_at" : "2018-01-11T12:05:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-356915438",
      "id" : 356915438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T12:05:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356915438",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r160982806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160982806"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wrong indentation. Also `any_destination_bech32`?",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-11T15:02:19Z",
      "diff_hunk" : "@@ -2661,6 +2662,14 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if the destination doesn't contain a witness program, in which\n+        // case the addresstype for this destination is not bech32:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+          anyDestinationBech32 = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r160982806",
      "id" : 160982806,
      "original_commit_id" : "c3bc3f6a19f77ac39ccd95190932b4317febf8c2",
      "original_position" : 18,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88195958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160982806",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r160982870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160982870"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wrong indentation.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-11T15:02:31Z",
      "diff_hunk" : "@@ -2739,8 +2748,15 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If g_change_type is p2sh_segwit, use bech32 for the change\n+                // address if any destination is bech32.\n+                OutputType change_type = g_change_type;\n+                if (g_change_type == OUTPUT_TYPE_P2SH_SEGWIT && anyDestinationBech32) {\n+                  change_type = OUTPUT_TYPE_BECH32;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r160982870",
      "id" : 160982870,
      "original_commit_id" : "c3bc3f6a19f77ac39ccd95190932b4317febf8c2",
      "original_position" : 33,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88195958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160982870",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161038291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161038291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will fix indentation and check variable name, thanks.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-11T18:32:29Z",
      "diff_hunk" : "@@ -2661,6 +2662,14 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if the destination doesn't contain a witness program, in which\n+        // case the addresstype for this destination is not bech32:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+          anyDestinationBech32 = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161038291",
      "id" : 161038291,
      "in_reply_to_id" : 160982806,
      "original_commit_id" : "c3bc3f6a19f77ac39ccd95190932b4317febf8c2",
      "original_position" : 18,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88262479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161038291",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">  Should check inputs instead?\r\n\r\nOr even check if any input or any output is bech32?",
      "created_at" : "2018-01-11T18:34:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357019868",
      "id" : 357019868,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T18:34:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357019868",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "agreed with @TheBlueMatt just check if it's set",
      "created_at" : "2018-01-11T19:06:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357028850",
      "id" : 357028850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T19:06:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357028850",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I can't reproduce this Travis failure on MacOS or Ubuntu 14.04 (I didn't use the depends system).",
      "created_at" : "2018-01-11T19:23:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357033789",
      "id" : 357033789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T19:23:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357033789",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seemed like people in the IRC meeting liked:  \"If the configured change type is not legacy, use p2wpkh if any of the outputs are p2wpkh\".",
      "created_at" : "2018-01-11T20:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357053281",
      "id" : 357053281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T23:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357053281",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell by \"legacy\" you mean `p2sh-segwit`? `-changetype=legacy` means p2pkh (in which case we also don't want to use bech32). Maybe we should also rename that `legacy` option, because the term seems overloaded.",
      "created_at" : "2018-01-11T20:49:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357056748",
      "id" : 357056748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T20:49:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357056748",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "By legacy I mean p2pkh. We should not create native segwit change if the user has specifically asked for non-segwit change.  If a user is setting legacy then it's likely that they really don't want segwit outputs for some reason (for example, compatibility with older software).\r\n\r\nThat argument doesn't apply for p2sh-segwit. The only reason to ever use p2sh-segwit change is for change distinguishability privacy, which, as you note-- doesn't apply when there are segwit outputs.",
      "created_at" : "2018-01-11T23:14:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357092710",
      "id" : 357092710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T23:14:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357092710",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As a pedantic aside, it's a mistake to say \"bech32\" -- there is no address involved with change, so no bech32 involved here at all.  The question here is to use p2sh-p2wpkh or p2wpkh, which would exist no less even if bech32 had never been specified.",
      "created_at" : "2018-01-11T23:16:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357093139",
      "id" : 357093139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-11T23:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357093139",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2018-01-12T02:43:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357127353",
      "id" : 357127353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T02:43:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357127353",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell I know there's no spoon, but block explorers will display a spoon :-)",
      "created_at" : "2018-01-12T12:04:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357221725",
      "id" : 357221725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T12:04:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357221725",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161257090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161257090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T15:53:13Z",
      "diff_hunk" : "@@ -2661,6 +2662,14 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if the destination doesn't contain a witness program, in which\n+        // case the addresstype for this destination is not bech32:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+          anyDestinationBech32 = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161257090",
      "id" : 161257090,
      "in_reply_to_id" : 160982806,
      "original_commit_id" : "c3bc3f6a19f77ac39ccd95190932b4317febf8c2",
      "original_position" : 18,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88520049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161257090",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161261687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161261687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should probably check/track witness version here? It shouldn't be >0 unless we update, but probably more future-safe.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T16:10:21Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161261687",
      "id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88525644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161261687",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161262071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161262071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`and any destination is (P2SH-)P2WPKH,` I don't think this is correct? should just be `P2WPKH`",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T16:11:56Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is (P2SH-)P2WPKH, use P2WPKH for the change ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161262071",
      "id" : 161262071,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 29,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88525644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161262071",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "If this is merged, I think it ought to be paired with #12146.  It's a good, off-by-default option to have available for strange edge cases that want to run the latest full node software but have what would otherwise be an infuriating need to remain compatible with legacy systems.\r\n\r\nJust my 2 bits.",
      "created_at" : "2018-01-12T16:19:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357283449",
      "id" : 357283449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T16:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357283449",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4107993?v=4",
         "events_url" : "https://api.github.com/users/sneurlax/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sneurlax/followers",
         "following_url" : "https://api.github.com/users/sneurlax/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sneurlax/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sneurlax",
         "id" : 4107993,
         "login" : "sneurlax",
         "organizations_url" : "https://api.github.com/users/sneurlax/orgs",
         "received_events_url" : "https://api.github.com/users/sneurlax/received_events",
         "repos_url" : "https://api.github.com/users/sneurlax/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sneurlax/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sneurlax/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sneurlax"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This should be ready for review, pending Travis' blessing.\r\n\r\n@sneurlax there's no need for that. Those who would use #12146 would also launch with `-addresstype=legacy`, which prevents the behavior this PR adds.",
      "created_at" : "2018-01-12T16:23:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357284596",
      "id" : 357284596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T16:23:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357284596",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I must still misunderstand their relation, then.  Sorry for piping up.\r\n\r\nDoes `-changetype=bech32` also prevent the behavior this PR adds?",
      "created_at" : "2018-01-12T16:34:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357287565",
      "id" : 357287565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T16:34:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357287565",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4107993?v=4",
         "events_url" : "https://api.github.com/users/sneurlax/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sneurlax/followers",
         "following_url" : "https://api.github.com/users/sneurlax/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sneurlax/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sneurlax",
         "id" : 4107993,
         "login" : "sneurlax",
         "organizations_url" : "https://api.github.com/users/sneurlax/orgs",
         "received_events_url" : "https://api.github.com/users/sneurlax/received_events",
         "repos_url" : "https://api.github.com/users/sneurlax/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sneurlax/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sneurlax/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sneurlax"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161269039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161269039"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see why this is the case. No payment here is native segwit?",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T16:38:57Z",
      "diff_hunk" : "@@ -195,5 +225,40 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161269039",
      "id" : 161269039,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 102,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 88525644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161269039",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK",
      "created_at" : "2018-01-12T16:43:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357290095",
      "id" : 357290095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T16:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357290095",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sneurlax yes. If you set `-changetype` it will honor that. Only if you don't set `-changetype` and you don't set `-addresstype=legacy` it will use the following rule: use a native segwit change output* if any destination is a native segwit address.",
      "created_at" : "2018-01-12T16:59:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357294802",
      "id" : 357294802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-12T16:59:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357294802",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161298191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161298191"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would new witness versions require different change address behavior?",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T18:48:55Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161298191",
      "id" : 161298191,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88569986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161298191",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161299063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161299063"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`addresstype` implicitly sets `changetype`:\r\n\r\n`g_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), g_address_type)`\r\n\r\nIf the user overrides `changetype` it will use that, so I could change the word \"always\" in the comment to reflect that better.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T18:53:03Z",
      "diff_hunk" : "@@ -195,5 +225,40 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161299063",
      "id" : 161299063,
      "in_reply_to_id" : 161269039,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 102,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 88571058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161299063",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161305747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161305747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "riiiiiiiiiiight. Could you just write that? I actually forgot this and I've reviewed all the PRs so far :(",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T19:24:54Z",
      "diff_hunk" : "@@ -195,5 +225,40 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161305747",
      "id" : 161305747,
      "in_reply_to_id" : 161269039,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 102,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 88579155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161305747",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161306395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161306395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's say you send to a v1, you wouldn't want to accidentally make a v0 to \"copy\" it. Perhaps more appropriate for an assert here.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T19:27:54Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161306395",
      "id" : 161306395,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88579972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161306395",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161307005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161307005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "add at end of above comment \"unless changetype is set otherwise\"",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T19:30:38Z",
      "diff_hunk" : "@@ -195,5 +225,40 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161307005",
      "id" : 161307005,
      "in_reply_to_id" : 161269039,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 102,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 88580710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161307005",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161321827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161321827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T20:48:53Z",
      "diff_hunk" : "@@ -195,5 +225,40 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161321827",
      "id" : 161321827,
      "in_reply_to_id" : 161269039,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 102,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 88599183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161321827",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161323276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161323276"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It might be assertophobia, but I'm not sure what you mean by that example. If you send coins to a future v1 segwit address, the change has to go somewhere right? So the change would just go to a v0 witness derived from the next available key in the pool.\r\n\r\nNote that `IsWitnessProgram` writes to `witnessversion`, not the other way around. And `witnessversion` isn't used when the change address is created.\r\n\r\nIt depends on what the intention of v1 is whether change can safely go to a v1 address. But I don't see how it would be unsafe to send to a v0 address. Of course maybe there is a reason, or future us will find a reason. So an assert would force them to think about that. Is that what you mean? ",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T20:56:14Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161323276",
      "id" : 161323276,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88600993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161323276",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161326063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161326063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not unsafe, but defeats the privacy logic that this enables, I think.\r\n\r\nMaybe I'm making too much hay of this.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T21:10:49Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161326063",
      "id" : 161326063,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88604436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161326063",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161328143"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161328143"
         }
      },
      "author_association" : "OWNER",
      "body" : "I think we can discuss what to do with v1 witnesses when the time comes.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-12T21:21:44Z",
      "diff_hunk" : "@@ -195,5 +225,40 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161328143",
      "id" : 161328143,
      "in_reply_to_id" : 161269039,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 102,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 88606966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161328143",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161405681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161405681"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "short indent here.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-14T18:18:07Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+          any_destination_native_segwit = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161405681",
      "id" : 161405681,
      "original_commit_id" : "de8ea9c68a69aa2c61abbe26d62e47c3b321fe78",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88690321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161405681",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161405829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161405829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Really not sure what the point is here - we definitely should allowe sending to >v0 witness versions, its not our job to make sure someone giving us an address gives us something that is currently safe (ie has been forked to have some meaning), and we shouldn't need an update just to send to a newly-defined segwit version.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-14T18:25:14Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161405829",
      "id" : 161405829,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88690321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161405829",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161531689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161531689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-15T14:24:34Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+          any_destination_native_segwit = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161531689",
      "id" : 161531689,
      "in_reply_to_id" : 161405681,
      "original_commit_id" : "de8ea9c68a69aa2c61abbe26d62e47c3b321fe78",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88835295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161531689",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt test failure seems indeterministic. Afaik I only added a comment since the last time Travis was happy. We'll see what happens with this indentation fix.",
      "created_at" : "2018-01-15T14:26:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357697093",
      "id" : 357697093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-15T14:26:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357697093",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161533605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161533605"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt Why are we having the wallet make v0 change outputs if the receiving address is v1+? Makes no sense to me.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-15T14:31:57Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161533605",
      "id" : 161533605,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88837550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161533605",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`net.py` fails on Travis, but passes locally. I'll rebase because there are some new test related fixes on master.",
      "created_at" : "2018-01-15T15:06:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357707934",
      "id" : 357707934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-15T15:06:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357707934",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebase made Travis happy.",
      "created_at" : "2018-01-15T16:21:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357728968",
      "id" : 357728968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-15T16:21:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357728968",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161570617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161570617"
         }
      },
      "author_association" : "OWNER",
      "body" : "Suggestion: test g_address_type against OUTPUT_TYPE_DEFAULT, instead of touching `gArgs` here. \r\n\r\nIf that is not possible, please move the `gArgs.IsArgSet(\"-changetype\")` to `wallet/init.cpp` and set a global boolean `g_changetype_is_default` or such - don't spread the handling for one option over two separate places.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-15T16:49:58Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is (P2SH-)P2WPKH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type = g_change_type;\n+                if (!gArgs.IsArgSet(\"-changetype\") && g_address_type != OUTPUT_TYPE_LEGACY && any_destination_native_segwit) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161570617",
      "id" : 161570617,
      "original_commit_id" : "2324577b76e45e2f67c786338a562a49fb436f45",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88881306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161570617",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161660342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161660342"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@instagibbs  since we don't support v1  there is no 'private' option possible for us,  so given that privacy is impossible, we should at least choose the most efficient!\r\n\r\nThe only reason we initially defaulted to do anything but produce native change is because under the assumption that most payments would be non-native that would be pretty bad for privacy.  But that privacy argument only holds when the decision results in us matching. \r\n\r\nPerhaps in the future if we support both v0 and v1 and have no particular reason to choose between them (e.g. they're both about equally efficient, and our wallet's policy doesn't demand one vs the other), we would just match whatever we're paying... but we can't do that now.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-16T04:50:05Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161660342",
      "id" : 161660342,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 88985053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161660342",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161724493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161724493"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`OUTPUT_TYPE_DEFAULT` is used for the help message and is defined as `OUTPUT_TYPE_P2SH_SEGWIT`. I'll try (something along the lines of) @luke-jr's 5efd54745. ",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-16T11:03:19Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is (P2SH-)P2WPKH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type = g_change_type;\n+                if (!gArgs.IsArgSet(\"-changetype\") && g_address_type != OUTPUT_TYPE_LEGACY && any_destination_native_segwit) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161724493",
      "id" : 161724493,
      "in_reply_to_id" : 161570617,
      "original_commit_id" : "2324577b76e45e2f67c786338a562a49fb436f45",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89057843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161724493",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`g_change_type` is no longer based on `-addresstype`. Functions that use `g_change_type` need to handle `OUTPUT_TYPE_NONE`, which I've done everywhere with: `g_change_type ? g_change_type : g_address_type`.",
      "created_at" : "2018-01-16T12:00:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357939402",
      "id" : 357939402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-16T12:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357939402",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK 327634f97e5921815c30e50d076cde0f6ff51aaf\r\n\r\nI think the code can be made a bit cleaner by introducing an explicit P2SH_SEGWIT_BUT_NATIVE_WHEN_NATIVE_DESTINATION or so type in `OutputType`, but let's do that later.",
      "created_at" : "2018-01-16T14:47:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357982763",
      "id" : 357982763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-16T14:47:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357982763",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161844931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161844931"
         }
      },
      "author_association" : "MEMBER",
      "body" : "shouldn't this read:\r\n>// and any destination is P2WPKH, use P2WPKH for the change",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-16T18:27:35Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is (P2SH-)P2WPKH, use P2WPKH for the change",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161844931",
      "id" : 161844931,
      "original_commit_id" : "327634f97e5921815c30e50d076cde0f6ff51aaf",
      "original_position" : 29,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89199411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161844931",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161865943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161865943"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually I meant P2WPKH or P2WSH. Fixed.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-16T19:42:34Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is (P2SH-)P2WPKH, use P2WPKH for the change",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r161865943",
      "id" : 161865943,
      "in_reply_to_id" : 161844931,
      "original_commit_id" : "327634f97e5921815c30e50d076cde0f6ff51aaf",
      "original_position" : 29,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89224139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161865943",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162027651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162027651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't this compare explicitly? ie `change_type = g_change_type != OUTPUT_TYPE_NONE ? g_change_type : g_address_type`",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T11:51:07Z",
      "diff_hunk" : "@@ -643,8 +643,9 @@ void PaymentServer::fetchPaymentACK(CWallet* wallet, const SendCoinsRecipient& r\n         // use for change. Despite an actual payment and not change, this is a close match:\n         // it's the output type we use subject to privacy issues, but not restricted by what\n         // other software supports.\n-        wallet->LearnRelatedScripts(newKey, g_change_type);\n-        CTxDestination dest = GetDestinationForKey(newKey, g_change_type);\n+        OutputType change_type = g_change_type ? g_change_type : g_address_type;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162027651",
      "id" : 162027651,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 6,
      "path" : "src/qt/paymentserver.cpp",
      "position" : null,
      "pull_request_review_id" : 89412532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162027651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162039648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162039648"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wanted to keep it short for readability and leverage that OUTPUT_TYPE_NONE is 0. I can change that if you think it's unsafe.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T12:43:19Z",
      "diff_hunk" : "@@ -643,8 +643,9 @@ void PaymentServer::fetchPaymentACK(CWallet* wallet, const SendCoinsRecipient& r\n         // use for change. Despite an actual payment and not change, this is a close match:\n         // it's the output type we use subject to privacy issues, but not restricted by what\n         // other software supports.\n-        wallet->LearnRelatedScripts(newKey, g_change_type);\n-        CTxDestination dest = GetDestinationForKey(newKey, g_change_type);\n+        OutputType change_type = g_change_type ? g_change_type : g_address_type;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162039648",
      "id" : 162039648,
      "in_reply_to_id" : 162027651,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 6,
      "path" : "src/qt/paymentserver.cpp",
      "position" : null,
      "pull_request_review_id" : 89426424,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162039648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162059376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162059376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it should be changed (in the future). The whole enum should be a c++11 enum class to be type safe. Though, that will touch all the code, so maybe too late for 0.16...",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T14:08:45Z",
      "diff_hunk" : "@@ -643,8 +643,9 @@ void PaymentServer::fetchPaymentACK(CWallet* wallet, const SendCoinsRecipient& r\n         // use for change. Despite an actual payment and not change, this is a close match:\n         // it's the output type we use subject to privacy issues, but not restricted by what\n         // other software supports.\n-        wallet->LearnRelatedScripts(newKey, g_change_type);\n-        CTxDestination dest = GetDestinationForKey(newKey, g_change_type);\n+        OutputType change_type = g_change_type ? g_change_type : g_address_type;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162059376",
      "id" : 162059376,
      "in_reply_to_id" : 162027651,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 6,
      "path" : "src/qt/paymentserver.cpp",
      "position" : null,
      "pull_request_review_id" : 89450958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162059376",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162062952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162062952"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: heh, you are excessively using new lines in python code",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T14:22:05Z",
      "diff_hunk" : "@@ -104,10 +112,32 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))\n+\n+        # Make sure the destinations are included, and remove it:\n+        for destination in destinations:\n+            output_addresses.pop(output_addresses.index(destination))\n+\n+        assert_equal(len(output_addresses), 1)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162062952",
      "id" : 162062952,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 56,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89455416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162062952",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162063432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162063432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: Should probably use named args, as it is not clear what \"False\" refers to.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T14:23:52Z",
      "diff_hunk" : "@@ -104,10 +112,32 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))\n+\n+        # Make sure the destinations are included, and remove it:\n+        for destination in destinations:\n+            output_addresses.pop(output_addresses.index(destination))\n+\n+        assert_equal(len(output_addresses), 1)\n+\n+        change_address = output_addresses[0]\n+\n+        self.log.debug(\"Check if change address \" +  change_address + \" is \" + expected_type)\n+\n+        self.test_address(node_sender, change_address, False, expected_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162063432",
      "id" : 162063432,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 61,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89455416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162063432",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162114601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162114601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T17:01:14Z",
      "diff_hunk" : "@@ -104,10 +112,32 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))\n+\n+        # Make sure the destinations are included, and remove it:\n+        for destination in destinations:\n+            output_addresses.pop(output_addresses.index(destination))\n+\n+        assert_equal(len(output_addresses), 1)\n+\n+        change_address = output_addresses[0]\n+\n+        self.log.debug(\"Check if change address \" +  change_address + \" is \" + expected_type)\n+\n+        self.test_address(node_sender, change_address, False, expected_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162114601",
      "id" : 162114601,
      "in_reply_to_id" : 162063432,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 61,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89515860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162114601",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162114607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162114607"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed a few blank lines...",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T17:01:16Z",
      "diff_hunk" : "@@ -104,10 +112,32 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))\n+\n+        # Make sure the destinations are included, and remove it:\n+        for destination in destinations:\n+            output_addresses.pop(output_addresses.index(destination))\n+\n+        assert_equal(len(output_addresses), 1)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162114607",
      "id" : 162114607,
      "in_reply_to_id" : 162062952,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 56,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89515868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162114607",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162171610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162171610"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suggest writing this as:\r\n\r\n```c++\r\ng_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), OUTPUT_TYPE_NONE);\r\nif (g_change_type == OUTPUT_TYPE_NONE && gArgs.IsArgSet(\"-changetype\")) {\r\n      return InitError(strprintf(_(\"Unknown change type '%s'\"), gArgs.GetArg(\"-changetype\", \"\")));\r\n}\r\n```\r\n\r\nReasons:\r\n\r\n- More consistent with `g_address_type` code above\r\n- Smaller diff, less code, less nesting\r\n- Doesn't leave `g_change_type` set to indeterminate value if `!IsArgSet`.\r\n\r\nYou may additionally want to replace `gArgs.IsArgSet(\"-changetype\")` with `!gArgs.GetArg(\"-changetype\", \"\").empty()`, so passing the empty string is the same as not passing a value, and will not trigger an error. This would be more consistent with addresstype parsing above, and might be practically useful, e.g. if somebody has an initial value set in a config file but wants to reset it on the command line.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T20:37:31Z",
      "diff_hunk" : "@@ -182,9 +182,11 @@ bool WalletParameterInteraction()\n         return InitError(strprintf(_(\"Unknown address type '%s'\"), gArgs.GetArg(\"-addresstype\", \"\")));\n     }\n \n-    g_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), g_address_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162171610",
      "id" : 162171610,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 4,
      "path" : "src/wallet/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 89217488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162171610",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162174440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162174440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is introducing an inconsistency between `getnewaddress` and `getrawchangeaddress`. Former will continue treating empty string like null, and latter will now treat the empty string as an error. Would suggest either passing `output_type` here to continue treating empty string like null both places, or passing `OUTPUT_TYPE_NONE` in `getnewaddress` to now raise an error both places.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T20:49:13Z",
      "diff_hunk" : "@@ -256,9 +256,9 @@ UniValue getrawchangeaddress(const JSONRPCRequest& request)\n         pwallet->TopUpKeyPool();\n     }\n \n-    OutputType output_type = g_change_type;\n+    OutputType output_type = g_change_type ? g_change_type : g_address_type;\n     if (!request.params[0].isNull()) {\n-        output_type = ParseOutputType(request.params[0].get_str(), g_change_type);\n+        output_type = ParseOutputType(request.params[0].get_str(), OUTPUT_TYPE_NONE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162174440",
      "id" : 162174440,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 8,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89217488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162174440",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162175280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162175280"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "May be easier to read as\r\n\r\n```\r\noutput_addresses = [vout['scriptPubKey']['addresses'][0] for vout in tx[\"vout\"]]\r\n```\r\n",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T20:52:25Z",
      "diff_hunk" : "@@ -104,10 +109,28 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162175280",
      "id" : 162175280,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 47,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89217488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162175280",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162175368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162175368"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could simplify to `output_addresses.remove(destination)`. Another alternative could be\r\n\r\n```python\r\nchange_addresses = [d for d in output_addresses if d not in destinations]\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T20:52:50Z",
      "diff_hunk" : "@@ -104,10 +109,28 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))\n+        for destination in destinations:\n+            output_addresses.pop(output_addresses.index(destination))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162175368",
      "id" : 162175368,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 49,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89217488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162175368",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162176966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162176966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a suggestion, but perhaps this would be simpler as\r\n\r\n```c++\r\nOutputType change_type =\r\n    g_change_type != OUTPUT_TYPE_NONE ? g_change_type :\r\n    g_address_type != OUTPUT_TYPE_LEGACY && any_destination_native_segwit ? OUTPUT_TYPE_BECH32 :\r\n    g_address_type;\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-17T20:59:33Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type = g_change_type ? g_change_type : g_address_type;\n+                if (g_change_type == OUTPUT_TYPE_NONE && g_address_type != OUTPUT_TYPE_LEGACY && any_destination_native_segwit) {\n+                    change_type = OUTPUT_TYPE_BECH32;\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162176966",
      "id" : 162176966,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 34,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89217488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162176966",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162277984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162277984"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Being able to override config file seems quite useful, I'll try your suggestion.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-18T08:45:14Z",
      "diff_hunk" : "@@ -182,9 +182,11 @@ bool WalletParameterInteraction()\n         return InitError(strprintf(_(\"Unknown address type '%s'\"), gArgs.GetArg(\"-addresstype\", \"\")));\n     }\n \n-    g_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), g_address_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162277984",
      "id" : 162277984,
      "in_reply_to_id" : 162171610,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 4,
      "path" : "src/wallet/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 89705105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162277984",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting how Github put @ryanofsky's review above @MarcoFalke's even though it's more recent.",
      "created_at" : "2018-01-18T08:48:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-358577908",
      "id" : 358577908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-18T08:48:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/358577908",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328431"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky setting `changetype=...` in the config file makes `gArgs.IsArgSet(\"-changetype\"` evaluate to true. The config file value is ignored if a parameter overrides it. I still like your shorter notation, so using that now.\r\n",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-18T12:33:36Z",
      "diff_hunk" : "@@ -182,9 +182,11 @@ bool WalletParameterInteraction()\n         return InitError(strprintf(_(\"Unknown address type '%s'\"), gArgs.GetArg(\"-addresstype\", \"\")));\n     }\n \n-    g_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), g_address_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328431",
      "id" : 162328431,
      "in_reply_to_id" : 162171610,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 4,
      "path" : "src/wallet/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 89765060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328431",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328435"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There was a bug there: `OutputType output_type = g_change_type ? g_change_type : g_address_type` above is overridden in this line. I added some tests for `getrawchangeaddress`.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-18T12:33:38Z",
      "diff_hunk" : "@@ -256,9 +256,9 @@ UniValue getrawchangeaddress(const JSONRPCRequest& request)\n         pwallet->TopUpKeyPool();\n     }\n \n-    OutputType output_type = g_change_type;\n+    OutputType output_type = g_change_type ? g_change_type : g_address_type;\n     if (!request.params[0].isNull()) {\n-        output_type = ParseOutputType(request.params[0].get_str(), g_change_type);\n+        output_type = ParseOutputType(request.params[0].get_str(), OUTPUT_TYPE_NONE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328435",
      "id" : 162328435,
      "in_reply_to_id" : 162174440,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 8,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89765067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328435",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328443"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice! Done.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-18T12:33:41Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type = g_change_type ? g_change_type : g_address_type;\n+                if (g_change_type == OUTPUT_TYPE_NONE && g_address_type != OUTPUT_TYPE_LEGACY && any_destination_native_segwit) {\n+                    change_type = OUTPUT_TYPE_BECH32;\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328443",
      "id" : 162328443,
      "in_reply_to_id" : 162176966,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 34,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 89765076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328443",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is, done.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-18T12:33:42Z",
      "diff_hunk" : "@@ -104,10 +109,28 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328448",
      "id" : 162328448,
      "in_reply_to_id" : 162175280,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 47,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89765083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328448",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328462"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's what happens if you write javascript for a few years... :-)\r\n\r\nFixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-18T12:33:44Z",
      "diff_hunk" : "@@ -104,10 +109,28 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = list(map(lambda vout: vout['scriptPubKey']['addresses'][0], tx[\"vout\"]))\n+        for destination in destinations:\n+            output_addresses.pop(output_addresses.index(destination))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162328462",
      "id" : 162328462,
      "in_reply_to_id" : 162175368,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 49,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 89765096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162328462",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think the code can be made a bit cleaner by introducing an explicit P2SH_SEGWIT_BUT_NATIVE_WHEN_NATIVE_DESTINATION or so type in OutputType, but let's do that later.\r\n\r\n@sipa but `-addresstype` could have that value?",
      "created_at" : "2018-01-18T22:37:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-358805079",
      "id" : 358805079,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-18T22:37:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/358805079",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162708605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162708605"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162171610\r\n\r\n> @ryanofsky setting changetype=... in the config file makes gArgs.IsArgSet(\"-changetype\" evaluate to true\r\n\r\nYes, that's the reason I also suggested replacing `gArgs.IsArgSet(\"-changetype\")` with `!gArgs.GetArg(\"-changetype\", \"\").empty()`\r\n",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-19T19:18:00Z",
      "diff_hunk" : "@@ -182,9 +182,11 @@ bool WalletParameterInteraction()\n         return InitError(strprintf(_(\"Unknown address type '%s'\"), gArgs.GetArg(\"-addresstype\", \"\")));\n     }\n \n-    g_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), g_address_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162708605",
      "id" : 162708605,
      "in_reply_to_id" : 162171610,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 4,
      "path" : "src/wallet/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 90216500,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162708605",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I just realized this PR doesn't currently update the `-changetype` help text, so I withdraw my ACK until that is done. (The current text says `default is same as -addresstype`, which is no longer accurate.)\r\n\r\nConditional utACK 0ee841a21aaea880e3af1e93b53d373295d1f829 if help is updated.",
      "created_at" : "2018-01-19T21:56:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-359100547",
      "id" : 359100547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-19T22:00:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359100547",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> current text says `default is same as -addresstype`, which is no longer accurate\r\n\r\nMaybe I can change it to: \"Default is same as -addresstype, except when sending to a native segwit address and -addresstype is p2sh-segwit\"?",
      "created_at" : "2018-01-20T13:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-359172020",
      "id" : 359172020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-20T13:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359172020",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162784075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162784075"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with @ajtowns. Nit, `const OutputType ....`. Suggestion:\r\n```cpp\r\nconst OutputType change_type = g_change_type == OUTPUT_TYPE_NONE ? g_address_type : g_change_type;\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-20T14:38:59Z",
      "diff_hunk" : "@@ -643,8 +643,9 @@ void PaymentServer::fetchPaymentACK(CWallet* wallet, const SendCoinsRecipient& r\n         // use for change. Despite an actual payment and not change, this is a close match:\n         // it's the output type we use subject to privacy issues, but not restricted by what\n         // other software supports.\n-        wallet->LearnRelatedScripts(newKey, g_change_type);\n-        CTxDestination dest = GetDestinationForKey(newKey, g_change_type);\n+        OutputType change_type = g_change_type ? g_change_type : g_address_type;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162784075",
      "id" : 162784075,
      "in_reply_to_id" : 162027651,
      "original_commit_id" : "d2c2be7200307d1ed9b6291745b34d5db2c645a4",
      "original_position" : 6,
      "path" : "src/qt/paymentserver.cpp",
      "position" : null,
      "pull_request_review_id" : 90305290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162784075",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162784617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162784617"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This can be avoided/skipped if there is a custom address in coin control. Move it below to where `any_destination_native_segwit` is needed.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-20T15:05:10Z",
      "diff_hunk" : "@@ -2661,6 +2662,13 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n \n         if (recipient.fSubtractFeeFromAmount)\n             nSubtractFeeFromAmount++;\n+\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162784617",
      "id" : 162784617,
      "in_reply_to_id" : 161261687,
      "original_commit_id" : "6349a3005375066de984c1f359fb166fa1c82fad",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 90305290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162784617",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162784913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162784913"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I know this was here before but shouldn't this be called by CReserveKey only if the key isn't returned to the pool?",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-20T15:18:59Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type =\n+                    g_change_type != OUTPUT_TYPE_NONE ? g_change_type :\n+                    g_address_type != OUTPUT_TYPE_LEGACY && any_destination_native_segwit ? OUTPUT_TYPE_BECH32 :\n+                    g_address_type;\n+\n+                LearnRelatedScripts(vchPubKey, change_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162784913",
      "id" : 162784913,
      "original_commit_id" : "0ee841a21aaea880e3af1e93b53d373295d1f829",
      "original_position" : 36,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 90305290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162784913",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162785050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162785050"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "IMO should avoid long expressions. Suggestion:\r\n```cpp\r\nOutputType change_type = g_change_type;\r\nif (change_type == OUTPUT_TYPE_NONE) {\r\n    if (any_destination_native_segwit && g_address_type != OUTPUT_TYPE_LEGAC) {\r\n        change_type = OUTPUT_TYPE_BECH32;\r\n    } else {\r\n        change_type = g_address_type;\r\n    }\r\n}\r\n```\r\n\r\nAlso, `CreateTransaction` is already a rather long function, could you factor out this to a new function? Then add tests for that in `src/wallet/test/wallet_tests.cpp`.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-20T15:23:26Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type =",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162785050",
      "id" : 162785050,
      "original_commit_id" : "0ee841a21aaea880e3af1e93b53d373295d1f829",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 90305290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162785050",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162971714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162971714"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh wait, now I get it. So if the config file says `changetype=bech32` the user could unset it with `-changetype=`. Fixed.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-22T15:33:35Z",
      "diff_hunk" : "@@ -182,9 +182,11 @@ bool WalletParameterInteraction()\n         return InitError(strprintf(_(\"Unknown address type '%s'\"), gArgs.GetArg(\"-addresstype\", \"\")));\n     }\n \n-    g_change_type = ParseOutputType(gArgs.GetArg(\"-changetype\", \"\"), g_address_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162971714",
      "id" : 162971714,
      "in_reply_to_id" : 162171610,
      "original_commit_id" : "b9f211c6d3a96fa003732a0a21d7d04ecf80501c",
      "original_position" : 4,
      "path" : "src/wallet/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 90512782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162971714",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162971760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162971760"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Switched to your version.\r\n\r\nI extracted the change type stuff to a new function. I made a note to add tests later.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-22T15:33:42Z",
      "diff_hunk" : "@@ -2739,8 +2747,16 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n                     return false;\n                 }\n \n-                LearnRelatedScripts(vchPubKey, g_change_type);\n-                scriptChange = GetScriptForDestination(GetDestinationForKey(vchPubKey, g_change_type));\n+                // If -changetype is not specified and g_address_type is not legacy,\n+                // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+                // output.\n+                OutputType change_type =",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r162971760",
      "id" : 162971760,
      "in_reply_to_id" : 162785050,
      "original_commit_id" : "0ee841a21aaea880e3af1e93b53d373295d1f829",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 90512833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/162971760",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated help text:\r\n<img width=\"509\" alt=\"schermafbeelding 2018-01-22 om 15 41 28\" src=\"https://user-images.githubusercontent.com/10217/35226167-c438fac6-ff8a-11e7-83c3-6adc90047236.png\">\r\n\r\n@promag added the `const` you suggested, as well as explicit `== OUTPUT_TYPE_NONE` in both places (@ajtowns).\r\n\r\n> This can be avoided/skipped if there is a custom address in coin control. Move it below to where any_destination_native_segwit is needed.\r\n\r\nDone (which involved another loop over `vecSend`, but I assume that's trivially fast).",
      "created_at" : "2018-01-22T15:33:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-359459874",
      "id" : 359459874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-22T15:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359459874",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163077600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163077600"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Performance improvement:\r\n```cpp\r\n    any_destination_native_segwit = true;\r\n    break;\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-22T21:44:57Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)\n+{\n+    // If -changetype is not specified and g_address_type is not legacy,\n+    // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+    // output.\n+    bool any_destination_native_segwit = false;\n+    for (const auto& recipient : vecSend) {\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+            any_destination_native_segwit = true;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163077600",
      "id" : 163077600,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 90637318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163077600",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163078828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163078828"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suggestions, for now, keep static and not a `CWallet` member:\r\n```cpp\r\nstatic OutputType GetChangeTypeForRecipients(const std::vector<CRecipient>& recipients)\r\n{\r\n```\r\nAnd below:\r\n```cpp\r\nconst OutputType change_type = GetChangeTypeForRecipients(vecSend);\r\n```\r\n*don't mind the function name.* ",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-22T21:50:04Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163078828",
      "id" : 163078828,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90637318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163078828",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163263340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163263340"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What's the advantage of making it static? Especially if the longer term aim is to specify launch options for individual wallets (and presumably replace references to `g_change_type` with a `CWallet` member).",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T14:44:40Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163263340",
      "id" : 163263340,
      "in_reply_to_id" : 163078828,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90846570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163263340",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163268093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163268093"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T14:59:02Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)\n+{\n+    // If -changetype is not specified and g_address_type is not legacy,\n+    // and any destination is P2WPKH or P2WSH, use P2WPKH for the change\n+    // output.\n+    bool any_destination_native_segwit = false;\n+    for (const auto& recipient : vecSend) {\n+        // Check if any destination contains a witness program:\n+        int witnessversion = 0;\n+        std::vector<unsigned char> witnessprogram;\n+        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+            any_destination_native_segwit = true;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163268093",
      "id" : 163268093,
      "in_reply_to_id" : 163077600,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 90852345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163268093",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163271465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163271465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I just think it's too soon to *expose* this in the `CWallet`. Feel free to leave as it is.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:09:21Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163271465",
      "id" : 163271465,
      "in_reply_to_id" : 163078828,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90856447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163271465",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK dc2812f.\r\n\r\nThe only thing that bothers me is the fact that `g_address_type = OUTPUT_TYPE_NONE` is an error and now `g_change_type = OUTPUT_TYPE_NONE` is not.",
      "created_at" : "2018-01-23T15:33:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-359827900",
      "id" : 359827900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-23T15:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359827900",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163282074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163282074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is perhaps just personal taste, but I prefer early function return if we already know what change address we'll use without having to look at the outputs. That also means we can remove the local variables `any_destination_native_segwit` and `change_type`. It'd look something like:\r\n\r\n```\r\n    // If -changetype is specified, always use that change type.\r\n    if (g_change_type != OUTPUT_TYPE_NONE) {\r\n        return g_change_type;\r\n    }\r\n\r\n    // if g_address_type is legacy, use legacy address as change (even\r\n    // if some of the outputs are P2WPKH or P2WSH).\r\n    if (g_address_type == OUTPUT_TYPE_LEGACY) {\r\n        return OUTPUT_TYPE_LEGACY;\r\n    }\r\n\r\n    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\r\n    // output.\r\n    for (const auto& recipient : vecSend) {\r\n        // Check if any destination contains a witness program:\r\n        int witnessversion = 0;\r\n        std::vector<unsigned char> witnessprogram;\r\n        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\r\n            return OUTPUT_TYPE_BECH32;\r\n        }\r\n    }\r\n\r\n    // else use g_address_type for change\r\n    return g_address_type;\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:40:05Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163282074",
      "id" : 163282074,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163282074",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163282385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163282385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "please update the lines above to say there are 5 nodes under test, and describe what node4 is for.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:40:58Z",
      "diff_hunk" : "@@ -10,7 +10,7 @@\n     - node2 uses p2sh/segwit addresses and bech32 addresses for change\n     - node3 uses bech32 addresses\n \n-node4 exists to generate new blocks.\n+node5 exists to generate new blocks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163282385",
      "id" : 163282385,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 5,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163282385",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163283684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163283684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "update comment: `on node5`",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:44:36Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = [vout['scriptPubKey']['addresses'][0] for vout in tx[\"vout\"]]\n+        change_addresses = [d for d in output_addresses if d not in destinations]\n+        assert_equal(len(change_addresses), 1)\n+\n+        self.log.debug(\"Check if change address \" +  change_addresses[0] + \" is \" + expected_type)\n+        self.test_address(node_sender, change_addresses[0], multisig=False, typ=expected_type)\n+\n     def run_test(self):\n         # Mine 101 blocks on node4 to bring nodes out of IBD and make sure that",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163283684",
      "id" : 163283684,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 65,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163283684",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163284201"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163284201"
         }
      },
      "author_association" : "MEMBER",
      "body" : "update comment",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:46:08Z",
      "diff_hunk" : "@@ -183,7 +211,7 @@ def run_test(self):\n                 assert_equal(unconf_balances[to_node], to_send * 10 * (2 + n))\n \n             # node4 collects fee and block subsidy to keep accounting simple",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163284201",
      "id" : 163284201,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 75,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163284201",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163287999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163287999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unnecessary double space",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:56:41Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163287999",
      "id" : 163287999,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 49,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163287999",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163288051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163288051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unnecessary double space",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:56:50Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = [vout['scriptPubKey']['addresses'][0] for vout in tx[\"vout\"]]\n+        change_addresses = [d for d in output_addresses if d not in destinations]\n+        assert_equal(len(change_addresses), 1)\n+\n+        self.log.debug(\"Check if change address \" +  change_addresses[0] + \" is \" + expected_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163288051",
      "id" : 163288051,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 61,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163288051",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163288383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163288383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the whole docstring could be updated to reflect better what the test is actually doing:\r\n\r\n```\r\n\"\"\"Test that the wallet can send and receive using all combinations of address types.\r\n\r\nThere are 5 nodes-under-test:\r\n    - node0 uses legacy addresses\r\n    - node1 uses p2sh/segwit addresses\r\n    - node2 uses p2sh/segwit addresses and bech32 addresses for change\r\n    - node3 uses bech32 addresses\r\n    - node4 uses p2sh/segwit addresses for change\r\n\r\nnode5 exists to generate new blocks.\r\n\r\n## Multisig address test\r\n\r\nTest that adding a multisig address with:\r\n    - an uncompressed pubkey always gives a legacy address\r\n    - only compressed pubkeys gives the an `-addresstype` address\r\n\r\n## Sending to address types test\r\n\r\nA series of tests, iterating over node0-node4. In each iteration of the test, one node sends:\r\n    - 10/101th of its balance to itself (using getrawchangeaddress for single key addresses)\r\n    - 20/101th to the next node\r\n    - 30/101th to the node after that\r\n    - 40/101th to the remaining node\r\n    - 1/101th remains as fee+change\r\n\r\nIterate over each node for single key addresses, and then over each node for\r\nmultisig addresses.\r\n\r\nRepeat test, but with explicit address_type parameters passed to getnewaddress\r\nand getrawchangeaddress:\r\n    - node0 and node3 send to p2sh.\r\n    - node1 sends to bech32.\r\n    - node2 sends to legacy.\r\n\r\nAs every node sends coins after receiving, this also\r\nverifies that spending coins sent to all these address types works.\r\n\r\n## Change type test\r\n\r\nTest that the nodes generate the correct change address type:\r\n    - node0 always uses a legacy change address.\r\n    - node1 uses a bech32 addresses for change if any destination address is bech32.\r\n    - node4 always uses p2sh/segwit output for change.\r\n\"\"\"\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T15:57:46Z",
      "diff_hunk" : "@@ -24,18 +24,30 @@\n multisig addresses. In a second iteration, the same is done, but with explicit address_type\n parameters passed to getnewaddress and getrawchangeaddress. Node0 and node3 send to p2sh,\n node 1 sends to bech32, and node2 sends to legacy. As every node sends coins after receiving,\n-this also verifies that spending coins sent to all these address types works.\"\"\"\n+this also verifies that spending coins sent to all these address types works.\n+\n+Test that node1 uses a bech32 addresses for change if any destination address is\n+bech32. Test that node0 always uses a legacy change address. Test that node4 uses\n+p2sh/segwit output for change.\n+\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163288383",
      "id" : 163288383,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 19,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163288383",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163292563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163292563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggest you make all of these logs `INFO` level",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:09:18Z",
      "diff_hunk" : "@@ -195,5 +223,47 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163292563",
      "id" : 163292563,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 96,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163292563",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163292737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163292737"
         }
      },
      "author_association" : "MEMBER",
      "body" : "suggest you make these named arguments so it's clear what the `\"\"` is for.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:09:49Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163292737",
      "id" : 163292737,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 49,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163292737",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163292876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163292876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps clearer as:\r\n\r\n```\r\n        self.extra_args = [[\"-addresstype=legacy\"],                             # node0\r\n                           [\"-addresstype=p2sh-segwit\"],                        # node1\r\n                           [\"-addresstype=p2sh-segwit\", \"-changetype=bech32\"],  # node2\r\n                           [\"-addresstype=bech32\"],                             # node3\r\n                           [\"-changetype=p2sh-segwit\"],                         # node4\r\n                           []]                                                  # node5\r\n```",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:10:17Z",
      "diff_hunk" : "@@ -24,18 +24,30 @@\n multisig addresses. In a second iteration, the same is done, but with explicit address_type\n parameters passed to getnewaddress and getrawchangeaddress. Node0 and node3 send to p2sh,\n node 1 sends to bech32, and node2 sends to legacy. As every node sends coins after receiving,\n-this also verifies that spending coins sent to all these address types works.\"\"\"\n+this also verifies that spending coins sent to all these address types works.\n+\n+Test that node1 uses a bech32 addresses for change if any destination address is\n+bech32. Test that node0 always uses a legacy change address. Test that node4 uses\n+p2sh/segwit output for change.\n+\"\"\"\n \n from decimal import Decimal\n import itertools\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, connect_nodes_bi, sync_blocks, sync_mempools\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    connect_nodes_bi,\n+    sync_blocks,\n+    sync_mempools,\n+)\n \n class AddressTypeTest(BitcoinTestFramework):\n     def set_test_params(self):\n-        self.num_nodes = 5\n-        self.extra_args = [[\"-addresstype=legacy\"], [\"-addresstype=p2sh-segwit\"], [\"-addresstype=p2sh-segwit\", \"-changetype=bech32\"], [\"-addresstype=bech32\"], []]\n+        self.num_nodes = 6\n+        self.extra_args = [[\"-addresstype=legacy\"], [\"-addresstype=p2sh-segwit\"], [\"-addresstype=p2sh-segwit\", \"-changetype=bech32\"], [\"-addresstype=bech32\"], [\"-changetype=p2sh-segwit\"], []]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163292876",
      "id" : 163292876,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 40,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163292876",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163294136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163294136"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's fine to join these lines",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:14:00Z",
      "diff_hunk" : "@@ -195,5 +223,47 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output (unless changetype is set otherwise):\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug('getrawchangeaddress defaults to addresstype if -changetype is not set and argument is absent')\n+        self.test_address(3, self.nodes[3].getrawchangeaddress(), multisig=False, typ='bech32')\n+\n+        self.log.debug('getrawchangeaddress fails with invalid changetype argument')\n+        assert_raises_rpc_error(-5, \"Unknown address type 'bech23'\", self.nodes[3].getrawchangeaddress, 'bech23')\n+\n+        self.log.debug(\"Nodes with addresstype=p2sh-segwit only use a P2WPKH change output \" +\n+                       \"if any destination address is bech32:\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163294136",
      "id" : 163294136,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 111,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90869057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163294136",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306253"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I find your version more readable as well, so switched to that.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:32Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306253",
      "id" : 163306253,
      "in_reply_to_id" : 163282074,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90898006,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306253",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:39Z",
      "diff_hunk" : "@@ -10,7 +10,7 @@\n     - node2 uses p2sh/segwit addresses and bech32 addresses for change\n     - node3 uses bech32 addresses\n \n-node4 exists to generate new blocks.\n+node5 exists to generate new blocks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306282",
      "id" : 163306282,
      "in_reply_to_id" : 163282385,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 5,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306282",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's much clearer, thanks. I also ordered the change address tests by node id added node 2 and 3 to the description. ",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:45Z",
      "diff_hunk" : "@@ -24,18 +24,30 @@\n multisig addresses. In a second iteration, the same is done, but with explicit address_type\n parameters passed to getnewaddress and getrawchangeaddress. Node0 and node3 send to p2sh,\n node 1 sends to bech32, and node2 sends to legacy. As every node sends coins after receiving,\n-this also verifies that spending coins sent to all these address types works.\"\"\"\n+this also verifies that spending coins sent to all these address types works.\n+\n+Test that node1 uses a bech32 addresses for change if any destination address is\n+bech32. Test that node0 always uses a legacy change address. Test that node4 uses\n+p2sh/segwit output for change.\n+\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306313",
      "id" : 163306313,
      "in_reply_to_id" : 163288383,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 19,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306313",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306330"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:49Z",
      "diff_hunk" : "@@ -24,18 +24,30 @@\n multisig addresses. In a second iteration, the same is done, but with explicit address_type\n parameters passed to getnewaddress and getrawchangeaddress. Node0 and node3 send to p2sh,\n node 1 sends to bech32, and node2 sends to legacy. As every node sends coins after receiving,\n-this also verifies that spending coins sent to all these address types works.\"\"\"\n+this also verifies that spending coins sent to all these address types works.\n+\n+Test that node1 uses a bech32 addresses for change if any destination address is\n+bech32. Test that node0 always uses a legacy change address. Test that node4 uses\n+p2sh/segwit output for change.\n+\"\"\"\n \n from decimal import Decimal\n import itertools\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, connect_nodes_bi, sync_blocks, sync_mempools\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    connect_nodes_bi,\n+    sync_blocks,\n+    sync_mempools,\n+)\n \n class AddressTypeTest(BitcoinTestFramework):\n     def set_test_params(self):\n-        self.num_nodes = 5\n-        self.extra_args = [[\"-addresstype=legacy\"], [\"-addresstype=p2sh-segwit\"], [\"-addresstype=p2sh-segwit\", \"-changetype=bech32\"], [\"-addresstype=bech32\"], []]\n+        self.num_nodes = 6\n+        self.extra_args = [[\"-addresstype=legacy\"], [\"-addresstype=p2sh-segwit\"], [\"-addresstype=p2sh-segwit\", \"-changetype=bech32\"], [\"-addresstype=bech32\"], [\"-changetype=p2sh-segwit\"], []]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306330",
      "id" : 163306330,
      "in_reply_to_id" : 163292876,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 40,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306341"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:51Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306341",
      "id" : 163306341,
      "in_reply_to_id" : 163287999,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 49,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306341",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:57Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306373",
      "id" : 163306373,
      "in_reply_to_id" : 163292737,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 49,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306373",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:49:59Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = [vout['scriptPubKey']['addresses'][0] for vout in tx[\"vout\"]]\n+        change_addresses = [d for d in output_addresses if d not in destinations]\n+        assert_equal(len(change_addresses), 1)\n+\n+        self.log.debug(\"Check if change address \" +  change_addresses[0] + \" is \" + expected_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306388",
      "id" : 163306388,
      "in_reply_to_id" : 163288051,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 61,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306388",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306404"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:50:02Z",
      "diff_hunk" : "@@ -104,10 +116,26 @@ def test_address(self, node, address, multisig, typ):\n             # Unknown type\n             assert(False)\n \n+    def test_change_output_type(self, node_sender, destinations, expected_type):\n+        txid = self.nodes[node_sender].sendmany(\"\",  dict.fromkeys(destinations, 0.001))\n+        raw_tx = self.nodes[node_sender].getrawtransaction(txid)\n+        tx = self.nodes[node_sender].decoderawtransaction(raw_tx)\n+\n+        # Make sure the transaction has change:\n+        assert_equal(len(tx[\"vout\"]), len(destinations) + 1)\n+\n+        # Make sure the destinations are included, and remove them:\n+        output_addresses = [vout['scriptPubKey']['addresses'][0] for vout in tx[\"vout\"]]\n+        change_addresses = [d for d in output_addresses if d not in destinations]\n+        assert_equal(len(change_addresses), 1)\n+\n+        self.log.debug(\"Check if change address \" +  change_addresses[0] + \" is \" + expected_type)\n+        self.test_address(node_sender, change_addresses[0], multisig=False, typ=expected_type)\n+\n     def run_test(self):\n         # Mine 101 blocks on node4 to bring nodes out of IBD and make sure that",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306404",
      "id" : 163306404,
      "in_reply_to_id" : 163283684,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 65,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306404",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:50:05Z",
      "diff_hunk" : "@@ -183,7 +211,7 @@ def run_test(self):\n                 assert_equal(unconf_balances[to_node], to_send * 10 * (2 + n))\n \n             # node4 collects fee and block subsidy to keep accounting simple",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306429",
      "id" : 163306429,
      "in_reply_to_id" : 163284201,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 75,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898238,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306429",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306459"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:50:10Z",
      "diff_hunk" : "@@ -195,5 +223,47 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306459",
      "id" : 163306459,
      "in_reply_to_id" : 163292563,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 96,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306459",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306473"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T16:50:13Z",
      "diff_hunk" : "@@ -195,5 +223,47 @@ def run_test(self):\n                 to_node %= 4\n                 assert_equal(new_balances[to_node], old_balances[to_node] + to_send * 10 * (2 + n))\n \n+        # Get one p2sh/segwit address from node2 and two bech32 addresses from node3:\n+        to_address_p2sh = self.nodes[2].getnewaddress()\n+        to_address_bech32_1 = self.nodes[3].getnewaddress()\n+        to_address_bech32_2 = self.nodes[3].getnewaddress()\n+\n+        # Fund node 4:\n+        self.nodes[5].sendtoaddress(self.nodes[4].getnewaddress(), Decimal(\"1\"))\n+        self.nodes[5].generate(1)\n+        sync_blocks(self.nodes)\n+        assert_equal(self.nodes[4].getbalance(), 1)\n+\n+        self.log.debug(\"Nodes with change_type=bech32 always use a P2WPKH change output:\")\n+        self.test_change_output_type(2, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(2, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug(\"Nodes with addresstype=bech32 always use a P2WPKH change output (unless changetype is set otherwise):\")\n+        self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+        self.test_change_output_type(3, [to_address_p2sh], 'bech32')\n+\n+        self.log.debug('getrawchangeaddress defaults to addresstype if -changetype is not set and argument is absent')\n+        self.test_address(3, self.nodes[3].getrawchangeaddress(), multisig=False, typ='bech32')\n+\n+        self.log.debug('getrawchangeaddress fails with invalid changetype argument')\n+        assert_raises_rpc_error(-5, \"Unknown address type 'bech23'\", self.nodes[3].getrawchangeaddress, 'bech23')\n+\n+        self.log.debug(\"Nodes with addresstype=p2sh-segwit only use a P2WPKH change output \" +\n+                       \"if any destination address is bech32:\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163306473",
      "id" : 163306473,
      "in_reply_to_id" : 163294136,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 111,
      "path" : "test/functional/address_types.py",
      "position" : null,
      "pull_request_review_id" : 90898289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T16:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163306473",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163334775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163334775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`TransactionChangeType()` doesn't really need to be a class member function on `CWallet`, and could be a utility function in walletutil.cpp. In general, it'd be nice to start making the wallet class and wallet.cpp a bit smaller, but that's probably a tidy-up for another day.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T18:31:15Z",
      "diff_hunk" : "@@ -2644,6 +2644,34 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163334775",
      "id" : 163334775,
      "original_commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90932095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T18:31:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163334775",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163345596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163345596"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "cc @jnewbery given your last comment. I'll leave it as is, but useful to know what the future direction shouldl be.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T19:08:43Z",
      "diff_hunk" : "@@ -2644,6 +2644,31 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163345596",
      "id" : 163345596,
      "in_reply_to_id" : 163078828,
      "original_commit_id" : "629fa755b821add57ed81818a1d42acf6dc8f2d4",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90944498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T19:08:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163345596",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163347383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163347383"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "+1",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T19:14:58Z",
      "diff_hunk" : "@@ -2644,6 +2644,34 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163347383",
      "id" : 163347383,
      "in_reply_to_id" : 163334775,
      "original_commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 90946620,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-23T19:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163347383",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-23T21:28:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-359936480",
      "id" : 359936480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12119",
      "updated_at" : "2018-01-23T21:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359936480",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163560224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163560224"
         }
      },
      "author_association" : "OWNER",
      "body" : "Agree, this should be moved at some point.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-24T14:23:18Z",
      "diff_hunk" : "@@ -2644,6 +2644,34 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163560224",
      "id" : 163560224,
      "in_reply_to_id" : 163334775,
      "original_commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 91190992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-24T14:23:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163560224",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163582303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163582303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For the future, it might be a good idea add `change_type` and `address_type` fields to CoinControl class, and have this method accept a CoinControl argument, instead of relying on the globals. This would make it easier to ensure that when an RPC is being called that has address type options, that they will take precedence over the globals.\r\n\r\nPieter's suggestion of adding a separate `P2SH_SEGWIT_BUT_NATIVE_WHEN_NATIVE_DESTINATION` enum value instead of assigning multiple meanings to `OUTPUT_TYPE_NONE` is also a good idea https://github.com/bitcoin/bitcoin/pull/12119#issuecomment-357982763.\r\n\r\nOther cleanups are also possible. I think a nice refactoring PR that didn't change behavior could be submitted that:\r\n\r\n* Changed OutputType from enum to enum class.\r\n* Got rid of `DEFAULT` enum value and just set P2SH_SEGWIT as default during initialization.\r\n* Got rid of `NONE` enum value, replacing it with `PARSE_ERROR` and `P2SH_SEGWIT_BUT_NATIVE_WHEN_NATIVE_DESTINATION` (or something shorter like `MATCH_OTHER_OUTPUTS`).",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-24T15:34:27Z",
      "diff_hunk" : "@@ -2644,6 +2644,34 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)\n+{\n+    // If -changetype is specified, always use that change type.\n+    if (g_change_type != OUTPUT_TYPE_NONE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163582303",
      "id" : 163582303,
      "original_commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : 7,
      "pull_request_review_id" : 91217672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-24T15:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163582303",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163583872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163583872"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice wrap up @ryanofsky. In #12194 I'm adding change type to coin control, however I'm not passing coin control here.",
      "commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "created_at" : "2018-01-24T15:39:08Z",
      "diff_hunk" : "@@ -2644,6 +2644,34 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     return true;\n }\n \n+OutputType CWallet::TransactionChangeType(const std::vector<CRecipient>& vecSend)\n+{\n+    // If -changetype is specified, always use that change type.\n+    if (g_change_type != OUTPUT_TYPE_NONE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12119#discussion_r163583872",
      "id" : 163583872,
      "in_reply_to_id" : 163582303,
      "original_commit_id" : "596c44633fd03e76cc12f2fd37452e223ba43115",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : 7,
      "pull_request_review_id" : 91219534,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12119",
      "updated_at" : "2018-01-24T15:39:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163583872",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
