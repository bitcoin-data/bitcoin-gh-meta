[
   {
      "author_association" : "MEMBER",
      "body" : "Does the crash also happen in a python functional test? If yes, mind to add one?",
      "created_at" : "2020-06-17T10:11:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645283826",
      "id" : 645283826,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4MzgyNg==",
      "updated_at" : "2020-06-17T10:11:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645283826",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke haven't tried but I'd say it should - but it will be one of those loop-until-it-happens test. I'll give it a try.",
      "created_at" : "2020-06-17T10:14:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645285177",
      "id" : 645285177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4NTE3Nw==",
      "updated_at" : "2020-06-17T10:14:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645285177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "does this need backport to 0.19?",
      "created_at" : "2020-06-17T10:16:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645286264",
      "id" : 645286264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4NjI2NA==",
      "updated_at" : "2020-06-17T10:16:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645286264",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke yes, and probably is a clean backport.",
      "created_at" : "2020-06-17T10:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645287165",
      "id" : 645287165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4NzE2NQ==",
      "updated_at" : "2020-06-17T10:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645287165",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi, just tested the running of several background processes of the following script :\r\n\r\n```\r\n# Bitcoin Core RPC client version v0.20.0.0-ga62f0ed64f8bbbdfe6467ac5ce92ef5b5222d1bd\r\nwallet=xxxxxx\r\nfor i in {1..1000}\r\ndo\r\n  echo $i\r\n  bitcoin-cli loadwallet $wallet\r\n  bitcoin-cli unloadwallet $wallet\r\ndone\r\n\r\n```\r\nCrash is immediate. Here's valgrind output:\r\n\r\n```\r\nvalgrind /usr/local/bin/bitcoind -daemon -walletrbf -conf=/root/.bitcoin/bitcoin.conf -fallbackfee=0.00001 -rpcworkqueue=128\r\n==30964== Memcheck, a memory error detector\r\n==30964== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==30964== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\r\n==30964== Command: /usr/local/bin/bitcoind -daemon -walletrbf -conf=/root/.bitcoin/bitcoin.conf -fallbackfee=0.00001 -rpcworkqueue=128\r\n==30964==\r\nBitcoin Core starting\r\n==30964==\r\n==30964== HEAP SUMMARY:\r\n==30964==     in use at exit: 2,232,114 bytes in 2,271 blocks\r\n==30964==   total heap usage: 3,234 allocs, 963 frees, 2,462,760 bytes allocated\r\n==30964==\r\n==30964== LEAK SUMMARY:\r\n==30964==    definitely lost: 0 bytes in 0 blocks\r\n==30964==    indirectly lost: 0 bytes in 0 blocks\r\n==30964==      possibly lost: 0 bytes in 0 blocks\r\n==30964==    still reachable: 2,232,114 bytes in 2,271 blocks\r\n==30964==         suppressed: 0 bytes in 0 blocks\r\n==30964== Reachable blocks (those to which a pointer was found) are not shown.\r\n==30964== To see them, rerun with: --leak-check=full --show-leak-kinds=all\r\n==30964==\r\n==30964== For lists of detected and suppressed errors, rerun with: -s\r\n==30964== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\nroot@backdev2:/home/psb/bin# ==30973== Syscall param pwrite64(buf) points to uninitialised byte(s)\r\n==30973==    at 0x507B983: ??? (syscall-template.S:84)\r\n==30973==    by 0x53CF188: __os_io (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BD04C: __memp_pgwrite.part.0 (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BD408: __memp_bhwrite (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BC31A: __memp_alloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BED27: __memp_fget (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5348408: __db_verify (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534A846: __db_verify_internal (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x52B9026: Db::verify(char const*, char const*, std::ostream*, unsigned int) (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x3DF7E5: BerkeleyEnvironment::Verify(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, bool (*)(boost::filesystem::path const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (db.cpp:277)\r\n==30973==    by 0x3DFB4A: BerkeleyBatch::VerifyDatabaseFile(boost::filesystem::path const&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, bool (*)(boost::filesystem::path const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)) (db.cpp:422)\r\n==30973==    by 0x472D48: CWallet::Verify(interfaces::Chain&, WalletLocation const&, bool, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&) (wallet.cpp:3778)\r\n==30973==  Address 0xd63ee08 is 120 bytes inside a block of size 1,112 alloc'd\r\n==30973==    at 0x402E7BD: malloc (vg_replace_malloc.c:309)\r\n==30973==    by 0x53CC964: __os_malloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x539B4F3: __env_alloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BBBC0: __memp_alloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BED27: __memp_fget (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x52D4063: __bam_new_file (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5386387: __db_new_file (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5386906: __db_open (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534B2B8: __db_vrfy_pgset (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534B4BE: __db_vrfy_dbinfo_create (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5348056: __db_verify (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534A846: __db_verify_internal (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==\r\n==30973==\r\n==30973== Process terminating with default action of signal 6 (SIGABRT)\r\n==30973==    at 0x6350FFF: raise (raise.c:51)\r\n==30973==    by 0x6352429: abort (abort.c:89)\r\n==30973==    by 0x6349E66: __assert_fail_base (assert.c:92)\r\n==30973==    by 0x6349F11: __assert_fail (assert.c:101)\r\n==30973==    by 0x49085A: BerkeleyDatabase (db.h:125)\r\n==30973==    by 0x49085A: std::unique_ptr<BerkeleyDatabase, std::default_delete<BerkeleyDatabase> > MakeUnique<BerkeleyDatabase, std::shared_ptr<BerkeleyEnvironment>, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >(std::shared_ptr<BerkeleyEnvironment>&&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&&) (memory.h:16)\r\n==30973==    by 0x49091F: BerkeleyDatabase::Create(boost::filesystem::path const&) (db.h:139)\r\n==30973==    by 0x47E2C1: CWallet::CreateWalletFromFile(interfaces::Chain&, WalletLocation const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&, unsigned long) (wallet.cpp:3805)\r\n==30973==    by 0x4823E6: LoadWallet(interfaces::Chain&, WalletLocation const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&) (wallet.cpp:157)\r\n==30973==    by 0x40A7FD: loadwallet(JSONRPCRequest const&) (rpcwallet.cpp:2626)\r\n==30973==    by 0x22BFEB: operator() (server.h:104)\r\n==30973==    by 0x22BFEB: std::_Function_handler<bool (JSONRPCRequest const&, UniValue&, bool), CRPCCommand::CRPCCommand(char const*, char const*, UniValue (*)(JSONRPCRequest const&), std::initializer_list<char const*>)::{lambda(JSONRPCRequest const&, UniValue&, bool)#1}>::_M_invoke(std::_Any_data const&, JSONRPCRequest const&, UniValue&, bool&&) (functional:1717)\r\n==30973==    by 0x14A95E: operator() (functional:2127)\r\n==30973==    by 0x14A95E: operator() (chain.cpp:208)\r\n==30973==    by 0x14A95E: std::_Function_handler<bool (JSONRPCRequest const&, UniValue&, bool), interfaces::(anonymous namespace)::RpcHandlerImpl::RpcHandlerImpl(CRPCCommand const&)::{lambda(JSONRPCRequest const&, UniValue&, bool)#1}>::_M_invoke(std::_Any_data const&, JSONRPCRequest const&, UniValue&, bool&&) (functional:1717)\r\n==30973==    by 0x2B32DB: operator() (functional:2127)\r\n==30973==    by 0x2B32DB: ExecuteCommand (server.cpp:453)\r\n==30973==    by 0x2B32DB: CRPCTable::execute(JSONRPCRequest const&) const (server.cpp:436)\r\n==30973==\r\n==30973== HEAP SUMMARY:\r\n==30973==     in use at exit: 475,082,336 bytes in 3,760,553 blocks\r\n==30973==   total heap usage: 9,888,764 allocs, 6,128,211 frees, 1,385,505,603 bytes allocated\r\n==30973==\r\n\r\n```",
      "created_at" : "2020-06-17T11:56:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645329513",
      "id" : 645329513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTMyOTUxMw==",
      "updated_at" : "2020-06-17T12:07:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645329513",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/47175970?v=4",
         "events_url" : "https://api.github.com/users/fscemama/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fscemama/followers",
         "following_url" : "https://api.github.com/users/fscemama/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fscemama/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fscemama",
         "id" : 47175970,
         "login" : "fscemama",
         "node_id" : "MDQ6VXNlcjQ3MTc1OTcw",
         "organizations_url" : "https://api.github.com/users/fscemama/orgs",
         "received_events_url" : "https://api.github.com/users/fscemama/received_events",
         "repos_url" : "https://api.github.com/users/fscemama/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fscemama/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fscemama/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fscemama"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke pushed 50b7e8216564d1e897f2f05b6d91abb5afd90f0c, I welcome any python ninja to make it more cool.",
      "created_at" : "2020-06-17T13:01:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645359186",
      "id" : 645359186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM1OTE4Ng==",
      "updated_at" : "2020-06-17T13:01:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645359186",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441536261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441536261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think we can assert that a race happened. Races are only intermittent.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-17T13:16:51Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441536261",
      "id" : 441536261,
      "line" : 242,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzNjI2MQ==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : 51,
      "pull_request_review_id" : 432389218,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441536261",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441560325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441560325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this one is pretty much guaranteed, loading takes a bit.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-17T13:50:10Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441560325",
      "id" : 441560325,
      "in_reply_to_id" : 441536261,
      "line" : 242,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MDMyNQ==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : 51,
      "pull_request_review_id" : 432421572,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441560325",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fscemama if you can please repeat the test but using this branch.",
      "created_at" : "2020-06-17T13:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645386274",
      "id" : 645386274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM4NjI3NA==",
      "updated_at" : "2020-06-17T13:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645386274",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Sure. Can you confirm I must compile [this](https://github.com/promag/bitcoin/tree/2020-06-loadwallet) and re-test ?",
      "created_at" : "2020-06-17T14:00:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645391561",
      "id" : 645391561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM5MTU2MQ==",
      "updated_at" : "2020-06-17T14:00:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645391561",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/47175970?v=4",
         "events_url" : "https://api.github.com/users/fscemama/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fscemama/followers",
         "following_url" : "https://api.github.com/users/fscemama/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fscemama/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fscemama",
         "id" : 47175970,
         "login" : "fscemama",
         "node_id" : "MDQ6VXNlcjQ3MTc1OTcw",
         "organizations_url" : "https://api.github.com/users/fscemama/orgs",
         "received_events_url" : "https://api.github.com/users/fscemama/received_events",
         "repos_url" : "https://api.github.com/users/fscemama/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fscemama/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fscemama/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fscemama"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "**Successfull.** Will send these kind of normal messages:\r\n\r\n```\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\n```\r\n\r\nNo crash. Hourra!",
      "created_at" : "2020-06-17T14:32:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645411416",
      "id" : 645411416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTQxMTQxNg==",
      "updated_at" : "2020-06-17T14:32:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645411416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/47175970?v=4",
         "events_url" : "https://api.github.com/users/fscemama/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fscemama/followers",
         "following_url" : "https://api.github.com/users/fscemama/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fscemama/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fscemama",
         "id" : 47175970,
         "login" : "fscemama",
         "node_id" : "MDQ6VXNlcjQ3MTc1OTcw",
         "organizations_url" : "https://api.github.com/users/fscemama/orgs",
         "received_events_url" : "https://api.github.com/users/fscemama/received_events",
         "repos_url" : "https://api.github.com/users/fscemama/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fscemama/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fscemama/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fscemama"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19101 (refactor: remove ::vpwallets and related global variables by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-17T23:28:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645678498",
      "id" : 645678498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTY3ODQ5OA==",
      "updated_at" : "2020-06-20T03:50:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645678498",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442256581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442256581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    auto result = WITH_LOCK(g_loading_wallet_mutex, return g_loading_wallet_set.insert(location.GetName()));\r\n    if (!result.second) {\r\n        error = Untranslated(\"Wallet already being loading.\");\r\n        return nullptr;\r\n    }\r\n```",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T14:11:16Z",
      "diff_hunk" : "@@ -167,6 +169,25 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n }\n \n+std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+{\n+    std::pair<std::set<std::string>::iterator,bool> result;\n+    {\n+        LOCK(g_loading_wallet_mutex);\n+        result = g_loading_wallet_set.insert(location.GetName());\n+        if (!result.second) {\n+            error = Untranslated(\"Wallet already being loading.\");\n+            return nullptr;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442256581",
      "id" : 442256581,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI1NjU4MQ==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 180,
      "original_position" : 36,
      "original_start_line" : 174,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433323783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442256581",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442272308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442272308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: It seems using an unnamed namespace is preferable:\r\n- https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#Rs-unnamed2\r\n- https://stackoverflow.com/questions/154469/unnamed-anonymous-namespaces-vs-static-functions\r\n- https://stackoverflow.com/questions/4422507/superiority-of-unnamed-namespace-over-static\r\n- https://stackoverflow.com/questions/4977252/why-an-unnamed-namespace-is-a-superior-alternative-to-static\r\n\r\nFrom the recent pull:\r\n- https://github.com/bitcoin/bitcoin/pull/19176#discussion_r435937252\r\n- https://github.com/bitcoin/bitcoin/pull/19176#issuecomment-641304921\r\n>  - Use anonymous namespace instead of static",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T14:32:07Z",
      "diff_hunk" : "@@ -145,7 +147,7 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     }\n }\n \n-std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+static std::shared_ptr<CWallet> LoadWalletInternal(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442272308",
      "id" : 442272308,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MjMwOA==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 150,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433323783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442272308",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> btw, couldn't get an error with the testing bash script on master\r\n\r\n@hebasto see https://github.com/bitcoin/bitcoin/issues/19232#issuecomment-645316204",
      "created_at" : "2020-06-18T14:50:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-646069330",
      "id" : 646069330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA2OTMzMA==",
      "updated_at" : "2020-06-18T14:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646069330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442287633"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442287633"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to not test the cli? IIRC the reported bug was about the cli",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T14:51:45Z",
      "diff_hunk" : "@@ -212,6 +230,18 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        if not self.options.usecli:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442287633",
      "id" : 442287633,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI4NzYzMw==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 233,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 433364930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442287633",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442289228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442289228"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I just need to get the cli equivalent to `get_rpc_proxy`.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T14:53:45Z",
      "diff_hunk" : "@@ -212,6 +230,18 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        if not self.options.usecli:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442289228",
      "id" : 442289228,
      "in_reply_to_id" : 442287633,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI4OTIyOA==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 233,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 433366949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442289228",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > btw, couldn't get an error with the testing bash script on master\r\n> \r\n> @hebasto see [#19232 (comment)](https://github.com/bitcoin/bitcoin/issues/19232#issuecomment-645316204)\r\n\r\nIndeed :)\r\n\r\nOn master:\r\n```\r\n2020-06-18T14:57:15Z [httpworker.0] Using BerkeleyDB version Berkeley DB 5.3.28: (September  9, 2013)\r\n2020-06-18T14:57:15Z [httpworker.0] Using wallet /home/hebasto/.bitcoin/regtest/wallets/foo\r\n2020-06-18T14:57:15Z [httpworker.0] BerkeleyEnvironment::Open: LogDir=/home/hebasto/.bitcoin/regtest/wallets/foo/database ErrorFile=/home/hebasto/.bitcoin/regtest/wallets/foo/db.log\r\n2020-06-18T14:57:15Z [httpworker.0] init message: Loading wallet...\r\nbitcoind: ./wallet/bdb.h:113: BerkeleyDatabase::BerkeleyDatabase(std::shared_ptr<BerkeleyEnvironment>, std::string): Assertion `inserted.second' failed.\r\n2020-06-18T14:57:15Z [httpworker.1] Using BerkeleyDB version Berkeley DB 5.3.28: (September  9, 2013)\r\n2020-06-18T14:57:15Z [httpworker.1] Using wallet /home/hebasto/.bitcoin/regtest/wallets/foo\r\nAborted (core dumped)\r\n```",
      "created_at" : "2020-06-18T14:59:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-646076025",
      "id" : 646076025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA3NjAyNQ==",
      "updated_at" : "2020-06-18T14:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646076025",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Testing this PR with two parallel testing scripts and got _different_ error messages:\r\n```\r\n$ ~/test.sh & ~/test.sh \r\n[1] 354\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\n{\r\n  \"name\": \"foo\",\r\n  \"warning\": \"\"\r\n}\r\n{\r\n  \"name\": \"foo\",\r\n  \"warning\": \"\"\r\n}\r\n{\r\n  \"name\": \"foo\",\r\n  \"warning\": \"\"\r\n}\r\n{\r\n  \"name\": \"foo\",\r\n  \"warning\": \"\"\r\n}\r\n{\r\n  \"name\": \"foo\",\r\n  \"warning\": \"\"\r\n}\r\n[1]+  Exit 18                 ~/test.sh\r\n```",
      "created_at" : "2020-06-18T15:09:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-646083177",
      "id" : 646083177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA4MzE3Nw==",
      "updated_at" : "2020-06-18T15:09:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646083177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@hebasto yes that's expected - one is from concurrent load and the other from concurrent unload.",
      "created_at" : "2020-06-18T15:12:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-646085338",
      "id" : 646085338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA4NTMzOA==",
      "updated_at" : "2020-06-18T15:12:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646085338",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442303560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442303560"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is better for a follow up - being a bugfix we should make it minimal so it's easily backported. Unless we allow an anonymous namespace between functions?",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T15:14:36Z",
      "diff_hunk" : "@@ -145,7 +147,7 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     }\n }\n \n-std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+static std::shared_ptr<CWallet> LoadWalletInternal(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442303560",
      "id" : 442303560,
      "in_reply_to_id" : 442272308,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwMzU2MA==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 150,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433386732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442303560",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442304056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442304056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, will apply this.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T15:15:20Z",
      "diff_hunk" : "@@ -167,6 +169,25 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n }\n \n+std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+{\n+    std::pair<std::set<std::string>::iterator,bool> result;\n+    {\n+        LOCK(g_loading_wallet_mutex);\n+        result = g_loading_wallet_set.insert(location.GetName());\n+        if (!result.second) {\n+            error = Untranslated(\"Wallet already being loading.\");\n+            return nullptr;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442304056",
      "id" : 442304056,
      "in_reply_to_id" : 442256581,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNDA1Ng==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 180,
      "original_position" : 36,
      "original_start_line" : 174,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433387443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442304056",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442308431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442308431"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think this is better for a follow up - being a bugfix we should make it minimal so it's easily backported.\r\n\r\nIt's up to you :)\r\n\r\n> Unless we allow an anonymous namespace between functions?\r\n\r\nWhy not?",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-18T15:21:30Z",
      "diff_hunk" : "@@ -145,7 +147,7 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     }\n }\n \n-std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+static std::shared_ptr<CWallet> LoadWalletInternal(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442308431",
      "id" : 442308431,
      "in_reply_to_id" : 442272308,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwODQzMQ==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 150,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433393382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442308431",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442563135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442563135"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-19T00:02:42Z",
      "diff_hunk" : "@@ -212,6 +230,18 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        if not self.options.usecli:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442563135",
      "id" : 442563135,
      "in_reply_to_id" : 442287633,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MzEzNQ==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 233,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 433722019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442563135",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442563191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442563191"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-19T00:02:51Z",
      "diff_hunk" : "@@ -167,6 +169,25 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n }\n \n+std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+{\n+    std::pair<std::set<std::string>::iterator,bool> result;\n+    {\n+        LOCK(g_loading_wallet_mutex);\n+        result = g_loading_wallet_set.insert(location.GetName());\n+        if (!result.second) {\n+            error = Untranslated(\"Wallet already being loading.\");\n+            return nullptr;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442563191",
      "id" : 442563191,
      "in_reply_to_id" : 442256581,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MzE5MQ==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 180,
      "original_position" : 36,
      "original_start_line" : 174,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433722083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442563191",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442563286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442563286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Placed in anonymous namespace.",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-19T00:03:10Z",
      "diff_hunk" : "@@ -145,7 +147,7 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     }\n }\n \n-std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+static std::shared_ptr<CWallet> LoadWalletInternal(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442563286",
      "id" : 442563286,
      "in_reply_to_id" : 442272308,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MzI4Ng==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 150,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 433722189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T01:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442563286",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r443897594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443897594"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"qa: Test concurrent wallet loading\" (9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7)\r\n\r\n> I don't think we can assert that a race happened. Races are only intermittent.\r\n\r\nI would agree with Marco that in general tests like this are fragile and bad and slow and more trouble than they are worth, but also agree with promag that in practice this test is unlikely to fail.\r\n\r\nTo avoid potential problems from this, I'd suggest adding a comment here like \"got_loading_error condition is not guaranteed to be true but very unlikely to be false based on how long it takes to load a wallet\", so in case this does fail, future developers don't waste time trying to figure it out and can ignore or remove the test\r\n\r\nIn general it's easier to write tests for race conditions by making them invasive and implementing them in c++",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-06-23T00:36:40Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r443897594",
      "id" : 443897594,
      "in_reply_to_id" : 441536261,
      "line" : 242,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg5NzU5NA==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : 51,
      "pull_request_review_id" : 435362710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T01:16:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443897594",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This could be implemented by making the second loadwallet call block and wait for the first loadwallet call to finish, and then return the existing \"duplicate wallet\" error\r\n\r\nIf the 2nd waits then why return an error?\r\n\r\nEdit: actually, I wonder if loading an already loaded wallet should be an error in the first place.\r\n\r\n> This change would also make simultaneous wallet load calls work more similar to the the way simultaneous wallet unload calls already work.\r\n\r\nThe 2nd concurrent unload doesn't wait.\r\n\r\nI'm happy to make changes but I think current API is not ideal for concurrent clients.\r\n\r\nI had the idea of counting loads (incr load and decr unload) and then effective unload would happen when count is zero. This would simplify concurrent clients using the same wallet - each client must load->use->unload. But this is breaking change and so I think a new pair of RPC methods would be better like `acquirewallet`/`releasewallet`. However this would bring same problems as unspent locks..",
      "created_at" : "2020-06-23T08:10:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-647983829",
      "id" : 647983829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Nzk4MzgyOQ==",
      "updated_at" : "2020-06-23T09:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647983829",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > This could be implemented by making the second loadwallet call block and wait for the first loadwallet call to finish, and then return the existing \"duplicate wallet\" error\r\n> \r\n> If the 2nd waits then why return an error?\r\n\r\nBecause I think the point of changing this is to fix a race condition, not add a new one. If you load the same wallet twice one load should succeed, and one load should return error duplicate wallet. There shouldn't be an unpredictable length of time where both calls mysteriously succeed. Also, I presume code would be simpler not having a special case to suppress the error.\r\n\r\n> Edit: actually, I wonder if loading an already loaded wallet should be an error in the first place.\r\n\r\nThis would be a reasonable design, but I don't see a reason not to return the existing error. At this point all it would be doing is hiding information we know and breaking backwards compatibility.\r\n\r\n> > This change would also make simultaneous wallet load calls work more similar to the the way simultaneous wallet unload calls already work.\r\n> \r\n> The 2nd concurrent unload doesn't wait.\r\n\r\nOh, I figured it did, but didn't look closely. Again I think it'd be better if it waited, to avoid any need to poll when you need a wallet unloaded. And I think it'd simplify both server & client implementations to drop the extra error condition and just return \"succeeded\", \"failed\", or \"already not loaded\", never \"currently unloading\".\r\n\r\n> I'm happy to make changes but I think current API is not ideal for concurrent clients.\r\n> \r\n> I had the idea of counting loads (incr load and decr unload) and then effective unload would happen when count is zero. This would simplify concurrent clients using the same wallet - each client must load->use->unload. But this is breaking change and so I think a new pair of RPC methods would be better like `acquirewallet`/`releasewallet`. However this would bring same problems as unspent locks..\r\n\r\nYes, I wouldn't suggest this. I think the API I'm suggesting is pretty ideal for concurrent clients because it would let them unload & unload wallets reliably and never poll. The only place where reference counting would be useful would be for concurrent clients that have no way of communicating with each other. But even in this case reference counting would be unreliable and leaky if something ever went wrong like a connection getting dropped or a client process being killed. \r\n\r\nOverall, I think the current fix in 9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7 is good, and definitely better than having the bug. I think it would be simpler on both server and client sides if load and unload RPCs never returned \"currently loading\" or \"currently unloading\" and just waited to return definitive statuses. But this isn't necessary and I wouldn't want it to hold things up. I appreciate you fixing this and considering my suggestions!",
      "created_at" : "2020-06-23T23:14:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-648475843",
      "id" : 648475843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODQ3NTg0Mw==",
      "updated_at" : "2020-06-23T23:14:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648475843",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This PR might be close to being mergeable. It has acks from me and hebasto and some review comments from Marco. Suggestions I made to improve this aren't blocking and could be followed up later.",
      "created_at" : "2020-06-29T14:16:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-651151001",
      "id" : 651151001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE1MTAwMQ==",
      "updated_at" : "2020-06-29T14:16:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651151001",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think the API I'm suggesting is pretty ideal for concurrent clients because it would let them unload & unload wallets reliably and never poll. \r\n\r\nI disagree, current API (with or without your suggestion) doesn't make it easy to concurrently use a wallet (load+use+unload) -  client A unloads and messes client B.  And in the case some coordination exists on the client side, those improvements aren't really necessary.\r\n\r\n> reference counting would be unreliable and leaky if something ever went wrong like a connection getting dropped or a client process being killed.\r\n\r\nRight, For this I thought about a new RPC endpoint where the wallet counting would be tied to the connection and load/unload would happen indirectly.",
      "created_at" : "2020-06-29T14:24:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-651155955",
      "id" : 651155955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE1NTk1NQ==",
      "updated_at" : "2020-06-29T14:52:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651155955",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I disagree, current API (with or without your suggestion) doesn't make it easy to concurrently use a wallet (load+use+unload) - client A unloads and messes client B.\r\n\r\nI don't think we disagree about anything here. This is irrelevant. Neither your fix, nor the one I'm suggesting tries to do this, because it would require storing client state in the server, which would be an awkward and unreliable way to design things.\r\n\r\n> And in the case some coordination exists on the client side, those improvements aren't really necessary.\r\n\r\nHere is the use case: I want to write little shell script that unloads a wallet whether or not is it already loaded, maybe so I can back it up. Or I want to write a little shell script that loads a wallet, whether or not it is already loaded, maybe so I can check my balance or perform a transaction.\r\n\r\nWith the current API writing either of these scripts requires checking 4 for different error states (success/failure/in-progress/already-loaded-or-unloaded) and writing a loop to poll the server. With the API I am proposing, no polling is required and there are only 3 states to check instead of 4.\r\n\r\nAlso, the server-side implementation should be simpler. I am happy to implement it as a followup if the current PR is merged.",
      "created_at" : "2020-06-29T15:06:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-651181150",
      "id" : 651181150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE4MTE1MA==",
      "updated_at" : "2020-06-29T15:13:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651181150",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK 9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7 I have not reviewed the code",
      "created_at" : "2020-06-29T15:13:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-651185223",
      "id" : 651185223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE4NTIyMw==",
      "updated_at" : "2020-06-29T15:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651185223",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky Agree in making those improvements for future releases? IMO this is enough as a fix for latest version and to backport.",
      "created_at" : "2020-06-29T15:22:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-651190283",
      "id" : 651190283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE5MDI4Mw==",
      "updated_at" : "2020-06-29T15:22:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651190283",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky Agree in making those improvements for future releases? IMO this is enough as a fix for latest version and to backport.\r\n\r\nYes I acked this PR twice and commented repeatedly it would be fine to improve this later.",
      "created_at" : "2020-06-29T15:23:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-651191237",
      "id" : 651191237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE5MTIzNw==",
      "updated_at" : "2020-06-29T15:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651191237",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r475075615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/475075615"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The race does indeed happen: https://cirrus-ci.com/task/5075565516423168?command=ci#L5121",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-08-22T10:16:20Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r475075615",
      "id" : 475075615,
      "in_reply_to_id" : 441536261,
      "line" : 242,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA3NTYxNQ==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : 51,
      "pull_request_review_id" : 472916949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-22T10:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/475075615",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r475085751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/475085751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So it was slower to spawn those threads than to load the wallet. Not sure about c++ test because it would need to force block inside loading. Maybe we could improve this first by waiting for all threads to be ready to load?",
      "commit_id" : "9b009fae6e2eb0ab2ee7ce7882c3556a9ac363a7",
      "created_at" : "2020-08-22T12:30:24Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r475085751",
      "id" : 475085751,
      "in_reply_to_id" : 441536261,
      "line" : 242,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA4NTc1MQ==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : 51,
      "pull_request_review_id" : 472922938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-22T12:30:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/475085751",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
