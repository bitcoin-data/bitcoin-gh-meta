[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19102 (wallet: Introduce and use DummyDatabase instead of dummy BerkeleyDatabase by achow101)\n* #19077 (wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets by achow101)\n* #18971 (wallet: Refactor the classes in wallet/db.{cpp/h} by achow101)\n* #18608 (refactor: Remove CAddressBookData::destdata by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-17T23:18:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-645675131",
      "id" : 645675131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTY3NTEzMQ==",
      "updated_at" : "2020-06-17T23:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645675131",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442285323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: coding style `} else if (!ret) {`",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-18T14:48:40Z",
      "diff_hunk" : "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442285323",
      "id" : 442285323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI4NTMyMw==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 871,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433361872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This does limit flexibility a bit, though I guess one cursor at a time is enough for all our current and future use cases.",
      "created_at" : "2020-06-18T14:49:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646068957",
      "id" : 646068957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA2ODk1Nw==",
      "updated_at" : "2020-06-18T14:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646068957",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442290726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think `StartCursor` would be a better name, after all, the whole process (including details like whether something is created) is internal.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-18T14:55:50Z",
      "diff_hunk" : "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442290726",
      "id" : 442290726,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MDcyNg==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 742,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433368972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442291942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-18T14:57:28Z",
      "diff_hunk" : "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442291942",
      "id" : 442291942,
      "in_reply_to_id" : 442285323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MTk0Mg==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 871,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433370582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This does limit flexibility a bit, though I guess one cursor at a time is enough for all our current and future use cases.\r\n\r\nIf another cursor was needed, you could use another Batch object. But we barely use cursors, so one is enough for now.",
      "created_at" : "2020-06-18T14:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646075489",
      "id" : 646075489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA3NTQ4OQ==",
      "updated_at" : "2020-06-18T14:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646075489",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If another cursor was needed, you could use another Batch object. But we barely use cursors, so one is enough for now.\r\n\r\nOhh! I missed that it's on the batch, not on the database object.",
      "created_at" : "2020-06-18T15:03:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646079286",
      "id" : 646079286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA3OTI4Ng==",
      "updated_at" : "2020-06-18T15:03:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646079286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442494190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442494190"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Handle cursor internally\" (cda86544ae9de430e4558b87945046d5612202ac)\r\n\r\nMinor: I think it'd be a little clearer to keep this close here as m_batch.CloseCursor() so it's more obvious cursor is closed in all cases, and so you don't need to add a new close call in a different place above.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-18T20:49:08Z",
      "diff_hunk" : "@@ -742,8 +745,8 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n             if (!strErr.empty())\n                 pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n         }\n-        pcursor->close();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442494190",
      "id" : 442494190,
      "line" : 745,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5NDE5MA==",
      "original_commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "original_line" : 745,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 32,
      "pull_request_review_id" : 433636222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442494190",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443263535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443263535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, just `return ret == 0`.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-21T22:41:13Z",
      "diff_hunk" : "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n     if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443263535",
      "id" : 443263535,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI2MzUzNQ==",
      "original_commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "original_line" : 750,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 434538398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443263535",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443265733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443265733"
         }
      },
      "author_association" : "MEMBER",
      "body" : "But above, in https://github.com/bitcoin/bitcoin/pull/19308/files#diff-e506682270036e4c8e0b8159a34b652dR723, it returns so it needs to be closed there, or am I missing something?",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-21T23:12:38Z",
      "diff_hunk" : "@@ -742,8 +745,8 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n             if (!strErr.empty())\n                 pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n         }\n-        pcursor->close();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443265733",
      "id" : 443265733,
      "in_reply_to_id" : 442494190,
      "line" : 745,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI2NTczMw==",
      "original_commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "original_line" : 745,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 32,
      "pull_request_review_id" : 434538398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:44:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443265733",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443785276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443785276"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Renamed to `StartCursor`.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T19:43:44Z",
      "diff_hunk" : "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443785276",
      "id" : 443785276,
      "in_reply_to_id" : 442290726,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NTI3Ng==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 742,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 435221277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:43:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443785276",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443786075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443786075"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've moved it to after the `catch` block and removed the ones inside the loop except for the ones right before the early return.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T19:45:29Z",
      "diff_hunk" : "@@ -742,8 +745,8 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n             if (!strErr.empty())\n                 pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n         }\n-        pcursor->close();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443786075",
      "id" : 443786075,
      "in_reply_to_id" : 442494190,
      "line" : 745,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NjA3NQ==",
      "original_commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "original_line" : 745,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 32,
      "pull_request_review_id" : 435222306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T19:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443786075",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`assert(m_cursor)`? There was no check for `pcursor`.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T21:33:26Z",
      "diff_hunk" : "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838828",
      "id" : 443838828,
      "line" : 754,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgzODgyOA==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 754,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 73,
      "pull_request_review_id" : 435289625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T21:52:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838828",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, move these to header.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T21:33:43Z",
      "diff_hunk" : "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443838936",
      "id" : 443838936,
      "line" : 338,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgzODkzNg==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 338,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 435289625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T21:52:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443838936",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443863984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443863984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T22:39:52Z",
      "diff_hunk" : "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n     if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443863984",
      "id" : 443863984,
      "in_reply_to_id" : 443263535,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2Mzk4NA==",
      "original_commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "original_line" : 750,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 435321636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T22:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443863984",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864251"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think an assert is necessary.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T22:40:37Z",
      "diff_hunk" : "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864251",
      "id" : 443864251,
      "in_reply_to_id" : 443838828,
      "line" : 754,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NDI1MQ==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 754,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 73,
      "pull_request_review_id" : 435321980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T22:40:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864251",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm pretty sure that won't compile.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T22:42:52Z",
      "diff_hunk" : "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443864917",
      "id" : 443864917,
      "in_reply_to_id" : 443838936,
      "line" : 338,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NDkxNw==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 338,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 435322973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T22:42:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443864917",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443867602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443867602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I mean 04998ef3cb866b2371bb047a5091787f61692588.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T22:51:34Z",
      "diff_hunk" : "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443867602",
      "id" : 443867602,
      "in_reply_to_id" : 443838936,
      "line" : 338,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NzYwMg==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 338,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 435326710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T22:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443867602",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443872725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443872725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah. Maybe if I have to push again.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-22T23:08:16Z",
      "diff_hunk" : "@@ -335,7 +335,7 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n }\n \n \n-BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n+BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr), m_cursor(nullptr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r443872725",
      "id" : 443872725,
      "in_reply_to_id" : 443838936,
      "line" : 338,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg3MjcyNQ==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 338,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 435333578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-22T23:08:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443872725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444090941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444090941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If it's something that can't happen then an assertion is fine. Also, it means that `StartCursor` must be called before.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-23T09:31:16Z",
      "diff_hunk" : "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444090941",
      "id" : 444090941,
      "in_reply_to_id" : 443838828,
      "line" : 754,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5MDk0MQ==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 754,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 73,
      "pull_request_review_id" : 435607641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T09:31:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444090941",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444322405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444322405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If I have to push again.",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-23T15:41:51Z",
      "diff_hunk" : "@@ -738,27 +739,30 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::StartCursor()\n {\n+    assert(!m_cursor);\n     if (!pdb)\n-        return nullptr;\n-    Dbc* pcursor = nullptr;\n-    int ret = pdb->cursor(nullptr, &pcursor, 0);\n-    if (ret != 0)\n-        return nullptr;\n-    return pcursor;\n+        return false;\n+    int ret = pdb->cursor(nullptr, &m_cursor, 0);\n+    return ret == 0;\n }\n \n-int BerkeleyBatch::ReadAtCursor(Dbc* pcursor, CDataStream& ssKey, CDataStream& ssValue)\n+bool BerkeleyBatch::ReadAtCursor(CDataStream& ssKey, CDataStream& ssValue, bool& complete)\n {\n+    complete = false;\n+    if (m_cursor == nullptr) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444322405",
      "id" : 444322405,
      "in_reply_to_id" : 443838828,
      "line" : 754,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMyMjQwNQ==",
      "original_commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "original_line" : 754,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 73,
      "pull_request_review_id" : 435912776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T15:41:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444322405",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444522324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444522324"
         }
      },
      "author_association" : "NONE",
      "body" : "15tNMnu84FEsYbsavhHKmQTsNBCZBPg5EY\nhttps://freebitco.in/#\nhttps://btcdirect.eu/fr-be/cours-bitcoin\nhttps://www.blockchain.com/btc/payment_request?address=12dRugNcdxK39288NjcDV4GX7rMsKCGn6B",
      "commit_id" : "ca24edfbc1941ed0a3c9586416dae4e84794eb66",
      "created_at" : "2020-06-23T21:35:28Z",
      "diff_hunk" : "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r444522324",
      "id" : 444522324,
      "in_reply_to_id" : 442285323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUyMjMyNA==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 871,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 436175520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T21:35:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444522324",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/65382356?v=4",
         "events_url" : "https://api.github.com/users/kkarimalami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kkarimalami/followers",
         "following_url" : "https://api.github.com/users/kkarimalami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kkarimalami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kkarimalami",
         "id" : 65382356,
         "login" : "kkarimalami",
         "node_id" : "MDQ6VXNlcjY1MzgyMzU2",
         "organizations_url" : "https://api.github.com/users/kkarimalami/orgs",
         "received_events_url" : "https://api.github.com/users/kkarimalami/received_events",
         "repos_url" : "https://api.github.com/users/kkarimalami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kkarimalami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kkarimalami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kkarimalami"
      }
   }
]
