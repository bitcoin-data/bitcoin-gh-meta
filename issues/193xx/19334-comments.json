[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19335 (wallet: Cleanup and separate BerkeleyDatabase and BerkeleyBatch by achow101)\n* #19320 (wallet: Replace CDataStream& with CDataStream&& where appropriate by MarcoFalke)\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19102 (wallet: Introduce and use DummyDatabase instead of dummy BerkeleyDatabase by achow101)\n* #19077 (wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-20T03:34:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#issuecomment-646931904",
      "id" : 646931904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19334",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjkzMTkwNA==",
      "updated_at" : "2020-07-07T21:51:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646931904",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444411657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444411657"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote for future cleanup: This code is just moving from the header, not changing, but want to note it seems pretty unsafe to access m_databases without locking cs_db here given multithreaded loadwallet & unloadwallet rpcs and fact that environments can be shared between wallets",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:05:27Z",
      "diff_hunk" : "@@ -324,6 +324,14 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n     dbenv->lsn_reset(strFile.c_str(), 0);\n }\n \n+BerkeleyDatabase::~BerkeleyDatabase()\n+{\n+    if (env) {\n+        size_t erased = env->m_databases.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444411657",
      "id" : 444411657,
      "line" : 331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxMTY1Nw==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 331,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 8,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444411657",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444414128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444414128"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote for future cleanup: I didn't test but it was reported that this erase fails sometimes https://github.com/bitcoin/bitcoin/pull/18971#discussion_r441722431. This seems harmless but is also unexpected. Good to debug and fix in the future.",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:10:03Z",
      "diff_hunk" : "@@ -324,6 +324,14 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n     dbenv->lsn_reset(strFile.c_str(), 0);\n }\n \n+BerkeleyDatabase::~BerkeleyDatabase()\n+{\n+    if (env) {\n+        size_t erased = env->m_databases.erase(strFile);\n+        assert(erased == 1);\n+        env->m_fileids.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444414128",
      "id" : 444414128,
      "line" : 333,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxNDEyOA==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 333,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 10,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444414128",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444428173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444428173"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote for future cleanup: Descriptions and names of Close and Flush here are misleading. \r\n\r\nI'd expect Database::Flush to reliably flush data to disk like Batch::Flush does. But Database::Flush may or may not flush data in the current database, and may flush data in other databases, since what it actually does is iterate over all databases in the environment and close ones are not in use. If the current database is in use it does nothing.\r\n\r\nDatabase::Close is similarly misnamed. It basically does the same thing as Database::Flush so it or may not close the current database. The only thing it does differently is call log_archive after and remove environment log files.\r\n\r\nTo clean up this mess, I would ban use of the word \"Flush\" and:\r\n\r\n- Rename Batch::Flush to Batch::Checkpoint and rename Database::Flush to Database::CloseIfUnused as suggested https://github.com/bitcoin/bitcoin/pull/18971#discussion_r439615919\r\n- Drop Database::Close and have a separate Archive method, or just archive logs automatically when the environment is closed as originally implemented in e172e78f8e4c70b3fe67cb152497f35587e2300c #18971 but then reverted https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-644424649\r\n",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:36:14Z",
      "diff_hunk" : "@@ -130,9 +125,13 @@ class BerkeleyDatabase\n      */\n     bool Backup(const std::string& strDest) const;\n \n-    /** Make sure all changes are flushed to disk.\n+    /** Make sure all changes are flushed to database file.\n+     */\n+    void Flush();\n+    /** Flush to the database file and close the database.\n+     *  Also close the environment if no other databases are open in it.\n      */\n-    void Flush(bool shutdown);\n+    void Close();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444428173",
      "id" : 444428173,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQyODE3Mw==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 134,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.h",
      "position" : null,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444428173",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444428729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444428729"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote: TODO is removed here because it was previously implemented https://github.com/bitcoin/bitcoin/pull/18971#discussion_r432694132",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:37:14Z",
      "diff_hunk" : "@@ -694,22 +702,17 @@ bool BerkeleyDatabase::Backup(const std::string& strDest) const\n     }\n }\n \n-void BerkeleyDatabase::Flush(bool shutdown)\n+void BerkeleyDatabase::Flush()\n {\n     if (!IsDummy()) {\n-        env->Flush(shutdown);\n-        if (shutdown) {\n-            LOCK(cs_db);\n-            g_dbenvs.erase(env->Directory().string());\n-            env = nullptr;\n-        } else {\n-            // TODO: To avoid g_dbenvs.erase erasing the environment prematurely after the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444428729",
      "id" : 444428729,
      "line" : 706,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQyODcyOQ==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 706,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 64,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444428729",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444430775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444430775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote: Erase call was buggy here and is moved to destructor in this commit for reasons described https://github.com/bitcoin/bitcoin/pull/18971#discussion_r436856577",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:40:45Z",
      "diff_hunk" : "@@ -694,22 +702,17 @@ bool BerkeleyDatabase::Backup(const std::string& strDest) const\n     }\n }\n \n-void BerkeleyDatabase::Flush(bool shutdown)\n+void BerkeleyDatabase::Flush()\n {\n     if (!IsDummy()) {\n-        env->Flush(shutdown);\n-        if (shutdown) {\n-            LOCK(cs_db);\n-            g_dbenvs.erase(env->Directory().string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444430775",
      "id" : 444430775,
      "line" : 703,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQzMDc3NQ==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 703,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 61,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444430775",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444431566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444431566"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote: m_fileids.erase is moving to ~Database destructor in this commit for reasons described https://github.com/bitcoin/bitcoin/pull/18971#discussion_r436976128",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:42:01Z",
      "diff_hunk" : "@@ -694,22 +702,17 @@ bool BerkeleyDatabase::Backup(const std::string& strDest) const\n     }\n }\n \n-void BerkeleyDatabase::Flush(bool shutdown)\n+void BerkeleyDatabase::Flush()\n {\n     if (!IsDummy()) {\n-        env->Flush(shutdown);\n-        if (shutdown) {\n-            LOCK(cs_db);\n-            g_dbenvs.erase(env->Directory().string());\n-            env = nullptr;\n-        } else {\n-            // TODO: To avoid g_dbenvs.erase erasing the environment prematurely after the\n-            // first database shutdown when multiple databases are open in the same\n-            // environment, should replace raw database `env` pointers with shared or weak\n-            // pointers, or else separate the database and environment shutdowns so\n-            // environments can be shut down after databases.\n-            env->m_fileids.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444431566",
      "id" : 444431566,
      "line" : 711,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQzMTU2Ng==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 711,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 69,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444431566",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444431831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444431831"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move BerkeleyDatabase::Flush(true) to Close()\" (da7ac55e65926d7c0ef9b4ad8afaf96468d9574b)\r\n\r\nNote for future cleanup, this destructor should be calling CloseDb and asserting !m_db here https://github.com/bitcoin/bitcoin/pull/18971#discussion_r437012889 to make sure the database is actually closed",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T18:42:28Z",
      "diff_hunk" : "@@ -324,6 +324,14 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n     dbenv->lsn_reset(strFile.c_str(), 0);\n }\n \n+BerkeleyDatabase::~BerkeleyDatabase()\n+{\n+    if (env) {\n+        size_t erased = env->m_databases.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444431831",
      "id" : 444431831,
      "line" : 331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQzMTgzMQ==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 331,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 8,
      "pull_request_review_id" : 436031185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444431831",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444483245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444483245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I would prefer to keep the naming and move to make the functions actually do as the names suggest. Since the goal is to have a standard interface, changing the names to match the craziness we have for BDB seems counterproductive. For example, in #19077, Flush and Close do work as you would expect.\r\n\r\nI think many of these issues stem from the fact that we allow multiple BerkeleyDatabases for one BerkeleyEnvironment. I think if we stopped doing that, we would be able to make Flush and Close behave in the ways that we expect.",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-06-23T20:20:12Z",
      "diff_hunk" : "@@ -130,9 +125,13 @@ class BerkeleyDatabase\n      */\n     bool Backup(const std::string& strDest) const;\n \n-    /** Make sure all changes are flushed to disk.\n+    /** Make sure all changes are flushed to database file.\n+     */\n+    void Flush();\n+    /** Flush to the database file and close the database.\n+     *  Also close the environment if no other databases are open in it.\n      */\n-    void Flush(bool shutdown);\n+    void Close();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r444483245",
      "id" : 444483245,
      "in_reply_to_id" : 444428173,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4MzI0NQ==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 134,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.h",
      "position" : null,
      "pull_request_review_id" : 436124485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444483245",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Many of the suggested cleanups are done in #19335 (as I suspect you already know)",
      "created_at" : "2020-06-23T20:21:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#issuecomment-648397000",
      "id" : 648397000,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19334",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODM5NzAwMA==",
      "updated_at" : "2020-06-23T20:22:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648397000",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-01T14:25:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#issuecomment-652450340",
      "id" : 652450340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19334",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjQ1MDM0MA==",
      "updated_at" : "2020-07-01T14:25:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652450340",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-05T22:38:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#issuecomment-653947714",
      "id" : 653947714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19334",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1Mzk0NzcxNA==",
      "updated_at" : "2020-07-05T22:38:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653947714",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450421287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450421287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b46a69556d4c42245b60eeb4ff00ddc070669fd4:  this destructor is now called from a place that _did_ have a `cs_db` lock: https://github.com/bitcoin/bitcoin/pull/19334/commits/b46a69556d4c42245b60eeb4ff00ddc070669fd4#diff-f9e31f5caede7a3aa7106793ffa1e1eaL702",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-07-06T19:00:31Z",
      "diff_hunk" : "@@ -324,6 +324,14 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n     dbenv->lsn_reset(strFile.c_str(), 0);\n }\n \n+BerkeleyDatabase::~BerkeleyDatabase()\n+{\n+    if (env) {\n+        size_t erased = env->m_databases.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450421287",
      "id" : 450421287,
      "in_reply_to_id" : 444411657,
      "line" : 331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQyMTI4Nw==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 331,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 8,
      "pull_request_review_id" : 443334062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450421287",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450432172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450432172"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ae35e09495db8f5dea407053aebc05515f172469  nit : `Make a DatabaseBatch`",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-07-06T19:23:14Z",
      "diff_hunk" : "@@ -107,4 +111,60 @@ class DatabaseBatch\n     virtual bool TxnAbort() = 0;\n };\n \n+/** An instance of this class represents one database.\n+ **/\n+class WalletDatabase\n+{\n+public:\n+    /** Create dummy DB handle */\n+    WalletDatabase() : nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0) {}\n+    virtual ~WalletDatabase() {};\n+\n+    /** Open the database if it is not already opened. */\n+    virtual void Open(const char* mode) = 0;\n+\n+    //! Counts the number of active database users to be sure that the database is not closed while someone is using it\n+    std::atomic<int> m_refcount{0};\n+    /** Indicate the a new database user has began using the database. Increments m_refcount */\n+    virtual void AddRef() = 0;\n+    /** Indicate that database user has stopped using the database and that it could be flushed or closed. Decrement m_refcount */\n+    virtual void RemoveRef() = 0;\n+\n+    /** Rewrite the entire database on disk, with the exception of key pszSkip if non-zero\n+     */\n+    virtual bool Rewrite(const char* pszSkip=nullptr) = 0;\n+\n+    /** Back up the entire database to a file.\n+     */\n+    virtual bool Backup(const std::string& strDest) const = 0;\n+\n+    /** Make sure all changes are flushed to database file.\n+     */\n+    virtual void Flush() = 0;\n+    /** Flush to the database file and close the database.\n+     *  Also close the environment if no other databases are open in it.\n+     */\n+    virtual void Close() = 0;\n+    /* flush the wallet passively (TRY_LOCK)\n+       ideal to be called periodically */\n+    virtual bool PeriodicFlush() = 0;\n+\n+    virtual void IncrementUpdateCounter() = 0;\n+\n+    virtual void ReloadDbEnv() = 0;\n+\n+    std::atomic<unsigned int> nUpdateCounter;\n+    unsigned int nLastSeen;\n+    unsigned int nLastFlushed;\n+    int64_t nLastWalletUpdate;\n+\n+    /** Verifies the environment and database file */\n+    virtual bool Verify(bilingual_str& error) = 0;\n+\n+    std::string m_file_path;\n+\n+    /** Make a BerkeleyBatch connected to this database */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450432172",
      "id" : 450432172,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQzMjE3Mg==",
      "original_commit_id" : "ae35e09495db8f5dea407053aebc05515f172469",
      "original_line" : 166,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 443334062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450432172",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450507636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450507636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-07-06T22:15:42Z",
      "diff_hunk" : "@@ -107,4 +111,60 @@ class DatabaseBatch\n     virtual bool TxnAbort() = 0;\n };\n \n+/** An instance of this class represents one database.\n+ **/\n+class WalletDatabase\n+{\n+public:\n+    /** Create dummy DB handle */\n+    WalletDatabase() : nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0) {}\n+    virtual ~WalletDatabase() {};\n+\n+    /** Open the database if it is not already opened. */\n+    virtual void Open(const char* mode) = 0;\n+\n+    //! Counts the number of active database users to be sure that the database is not closed while someone is using it\n+    std::atomic<int> m_refcount{0};\n+    /** Indicate the a new database user has began using the database. Increments m_refcount */\n+    virtual void AddRef() = 0;\n+    /** Indicate that database user has stopped using the database and that it could be flushed or closed. Decrement m_refcount */\n+    virtual void RemoveRef() = 0;\n+\n+    /** Rewrite the entire database on disk, with the exception of key pszSkip if non-zero\n+     */\n+    virtual bool Rewrite(const char* pszSkip=nullptr) = 0;\n+\n+    /** Back up the entire database to a file.\n+     */\n+    virtual bool Backup(const std::string& strDest) const = 0;\n+\n+    /** Make sure all changes are flushed to database file.\n+     */\n+    virtual void Flush() = 0;\n+    /** Flush to the database file and close the database.\n+     *  Also close the environment if no other databases are open in it.\n+     */\n+    virtual void Close() = 0;\n+    /* flush the wallet passively (TRY_LOCK)\n+       ideal to be called periodically */\n+    virtual bool PeriodicFlush() = 0;\n+\n+    virtual void IncrementUpdateCounter() = 0;\n+\n+    virtual void ReloadDbEnv() = 0;\n+\n+    std::atomic<unsigned int> nUpdateCounter;\n+    unsigned int nLastSeen;\n+    unsigned int nLastFlushed;\n+    int64_t nLastWalletUpdate;\n+\n+    /** Verifies the environment and database file */\n+    virtual bool Verify(bilingual_str& error) = 0;\n+\n+    std::string m_file_path;\n+\n+    /** Make a BerkeleyBatch connected to this database */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450507636",
      "id" : 450507636,
      "in_reply_to_id" : 450432172,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNzYzNg==",
      "original_commit_id" : "ae35e09495db8f5dea407053aebc05515f172469",
      "original_line" : 166,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 443441198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450507636",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450507707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450507707"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added the lock back.",
      "commit_id" : "4c5ab9dce54fdfc83141a793ffffef401a9ea7db",
      "created_at" : "2020-07-06T22:15:52Z",
      "diff_hunk" : "@@ -324,6 +324,14 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n     dbenv->lsn_reset(strFile.c_str(), 0);\n }\n \n+BerkeleyDatabase::~BerkeleyDatabase()\n+{\n+    if (env) {\n+        size_t erased = env->m_databases.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#discussion_r450507707",
      "id" : 450507707,
      "in_reply_to_id" : 444411657,
      "line" : 331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNzcwNw==",
      "original_commit_id" : "da7ac55e65926d7c0ef9b4ad8afaf96468d9574b",
      "original_line" : 331,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 8,
      "pull_request_review_id" : 443441287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19334",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T22:15:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450507707",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-08T23:41:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19334#issuecomment-655812991",
      "id" : 655812991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19334",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTgxMjk5MQ==",
      "updated_at" : "2020-07-08T23:41:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655812991",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
