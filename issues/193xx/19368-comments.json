[
   {
      "author_association" : "MEMBER",
      "body" : "Oh nice. Does that mean we can enable the tests again?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/67881de0e3b1cef1d0f978582765a8aeeb09c21a/ci/test/00_setup_env_mac_host.sh#L14",
      "created_at" : "2020-06-25T11:01:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19368#issuecomment-649469706",
      "id" : 649469706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTQ2OTcwNg==",
      "updated_at" : "2020-06-25T11:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/649469706",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke oh, I didn't even know we had already experienced this problem, I thought it's just me ð  I've looked at the comment and related travis logs and indeed the error is the same as in my stacktrace. \r\n\r\nFrom what I understood the behaviour we see on macOS is similar to `BrokenPipeError` and `ConnectionResetError` on linux/BSD, it's also triggered by reset connection. So It's reasonable to expect that the same workaround (reconnect and retry) would work. Though it is still a mystery to me why the connection would be reset in the first place, but I'm afraid that's beyond my understanding.\r\n\r\nI think we can try to enable the tests again. Would you suggest to have some prior discussion on IRC maybe or just re-enable the tests in this PR and let reviewers decide?",
      "created_at" : "2020-06-26T02:29:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19368#issuecomment-649915885",
      "id" : 649915885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTkxNTg4NQ==",
      "updated_at" : "2020-06-26T02:29:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/649915885",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  just re-enable the tests in this PR and let reviewers decide?\r\n\r\nThat seems fine",
      "created_at" : "2020-06-26T11:59:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19368#issuecomment-650141402",
      "id" : 650141402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MDE0MTQwMg==",
      "updated_at" : "2020-06-26T11:59:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/650141402",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19368#discussion_r447035286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447035286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~~Why remove the catch for `subprocess.SubprocessError`?~~\r\nEdit: I understand now, the semantics of `subprocess.run` are different in that it never raises `subprocess.SubProcesserror`,  so this is enough to keep the same behavior as before.",
      "commit_id" : "3a7e79478ab41af7c53ce14d9fca9815bffe1f73",
      "created_at" : "2020-06-29T14:56:18Z",
      "diff_hunk" : "@@ -396,11 +396,12 @@ def run_tests(*, test_list, src_dir, build_dir, tmpdir, jobs=1, enable_coverage=\n     args = args or []\n \n     # Warn if bitcoind is already running\n-    # pidof might fail or return an empty string if bitcoind is not running\n     try:\n-        if subprocess.check_output([\"pidof\", \"bitcoind\"]) not in [b'']:\n+        # pgrep exits with code zero when one or more matching processes found\n+        if subprocess.run([\"pgrep\", \"-x\", \"bitcoind\"], stdout=subprocess.DEVNULL).returncode == 0:\n             print(\"%sWARNING!%s There is already a bitcoind process running on this system. Tests may fail unexpectedly due to resource contention!\" % (BOLD[1], BOLD[0]))\n-    except (OSError, subprocess.SubprocessError):\n+    except OSError:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19368#discussion_r447035286",
      "id" : 447035286,
      "line" : 403,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzNTI4Ng==",
      "original_commit_id" : "8cf9d15b823d91d2a74fc83832fccca2219342c9",
      "original_line" : 403,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 11,
      "pull_request_review_id" : 439228533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19368",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-29T14:58:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447035286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 3a7e79478ab41af7c53ce14d9fca9815bffe1f73\r\nVerified that the `pgrep` works on FreeBSD whereas `pidof` does not. It's somewhat of a pity that we need to rely on a shell commend being present here at all, but for this single optional check it's also not worth introducing an dependency on, say, the `psutil` module.",
      "created_at" : "2020-06-29T15:02:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19368#issuecomment-651179138",
      "id" : 651179138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE3OTEzOA==",
      "updated_at" : "2020-06-29T15:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651179138",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Though it is still a mystery to me why the connection would be reset in the first place, but I'm afraid that's beyond my understanding.\r\n\r\nThere are various edge cases where a connection reset can happen. For example at shutdown it's not guaranteed that `stop` RPC command  will return a value. It usually does, but on a busy system it might not, and the RPC server is shut down before it manages to send the reply.\r\n",
      "created_at" : "2020-06-29T15:07:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19368#issuecomment-651181663",
      "id" : 651181663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE4MTY2Mw==",
      "updated_at" : "2020-06-29T15:07:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651181663",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
