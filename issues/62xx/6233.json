{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This prevents an edge case where a block downloaded and pruned\nin-between successive calls to FindNextBlocksToDownload could\ncause the block to be unnecessarily re-requested.\n\nThe issue is that pindexLastCommonBlock is only updated on calls\nto FindNextBlocksToDownload, by starting at its prior value and then\nadvancing forward until we encounter a block for which we don't \nHAVE_DATA (which we then try to request).\n\nDuring initial block download, it's possible for the tip to advance by \nmany blocks during a single call to ActivateBestChain (since blocks \narrive out of order, when a block comes in that completes a long \nsequence, then we'll see many tip updates in a row).  If a long enough \nsequence of tip updates occurs, then it's possible that the block\nthat just arrived could be pruned at the end of processing, before \nFindNextBlocksToDownload can be called for any other peers.  This\nin turn would cause us to re-request the block from one of those peers,\nsince we'd no longer HAVE_DATA for it.\n\nSince blocks in chainActive never need to be re-downloaded, this\npull should prevent pruning nodes from ever re-requesting blocks in this\nsituation, while still allowing for pruning nodes to redownload blocks\nthat may have been previously pruned but are needed for a reorg (this \nis exercised in `pruning.py`, which this pull passes).\n",
   "closed_at" : "2015-06-25T14:37:02Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 6,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6233/comments",
   "created_at" : "2015-06-04T19:26:55Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6233/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/6233",
   "id" : 85240937,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6233/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MzY5NjkxMTY=",
   "number" : 6233,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/6233.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6233",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/6233.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6233"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Advance pindexLastCommonBlock for blocks in chainActive",
   "updated_at" : "2015-06-25T14:42:57Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6233",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
      "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sdaftuar/followers",
      "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sdaftuar",
      "id" : 7463573,
      "login" : "sdaftuar",
      "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
      "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
      "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
      "repos_url" : "https://api.github.com/users/sdaftuar/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sdaftuar"
   }
}
