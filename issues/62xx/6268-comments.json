[
   {
      "body" : "Just checked and right: `generate` does not use `keepKey()`.\r\nPR #5994 would fix this (next to decoupling wallet / miner). I'm also happy to write a standalone-fix for this issue if no one already started.",
      "created_at" : "2015-06-10T19:33:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-110886680",
      "id" : 110886680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-06-10T19:33:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110886680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I think this was done on purpose, to avoid having to generate a new key for each block and thus speed up generation. @sipa do you remember?\r\n\r\nEdit: but of course, if you seriously need this, we could just make it a flag.",
      "created_at" : "2015-06-11T08:29:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-111040583",
      "id" : 111040583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-06-11T08:44:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111040583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "If I'm not mistaken, then this was introduced by https://github.com/bitcoin/bitcoin/commit/18379875bf7dd91637e4a206db58cd0968b5d47f.\r\n\r\nFor me this was pretty confusing, because it has an impact on `\"getnewaddress\"`, and the \"new\" address may already have received mined coins. To reproduce in regtest mode, starting from scratch:\r\n```shell\r\n./src/bitcoin-cli \"generate\" 101\r\n[\r\n  # block hashes\r\n]\r\n./src/bitcoin-cli \"listunspent\"\r\n[\r\n  {\r\n    \"txid\": \"b148b7d13c3351875d070d0567855bce47fcc797b3504247c4fcd68d902523ab\",\r\n    \"vout\": 0,\r\n    \"address\": \"mu1ZwmfRH4HHowDrrjSTsqSfMKLBeZkn2a\",\r\n    \"scriptPubKey\": \"2103ad57ff9cd560507938698630455ab926b070add217a3b30aead57cd578b935feac\",\r\n    \"amount\": 50.00000000,\r\n    \"confirmations\": 101,\r\n    \"spendable\": true\r\n  }\r\n]\r\n./src/bitcoin-cli \"getnewaddress\"   # ... or \"getrawchangeaddress\"\r\nmu1ZwmfRH4HHowDrrjSTsqSfMKLBeZkn2a  # the new address isn't empty, but has 50.0 BTC\r\n```\r\n\r\nAdditional coins will be mined to that address, too, if `\"generate\"` is used again.",
      "created_at" : "2015-06-13T23:56:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-111764103",
      "id" : 111764103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-06-13T23:56:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111764103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "body" : "Using the same key for multiple blocks was intentional afaik, not marking it as used at all is not. I'll have a look later.",
      "created_at" : "2015-06-14T12:03:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-111816841",
      "id" : 111816841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-06-14T12:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111816841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Heh, I ran into this exact same bug the other day writing a unit test as well :). Anyway, yea, we should use the same key for multiple blocks since they won't be the same anyway, but we should be keeping the key, otherwise things break :).",
      "created_at" : "2015-06-15T08:28:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-111975975",
      "id" : 111975975,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-06-15T08:28:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111975975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "(Also, I have a fix for this coming in the next frt pull, soon)",
      "created_at" : "2015-06-15T08:28:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-111976013",
      "id" : 111976013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-06-15T08:28:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111976013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "This was fixed in https://github.com/bitcoin/bitcoin/commit/5496253966abec287ea61a648cb518d14903f91f#diff-c2c990fee1c3381462640e80ae7db0d0L168",
      "created_at" : "2015-07-17T23:10:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-122441304",
      "id" : 122441304,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-07-17T23:10:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/122441304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Thanks for noticing @TheBlueMatt ",
      "created_at" : "2015-07-21T10:48:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6268#issuecomment-123260662",
      "id" : 123260662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6268",
      "updated_at" : "2015-07-21T10:48:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/123260662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
