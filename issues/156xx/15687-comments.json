[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r270115880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270115880"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use single quotes here like the rest of the file.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-03-28T17:26:08Z",
      "diff_hunk" : "@@ -36,8 +39,29 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, \"regtest\", \"wallets\", \"wallet.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r270115880",
      "id" : 270115880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDExNTg4MA==",
      "original_commit_id" : "6d9b033e3d2261d753f29b8c970583978c595430",
      "original_position" : 22,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 220167521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270115880",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2019-03-28T18:48:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-477725049",
      "id" : 477725049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NzcyNTA0OQ==",
      "updated_at" : "2019-05-29T10:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/477725049",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r270194549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270194549"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: instead of logging the timestamps and whether they changed, you might use `assert_equal` (or explicitly comment it out, if it currently fails)",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-03-28T20:52:32Z",
      "diff_hunk" : "@@ -36,8 +39,29 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, \"regtest\", \"wallets\", \"wallet.dat\")\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        ba = bytearray(128*1024)\n+        mv = memoryview(ba)\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))\n+        return timestamp\n \n+    def log_wallet_timestamp_comparison(self, new, old):\n+        result = 'unchanged' if new == old else 'increased! **FIX ME**'\n+        self.log.info('Wallet file timestamp {0}\\n'.format(result))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r270194549",
      "id" : 270194549,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDE5NDU0OQ==",
      "original_commit_id" : "6d9b033e3d2261d753f29b8c970583978c595430",
      "original_position" : 40,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 220267894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270194549",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r270194858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270194858"
         }
      },
      "author_association" : "MEMBER",
      "body" : "TODO's shouldn't be logged, but added as inline comments",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-03-28T20:53:28Z",
      "diff_hunk" : "@@ -46,9 +70,23 @@ def run_test(self):\n         self.assert_raises_tool_error('Error loading wallet.dat. Is wallet being used by other process?', '-wallet=wallet.dat', 'info')\n         self.assert_raises_tool_error('Error: no wallet file at nonexistent.dat', '-wallet=nonexistent.dat', 'info')\n \n-        # stop the node to close the wallet to call info command\n+        # Stop the node to close the wallet to call the info command.\n+        self.log.info('Stop node\\n')\n         self.stop_node(0)\n \n+        # Wallet tool info should work with wallet file permissions set to read-only.\n+        # This needs to be fixed.\n+        self.log.info('Set wallet file permissions to read-only')\n+        os.chmod(self.wallet_path(), 0o400)\n+        self.log.info('Call wallet tool info')\n+        self.assert_raises_tool_error('Error loading . Is wallet being used by another process?', 'info')\n+        self.log.info('Wallet tool info command raises loading error! **FIX ME**')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r270194858",
      "id" : 270194858,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDE5NDg1OA==",
      "original_commit_id" : "6d9b033e3d2261d753f29b8c970583978c595430",
      "original_position" : 62,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 220268348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270194858",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r271350408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271350408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for reviewing! I added both logs and assertions with the logs serving as a sanity check for the assertions. Based on your feedback, I switched the assertions from passing ones that need to be inverted, to failing ones that need to be uncommented.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-04-02T14:59:30Z",
      "diff_hunk" : "@@ -36,8 +39,29 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, \"regtest\", \"wallets\", \"wallet.dat\")\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        ba = bytearray(128*1024)\n+        mv = memoryview(ba)\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))\n+        return timestamp\n \n+    def log_wallet_timestamp_comparison(self, new, old):\n+        result = 'unchanged' if new == old else 'increased! **FIX ME**'\n+        self.log.info('Wallet file timestamp {0}\\n'.format(result))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r271350408",
      "id" : 271350408,
      "in_reply_to_id" : 270194549,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MTM1MDQwOA==",
      "original_commit_id" : "6d9b033e3d2261d753f29b8c970583978c595430",
      "original_position" : 40,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 221716094,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271350408",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r271351032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271351032"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. Waiting for Travis CI to pass locally and then will push a rebased update.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-04-02T15:00:34Z",
      "diff_hunk" : "@@ -46,9 +70,23 @@ def run_test(self):\n         self.assert_raises_tool_error('Error loading wallet.dat. Is wallet being used by other process?', '-wallet=wallet.dat', 'info')\n         self.assert_raises_tool_error('Error: no wallet file at nonexistent.dat', '-wallet=nonexistent.dat', 'info')\n \n-        # stop the node to close the wallet to call info command\n+        # Stop the node to close the wallet to call the info command.\n+        self.log.info('Stop node\\n')\n         self.stop_node(0)\n \n+        # Wallet tool info should work with wallet file permissions set to read-only.\n+        # This needs to be fixed.\n+        self.log.info('Set wallet file permissions to read-only')\n+        os.chmod(self.wallet_path(), 0o400)\n+        self.log.info('Call wallet tool info')\n+        self.assert_raises_tool_error('Error loading . Is wallet being used by another process?', 'info')\n+        self.log.info('Wallet tool info command raises loading error! **FIX ME**')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r271351032",
      "id" : 271351032,
      "in_reply_to_id" : 270194858,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MTM1MTAzMg==",
      "original_commit_id" : "6d9b033e3d2261d753f29b8c970583978c595430",
      "original_position" : 62,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 221716865,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271351032",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Lowered the buffer size for the shasum function to 16Kb and hoisted that value to a constant. Rebased.\r\n\r\nThis should be ready for review.",
      "created_at" : "2019-04-05T11:19:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-480239739",
      "id" : 480239739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDIzOTczOQ==",
      "updated_at" : "2019-04-05T11:19:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480239739",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r294304432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/294304432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I understand surrounding the `info` methods, but what is the logic here? creating a wallet that already exists should leave it untouched?",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-06-17T13:44:37Z",
      "diff_hunk" : "@@ -87,15 +161,32 @@ def run_test(self):\n             Address Book: 0\n         ''')\n         self.assert_tool_output(out, '-wallet=foo', 'create')\n-\n+        shasum_after = self.wallet_shasum()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r294304432",
      "id" : 294304432,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NDMwNDQzMg==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 137,
      "path" : "test/functional/tool_wallet.py",
      "position" : 149,
      "pull_request_review_id" : 250503590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/294304432",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks good to me\r\nACK 96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "created_at" : "2019-06-17T13:45:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-502688526",
      "id" : 502688526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMjY4ODUyNg==",
      "updated_at" : "2019-06-17T13:45:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/502688526",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296843161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296843161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: Could be a \"const\" member, set in the first line of `run_test`?\r\n\r\n```py\r\nself.wallet_path = os.path.join(...",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-06-24T17:55:21Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296843161",
      "id" : 296843161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njg0MzE2MQ==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 25,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 253566459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296843161",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296846078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296846078"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: Is it required to log the timestamp in a simple getter method? I'd prefer if it was logged by the caller or just asserted (Looks like you already do both of that)",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-06-24T18:02:16Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        mv = memoryview(bytearray(BUFFER_SIZE))\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296846078",
      "id" : 296846078,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njg0NjA3OA==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 37,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 253566459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296846078",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296846588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296846588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You aren't verifying anything here, it seems. I'd prefer if this was just a simple getter util method and the caller logs/asserts if appropriate.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-06-24T18:03:32Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        mv = memoryview(bytearray(BUFFER_SIZE))\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))\n+        return timestamp\n \n+    def log_wallet_permissions(self):\n+        result = oct(os.lstat(self.wallet_path()).st_mode)[-3:]\n+        self.log.info('Verifying wallet file permissions: {}'.format(result))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296846588",
      "id" : 296846588,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njg0NjU4OA==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 42,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 253566459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296846588",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296847292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296847292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This looks like a test-dev debug statement. Maybe use `self.log.debug`?",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-06-24T18:05:18Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        mv = memoryview(bytearray(BUFFER_SIZE))\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))\n+        return timestamp\n \n+    def log_wallet_permissions(self):\n+        result = oct(os.lstat(self.wallet_path()).st_mode)[-3:]\n+        self.log.info('Verifying wallet file permissions: {}'.format(result))\n+\n+    def log_wallet_timestamp_comparison(self, old, new):\n+        result = 'unchanged' if new == old else 'increased!'\n+        self.log.info('Wallet file timestamp {}\\n'.format(result))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296847292",
      "id" : 296847292,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njg0NzI5Mg==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 46,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 253566459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296847292",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296848599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296848599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like you are overwriting a previous symbol with the same name. I think it is clearer to split the tests into smaller ones, so that overwriting does not happen. I.e.\r\n\r\n```py\r\n  self run_test(self):\r\n   self.run_test_foo_bar()\r\n   self.run_test_gen_tx()\r\n\r\n  def run_test_foo_bar(self):\r\n    assert True\r\n\r\n...",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-06-24T18:08:41Z",
      "diff_hunk" : "@@ -59,12 +101,32 @@ def run_test(self):\n             Address Book: 3\n         ''')\n         self.assert_tool_output(out, '-wallet=wallet.dat', 'info')\n-\n-        # mutate the wallet to check the info command output changes accordingly\n+        shasum_after = self.wallet_shasum()\n+        timestamp_after = self.wallet_timestamp(' after info')\n+        self.log.info('Setting wallet file permissions to read/write')\n+        os.chmod(self.wallet_path(), stat.S_IRUSR | stat.S_IWUSR) # Set wallet permissions to 600\n+        self.log_wallet_permissions()\n+        assert_equal(shasum_before, shasum_after)\n+        self.log.info('Wallet file shasum unchanged')\n+        self.log_wallet_timestamp_comparison(timestamp_before, timestamp_after)\n+        #\n+        # TODO: Wallet tool info should not write to the wallet file.\n+        # This assertion should be uncommented and succeed:\n+        # assert_equal(timestamp_before, timestamp_after)\n+\n+        # Mutate the wallet to verify that the info command output changes accordingly.\n+        self.log.info('Starting node')\n         self.start_node(0)\n+\n+        self.log.info('Generating transaction to mutate wallet')\n         self.nodes[0].generate(1)\n+\n+        self.log.info('Stopping node\\n')\n         self.stop_node(0)\n \n+        self.log.info('Calling wallet tool info after generating a transaction')\n+        shasum_before = self.wallet_shasum()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r296848599",
      "id" : 296848599,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njg0ODU5OQ==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 106,
      "path" : "test/functional/tool_wallet.py",
      "position" : 114,
      "pull_request_review_id" : 253566459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296848599",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299653789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299653789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-02T19:43:05Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299653789",
      "id" : 299653789,
      "in_reply_to_id" : 296843161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTY1Mzc4OQ==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 25,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 257110066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299653789",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299654108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299654108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-02T19:43:58Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        mv = memoryview(bytearray(BUFFER_SIZE))\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299654108",
      "id" : 299654108,
      "in_reply_to_id" : 296846078,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTY1NDEwOA==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 37,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 257110463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299654108",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299654541"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299654541"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-02T19:45:16Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        mv = memoryview(bytearray(BUFFER_SIZE))\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))\n+        return timestamp\n \n+    def log_wallet_permissions(self):\n+        result = oct(os.lstat(self.wallet_path()).st_mode)[-3:]\n+        self.log.info('Verifying wallet file permissions: {}'.format(result))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299654541",
      "id" : 299654541,
      "in_reply_to_id" : 296846588,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTY1NDU0MQ==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 42,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 257111022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299654541",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299655015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299655015"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done, switched to loglevel `debug` for all the timestamp and shasum logging.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-02T19:46:26Z",
      "diff_hunk" : "@@ -36,8 +42,32 @@ def assert_tool_output(self, output, *args):\n         assert_equal(stderr, '')\n         assert_equal(stdout, output)\n \n-    def run_test(self):\n+    def wallet_path(self):\n+        return os.path.join(self.nodes[0].datadir, 'regtest', 'wallets', 'wallet.dat')\n+\n+    def wallet_shasum(self):\n+        h = hashlib.sha1()\n+        mv = memoryview(bytearray(BUFFER_SIZE))\n+        with open(self.wallet_path(), 'rb', buffering=0) as f:\n+            for n in iter(lambda : f.readinto(mv), 0):\n+                h.update(mv[:n])\n+        return h.hexdigest()\n+\n+    def wallet_timestamp(self, op):\n+        timestamp = os.path.getmtime(self.wallet_path())\n+        self.log.info('Wallet file timestamp {0}: {1}'.format(op, timestamp))\n+        return timestamp\n \n+    def log_wallet_permissions(self):\n+        result = oct(os.lstat(self.wallet_path()).st_mode)[-3:]\n+        self.log.info('Verifying wallet file permissions: {}'.format(result))\n+\n+    def log_wallet_timestamp_comparison(self, old, new):\n+        result = 'unchanged' if new == old else 'increased!'\n+        self.log.info('Wallet file timestamp {}\\n'.format(result))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299655015",
      "id" : 299655015,
      "in_reply_to_id" : 296847292,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTY1NTAxNQ==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 46,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 257111583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299655015",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299655199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299655199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-02T19:46:56Z",
      "diff_hunk" : "@@ -59,12 +101,32 @@ def run_test(self):\n             Address Book: 3\n         ''')\n         self.assert_tool_output(out, '-wallet=wallet.dat', 'info')\n-\n-        # mutate the wallet to check the info command output changes accordingly\n+        shasum_after = self.wallet_shasum()\n+        timestamp_after = self.wallet_timestamp(' after info')\n+        self.log.info('Setting wallet file permissions to read/write')\n+        os.chmod(self.wallet_path(), stat.S_IRUSR | stat.S_IWUSR) # Set wallet permissions to 600\n+        self.log_wallet_permissions()\n+        assert_equal(shasum_before, shasum_after)\n+        self.log.info('Wallet file shasum unchanged')\n+        self.log_wallet_timestamp_comparison(timestamp_before, timestamp_after)\n+        #\n+        # TODO: Wallet tool info should not write to the wallet file.\n+        # This assertion should be uncommented and succeed:\n+        # assert_equal(timestamp_before, timestamp_after)\n+\n+        # Mutate the wallet to verify that the info command output changes accordingly.\n+        self.log.info('Starting node')\n         self.start_node(0)\n+\n+        self.log.info('Generating transaction to mutate wallet')\n         self.nodes[0].generate(1)\n+\n+        self.log.info('Stopping node\\n')\n         self.stop_node(0)\n \n+        self.log.info('Calling wallet tool info after generating a transaction')\n+        shasum_before = self.wallet_shasum()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299655199",
      "id" : 299655199,
      "in_reply_to_id" : 296848599,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTY1NTE5OQ==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 106,
      "path" : "test/functional/tool_wallet.py",
      "position" : 114,
      "pull_request_review_id" : 257111799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299655199",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299656330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299656330"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, updated test name and logging to clarify that a bit. Happy to remove if you reckon it isn't a useful safeguard while fixing the issue.",
      "commit_id" : "7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-02T19:50:00Z",
      "diff_hunk" : "@@ -87,15 +161,32 @@ def run_test(self):\n             Address Book: 0\n         ''')\n         self.assert_tool_output(out, '-wallet=foo', 'create')\n-\n+        shasum_after = self.wallet_shasum()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#discussion_r299656330",
      "id" : 299656330,
      "in_reply_to_id" : 294304432,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTY1NjMzMA==",
      "original_commit_id" : "96e69a2ace8b0db496a0c429f05ccd5cb2f39c94",
      "original_position" : 137,
      "path" : "test/functional/tool_wallet.py",
      "position" : 149,
      "pull_request_review_id" : 257113217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15687",
      "updated_at" : "2019-07-08T11:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299656330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Linter is complaining about unused code because it is in the commented-out tests and Appveyor seems to keep file perms at 666. Reworking.",
      "created_at" : "2019-07-02T20:19:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-507829580",
      "id" : 507829580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNzgyOTU4MA==",
      "updated_at" : "2019-07-08T10:11:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507829580",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review @laanwj and @MarcoFalke. I've pushed rebased commits that address your feedback. Are you able to rereview/retest?",
      "created_at" : "2019-07-08T10:10:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-509165722",
      "id" : 509165722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwOTE2NTcyMg==",
      "updated_at" : "2019-07-08T10:10:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/509165722",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review ACK 7195fa792fcc19e9c064c4e38814c3b46a210b34",
      "created_at" : "2019-07-08T12:56:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-509214110",
      "id" : 509214110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwOTIxNDExMA==",
      "updated_at" : "2019-07-08T12:56:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/509214110",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The lone Travis failure appears to be an unrelated `wait_until` timeout > 60 sec in `feature_block.py`.\r\n",
      "created_at" : "2019-07-08T16:29:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15687#issuecomment-509297462",
      "id" : 509297462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwOTI5NzQ2Mg==",
      "updated_at" : "2019-07-08T16:29:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/509297462",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
