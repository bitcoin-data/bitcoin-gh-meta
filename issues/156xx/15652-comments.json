[
   {
      "author_association" : "MEMBER",
      "body" : "If it's the right fix then it needs:\r\n - update to functional test\r\n - backport to 0.17 and 0.18.",
      "created_at" : "2019-03-23T10:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475857449",
      "id" : 475857449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg1NzQ0OQ==",
      "updated_at" : "2019-03-23T10:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475857449",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do we also need to think about how this interacts with restoring the mempool from disk? e.g. is there a race condition where some transactions being loaded would be missed?",
      "created_at" : "2019-03-23T10:15:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475857634",
      "id" : 475857634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg1NzYzNA==",
      "updated_at" : "2019-03-23T10:15:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475857634",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "IIUC if the mempool is loaded after `postInitProcess` then `TransactionAddedToMempool` is already called.",
      "created_at" : "2019-03-23T10:21:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475858068",
      "id" : 475858068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg1ODA2OA==",
      "updated_at" : "2019-03-23T10:51:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475858068",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ordering checks out:\r\n\r\n- `CWallet::postInitProcess()` is called first: current mempool will be used, wallet will be notified when transactions added to mempool in `LoadMempool()`\r\n - `LoadMempool()` called first:  `CWallet::postInitProcess()` will process all the transactions\r\n\r\nAs for concurrency:\r\n\r\n`CWallet::postInitProcess()` locks the mempool for the duration of loading transactions from it. `LoadMempool()` locks the mempool for every individual transaction inserted. This means that it is posible for `CWallet::postInitProcess()` to be called *while* the mempool is being loaded. If it manages to get the lock, it will process the current transactions in the mempool, potentially partially complete.\r\n\r\nIs the wallet already registered at this point (before `CWallet::postInitProcess()`) for receiving `TransactionAddedToMempool ` events? If so, there is no race, but it might get some transactions multiple time (I think that's harmless?), if not, it will start receiving transactions again after registering and miss some in that timeframe.\r\n",
      "created_at" : "2019-03-23T10:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475858541",
      "id" : 475858541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg1ODU0MQ==",
      "updated_at" : "2019-03-23T10:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475858541",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Wallet is registered in `CWallet::CreateWalletFromFile`: https://github.com/bitcoin/bitcoin/blob/7b13c646457980f44599412f243694fa682a1abf/src/wallet/wallet.cpp#L4386\r\nwhich happens before `CWallet::postInitProcess`, so I think there's no race.",
      "created_at" : "2019-03-23T10:38:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475858946",
      "id" : 475858946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg1ODk0Ng==",
      "updated_at" : "2019-03-23T10:38:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475858946",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> but it might get some transactions multiple time (I think that's harmless?)\r\n\r\nI also think that trying to improve that is not worth the pain/complexity. But it may cost a bit for large wallets and a large mempool. I'm happy to followup something to improve that.",
      "created_at" : "2019-03-23T10:43:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475859248",
      "id" : 475859248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg1OTI0OA==",
      "updated_at" : "2019-03-23T10:43:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475859248",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268390608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268390608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, this lock is not at the begin of a scope, could move this to a new `CWallet` member.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-23T10:51:37Z",
      "diff_hunk" : "@@ -4401,6 +4401,12 @@ void CWallet::postInitProcess()\n     // Add wallet transactions that aren't already in a block to mempool\n     // Do this here as mempool requires genesis block to be loaded\n     ReacceptWalletTransactions();\n+\n+    // Update wallet transactions with current mempool transactions.\n+    LOCK(::mempool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268390608",
      "id" : 268390608,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODM5MDYwOA==",
      "original_commit_id" : "3cb4fb15bf0f97a9b40388254d8dc4c7c99868e8",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218035087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268390608",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I also think that trying to improve that is not worth the pain/complexity. But it may cost a bit for large wallets and a large mempool. I'm happy to followup something to improve that.\r\n\r\nI agree (it's not worth handling that explicitly), just wanted to cover all possible scenarios.",
      "created_at" : "2019-03-23T10:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475860211",
      "id" : 475860211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg2MDIxMQ==",
      "updated_at" : "2019-03-23T11:03:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475860211",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Moved the fix to `LoadWallet()`, which is used to dynamically load wallets - and so the startup behavior isn't changed.\r\n\r\nAlso added a test.",
      "created_at" : "2019-03-23T12:54:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475867418",
      "id" : 475867418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg2NzQxOA==",
      "updated_at" : "2019-03-23T12:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475867418",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\n node1 2019-03-23T13:08:34.742866Z POTENTIAL DEADLOCK DETECTED \r\n node1 2019-03-23T13:08:34.742874Z Previous lock order was: \r\n node1 2019-03-23T13:08:34.742883Z  (1) ::mempool.cs  wallet/wallet.cpp:152 \r\n node1 2019-03-23T13:08:34.742898Z  (2) cs_main  interfaces/chain.cpp:264 \r\n node1 2019-03-23T13:08:34.742912Z Current lock order is: \r\n node1 2019-03-23T13:08:34.742921Z  (2) cs_main  init.cpp:1475 \r\n node1 2019-03-23T13:08:34.742934Z  (2) cs_main  validation.cpp:4300 \r\n node1 2019-03-23T13:08:34.742947Z  (1) cs  txmempool.cpp:593 \r\n```",
      "created_at" : "2019-03-23T13:47:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475871120",
      "id" : 475871120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg3MTEyMA==",
      "updated_at" : "2019-03-23T13:47:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475871120",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke fixed.",
      "created_at" : "2019-03-23T16:57:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-475886249",
      "id" : 475886249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTg4NjI0OQ==",
      "updated_at" : "2019-03-23T16:57:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475886249",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268407542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268407542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The wallet module is not allowed to call directly into the node. This should be an interface method.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-23T20:00:13Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        LOCK2(cs_main, ::mempool.cs);\n+        for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268407542",
      "id" : 268407542,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODQwNzU0Mg==",
      "original_commit_id" : "3f70633a8867d47720702b14a2be1254f1d19ebe",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218053827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268407542",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268412591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268412591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, added 51cb2eb and then refactored `LoadWallet` to use it.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-23T23:11:18Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        LOCK2(cs_main, ::mempool.cs);\n+        for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268412591",
      "id" : 268412591,
      "in_reply_to_id" : 268407542,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODQxMjU5MQ==",
      "original_commit_id" : "3f70633a8867d47720702b14a2be1254f1d19ebe",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218059663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268412591",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tested ACK https://github.com/bitcoin/bitcoin/pull/15652/commits/3e31d680c55101c476a4a3db488cd29fb3dbea23, cannot reproduce #15591 with this fix",
      "created_at" : "2019-03-25T08:16:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-476095384",
      "id" : 476095384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NjA5NTM4NA==",
      "updated_at" : "2019-03-25T08:16:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/476095384",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268645607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268645607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could there be a race, since we don't take cs_main when removing txs from the mempool?\r\n\r\nI.e. a tx is first removed due to eviction, the wallet is notified and then it is re-added here.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T13:43:09Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268645607",
      "id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY0NTYwNw==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218334427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268645607",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268647166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268647166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to do this in `postInitProcess`?\r\n\r\nI understand that this is also called when the `createwallet` rpc is called, but the post-init seems useless in that case anyway.\r\n\r\nI'd suggest:\r\n* Remove `postInitProcess` from `createwallet`, because the wallet is fresh and there couldn't be any txs that need to be exchanged between mempool and wallet\r\n* Rename `postInitProcess` to `postLoadProcess`, since it is not needed on init, but on load\r\n* Move the below code into `postLoadProcess` with mempool::cs hold while adding the txs.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T13:46:31Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268647166",
      "id" : 268647166,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY0NzE2Ng==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218334427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268647166",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268657029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268657029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, `postInitProcess` is \"pre dynamic wallet support\". However I'd prefer to refactor in a different PR, this is a bug fix.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T14:07:44Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268657029",
      "id" : 268657029,
      "in_reply_to_id" : 268647166,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY1NzAyOQ==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218349513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268657029",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268659035"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268659035"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed, between `getMemoryPoolTransactions` and `TransactionAddedToMempool` a tx can be evicted.\r\n\r\nI see 2 solutions:\r\n - lock the wallet before the loop so that `TransactionRemovedFromMempool` comes after this\r\n - add a way to lock the mempool in `interfaces::` but not sure if this is wanted? cc @ryanofsky \r\n\r\n",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T14:11:50Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268659035",
      "id" : 268659035,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY1OTAzNQ==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218352071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268659035",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268675190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268675190"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268645607\r\n\r\n> I see 2 solutions:\r\n\r\nI think more ideally the wallet doesn't have knowledge or control of node locks, and can just register for notifications and handle them as they come in. Maybe the `ChainImpl::handleNotifications` method can be changed to something like:\r\n\r\n```c++\r\nstd::unique_ptr<Handler> handleNotifications(Notifications& notifications) override\r\n{\r\n    LOCK2(::cs_main, ::mempool.cs);\r\n    for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {\r\n        notifications.TransactionAddedToMempool(entry.GetSharedTx());\r\n    }\r\n    return MakeUnique<NotificationsHandlerImpl>(*this, notifications);\r\n}\r\n```",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T14:42:57Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268675190",
      "id" : 268675190,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY3NTE5MA==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218372433,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268675190",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268694388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268694388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fine with doing the rename et al. later, but is there any reason not to put it in `postInitProcess`? IIRC it was in there previously in this pull",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T15:16:54Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268694388",
      "id" : 268694388,
      "in_reply_to_id" : 268647166,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY5NDM4OA==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218396008,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268694388",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268695374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268695374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you move the loop into `postInitProcess`, you can just take a `LOCK(::mempool.cs)` in there",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T15:18:41Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268695374",
      "id" : 268695374,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODY5NTM3NA==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218397200,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268695374",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268701521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268701521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, could be moved back there.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T15:29:35Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268701521",
      "id" : 268701521,
      "in_reply_to_id" : 268647166,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODcwMTUyMQ==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 3,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218404645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268701521",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268701941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268701941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke `postInitProcess` is wallet module, should not use that right? https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268407542",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T15:30:19Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268701941",
      "id" : 268701941,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODcwMTk0MQ==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218405174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268701941",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268710750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268710750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, you'd have to move it to the interface\r\n\r\nAlternatively you could add it to `handleNotifications` as suggested by @ryanofsky, but then it would also be called for `createwallet`, which seems a bit wasteful",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T15:46:03Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268710750",
      "id" : 268710750,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODcxMDc1MA==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218415577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268710750",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268712558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268712558"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ryanofsky nice, I thought of something like `replayMemoryPoolNotifications`. However I'm not sure if these notifications should come after `ReacceptWalletTransactions`?",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T15:49:20Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268712558",
      "id" : 268712558,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODcxMjU1OA==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218417690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268712558",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268722954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268722954"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 596f91d20732a1714395e9f6e5d1e6c41f14a2e5:\r\n\r\nCould remove empty hunk to avoid having to solve conflicts in a backport?",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T16:07:42Z",
      "diff_hunk" : "@@ -146,6 +146,7 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268722954",
      "id" : 268722954,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODcyMjk1NA==",
      "original_commit_id" : "596f91d20732a1714395e9f6e5d1e6c41f14a2e5",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218429812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268722954",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15713](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15713.html) (refactor: Replace chain relayTransactions/submitMemoryPool by higher method by ariard)\n* [#15639](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15639.html) (bitcoin-wallet tool: Drop libbitcoin_server.a dependency by ryanofsky)\n* [#15632](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15632.html) (Remove ResendWalletTransactions from the Validation Interface by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-03-25T16:21:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-476272075",
      "id" : 476272075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NjI3MjA3NQ==",
      "updated_at" : "2019-04-01T02:57:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/476272075",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268760261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268760261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure how to solve the deadlock warning. Maybe take cs_wallet before both of these?\r\n\r\n```\r\nnode1 2019-03-25T17:06:10.586193Z Leaving InitialBlockDownload (latching to false) \r\n node1 2019-03-25T17:06:10.586301Z POTENTIAL DEADLOCK DETECTED \r\n node1 2019-03-25T17:06:10.586314Z Previous lock order was: \r\n node1 2019-03-25T17:06:10.586326Z  ::cs_main  interfaces/chain.cpp:372 \r\n node1 2019-03-25T17:06:10.586335Z  (1) ::mempool.cs  interfaces/chain.cpp:372 \r\n node1 2019-03-25T17:06:10.586350Z  cs_main  interfaces/chain.cpp:264 \r\n node1 2019-03-25T17:06:10.586359Z  (2) cs_wallet  wallet/wallet.cpp:1230 \r\n node1 2019-03-25T17:06:10.586386Z Current lock order is: \r\n node1 2019-03-25T17:06:10.586397Z  cs_main  interfaces/chain.cpp:264 \r\n node1 2019-03-25T17:06:10.586406Z  (2) cs_wallet  wallet/wallet.cpp:1871 \r\n node1 2019-03-25T17:06:10.586419Z  (1) pool.cs  validation.cpp:580 ",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T17:20:56Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void notifyMemoryPoolTransactions(Notifications& notifications) override\n+    {\n+        LOCK2(::cs_main, ::mempool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268760261",
      "id" : 268760261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc2MDI2MQ==",
      "original_commit_id" : "12fb550b080fea98fa4f2a4fdd2c7eda9c149806",
      "original_position" : 6,
      "path" : "src/interfaces/chain.cpp",
      "position" : 6,
      "pull_request_review_id" : 218473526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268760261",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268760412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268760412"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could you call this notifyMempoolTransactions? I'd like to converge on _mempool_ spelling rather than _memPool_ or _memoryPool_. Currently we have:\r\n\r\n<pre>\r\nChain::hasDescendantsIn<i>Mempool</i>\r\nChain::<i>mempool</i>MinFee\r\nChain::Notifications::TransactionAddedTo<i>Mempool</i>\r\nChain::Notifications::TransactionRemovedFrom<i>Mempool</i>\r\nChain::Lock::submitTo<i>MemoryPool</i>\r\n</pre>\r\n\r\nso the only existing exception is the `Chain::Lock` method, which I want to go away anyway.\r\n",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T17:21:13Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMemoryPoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268760412",
      "id" : 268760412,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc2MDQxMg==",
      "original_commit_id" : "12fb550b080fea98fa4f2a4fdd2c7eda9c149806",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 218473703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268760412",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268764635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268764635"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268760261\r\n\r\n> Not sure how to solve the deadlock warning. Maybe take cs_wallet before both of these?\r\n\r\nIt looks like you need to do the opposite and release cs_wallet before calling this.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T17:29:02Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void notifyMemoryPoolTransactions(Notifications& notifications) override\n+    {\n+        LOCK2(::cs_main, ::mempool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268764635",
      "id" : 268764635,
      "in_reply_to_id" : 268760261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc2NDYzNQ==",
      "original_commit_id" : "12fb550b080fea98fa4f2a4fdd2c7eda9c149806",
      "original_position" : 6,
      "path" : "src/interfaces/chain.cpp",
      "position" : 6,
      "pull_request_review_id" : 218473703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268764635",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268769208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268769208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268645607\r\n\r\n> Alternatively you could add it to handleNotifications as suggested by @ryanofsky, but then it would also be called for createwallet, which seems a bit wasteful\r\n\r\nAgree, this would be too wasteful. Having the separate method to replay notifications is probably better.\r\n\r\n> I'm not sure if these notifications should come after ReacceptWalletTransactions?\r\n\r\nI'm not 100% sure, but I don't think I see a problem if notifications about what's already in the mempool happen before the wallet adds more transactions to the mempool. I think what you have now basically seems good though.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T17:38:28Z",
      "diff_hunk" : "@@ -146,6 +146,15 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n     AddWallet(wallet);\n     wallet->postInitProcess();\n+\n+    {\n+        // Update wallet transactions with current mempool transactions.\n+        auto locked_chain = chain.lock();\n+        for (const CTransactionRef& tx : locked_chain->getMemoryPoolTransactions()) {\n+            wallet->TransactionAddedToMempool(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268769208",
      "id" : 268769208,
      "in_reply_to_id" : 268645607,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc2OTIwOA==",
      "original_commit_id" : "3e31d680c55101c476a4a3db488cd29fb3dbea23",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 218483678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268769208",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268783330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268783330"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The lock order is `cs_main, cs_wallet, ::mempool.cs`, no?",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T18:10:40Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void notifyMemoryPoolTransactions(Notifications& notifications) override\n+    {\n+        LOCK2(::cs_main, ::mempool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268783330",
      "id" : 268783330,
      "in_reply_to_id" : 268760261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc4MzMzMA==",
      "original_commit_id" : "12fb550b080fea98fa4f2a4fdd2c7eda9c149806",
      "original_position" : 6,
      "path" : "src/interfaces/chain.cpp",
      "position" : 6,
      "pull_request_review_id" : 218501066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268783330",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268788343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268788343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can get the functional tests to pass with the diff\r\n\r\n```diff\r\ndiff --git a/src/interfaces/chain.cpp b/src/interfaces/chain.cpp\r\nindex cb76461647..94e7a7ad53 100644\r\n--- a/src/interfaces/chain.cpp\r\n+++ b/src/interfaces/chain.cpp\r\n@@ -367,9 +367,9 @@ public:\r\n     {\r\n         return MakeUnique<RpcHandlerImpl>(command);\r\n     }\r\n-    void notifyMemoryPoolTransactions(Notifications& notifications) override\r\n+    void notifyMemoryPoolTransactions(Notifications& notifications, RecursiveMutex&cs_wallet) override\r\n     {\r\n-        LOCK2(::cs_main, ::mempool.cs);\r\n+        LOCK2(::cs_main, cs_wallet);         LOCK(::mempool.cs);\r\n         for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {\r\n             notifications.TransactionAddedToMempool(entry.GetSharedTx());\r\n         }\r\ndiff --git a/src/interfaces/chain.h b/src/interfaces/chain.h\r\nindex 3fa63d83be..b53d170645 100644\r\n--- a/src/interfaces/chain.h\r\n+++ b/src/interfaces/chain.h\r\n@@ -7,6 +7,7 @@\r\n \r\n #include <optional.h>               // For Optional and nullopt\r\n #include <primitives/transaction.h> // For CTransactionRef\r\n+#include <sync.h> // For RecursiveMutex\r\n \r\n #include <memory>\r\n #include <stddef.h>\r\n@@ -271,7 +272,7 @@ public:\r\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\r\n \r\n     //! Notify handler of all memory pool transactions.\r\n-    virtual void notifyMemoryPoolTransactions(Notifications& notifications) = 0;\r\n+    virtual void notifyMemoryPoolTransactions(Notifications& notifications,RecursiveMutex&cs_wallet) = 0;\r\n };\r\n \r\n //! Interface to let node manage chain clients (wallets, or maybe tools for\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 554ee62547..d72201679a 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -4404,7 +4404,7 @@ void CWallet::postInitProcess()\r\n     ReacceptWalletTransactions();\r\n \r\n     // Update wallet transactions with current mempool transactions.\r\n-    m_chain.notifyMemoryPoolTransactions(*this);\r\n+    m_chain.notifyMemoryPoolTransactions(*this, cs_wallet);\r\n }\r\n \r\n bool CWallet::BackupWallet(const std::string& strDest)\r\n",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T18:21:37Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void notifyMemoryPoolTransactions(Notifications& notifications) override\n+    {\n+        LOCK2(::cs_main, ::mempool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268788343",
      "id" : 268788343,
      "in_reply_to_id" : 268760261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc4ODM0Mw==",
      "original_commit_id" : "12fb550b080fea98fa4f2a4fdd2c7eda9c149806",
      "original_position" : 6,
      "path" : "src/interfaces/chain.cpp",
      "position" : 6,
      "pull_request_review_id" : 218506795,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268788343",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268794257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268794257"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will do.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-25T18:36:02Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMemoryPoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268794257",
      "id" : 268794257,
      "in_reply_to_id" : 268760412,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODc5NDI1Nw==",
      "original_commit_id" : "12fb550b080fea98fa4f2a4fdd2c7eda9c149806",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 218514151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268794257",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated, moved `notifyMempoolTransactions` to where the locks are held in the right order - `ReacceptWalletTransactions`. Needs squash though.\r\n\r\nBTW, could rename `ReacceptWalletTransactions` to `SyncWithChain` or something like that.",
      "created_at" : "2019-03-25T20:06:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-476356618",
      "id" : 476356618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NjM1NjYxOA==",
      "updated_at" : "2019-03-26T00:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/476356618",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "818b127 makes the new test pass on macOS. Don't forget to rename the \"wip\" commit.",
      "created_at" : "2019-03-26T15:45:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-476711811",
      "id" : 476711811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NjcxMTgxMQ==",
      "updated_at" : "2019-03-26T15:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/476711811",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Please squash to make it ready for review",
      "created_at" : "2019-03-26T16:41:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-476738246",
      "id" : 476738246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NjczODI0Ng==",
      "updated_at" : "2019-03-26T16:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/476738246",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269275853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269275853"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't like this going in `ReacceptWalletTransactions()` for a couple of reasons:\r\n\r\n- The name `ReacceptWalletTransactions()` suggests to me that we're reaccepting wallet transactions back into the mempool (which is what the function currently does). Adding functionality to fetch mempool txs back into the wallet changes the definition of this function so that it no longer matches the name.\r\n- `ReacceptWalletTransactions()` is called by various import* RPCs, which don't need to refetch the mempool txs into the wallet.\r\n\r\nI suggest moving this call into `postInitProcessing()` which is only called when a wallet is loaded.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-26T19:21:58Z",
      "diff_hunk" : "@@ -1890,6 +1890,9 @@ void CWallet::ReacceptWalletTransactions()\n         CValidationState state;\n         wtx.AcceptToMemoryPool(*locked_chain, state);\n     }\n+\n+    // Update wallet transactions with current mempool transactions.\n+    chain().notifyMempoolTransactions(*this);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269275853",
      "id" : 269275853,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTI3NTg1Mw==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 219108179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269275853",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269275899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269275899"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I'd prefer the name `getMempoolTransactions()` or `fetchMempoolTransactions()`. Notify to me signifies that the wallet is subscribing and getting a notification, whereas this interface function is actually used by the wallet to actively fetch the mempool transactions.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-26T19:22:09Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269275899",
      "id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTI3NTg5OQ==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219108179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269275899",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269369133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269369133"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T00:39:54Z",
      "diff_hunk" : "@@ -1890,6 +1890,9 @@ void CWallet::ReacceptWalletTransactions()\n         CValidationState state;\n         wtx.AcceptToMemoryPool(*locked_chain, state);\n     }\n+\n+    // Update wallet transactions with current mempool transactions.\n+    chain().notifyMempoolTransactions(*this);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269369133",
      "id" : 269369133,
      "in_reply_to_id" : 269275853,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTM2OTEzMw==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 219224636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269369133",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269369161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269369161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I'd prefer the name `getMempoolTransactions()` or `fetchMempoolTransactions()`.\r\n\r\nI think these are confusing since the function is void.\r\n\r\n",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T00:40:06Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269369161",
      "id" : 269369161,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTM2OTE2MQ==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219224669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269369161",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269372010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269372010"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Notify to me signifies that the wallet is subscribing and getting a notification\r\n\r\nThe \"standard\" for that is `handleX`, like `handleNotifications`.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T00:57:35Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269372010",
      "id" : 269372010,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTM3MjAxMA==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219227874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269372010",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269372993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269372993"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I suggest moving this call into `postInitProcessing()` which is only called when a wallet is loaded.\r\n\r\nThis was attempted before but there was a locking order problem, and was for that reason that I've placed `notifyMempoolTransactions` here. I've included 0994e3121 to address that.\r\n\r\nThe important thing to ensure is https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268783330.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T01:04:06Z",
      "diff_hunk" : "@@ -1890,6 +1890,9 @@ void CWallet::ReacceptWalletTransactions()\n         CValidationState state;\n         wtx.AcceptToMemoryPool(*locked_chain, state);\n     }\n+\n+    // Update wallet transactions with current mempool transactions.\n+    chain().notifyMempoolTransactions(*this);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269372993",
      "id" : 269372993,
      "in_reply_to_id" : 269275853,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTM3Mjk5Mw==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 219228996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269372993",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 3bf22a78c2e9951a7e7febb20577f2b6ac178bfc",
      "created_at" : "2019-03-27T13:31:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-477155394",
      "id" : 477155394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NzE1NTM5NA==",
      "updated_at" : "2019-03-27T13:31:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/477155394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269648409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269648409"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269275899\r\n\r\nAgree with John the name is not great. I think I'd probably call it `pushMempoolNotifications`.\r\n\r\nMore importantly, though, I think this needs to have a comment saying how it relates to `handleNotifications`. A good comment might be:\r\n\r\n\"Synchronously send TransactionAddedToMempool notifications about all current mempool entries to the specified handler. To avoid race conditions where out of date TransactionAddedFromMempool / TransactionRemovedFromMempool asynchronous notifications previously requested through `handleNotifications` would arrive during or after this call, this will block waiting for any previous asynchronous notifications to complete, and prevent new asynchronous notifications from being sent until this returns.\"\r\n\r\nI will say writing this makes me think the interface is overcomplicated. I guess I'd prefer my original suggestion of just sending `TransactionAddedFromMempool` notifications atomically in the same place the handler is registered: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268675190. Marco pointed out this would be wasteful in the case of `createwallet` calls https://github.com/bitcoin/bitcoin/pull/15652#discussion_r268710750, but the notifications could be optional if the waste is too much.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T16:15:53Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269648409",
      "id" : 269648409,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTY0ODQwOQ==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219571754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269648409",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269651974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269651974"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`requestMempoolTransactions()`?\r\n\r\nAgree with Russ about adding a comment.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T16:22:52Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269651974",
      "id" : 269651974,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTY1MTk3NA==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219576173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269651974",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269659744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269659744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> just sending TransactionAddedFromMempool notifications atomically in the same place the handler is registered\r\n\r\nI understand it is cleaner but it is weird to receive notifications before `handleNotifications` return. Thanks for the comment!\r\n\r\nEeny, meeny, miny, moe `requestMempoolTransactions`, after all we want to be notified of mempool transactions.\r\n\r\n",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T16:39:25Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269659744",
      "id" : 269659744,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTY1OTc0NA==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219586316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269659744",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 78ce8e91031ea8a87c55deeb060071d7dc26358e",
      "created_at" : "2019-03-27T17:24:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-477266203",
      "id" : 477266203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NzI2NjIwMw==",
      "updated_at" : "2019-03-27T17:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/477266203",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269682327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269682327"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> but it is weird to receive notifications before handleNotifications return\r\n\r\nThis is the current behavior and it isn't weird. Notifications start to arrive when RegisterValidationInterface is called, and can happen before that function returns, much less before handleNotifications returns.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T17:27:14Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269682327",
      "id" : 269682327,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTY4MjMyNw==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219615457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269682327",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think there's probably still a race condition here because add/remove notifications scheduled before the request for mempool transactions could arrive after the request:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/656a15e5394d8d841619b5b186fa0f9c8be0322b/src/validationinterface.cpp#L155\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/656a15e5394d8d841619b5b186fa0f9c8be0322b/src/validationinterface.cpp#L138\r\n\r\nYou might need to block waiting for previous notifications.\r\n",
      "created_at" : "2019-03-27T17:36:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-477271519",
      "id" : 477271519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NzI3MTUxOQ==",
      "updated_at" : "2019-03-27T17:36:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/477271519",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269709487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269709487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> This is the current behavior\r\n\r\nCurrently `cs_main` and `cs_wallet` are locked when `handleNotifications` is called so that doesn't happen, but otherwise you are right.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-27T18:28:29Z",
      "diff_hunk" : "@@ -269,6 +269,9 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Notify handler of all memory pool transactions.\n+    virtual void notifyMempoolTransactions(Notifications& notifications) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269709487",
      "id" : 269709487,
      "in_reply_to_id" : 269275899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTcwOTQ4Nw==",
      "original_commit_id" : "fea282767fe03ac0c36a39db1a201b422069e33e",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 219649699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269709487",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269965497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269965497"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-477271519\r\n\r\n> You might need to block waiting for previous notifications.\r\n\r\nOne way to do this:\r\n\r\n```c++\r\nvoid requestMempoolTransactions(Notifications& notifications) override\r\n{\r\n    std::promise<void> promise;\r\n    CallFunctionInValidationInterfaceQueue([&] {\r\n        LOCK2(::cs_main, ::mempool.cs);\r\n        for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {\r\n            notifications.TransactionAddedToMempool(entry.GetSharedTx());\r\n        }\r\n        promise.set_value();\r\n    });\r\n    promise.get_future().wait();\r\n}\r\n```",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-28T11:52:45Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269965497",
      "id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTk2NTQ5Nw==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 219973274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269965497",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269972909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269972909"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Previous suggestion in https://github.com/bitcoin/bitcoin/pull/15652/files#r269965497 isn't exception safe. Also, cs_main needs to be released before calling this.\r\n\r\nProbably better:\r\n\r\n```c++\r\nvoid requestMempoolTransactions(Notifications& notifications) override\r\n{\r\n    AssertLockNotHeld(::cs_main);\r\n    AssertLockNotHeld(::mempool.cs);\r\n    std::packaged_task<void()> task([&] {\r\n        LOCK2(::cs_main, ::mempool.cs);\r\n        for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {\r\n            notifications.TransactionAddedToMempool(entry.GetSharedTx());\r\n        }\r\n    });\r\n    CallFunctionInValidationInterfaceQueue([&] { task(); });\r\n    task.get_future().get();\r\n}\r\n```",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-28T12:17:08Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269972909",
      "id" : 269972909,
      "in_reply_to_id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2OTk3MjkwOQ==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 219983048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/269972909",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270045558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270045558"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks @ryanofsky!",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-28T14:56:47Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270045558",
      "id" : 270045558,
      "in_reply_to_id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDA0NTU1OA==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 220075187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270045558",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270050754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270050754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Haven't finished but it looks like there will be a lock order issue - cs_main -> mempool.cs -> cs_main -> cs_wallet.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-28T15:07:15Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270050754",
      "id" : 270050754,
      "in_reply_to_id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDA1MDc1NA==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 220082336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270050754",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270063306"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270063306"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270050754\r\n\r\n> Haven't finished but it looks like there will be a lock order issue - cs_main -> mempool.cs -> cs_main -> cs_wallet.\r\n\r\nThat does seem like a problem. One way to fix it would be to release main and mempool locks before calling TransactionAddedToMempool, by pushing the transactions to a vector, releasing the locks and then looping over the vector.\r\n\r\nAlternately if you changed the function to `pushMempoolTransactions(std::function<void(std::vector<CTransactionRef> push_fn))` you could release the locks and then send the vector to the wallet directly. Both of these changes would be nice optimizations for #10102, since passing a vector once across the socket is more efficient than calling `TransactionAddedToMempool` repeatedly and requiring lots of roundtrip traffic.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-28T15:30:59Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270063306",
      "id" : 270063306,
      "in_reply_to_id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDA2MzMwNg==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 220087547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270063306",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry for the churn and for keeping suggesting new code changes. If you want to go with a simple change that fixes the original bug and can be backported, but maybe is less efficient or has some obscure race conditions, that seems fine.",
      "created_at" : "2019-03-28T15:42:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-477651641",
      "id" : 477651641,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NzY1MTY0MQ==",
      "updated_at" : "2019-03-28T15:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/477651641",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky no problem at all! I think this is ready now.",
      "created_at" : "2019-03-29T09:38:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-477932711",
      "id" : 477932711,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NzkzMjcxMQ==",
      "updated_at" : "2019-03-29T09:38:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/477932711",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270460939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270460939"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15652#discussion_r269965497\r\n\r\nCurrent code looks ok, but I think I was misguided in making this thread because previous code in d94847f20c750d88a0aefa572155d54f8e39c144 was also ok. I think:\r\n\r\n1) I was right to point out there's a race condition where normal mempool add/remove notifications triggered before the `requestMempoolTransactions` call could arrive out of order during and after the call\r\n2) I was wrong to assume that the race condition would actually cause a problem. There is no problem if an unknown transaction is removed or an already added transaction is added again.\r\n3) I was wrong to think that my proposed changes would actually prevent add/remove notifications from arriving out of order. In fact, they would only prevent older add/remove notifications from arriving _during_ the `requestMempoolTransactions` call, not _after_ the call.\r\n\r\nSo, I think if you want go back to the simpler implementation in d94847f20c750d88a0aefa572155d54f8e39c144 that would be fine.\r\n\r\nOr if you did want to prevent obsolete add/remove notifications from arriving _after_ the `requestMempoolTransactions` call in addition to _during_, you'd need acquire the locks before calling `CallFunctionInValidationInterfaceQueue` and also fill the vector at the same time:\r\n\r\n```c++\r\nvoid requestMempoolTransactions(Notifications& notifications) override\r\n{\r\n    std::vector<CTransactionRef> transactions;\r\n    std::packaged_task<void()> task([&] {\r\n        for (const CTransactionRef& tx : transactions) {\r\n            notifications.TransactionAddedToMempool(tx);\r\n        }\r\n    });\r\n    {\r\n        LOCK2(::cs_main, ::mempool.cs);\r\n        for (const CTxMemPoolEntry& entry : ::mempool.mapTx) {\r\n            transactions.push_back(entry.GetSharedTx());\r\n        }\r\n        CallFunctionInValidationInterfaceQueue([&] { task(); });\r\n    }\r\n    AssertLockNotHeld(::cs_main);\r\n    AssertLockNotHeld(::mempool.cs);\r\n    task.get_future().get();\r\n}\r\n```",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-29T15:29:55Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270460939",
      "id" : 270460939,
      "in_reply_to_id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDQ2MDkzOQ==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 220608080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270460939",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If the branch that had d94847f in works without a `future` include and is correct, I'd prefer that ",
      "created_at" : "2019-03-29T16:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478057233",
      "id" : 478057233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODA1NzIzMw==",
      "updated_at" : "2019-03-29T16:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478057233",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> If the branch that had d94847f in works without a future include and is correct, I'd prefer that\r\n\r\nBranch is correct but the `requestMempoolTransactions` comment there doesn't accurately describe what the function does. Comment could just be updated to warn that `requestMempoolTransactions` is not synchronized with `handleNotifications`, and obsolete `handleNotifications` notifications could arrive during and after notifications sent by `requestMempoolTransactions` (but that this is harmless because wallet will ignore notifications about removed transactions it doesn't know about or added transactions that are already added).\r\n",
      "created_at" : "2019-03-29T17:03:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478074915",
      "id" : 478074915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODA3NDkxNQ==",
      "updated_at" : "2019-03-29T17:03:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478074915",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270498507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270498507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I was wrong to assume that the race condition would actually cause a problem. There is no problem if an unknown transaction is removed or an already added transaction is added again.\r\n\r\nRight, just unnecessary extra work, which is not an issue I think.",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-29T17:03:31Z",
      "diff_hunk" : "@@ -367,6 +367,13 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<RpcHandlerImpl>(command);\n     }\n+    void requestMempoolTransactions(Notifications& notifications) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270498507",
      "id" : 270498507,
      "in_reply_to_id" : 269965497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDQ5ODUwNw==",
      "original_commit_id" : "fae225a9f6c9046e21dd50a91a32ac529cb67136",
      "original_position" : 4,
      "path" : "src/interfaces/chain.cpp",
      "position" : 4,
      "pull_request_review_id" : 220657894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270498507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 78ce8e91031ea8a87c55deeb060071d7dc26358e\r\n\r\nOnly change since my last review is renaming a method and adding a comment. (Haven't read the comment)",
      "created_at" : "2019-03-29T19:51:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478128656",
      "id" : 478128656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODEyODY1Ng==",
      "updated_at" : "2019-03-29T19:51:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478128656",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 78ce8e91031ea8a87c55deeb060071d7dc26358e modulo the comment change that Russ requested.",
      "created_at" : "2019-03-29T20:23:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478137725",
      "id" : 478137725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODEzNzcyNQ==",
      "updated_at" : "2019-03-29T20:23:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478137725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested that 78ce8e91031ea8a87c55deeb060071d7dc26358e fails the test when run without compiling the bitcoind changes.",
      "created_at" : "2019-03-29T21:37:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478157586",
      "id" : 478157586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODE1NzU4Ng==",
      "updated_at" : "2019-03-29T21:37:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478157586",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270605729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270605729"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"interfaces: Add Chain::requestMempoolTransactions\" (d94847f20c750d88a0aefa572155d54f8e39c144)\r\n\r\nCurrent comment isn't really accurate. Maybe suggest:\r\n\r\n```c++\r\n//! Synchronously send TransactionAddedToMempool notifications about all\r\n//! current mempool transactions to the specified handler and return after\r\n//! the last one is sent. These notifications aren't coordinated with async\r\n//! notifications sent by handleNotifications, so out of date async\r\n//! notifications from handleNotifications can arrive during and after\r\n//! synchronous notifications from requestMempoolTransactions. Clients need\r\n//! to be prepared to handle this by ignoring notifications about unknown\r\n//! removed transactions and already added new transactions.\r\n```",
      "commit_id" : "4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-03-30T00:39:52Z",
      "diff_hunk" : "@@ -269,6 +269,16 @@ class Chain\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;\n+\n+    //! Synchronously send TransactionAddedToMempool notifications about all",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#discussion_r270605729",
      "id" : 270605729,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MDYwNTcyOQ==",
      "original_commit_id" : "d94847f20c750d88a0aefa572155d54f8e39c144",
      "original_position" : 5,
      "path" : "src/interfaces/chain.h",
      "position" : 5,
      "pull_request_review_id" : 220798813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15652",
      "updated_at" : "2019-03-31T10:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/270605729",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 4bf1b1cefa\r\n\r\nOnly the comment changed, didn't look at either the old or new comment.",
      "created_at" : "2019-04-01T16:33:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478651822",
      "id" : 478651822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODY1MTgyMg==",
      "updated_at" : "2019-04-01T16:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478651822",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 4bf1b1cefa9723bf2cfa8b1a938757abc99bb17b",
      "created_at" : "2019-04-01T18:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478702601",
      "id" : 478702601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODcwMjYwMQ==",
      "updated_at" : "2019-04-01T18:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478702601",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Merge commit 5a2a9b5b0603c1206e4419ffd0fd0d4939813fc2 seems to be missing an ack: https://github.com/bitcoin/bitcoin/pull/15652#pullrequestreview-221199549",
      "created_at" : "2019-04-01T19:47:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478719829",
      "id" : 478719829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODcxOTgyOQ==",
      "updated_at" : "2019-04-01T19:47:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478719829",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is an upstream issue on GitHub, I believe. Will follow up with some details shortly",
      "created_at" : "2019-04-01T20:33:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478736662",
      "id" : 478736662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODczNjY2Mg==",
      "updated_at" : "2019-04-01T20:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478736662",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Comments:\r\n* https://api.github.com/repos/bitcoin/bitcoin/issues/15652/comments\r\n\r\nReview summary comments:\r\n* https://api.github.com/repos/bitcoin/bitcoin/pulls/15652/reviews\r\n\r\nThey are showing my \"Concept ACK\" above, but for some reason not your utACK...",
      "created_at" : "2019-04-01T21:09:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478749124",
      "id" : 478749124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODc0OTEyNA==",
      "updated_at" : "2019-04-01T21:10:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478749124",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Will follow up with GitHub support",
      "created_at" : "2019-04-01T22:23:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478769054",
      "id" : 478769054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODc2OTA1NA==",
      "updated_at" : "2019-04-01T22:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478769054",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Backported in https://github.com/bitcoin/bitcoin/pull/15691.",
      "created_at" : "2019-04-02T12:05:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15652#issuecomment-478966259",
      "id" : 478966259,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15652",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3ODk2NjI1OQ==",
      "updated_at" : "2019-04-02T12:05:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/478966259",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
