[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415346339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415346339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of modifying the test_framwork/util.py, you could just remove the line `[regtest]` from the bitcoin.conf in the 16.3 datadir before starting the nodes",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T16:22:48Z",
      "diff_hunk" : "@@ -0,0 +1,87 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+\n+        self.start_nodes()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415346339",
      "id" : 415346339,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM0NjMzOQ==",
      "original_commit_id" : "efd68292966ada54d96ac964b4157c1d2d485ada",
      "original_line" : 65,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 65,
      "pull_request_review_id" : 400522178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415346339",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415346876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415346876"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, but wouldn't be better to make this generally available? For example the [comment](https://github.com/bitcoin/bitcoin/blob/master/test/functional/feature_backwards_compatibility.py#L11) in `feature_backwards_compatibility.py` states that it's not possible to test older nodes.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T16:25:38Z",
      "diff_hunk" : "@@ -0,0 +1,87 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+\n+        self.start_nodes()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415346876",
      "id" : 415346876,
      "in_reply_to_id" : 415346339,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM0Njg3Ng==",
      "original_commit_id" : "efd68292966ada54d96ac964b4157c1d2d485ada",
      "original_line" : 65,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 65,
      "pull_request_review_id" : 400522497,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415346876",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415354718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415354718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, if you want, you can create a generally available util method like\r\n\r\n```py\r\ndef adjust_bitcoin_conf_for_pre_16_3(conf_file):\r\n  ...",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T17:06:52Z",
      "diff_hunk" : "@@ -0,0 +1,87 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+\n+        self.start_nodes()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415354718",
      "id" : 415354718,
      "in_reply_to_id" : 415346339,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM1NDcxOA==",
      "original_commit_id" : "efd68292966ada54d96ac964b4157c1d2d485ada",
      "original_line" : 65,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 65,
      "pull_request_review_id" : 400526397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415354718",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415354824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415354824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sed does not exist on windows. I think this is possible entirely in python?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T17:07:36Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+import subprocess\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+        # older bitcoind's like v0.16.3 don't recognize config sections\n+        subprocess.call([\"sed\",\"-i\", \"-e\", \"s/\\[regtest\\]/ /g\", self.nodes[1].bitcoinconf])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415354824",
      "id" : 415354824,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM1NDgyNA==",
      "original_commit_id" : "64dd4032fee93f6c45372966fdb8981555238880",
      "original_line" : 55,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400526461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415354824",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415354963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415354963"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, will implement it. Have just force pushed a change that uses *sed* to make an in-file replacement.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T17:08:13Z",
      "diff_hunk" : "@@ -0,0 +1,87 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+\n+        self.start_nodes()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415354963",
      "id" : 415354963,
      "in_reply_to_id" : 415346339,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM1NDk2Mw==",
      "original_commit_id" : "efd68292966ada54d96ac964b4157c1d2d485ada",
      "original_line" : 65,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 65,
      "pull_request_review_id" : 400526525,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415354963",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415355171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415355171"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, just came to my mind. Windows!\r\nI'll use python's own regex utils. \r\n",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T17:09:23Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+import subprocess\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+        # older bitcoind's like v0.16.3 don't recognize config sections\n+        subprocess.call([\"sed\",\"-i\", \"-e\", \"s/\\[regtest\\]/ /g\", self.nodes[1].bitcoinconf])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415355171",
      "id" : 415355171,
      "in_reply_to_id" : 415354824,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM1NTE3MQ==",
      "original_commit_id" : "64dd4032fee93f6c45372966fdb8981555238880",
      "original_line" : 55,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400526636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415355171",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke \r\nThere are several error messages in travis that I don't know how to fix. Maybe because the v0.16.3 binaries are missing on test envs?",
      "created_at" : "2020-04-26T18:34:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#issuecomment-619602160",
      "id" : 619602160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18774",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTYwMjE2MA==",
      "updated_at" : "2020-04-26T18:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619602160",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415374788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415374788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    'wallet_upgradewallet.py',\r\n```",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-26T18:49:05Z",
      "diff_hunk" : "@@ -180,6 +180,7 @@\n     'mempool_expiry.py',\n     'wallet_import_rescan.py',\n     'wallet_import_with_label.py',\n+    'wallet_upgradewallet',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415374788",
      "id" : 415374788,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM3NDc4OA==",
      "original_commit_id" : "af3ff0efdce689e06261f5ee6012d902b2e7d3a6",
      "original_line" : 183,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : null,
      "pull_request_review_id" : 400536644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415374788",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "You'll also need to adjust ci/test/05_before_script.sh",
      "created_at" : "2020-04-26T18:49:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#issuecomment-619604633",
      "id" : 619604633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18774",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTYwNDYzMw==",
      "updated_at" : "2020-04-26T18:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619604633",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #16549 ([WIP] UI external signer support (e.g. hardware wallet) by Sjors)\n* #16546 ([WIP] External signer support - Wallet Box edition by Sjors)\n* #16528 (Native Descriptor Wallets using DescriptorScriptPubKeyMan by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-26T19:38:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#issuecomment-619613229",
      "id" : 619613229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18774",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTYxMzIyOQ==",
      "updated_at" : "2020-04-26T19:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619613229",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-27T00:34:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#issuecomment-619650567",
      "id" : 619650567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18774",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTY1MDU2Nw==",
      "updated_at" : "2020-04-27T00:34:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619650567",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415449758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415449758"
         }
      },
      "author_association" : "MEMBER",
      "body" : "python `with` context manager should simplify this",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T01:20:13Z",
      "diff_hunk" : "@@ -326,6 +326,16 @@ def initialize_datadir(dirname, n, chain):\n         os.makedirs(os.path.join(datadir, 'stdout'), exist_ok=True)\n     return datadir\n \n+def adjust_bitcoin_conf_for_pre_16_3(conf_file):\n+    conf = open(conf_file,'r', encoding='utf8')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415449758",
      "id" : 415449758,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ0OTc1OA==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 330,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400577111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415449758",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415450429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415450429"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can this be factored out into a `def skip_if_no_previous_release(self)`? Maybe a future pull?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T01:22:34Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415450429",
      "id" : 415450429,
      "line" : 47,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ1MDQyOQ==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 47,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 47,
      "pull_request_review_id" : 400577551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415450429",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415450717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415450717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "don't you need to shut down first?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T01:23:30Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+        # older bitcoind's like v0.16.3 don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_16_3(self.nodes[1].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        node_master.unloadwallet(\"\")\n+\n+        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v16_3_wallets_dir,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415450717",
      "id" : 415450717,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ1MDcxNw==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 88,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400577744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415450717",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415454548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415454548"
         }
      },
      "author_association" : "MEMBER",
      "body" : "would it be possible to user version 15, so that `-usehd=0` can be passed to the wallet?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T01:38:19Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415454548",
      "id" : 415454548,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ1NDU0OA==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 46,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400580618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415454548",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415722436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415722436"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have changed it.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:11:41Z",
      "diff_hunk" : "@@ -326,6 +326,16 @@ def initialize_datadir(dirname, n, chain):\n         os.makedirs(os.path.join(datadir, 'stdout'), exist_ok=True)\n     return datadir\n \n+def adjust_bitcoin_conf_for_pre_16_3(conf_file):\n+    conf = open(conf_file,'r', encoding='utf8')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415722436",
      "id" : 415722436,
      "in_reply_to_id" : 415449758,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyMjQzNg==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 330,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400851451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415722436",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415723440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415723440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've taken this piece of code from `feature_backwards_compatibility`, so I will later try it out with `skip_if_no_previous_release(self)`.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:13:24Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415723440",
      "id" : 415723440,
      "in_reply_to_id" : 415450429,
      "line" : 47,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyMzQ0MA==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 47,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 47,
      "pull_request_review_id" : 400852499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415723440",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415723727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415723727"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Indeed. The latest variant has it now.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:13:55Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+        ])\n+        # older bitcoind's like v0.16.3 don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_16_3(self.nodes[1].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        node_master.unloadwallet(\"\")\n+\n+        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v16_3_wallets_dir,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415723727",
      "id" : 415723727,
      "in_reply_to_id" : 415450717,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyMzcyNw==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 88,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400852845,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415723727",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415724408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415724408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have added a v0.15.2 node, so that we are now testing v0.15.2 with *-usehd=0* and v0.16.3 with *-usehd=1*. ",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:14:59Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415724408",
      "id" : 415724408,
      "in_reply_to_id" : 415454548,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyNDQwOA==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 46,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400853551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415724408",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415726704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415726704"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Btw. there is now a new helper method in *util.py* called `get_nodes_least_version`, because the framework couldn't start the v0.15.2 node. The error was thrown in `sync_mempools`and `sync_blocks`. It seems to have something to do with the call of `syncwithvalidationinterfacequeue`. This indirectly affected the `getpeerinfo`from `sync_blocks`, but because 0.15.2 never needed any peers for these particular tests, I thought, maybe a small helper methode for filtering those old nodes would be sufficient. If not, please, let me know what alternatives we have here.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:18:56Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415726704",
      "id" : 415726704,
      "in_reply_to_id" : 415454548,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyNjcwNA==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 46,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 400855992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415726704",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415728710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415728710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line can be removed, because python's scopes are more fluid",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:22:06Z",
      "diff_hunk" : "@@ -326,6 +326,14 @@ def initialize_datadir(dirname, n, chain):\n         os.makedirs(os.path.join(datadir, 'stdout'), exist_ok=True)\n     return datadir\n \n+def adjust_bitcoin_conf_for_pre_16_3(conf_file):\n+    conf_data = \"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415728710",
      "id" : 415728710,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyODcxMA==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 330,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400857922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415728710",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415728878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415728878"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\ndef adjust_bitcoin_conf_for_pre_17(conf_file):\r\n```\r\n\r\nSorry, this should say pre 17",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:22:28Z",
      "diff_hunk" : "@@ -326,6 +326,14 @@ def initialize_datadir(dirname, n, chain):\n         os.makedirs(os.path.join(datadir, 'stdout'), exist_ok=True)\n     return datadir\n \n+def adjust_bitcoin_conf_for_pre_16_3(conf_file):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415728878",
      "id" : 415728878,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyODg3OA==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 329,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400857922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415728878",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415729442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415729442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't like making sync_**all** only sync the latest versions. Why is this needed here anyway?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:23:22Z",
      "diff_hunk" : "@@ -408,13 +416,22 @@ def sync_blocks(rpc_connections, *, wait=1, timeout=60):\n         if best_hash.count(best_hash[0]) == len(rpc_connections):\n             return\n         # Check that each peer has at least one connection\n-        assert (all([len(x.getpeerinfo()) for x in rpc_connections]))\n+        assert (all([len(x.getpeerinfo()) for x in get_nodes_least_version(rpc_connections)]))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415729442",
      "id" : 415729442,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcyOTQ0Mg==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 419,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400857922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415729442",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415730186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415730186"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think, I should then also update every test where the above code is currently in use. Will make a separate pull request for that. :)",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:24:34Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.16.3 node binary:\n+\n+contrib/devtools/previous_release.sh -b v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_16_3,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"],\n+            []\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415730186",
      "id" : 415730186,
      "in_reply_to_id" : 415450429,
      "line" : 47,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczMDE4Ng==",
      "original_commit_id" : "f8049ba065a38db458e7a0826e69efe4b3b68f86",
      "original_line" : 47,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 47,
      "pull_request_review_id" : 400859634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415730186",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415730482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415730482"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd rather remove the call to sync_mempools. You can do that by deriving the function that calls it.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:25:07Z",
      "diff_hunk" : "@@ -426,8 +443,8 @@ def sync_mempools(rpc_connections, *, wait=1, timeout=60, flush_scheduler=True):\n         pool = [set(r.getrawmempool()) for r in rpc_connections]\n         if pool.count(pool[0]) == len(rpc_connections):\n             if flush_scheduler:\n-                for r in rpc_connections:\n-                    r.syncwithvalidationinterfacequeue()\n+                for r in get_nodes_least_version(rpc_connections):\n+                        r.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415730482",
      "id" : 415730482,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczMDQ4Mg==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 436,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400857922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415730482",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415734342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415734342"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because the v0.15.2 node has no peers. But you're right, if I am not using *sync_blocks* it should not react at all. In a previous version of upgradewallet test there was a *sync_blocks* call. Will adapt the code.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:31:25Z",
      "diff_hunk" : "@@ -408,13 +416,22 @@ def sync_blocks(rpc_connections, *, wait=1, timeout=60):\n         if best_hash.count(best_hash[0]) == len(rpc_connections):\n             return\n         # Check that each peer has at least one connection\n-        assert (all([len(x.getpeerinfo()) for x in rpc_connections]))\n+        assert (all([len(x.getpeerinfo()) for x in get_nodes_least_version(rpc_connections)]))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415734342",
      "id" : 415734342,
      "in_reply_to_id" : 415729442,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNDM0Mg==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 419,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400864051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415734342",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415735221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415735221"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I only knew, where am I calling *sync_mempools*. Will have to search a bit.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:32:56Z",
      "diff_hunk" : "@@ -426,8 +443,8 @@ def sync_mempools(rpc_connections, *, wait=1, timeout=60, flush_scheduler=True):\n         pool = [set(r.getrawmempool()) for r in rpc_connections]\n         if pool.count(pool[0]) == len(rpc_connections):\n             if flush_scheduler:\n-                for r in rpc_connections:\n-                    r.syncwithvalidationinterfacequeue()\n+                for r in get_nodes_least_version(rpc_connections):\n+                        r.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415735221",
      "id" : 415735221,
      "in_reply_to_id" : 415730482,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNTIyMQ==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 436,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400865019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415735221",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415735967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415735967"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think, it comes indirectly from *setup_network*. This method also calls *sync_* stuff.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:34:18Z",
      "diff_hunk" : "@@ -426,8 +443,8 @@ def sync_mempools(rpc_connections, *, wait=1, timeout=60, flush_scheduler=True):\n         pool = [set(r.getrawmempool()) for r in rpc_connections]\n         if pool.count(pool[0]) == len(rpc_connections):\n             if flush_scheduler:\n-                for r in rpc_connections:\n-                    r.syncwithvalidationinterfacequeue()\n+                for r in get_nodes_least_version(rpc_connections):\n+                        r.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415735967",
      "id" : 415735967,
      "in_reply_to_id" : 415730482,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNTk2Nw==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 436,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400865851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415735967",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415736457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415736457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can override setup_network and provide your own impl",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-27T11:35:09Z",
      "diff_hunk" : "@@ -426,8 +443,8 @@ def sync_mempools(rpc_connections, *, wait=1, timeout=60, flush_scheduler=True):\n         pool = [set(r.getrawmempool()) for r in rpc_connections]\n         if pool.count(pool[0]) == len(rpc_connections):\n             if flush_scheduler:\n-                for r in rpc_connections:\n-                    r.syncwithvalidationinterfacequeue()\n+                for r in get_nodes_least_version(rpc_connections):\n+                        r.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r415736457",
      "id" : 415736457,
      "in_reply_to_id" : 415730482,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNjQ1Nw==",
      "original_commit_id" : "e9a0ea40d43a075b9ef4976bff6f81e978ca687d",
      "original_line" : 436,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 400866398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415736457",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416953375"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416953375"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `self.stop_nodes` instead of listing each individually?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:07:51Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        v15_2_wallets_dir       = os.path.join(v15_2_node.datadir, \"regtest\")\n+        # stop all nodes\n+        self.stop_node(0)\n+        self.stop_node(1)\n+        self.stop_node(2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416953375",
      "id" : 416953375,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk1MzM3NQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 83,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 402247206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416953375",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416954599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416954599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since you're just loading the default wallet, `loadwallet('')` should be sufficient.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:10:33Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        v15_2_wallets_dir       = os.path.join(v15_2_node.datadir, \"regtest\")\n+        # stop all nodes\n+        self.stop_node(0)\n+        self.stop_node(1)\n+        self.stop_node(2)\n+\n+        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v16_3_wallets_dir,\n+            node_master_wallets_dir\n+        )\n+        self.restart_node(0, ['-nowallet'])\n+\n+        node_master.loadwallet(node_master_wallets_dir)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416954599",
      "id" : 416954599,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk1NDU5OQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 93,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 402247206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416954599",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416955492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416955492"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is the entire datadir and its going to be copying a lot more than just the wallet. Instead of copying the entire walletdir, just give the paths to the specific wallet.dat files?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:12:32Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        v15_2_wallets_dir       = os.path.join(v15_2_node.datadir, \"regtest\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416955492",
      "id" : 416955492,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk1NTQ5Mg==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 79,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 402247206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416955492",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416966113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416966113"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: why remove this line? Seems unrelated and goes against the pep8 rules",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:39:11Z",
      "diff_hunk" : "@@ -415,7 +422,6 @@ def sync_blocks(rpc_connections, *, wait=1, timeout=60):\n         \"\".join(\"\\n  {!r}\".format(b) for b in best_hash),\n     ))\n \n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416966113",
      "id" : 416966113,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk2NjExMw==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 418,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 402261835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416966113",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416966593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416966593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        conf_data_changed = conf_data.replace('[regtest]', '')\r\n```\r\n\r\nShould be doable without relying on the regex module",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:40:34Z",
      "diff_hunk" : "@@ -326,6 +326,13 @@ def initialize_datadir(dirname, n, chain):\n         os.makedirs(os.path.join(datadir, 'stdout'), exist_ok=True)\n     return datadir\n \n+def adjust_bitcoin_conf_for_pre_17(conf_file):\n+    with open(conf_file,'r', encoding='utf8') as conf:\n+        conf_data = conf.read()\n+    with open(conf_file, 'w+', encoding='utf8') as conf:\n+        conf_data_changed = re.sub(r'\\[regtest\\]', ' ', conf_data)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416966593",
      "id" : 416966593,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk2NjU5Mw==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 333,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 402261835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416966593",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416967844"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be nice to send some coins around, so that we can check the balance doesn't decrease from upgrading the wallet",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:43:45Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844",
      "id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk2Nzg0NA==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402261835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416967844",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416968585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416968585"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this now an HD wallet? If yes, would be nice to check that the master key hash is present in the wallet info (or something like that)",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-28T22:45:32Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        v15_2_wallets_dir       = os.path.join(v15_2_node.datadir, \"regtest\")\n+        # stop all nodes\n+        self.stop_node(0)\n+        self.stop_node(1)\n+        self.stop_node(2)\n+\n+        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v16_3_wallets_dir,\n+            node_master_wallets_dir\n+        )\n+        self.restart_node(0, ['-nowallet'])\n+\n+        node_master.loadwallet(node_master_wallets_dir)\n+        wallet_name = node_master.getwalletinfo()[\"walletname\"]\n+        wallet = node_master.get_wallet_rpc(wallet_name)\n+        old_version = wallet.getwalletinfo()[\"walletversion\"]\n+        # calling upgradewallet without version arguments\n+        # should return nothing if successful\n+        assert_equal(wallet.upgradewallet(), \"\")\n+        new_version = wallet.getwalletinfo()[\"walletversion\"]\n+        # upgraded wallet version should be greater than older one\n+        assert_greater_than(new_version, old_version)\n+\n+        self.stop_node(0)\n+\n+        # Copy the 0.15.2 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v15_2_wallets_dir,\n+            node_master_wallets_dir\n+        )\n+        self.restart_node(0, ['-nowallet'])\n+\n+        node_master.loadwallet(node_master_wallets_dir)\n+        wallet_name = node_master.getwalletinfo()[\"walletname\"]\n+        wallet = node_master.get_wallet_rpc(wallet_name)\n+        # calling upgradewallet with explicit version number\n+        # should return nothing if successful\n+        assert_equal(wallet.upgradewallet(169900), \"\")\n+        new_version = wallet.getwalletinfo()[\"walletversion\"]\n+        # upgraded wallet should have version 169900\n+        assert_equal(new_version, 169900)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416968585",
      "id" : 416968585,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk2ODU4NQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 151,
      "original_position" : 122,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 151,
      "pull_request_review_id" : 402261835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416968585",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417001157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417001157"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sadly, this can't be implemented, because old nodes aren't connected to *node_master*. We had this problem with rpc_connections previously when I tried to filter out old nodes. Now, the same problem happens when trying to use *sync_* methods. ",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T00:19:57Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417001157",
      "id" : 417001157,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAwMTE1Nw==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402298893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417001157",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417001468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417001468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have added appropriate tests.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T00:21:03Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        v15_2_wallets_dir       = os.path.join(v15_2_node.datadir, \"regtest\")\n+        # stop all nodes\n+        self.stop_node(0)\n+        self.stop_node(1)\n+        self.stop_node(2)\n+\n+        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v16_3_wallets_dir,\n+            node_master_wallets_dir\n+        )\n+        self.restart_node(0, ['-nowallet'])\n+\n+        node_master.loadwallet(node_master_wallets_dir)\n+        wallet_name = node_master.getwalletinfo()[\"walletname\"]\n+        wallet = node_master.get_wallet_rpc(wallet_name)\n+        old_version = wallet.getwalletinfo()[\"walletversion\"]\n+        # calling upgradewallet without version arguments\n+        # should return nothing if successful\n+        assert_equal(wallet.upgradewallet(), \"\")\n+        new_version = wallet.getwalletinfo()[\"walletversion\"]\n+        # upgraded wallet version should be greater than older one\n+        assert_greater_than(new_version, old_version)\n+\n+        self.stop_node(0)\n+\n+        # Copy the 0.15.2 wallet to the last Bitcoin Core version and open it:\n+        shutil.rmtree(node_master_wallets_dir)\n+        shutil.copytree(\n+            v15_2_wallets_dir,\n+            node_master_wallets_dir\n+        )\n+        self.restart_node(0, ['-nowallet'])\n+\n+        node_master.loadwallet(node_master_wallets_dir)\n+        wallet_name = node_master.getwalletinfo()[\"walletname\"]\n+        wallet = node_master.get_wallet_rpc(wallet_name)\n+        # calling upgradewallet with explicit version number\n+        # should return nothing if successful\n+        assert_equal(wallet.upgradewallet(169900), \"\")\n+        new_version = wallet.getwalletinfo()[\"walletversion\"]\n+        # upgraded wallet should have version 169900\n+        assert_equal(new_version, 169900)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417001468",
      "id" : 417001468,
      "in_reply_to_id" : 416968585,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAwMTQ2OA==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 151,
      "original_position" : 122,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 151,
      "pull_request_review_id" : 402299231,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417001468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417002711"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417002711"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "More precisely, this is the place where the error gets thrown.\r\n\r\n```shell\r\n File \"/test/functional/test_framework/test_framework.py\", line 499, in sync_blocks\r\n    sync_blocks(nodes or self.nodes, **kwargs)\r\n  File \"/test/functional/test_framework/util.py\", line 418, in sync_blocks\r\n    assert (all([len(x.getpeerinfo()) for x in rpc_connections]))\r\n```\r\n\r\nWe have seen this already. So, the question is, do we want to work on \"onboarding\" of old nodes so their converted wallets can be tested here, or should we rather open a dedicated PR for this?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T00:24:39Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417002711",
      "id" : 417002711,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAwMjcxMQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402300395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417002711",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417003021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417003021"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, that's much better. Have adapted the code.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T00:25:36Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")\n+        # Prepare for copying of the older wallet\n+        node_master_wallets_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        v16_3_wallets_dir       = os.path.join(v16_3_node.datadir, \"regtest/wallets\")\n+        v15_2_wallets_dir       = os.path.join(v15_2_node.datadir, \"regtest\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417003021",
      "id" : 417003021,
      "in_reply_to_id" : 416955492,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAwMzAyMQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 79,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 402300743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417003021",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417005666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417005666"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So syncing the blockchain is the issue?\r\n\r\nCan be done in a really dumb way:\r\n\r\n```\r\ndef dumb_sync_blocks(...):\r\n node_from = select node with max height\r\n for i in range(max(blockheight)):\r\n  b = node_from.getblock(lbockhash=node_from.getblockhash(i), verbose=0)\r\n  for n in nodes:\r\n    n.submitblock(b)",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T00:33:12Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417005666",
      "id" : 417005666,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAwNTY2Ng==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402303434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417005666",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417226610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417226610"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. Have tried it, but the v0.15.2 node doesn't expand its chain with submitted blocks. Interestingly, in its blockchaininfo the header count gets increased while block count remains at 0. The other node, v0.16.3 is working fine. Here my variant of *dumb_sync_blocks*\r\n\r\n```python\r\ndef dumb_sync_blocks(self):\r\n    node_from = self.nodes[0]\r\n    to_height = node_from.getblockheader(node_from.getbestblockhash())['height']\r\n    for n in range(1, len(self.nodes)):\r\n        height = self.nodes[n].getblockheader(self.nodes[n].getbestblockhash())['height']\r\n        for i in range(height, to_height+1):\r\n            b = node_from.getblock(blockhash=node_from.getblockhash(i), verbose=0)\r\n            self.nodes[n].submitblock(b)\r\n        new_height = self.nodes[n].getblockheader(self.nodes[n].getbestblockhash())['height']\r\n        print(\"node: {}, new best height: {}\".format(n, new_height))\r\n```\r\n\r\nThe output is like this:\r\n\r\n```shell\r\nnode: 1, new best height: 101\r\nnode: 2, new best height: 0\r\n```\r\n\r\nHere their respective blockchaininfo jsons:\r\n\r\n**v0.16.3**\r\n```js\r\n{\r\n'chain': 'regtest', \r\n'blocks': 101, \r\n'headers': 101, \r\n'bestblockhash': '1a2f4021b111f20b12071bb68c92dc0037a2237ae034b345b002971dbb9f5e16', }\r\n```\r\n\r\n**v0.15.2**\r\n```js\r\n{\r\n'chain': 'regtest', \r\n'blocks': 0, \r\n'headers': 101, \r\n'bestblockhash': '0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206' }\r\n```\r\n\r\nIn the test code I am sending some coins to both wallets and then calling *dumb_sync_blocks* to update all chains.\r\n\r\n```python\r\nnode_master.generatetoaddress(101, v16_3_address)\r\nself.dumb_sync_blocks()\r\n```",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T10:51:26Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417226610",
      "id" : 417226610,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIyNjYxMA==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402556195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417226610",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417261359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417261359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, right. regtest was hardforked",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T12:01:32Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417261359",
      "id" : 417261359,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2MTM1OQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402598924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417261359",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417264205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417264205"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, then I will be doing balance tests with v0.16.3 only? v0.15.2 can still be used for upgrade tests. Is this acceptable?",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T12:07:02Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417264205",
      "id" : 417264205,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2NDIwNQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402602542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417264205",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417265823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417265823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It might be possible to apply a hack and either:\r\n\r\n* never produce witnesses (use legacy-1-addresses)\r\n* maybe strip the witness from the blocks before submitting, but I doubt that works because VERIFY_WITNESS should be enforced from genesis, always.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T12:10:07Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417265823",
      "id" : 417265823,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2NTgyMw==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402604630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417265823",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417266415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417266415"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You don't have to do this, I am happy to merge the pull in its current state. Just let me know.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T12:11:19Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417266415",
      "id" : 417266415,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2NjQxNQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402605435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417266415",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417268839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417268839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. I think I should try to implement it. If it works, fine. If not, then you can merge the current state. Will come back to you later.",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T12:15:57Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417268839",
      "id" : 417268839,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2ODgzOQ==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402608545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417268839",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417313080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417313080"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Well, I have managed to sync the chains, but there is no way to make proper transactions. I have stolen a few things from *p2p_segwit*, like *build_next_block* for manual block generation and syncing:\r\n\r\n```js\r\nnode: 1, new best height: 101\r\nnode: 2, new best height: 101\r\n{\r\n'chain': 'regtest', \r\n'blocks': 101, \r\n'headers': 101, \r\n'bestblockhash': '0f2cfae3d63464c070eea6a8305f6f02245e69f41987c186da1c7f8af2bb1547', }\r\n{\r\n'chain': 'regtest', \r\n'blocks': 101, \r\n'headers': 101, \r\n'bestblockhash': '0f2cfae3d63464c070eea6a8305f6f02245e69f41987c186da1c7f8af2bb1547'}\r\n``` \r\n\r\nHowever, I see no way how to update balance of v0.15.2 as I'd need to build a transaction that would have to have the witness field.\r\n\r\nI will now push the latest changes.\r\n\r\n\r\n",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T13:28:01Z",
      "diff_hunk" : "@@ -0,0 +1,125 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        self.nodes[0].generatetoaddress(101, self.nodes[0].getnewaddress())\n+        # # Sanity check the test framework:\n+        res = self.nodes[0].getblockchaininfo()\n+        assert_equal(res['blocks'], 101)\n+        node_master = self.nodes[0]\n+        v16_3_node  = self.nodes[1]\n+        v15_2_node  = self.nodes[2]\n+\n+        self.log.info(\"Test upgradewallet RPC...\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417313080",
      "id" : 417313080,
      "in_reply_to_id" : 416967844,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxMzA4MA==",
      "original_commit_id" : "84267045efbfbe2a035e7f34851f1b3bc9964be8",
      "original_line" : 103,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 103,
      "pull_request_review_id" : 402664356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417313080",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417318100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417318100"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    with open(conf_file, 'w', encoding='utf8') as conf:\r\n```\r\n\r\nno need for the read flag",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T13:34:45Z",
      "diff_hunk" : "@@ -326,6 +326,13 @@ def initialize_datadir(dirname, n, chain):\n         os.makedirs(os.path.join(datadir, 'stdout'), exist_ok=True)\n     return datadir\n \n+def adjust_bitcoin_conf_for_pre_17(conf_file):\n+    with open(conf_file,'r', encoding='utf8') as conf:\n+        conf_data = conf.read()\n+    with open(conf_file, 'w+', encoding='utf8') as conf:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417318100",
      "id" : 417318100,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxODEwMA==",
      "original_commit_id" : "fa016debd2b2e9caad95e3e481de55f0776745ed",
      "original_line" : 332,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 402670677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417318100",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417319631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417319631"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        to_height = node_from.getblockcount()\r\n```",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T13:36:46Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than,\n+    assert_is_hex_string\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def dumb_sync_blocks(self):\n+        \"\"\"\n+        Little helper to sync older wallets. \n+        Notice that v0.15.2's regtest is hardforked, so there is \n+        actually no sync for it. v0.15.2 is only being used\n+        to test version upgrade and master hash key presence.\n+        v0.16.3 is being used to test version upgrade and balances.\n+        Further info: https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844\n+        \"\"\"\n+        node_from = self.nodes[0]\n+        to_height = node_from.getblockheader(node_from.getbestblockhash())['height']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417319631",
      "id" : 417319631,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxOTYzMQ==",
      "original_commit_id" : "d4fab8820cb33fd4c8a57c6746a0e2d552236487",
      "original_line" : 77,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 402670677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417319631",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417319999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417319999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            height = self.nodes[n].getblockcount()\r\n```",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T13:37:17Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than,\n+    assert_is_hex_string\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def dumb_sync_blocks(self):\n+        \"\"\"\n+        Little helper to sync older wallets. \n+        Notice that v0.15.2's regtest is hardforked, so there is \n+        actually no sync for it. v0.15.2 is only being used\n+        to test version upgrade and master hash key presence.\n+        v0.16.3 is being used to test version upgrade and balances.\n+        Further info: https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844\n+        \"\"\"\n+        node_from = self.nodes[0]\n+        to_height = node_from.getblockheader(node_from.getbestblockhash())['height']\n+        for n in range(1, len(self.nodes)):\n+            height = self.nodes[n].getblockheader(self.nodes[n].getbestblockhash())['height']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417319999",
      "id" : 417319999,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxOTk5OQ==",
      "original_commit_id" : "d4fab8820cb33fd4c8a57c6746a0e2d552236487",
      "original_line" : 79,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 402670677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417319999",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417321394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417321394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            assert_equal(self.nodes[n].getblockcount(), to_height)\r\n```",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T13:39:12Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than,\n+    assert_is_hex_string\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def dumb_sync_blocks(self):\n+        \"\"\"\n+        Little helper to sync older wallets. \n+        Notice that v0.15.2's regtest is hardforked, so there is \n+        actually no sync for it. v0.15.2 is only being used\n+        to test version upgrade and master hash key presence.\n+        v0.16.3 is being used to test version upgrade and balances.\n+        Further info: https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844\n+        \"\"\"\n+        node_from = self.nodes[0]\n+        to_height = node_from.getblockheader(node_from.getbestblockhash())['height']\n+        for n in range(1, len(self.nodes)):\n+            height = self.nodes[n].getblockheader(self.nodes[n].getbestblockhash())['height']\n+            for i in range(height, to_height+1):\n+                b = node_from.getblock(blockhash=node_from.getblockhash(i), verbose=0)\n+                self.nodes[n].submitblock(b)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417321394",
      "id" : 417321394,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMTM5NA==",
      "original_commit_id" : "d4fab8820cb33fd4c8a57c6746a0e2d552236487",
      "original_line" : 85,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 85,
      "pull_request_review_id" : 402670677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417321394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417342273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417342273"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. Btw., have tried to add you as Co-Author, but couldn't find your email or \"no-reply\" email. ",
      "commit_id" : "66fe7b1a98c03f690dcf60d359baac124658aeae",
      "created_at" : "2020-04-29T14:06:39Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"upgradewallet RPC functional test\n+\n+Test upgradewallet RPC. Download v0.15.2 v0.16.3 node binaries:\n+\n+contrib/devtools/previous_release.sh -b v0.15.2 v0.16.3\n+\"\"\"\n+\n+import os\n+import shutil\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import (\n+    adjust_bitcoin_conf_for_pre_17,\n+    assert_equal,\n+    assert_greater_than,\n+    assert_is_hex_string\n+)\n+\n+class UpgradeWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        self.extra_args = [\n+            [\"-addresstype=bech32\"], # current wallet version\n+            [\"-usehd=1\"],            # v0.16.3 wallet\n+            [\"-usehd=0\"]             # v0.15.2 wallet\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def setup_nodes(self):\n+        if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"false\":\n+            raise SkipTest(\"upgradewallet RPC tests\")\n+\n+        releases_path = os.getenv(\"PREVIOUS_RELEASES_DIR\") or os.getcwd() + \"/releases\"\n+        if not os.path.isdir(releases_path):\n+            if os.getenv(\"TEST_PREVIOUS_RELEASES\") == \"true\":\n+                raise AssertionError(\"TEST_PREVIOUS_RELEASES=1 but releases missing: \" + releases_path)\n+            raise SkipTest(\"This test requires binaries for previous releases\")\n+\n+        self.add_nodes(self.num_nodes, extra_args=self.extra_args, versions=[\n+            None,\n+            160300,\n+            150200\n+        ], binary=[\n+            self.options.bitcoind,\n+            releases_path + \"/v0.16.3/bin/bitcoind\",\n+            releases_path + \"/v0.15.2/bin/bitcoind\",\n+        ], binary_cli=[\n+            self.options.bitcoincli,\n+            releases_path + \"/v0.16.3/bin/bitcoin-cli\",\n+            releases_path + \"/v0.15.2/bin/bitcoin-cli\",\n+        ])\n+        # adapt bitcoin.conf, because older bitcoind's don't recognize config sections\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[1].bitcoinconf)\n+        adjust_bitcoin_conf_for_pre_17(self.nodes[2].bitcoinconf)\n+        self.start_nodes()\n+\n+    def dumb_sync_blocks(self):\n+        \"\"\"\n+        Little helper to sync older wallets. \n+        Notice that v0.15.2's regtest is hardforked, so there is \n+        actually no sync for it. v0.15.2 is only being used\n+        to test version upgrade and master hash key presence.\n+        v0.16.3 is being used to test version upgrade and balances.\n+        Further info: https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844\n+        \"\"\"\n+        node_from = self.nodes[0]\n+        to_height = node_from.getblockheader(node_from.getbestblockhash())['height']\n+        for n in range(1, len(self.nodes)):\n+            height = self.nodes[n].getblockheader(self.nodes[n].getbestblockhash())['height']\n+            for i in range(height, to_height+1):\n+                b = node_from.getblock(blockhash=node_from.getblockhash(i), verbose=0)\n+                self.nodes[n].submitblock(b)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18774#discussion_r417342273",
      "id" : 417342273,
      "in_reply_to_id" : 417321394,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM0MjI3Mw==",
      "original_commit_id" : "d4fab8820cb33fd4c8a57c6746a0e2d552236487",
      "original_line" : 85,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 85,
      "pull_request_review_id" : 402701775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T14:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417342273",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   }
]
