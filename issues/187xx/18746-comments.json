[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #17487 (coins: allow write to disk without cache drop by jamesob)\n* #9384 (CCoinsViewCache code cleanup & deduplication by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-23T10:02:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-618308518",
      "id" : 618308518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODMwODUxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-10T23:56:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618308518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, and code change looks good. No strong background in coins management to ACK though.",
      "created_at" : "2020-04-26T14:51:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-619564591",
      "id" : 619564591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTU2NDU5MQ==",
      "updated_at" : "2020-04-26T14:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619564591",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "New logic makes sense. \r\nConcept ACK (as I have no deep knowledge on coin management).",
      "created_at" : "2020-05-01T10:22:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-622332573",
      "id" : 622332573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjMzMjU3Mw==",
      "updated_at" : "2020-05-01T10:22:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622332573",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18746#discussion_r422263074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422263074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"no need to put it into this cache\" (we already fetched it)",
      "commit_id" : "c9849da1485458824851e56995b5470288d0372a",
      "created_at" : "2020-05-08T17:13:02Z",
      "diff_hunk" : "@@ -44,14 +44,12 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     if (it != cacheCoins.end())\n         return it;\n     Coin tmp;\n-    if (!base->GetCoin(outpoint, tmp))\n+    if (!base->GetCoin(outpoint, tmp) || tmp.IsSpent()) {\n+        // If we find a spent coin in the parent cache, no\n+        // need to fetch it into this cache.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#discussion_r422263074",
      "id" : 422263074,
      "line" : 49,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI2MzA3NA==",
      "original_commit_id" : "c9849da1485458824851e56995b5470288d0372a",
      "original_line" : 49,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 7,
      "pull_request_review_id" : 408387834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-08T17:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422263074",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18746#discussion_r422273680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422273680"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe add: \"A spent coin should never be added to the cache.\"",
      "commit_id" : "c9849da1485458824851e56995b5470288d0372a",
      "created_at" : "2020-05-08T17:34:20Z",
      "diff_hunk" : "@@ -166,20 +164,22 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.flags & CCoinsCacheEntry::FRESH && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.flags = CCoinsCacheEntry::DIRTY;\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.flags & CCoinsCacheEntry::FRESH) {\n-                    entry.flags |= CCoinsCacheEntry::FRESH;\n-                }\n+            if (it->second.flags & CCoinsCacheEntry::FRESH && it->second.coin.IsSpent()) {\n+                // A coin shouldn't be marked FRESH and spent (when a FRESH coin is spent,\n+                // it should be removed from the cache).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#discussion_r422273680",
      "id" : 422273680,
      "line" : 169,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI3MzY4MA==",
      "original_commit_id" : "c9849da1485458824851e56995b5470288d0372a",
      "original_line" : 169,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 39,
      "pull_request_review_id" : 408387834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-08T17:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422273680",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What's the rationale for changing this? Even if it's stylistically cleaner, I don't think it's worth changing semantics here unless there's a demonstrable performance benefit.",
      "created_at" : "2020-05-19T18:57:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-631016452",
      "id" : 631016452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTAxNjQ1Mg==",
      "updated_at" : "2020-05-19T18:57:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631016452",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What's the rationale for changing this?\r\n\r\nThere's an inconsistency between how we treat spending a fresh coin in the cache (erase it ie don't allow the coin to be spent and FRESH), and what we do when we encounter a spent coin in the parent cache (add it to the cache as spent and FRESH). This change removes that inconsistency and adds the invariant that no coin can be spent and FRESH in any cache.\r\n\r\nThere's unlikely to be any noticeable performance change here. After all, it's very rare that we'll fetch a spent coin from a parent cache (which I'd argue is all the more reason to remove the special case code for that).\r\n\r\nI think this is an improvement to clarity, but you may be right that it's not worth changing.",
      "created_at" : "2020-05-19T19:35:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-631037370",
      "id" : 631037370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTAzNzM3MA==",
      "updated_at" : "2020-05-19T19:35:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631037370",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18746#discussion_r430064663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430064663"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The whole function we are in here is called `FetchCoin` so I would understand \"fetching\" as everything that is going on in his function and not the fetch into a temp variable, so for me this is ok.",
      "commit_id" : "c9849da1485458824851e56995b5470288d0372a",
      "created_at" : "2020-05-25T20:16:22Z",
      "diff_hunk" : "@@ -44,14 +44,12 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     if (it != cacheCoins.end())\n         return it;\n     Coin tmp;\n-    if (!base->GetCoin(outpoint, tmp))\n+    if (!base->GetCoin(outpoint, tmp) || tmp.IsSpent()) {\n+        // If we find a spent coin in the parent cache, no\n+        // need to fetch it into this cache.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#discussion_r430064663",
      "id" : 430064663,
      "in_reply_to_id" : 422263074,
      "line" : 49,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA2NDY2Mw==",
      "original_commit_id" : "c9849da1485458824851e56995b5470288d0372a",
      "original_line" : 49,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 7,
      "pull_request_review_id" : 417864580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T20:30:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430064663",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think this is an improvement to clarity, but you may be right that it's not worth changing.\r\n\r\nI think it is, because we're changing this code for UTXO snapshots. The increased clarity should make those reviews (slightly) easier, something I bumped into myself: https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427512576",
      "created_at" : "2020-05-28T08:46:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-635207376",
      "id" : 635207376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTIwNzM3Ng==",
      "updated_at" : "2020-05-28T08:46:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635207376",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Touching the heart of consensus-critical code and modifying behavior therein, even if just for an unlikely corner case, should IMHO come with very substantial motivation. \r\n\r\nThis is right on the knife's edge. I agree that it's unlikely this change in behavior would change consensus, but it sets a precedent that I'm not totally comfortable with.\r\n\r\nTo be honest I'd rather abandon the UTXO snapshot-related optimization changes (https://github.com/bitcoin/bitcoin/pull/17487) than invite behavioral changes to coins cache solely on the basis of readability or clarity.",
      "created_at" : "2020-05-28T14:15:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-635376865",
      "id" : 635376865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTM3Njg2NQ==",
      "updated_at" : "2020-05-28T14:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635376865",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There aren't any dependencies between this and #17487, so I'm not sure that discussion of that PR is relevant here. I do however think it'd be a shame to abandon that PR. It's received substantial review from >10 contributors and the general reception was positive. In general, the decision to proceed with or abandon a PR should be based on the merit of that PR alone.",
      "created_at" : "2020-05-28T15:11:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-635411441",
      "id" : 635411441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTQxMTQ0MQ==",
      "updated_at" : "2020-05-28T16:16:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635411441",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Is the FetchCoin change covered by any testing here? I think it might not be, given that:\r\n\r\n* CCoinsViewCache::GetCoin already returns false if the coin was spent: https://github.com/bitcoin/bitcoin/blob/2f71a1ea35667b3873197201531e7ae198ec5bf4/src/coins.cpp#L61-L64\r\n\r\n* SingleEntryCacheTest in coins_test.cpp uses a (subclass of) CCoinsViewCache for both the parent and the child: https://github.com/bitcoin/bitcoin/blob/2f71a1ea35667b3873197201531e7ae198ec5bf4/src/test/coins_tests.cpp#L627-L628\r\n\r\n* This test case existed and passed even before your change:\r\n\r\n                        Base    Cache   Result  Cache        Result\r\n                        Value   Value   Value   Flags        Flags\r\n        CheckAccessCoin(SPENT , ABSENT, ABSENT, NO_ENTRY   , NO_ENTRY   );",
      "created_at" : "2020-10-17T00:13:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-710705262",
      "id" : 710705262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMDcwNTI2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-17T00:13:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/710705262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4276679?v=4",
         "events_url" : "https://api.github.com/users/robot-dreams/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-dreams/followers",
         "following_url" : "https://api.github.com/users/robot-dreams/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-dreams/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-dreams",
         "id" : 4276679,
         "login" : "robot-dreams",
         "node_id" : "MDQ6VXNlcjQyNzY2Nzk=",
         "organizations_url" : "https://api.github.com/users/robot-dreams/orgs",
         "received_events_url" : "https://api.github.com/users/robot-dreams/received_events",
         "repos_url" : "https://api.github.com/users/robot-dreams/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-dreams/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-dreams"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @robot-dreams. Excellent observation!\r\n\r\nI've updated `CCoinsViewCache::FetchCoin()` to assert that the coin returned from `GetCoin()` is not spent.\r\n\r\nI've also had to add a commit that changes the coins_tests unit test, since `CCoinsViewTest::GetCoin()` would sometimes return true even if the coin returned was empty (`IsSpent() == true`).\r\n\r\nI'm fairly confident that this is a good change, and I very much like adding invariants that remove the possibility of the program being in an inconsistent state. However, I'm going to close this PR for now since it hasn't received much attention over the year it's been open. We can always re-open it later if there's demand to clean up the coins interface. I also think if we were redesigning these interfaces now, we'd probably return a `std::optional<>` type to avoid having to return a bool _and_ have an in/out param, and also to avoid having a special `coinEmpty` marker.",
      "created_at" : "2021-05-17T14:56:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-842393167",
      "id" : 842393167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MjM5MzE2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-17T14:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842393167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "For the benefit of anyone who does revisit this closed PR at a later date (including perhaps myself), this PR was spun out of https://github.com/bitcoin/bitcoin/pull/18113 (the comments part was merged in https://github.com/bitcoin/bitcoin/pull/18410 and the consensus code changes were in this PR).\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/18113 was covered in [this](https://bitcoincore.reviews/18113) Bitcoin Core PR review club and includes a handy explanation of the validity of possible states (combinations of spent/unspent, fresh/not fresh, dirty/not dirty).",
      "created_at" : "2021-05-17T16:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-842480511",
      "id" : 842480511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MjQ4MDUxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-17T16:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842480511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   }
]
