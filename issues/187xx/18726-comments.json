[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2020-04-22T00:43:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18726#issuecomment-617482903",
      "id" : 617482903,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzQ4MjkwMw==",
      "updated_at" : "2020-04-24T18:37:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617482903",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK -- nit: now with so many small tests for checking the size limits, you could put them all in a new method of the test?",
      "created_at" : "2020-04-22T11:29:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18726#issuecomment-617720234",
      "id" : 617720234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzcyMDIzNA==",
      "updated_at" : "2020-04-22T11:29:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617720234",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Good idea, updated!  And thanks for the review.",
      "created_at" : "2020-04-22T17:39:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18726#issuecomment-617926835",
      "id" : 617926835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkyNjgzNQ==",
      "updated_at" : "2020-04-22T17:39:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617926835",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/63171930?v=4",
         "events_url" : "https://api.github.com/users/robot-visions/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-visions/followers",
         "following_url" : "https://api.github.com/users/robot-visions/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-visions/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-visions",
         "id" : 63171930,
         "login" : "robot-visions",
         "node_id" : "MDQ6VXNlcjYzMTcxOTMw",
         "organizations_url" : "https://api.github.com/users/robot-visions/orgs",
         "received_events_url" : "https://api.github.com/users/robot-visions/received_events",
         "repos_url" : "https://api.github.com/users/robot-visions/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-visions/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-visions/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-visions"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18726#discussion_r415055337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415055337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: explicitely setting `nTweak` and `nFlags` is not needed here",
      "commit_id" : "cd543d9193ac1882c1b4a8a84e3ac7356a8b7ce9",
      "created_at" : "2020-04-25T12:43:01Z",
      "diff_hunk" : "@@ -64,19 +64,40 @@ def set_test_params(self):\n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n-    def run_test(self):\n-        filter_node = self.nodes[0].add_p2p_connection(FilterNode())\n-\n+    def test_size_limits(self, filter_node):\n         self.log.info('Check that too large filter is rejected')\n-        with self.nodes[0].assert_debug_log(['Misbehaving']):\n-            filter_node.send_and_ping(msg_filterload(data=b'\\xaa', nHashFuncs=MAX_BLOOM_HASH_FUNCS+1))\n         with self.nodes[0].assert_debug_log(['Misbehaving']):\n             filter_node.send_and_ping(msg_filterload(data=b'\\xbb'*(MAX_BLOOM_FILTER_SIZE+1)))\n \n+        self.log.info('Check that max size filter is accepted')\n+        with self.nodes[0].assert_debug_log([], unexpected_msgs=['Misbehaving']):\n+            filter_node.send_and_ping(msg_filterload(data=b'\\xbb'*(MAX_BLOOM_FILTER_SIZE)))\n+        filter_node.send_and_ping(msg_filterclear())\n+\n+        self.log.info('Check that filter with too many hash functions is rejected')\n+        with self.nodes[0].assert_debug_log(['Misbehaving']):\n+            filter_node.send_and_ping(msg_filterload(data=b'\\xaa', nHashFuncs=MAX_BLOOM_HASH_FUNCS+1))\n+\n+        self.log.info('Check that filter with max hash functions is accepted')\n+        with self.nodes[0].assert_debug_log([], unexpected_msgs=['Misbehaving']):\n+            filter_node.send_and_ping(msg_filterload(data=b'\\xaa', nHashFuncs=MAX_BLOOM_HASH_FUNCS, nTweak=0, nFlags=1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18726#discussion_r415055337",
      "id" : 415055337,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA1NTMzNw==",
      "original_commit_id" : "edf2491c733c9063c22e2cb8e04b1c3af874d79e",
      "original_line" : 83,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/p2p_filter.py",
      "position" : null,
      "pull_request_review_id" : 400390239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T16:29:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415055337",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18726#discussion_r415095675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415095675"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed, thanks!",
      "commit_id" : "cd543d9193ac1882c1b4a8a84e3ac7356a8b7ce9",
      "created_at" : "2020-04-25T16:29:44Z",
      "diff_hunk" : "@@ -64,19 +64,40 @@ def set_test_params(self):\n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n-    def run_test(self):\n-        filter_node = self.nodes[0].add_p2p_connection(FilterNode())\n-\n+    def test_size_limits(self, filter_node):\n         self.log.info('Check that too large filter is rejected')\n-        with self.nodes[0].assert_debug_log(['Misbehaving']):\n-            filter_node.send_and_ping(msg_filterload(data=b'\\xaa', nHashFuncs=MAX_BLOOM_HASH_FUNCS+1))\n         with self.nodes[0].assert_debug_log(['Misbehaving']):\n             filter_node.send_and_ping(msg_filterload(data=b'\\xbb'*(MAX_BLOOM_FILTER_SIZE+1)))\n \n+        self.log.info('Check that max size filter is accepted')\n+        with self.nodes[0].assert_debug_log([], unexpected_msgs=['Misbehaving']):\n+            filter_node.send_and_ping(msg_filterload(data=b'\\xbb'*(MAX_BLOOM_FILTER_SIZE)))\n+        filter_node.send_and_ping(msg_filterclear())\n+\n+        self.log.info('Check that filter with too many hash functions is rejected')\n+        with self.nodes[0].assert_debug_log(['Misbehaving']):\n+            filter_node.send_and_ping(msg_filterload(data=b'\\xaa', nHashFuncs=MAX_BLOOM_HASH_FUNCS+1))\n+\n+        self.log.info('Check that filter with max hash functions is accepted')\n+        with self.nodes[0].assert_debug_log([], unexpected_msgs=['Misbehaving']):\n+            filter_node.send_and_ping(msg_filterload(data=b'\\xaa', nHashFuncs=MAX_BLOOM_HASH_FUNCS, nTweak=0, nFlags=1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18726#discussion_r415095675",
      "id" : 415095675,
      "in_reply_to_id" : 415055337,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA5NTY3NQ==",
      "original_commit_id" : "edf2491c733c9063c22e2cb8e04b1c3af874d79e",
      "original_line" : 83,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/p2p_filter.py",
      "position" : null,
      "pull_request_review_id" : 400409148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T16:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415095675",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/63171930?v=4",
         "events_url" : "https://api.github.com/users/robot-visions/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-visions/followers",
         "following_url" : "https://api.github.com/users/robot-visions/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-visions/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-visions",
         "id" : 63171930,
         "login" : "robot-visions",
         "node_id" : "MDQ6VXNlcjYzMTcxOTMw",
         "organizations_url" : "https://api.github.com/users/robot-visions/orgs",
         "received_events_url" : "https://api.github.com/users/robot-visions/received_events",
         "repos_url" : "https://api.github.com/users/robot-visions/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-visions/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-visions/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-visions"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK https://github.com/bitcoin/bitcoin/commit/cd543d9193ac1882c1b4a8a84e3ac7356a8b7ce9",
      "created_at" : "2020-04-25T16:43:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18726#issuecomment-619407398",
      "id" : 619407398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTQwNzM5OA==",
      "updated_at" : "2020-04-25T16:43:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619407398",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   }
]
