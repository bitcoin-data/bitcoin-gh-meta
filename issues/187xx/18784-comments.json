[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-04-28T10:48:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-620530816",
      "id" : 620530816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMDUzMDgxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-04-28T10:48:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620530816",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19673 (Move cs_vSend into SocketSendData and resolve RecordBytesSent lock inconsistency by troygiorshev)\n* #19509 (Per-Peer Message Capture by troygiorshev)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-23T01:41:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-662780381",
      "id" : 662780381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Mjc4MDM4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T10:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662780381",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "~ACK faae6ca9e8a3f67c737c03e122fd315cef5e66d7~\r\n\r\n~Reviewed, ran tests.~\r\n\r\n~This is a nice readability improvement too ð~\r\n\r\nChanged my mind, see below.",
      "created_at" : "2020-07-24T12:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-663522773",
      "id" : 663522773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzUyMjc3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T21:45:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663522773",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> getnettotals returns \"stale\" values or values that don't add up\r\n\r\nCan you explain this a bit? What do the values not add up to? As far as I can tell, `getnettotals` simply returns the totalbytessent and totalbytesreceived at some point in time. There are not consistency guarantees with subsequent calls to the `getpeerinfo` values.",
      "created_at" : "2020-07-31T16:36:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-667217798",
      "id" : 667217798,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NzIxNzc5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T16:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667217798",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've changed my mind on this one.  `getnettotals` and `getpeerinfo` are two separate rpcs, we shouldn't try and make them sync up.  `nTotalBytesSent` is separate from a node's `nSendBytes`.  Looking at the analogous structures on the receiving side, `nTotalBytesRecv` is clearly separate from `nRecvBytes`.\r\n\r\nHowever, I think a PR like this is needed to bring consistency between the two calls to `RecordBytesSent` (as it stands before this PR, one is under `cs_vSend` and the other is not).  I can see a few more improvements available too.",
      "created_at" : "2020-08-05T21:44:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-669529191",
      "id" : 669529191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTUyOTE5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T21:47:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669529191",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18784#discussion_r470912972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18784"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470912972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, drop `== true`.",
      "commit_id" : "faae6ca9e8a3f67c737c03e122fd315cef5e66d7",
      "created_at" : "2020-08-15T00:20:10Z",
      "diff_hunk" : "@@ -2760,11 +2758,11 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n             pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (optimisticSend == true) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#discussion_r470912972",
      "id" : 470912972,
      "line" : 2761,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxMjk3Mg==",
      "original_commit_id" : "faae6ca9e8a3f67c737c03e122fd315cef5e66d7",
      "original_line" : 2761,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 24,
      "pull_request_review_id" : 467929456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18784",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-15T00:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470912972",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18784#discussion_r470913264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18784"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470913264"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is conditionally called in 2 places, how about early return in `RecordBytesSent()` instead?",
      "commit_id" : "faae6ca9e8a3f67c737c03e122fd315cef5e66d7",
      "created_at" : "2020-08-15T00:22:17Z",
      "diff_hunk" : "@@ -2760,11 +2758,11 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n             pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (optimisticSend == true) {\n+            const size_t bytes_sent{SocketSendData(pnode)};\n+            if (bytes_sent) RecordBytesSent(bytes_sent);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#discussion_r470913264",
      "id" : 470913264,
      "line" : 2763,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxMzI2NA==",
      "original_commit_id" : "faae6ca9e8a3f67c737c03e122fd315cef5e66d7",
      "original_line" : 2763,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 467929456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18784",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-15T00:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470913264",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I've changed my mind on this one. getnettotals and getpeerinfo are two separate rpcs, we shouldn't try and make them sync up. nTotalBytesSent is separate from a node's nSendBytes. Looking at the analogous structures on the receiving side, nTotalBytesRecv is clearly separate from nRecvBytes.\r\n\r\nWhy are they separate? Let's assume we connect to a peer, send 100 bytes, disconnect. Send 100 bytes to another peer, then the total bytes sent should simply equal 200 bytes.",
      "created_at" : "2020-08-27T15:09:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682009846",
      "id" : 682009846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MjAwOTg0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T15:09:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682009846",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Why are they separate? Let's assume we connect to a peer, send 100 bytes, disconnect. Send 100 bytes to another peer, then the total bytes sent should simply equal 200 bytes.\r\n\r\nMaybe I'm completely off-base here, I'm not trying to make a big statement.\r\n\r\nIsn't it impossible to keep these RPCs synced?  They are two separate calls, something might happen in between them.\r\n\r\n1. Call `getnettotals`, note the value of `totalbytesrecv`\r\n2. node receives a message from another peer, of size 100 bytes\r\n3. Call `getpeerinfo`, see that the sum of `bytesrecv` for each node is 100 bytes more than `totalbytesrecv` from above",
      "created_at" : "2020-08-27T15:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682025637",
      "id" : 682025637,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MjAyNTYzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T15:35:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682025637",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, I see. The reason I created this pull was that a call to\r\n\r\n```\r\n        net_totals_before = self.nodes[0].getnettotals()\r\n        peer_info = self.nodes[0].getpeerinfo()\r\n        net_totals_after = self.nodes[0].getnettotals()\r\n```\r\n\r\nand then asserting that `before <= sum <= after` would sometimes fail.\r\n\r\nI haven't looked into #19673 so I am wondering if #19673 also fixes that issue.",
      "created_at" : "2020-08-27T15:51:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682034739",
      "id" : 682034739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MjAzNDczOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T15:51:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682034739",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "^\r\n\r\nWoah that shouldn't happen.  Will investigate.",
      "created_at" : "2020-08-27T15:57:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682038152",
      "id" : 682038152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MjAzODE1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T15:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682038152",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "#17107 ",
      "created_at" : "2020-08-27T16:14:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682047653",
      "id" : 682047653,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MjA0NzY1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T16:14:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682047653",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> a call to\r\n>\r\n>        net_totals_before = self.nodes[0].getnettotals()\r\n>        peer_info = self.nodes[0].getpeerinfo()\r\n>        net_totals_after = self.nodes[0].getnettotals()\r\n>\r\n> and then asserting that before <= sum <= after would sometimes fail.`\r\n\r\nWhat is `sum` here? Are you saying that `getnettotals.totalbytessent` can go down?\r\n\r\nI don't understand the problem you're trying to solve.",
      "created_at" : "2020-10-28T09:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717793951",
      "id" : 717793951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzc5Mzk1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T09:00:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717793951",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Are you saying that getnettotals.totalbytessent can go down?\r\n\r\nNo, it is returning the value it returned in a previous call. But getpeerinfo already returned the new correct value.\r\n\r\nhttps://github.com/bitcoin/bitcoin/issues/17107#issuecomment-541081114\r\n\r\n",
      "created_at" : "2020-10-28T09:19:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717804650",
      "id" : 717804650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzgwNDY1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T09:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717804650",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree with Wlad's assessment in that issue:\r\n\r\n> these are meant to be overall statistics, it doesn't seem super important that the net totals are immediately up to date.",
      "created_at" : "2020-10-28T09:34:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717812591",
      "id" : 717812591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzgxMjU5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T09:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717812591",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, then the test is wrong and should be removed:\r\n\r\n```diff\r\ndiff --git a/test/functional/rpc_net.py b/test/functional/rpc_net.py\r\nindex 03c858c694..afb67891af 100755\r\n--- a/test/functional/rpc_net.py\r\n+++ b/test/functional/rpc_net.py\r\n@@ -104,29 +104,15 @@ class NetTest(BitcoinTestFramework):\r\n \r\n     def test_getnettotals(self):\r\n         self.log.info(\"Test getnettotals\")\r\n-        # getnettotals totalbytesrecv and totalbytessent should be\r\n-        # consistent with getpeerinfo. Since the RPC calls are not atomic,\r\n-        # and messages might have been recvd or sent between RPC calls, call\r\n-        # getnettotals before and after and verify that the returned values\r\n-        # from getpeerinfo are bounded by those values.\r\n-        net_totals_before = self.nodes[0].getnettotals()\r\n         peer_info = self.nodes[0].getpeerinfo()\r\n-        net_totals_after = self.nodes[0].getnettotals()\r\n-        assert_equal(len(peer_info), 2)\r\n-        peers_recv = sum([peer['bytesrecv'] for peer in peer_info])\r\n-        peers_sent = sum([peer['bytessent'] for peer in peer_info])\r\n-\r\n-        assert_greater_than_or_equal(peers_recv, net_totals_before['totalbytesrecv'])\r\n-        assert_greater_than_or_equal(net_totals_after['totalbytesrecv'], peers_recv)\r\n-        assert_greater_than_or_equal(peers_sent, net_totals_before['totalbytessent'])\r\n-        assert_greater_than_or_equal(net_totals_after['totalbytessent'], peers_sent)\r\n+        net_totals = self.nodes[0].getnettotals()\r\n \r\n         # test getnettotals and getpeerinfo by doing a ping\r\n         # the bytes sent/received should change\r\n         # note ping and pong are 32 bytes each\r\n         self.nodes[0].ping()\r\n-        self.wait_until(lambda: (self.nodes[0].getnettotals()['totalbytessent'] >= net_totals_after['totalbytessent'] + 32 * 2), timeout=1)\r\n-        self.wait_until(lambda: (self.nodes[0].getnettotals()['totalbytesrecv'] >= net_totals_after['totalbytesrecv'] + 32 * 2), timeout=1)\r\n+        self.wait_until(lambda: (self.nodes[0].getnettotals()['totalbytessent'] >= net_totals['totalbytessent'] + 32 * 2), timeout=1)\r\n+        self.wait_until(lambda: (self.nodes[0].getnettotals()['totalbytesrecv'] >= net_totals['totalbytesrecv'] + 32 * 2), timeout=1)\r\n \r\n         peer_info_after_ping = self.nodes[0].getpeerinfo()\r\n         for before, after in zip(peer_info, peer_info_after_ping):\r\n",
      "created_at" : "2020-10-28T09:42:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717816363",
      "id" : 717816363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzgxNjM2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T09:42:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717816363",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> the test is wrong and should be removed:\r\n\r\nDone: #20258",
      "created_at" : "2020-10-28T10:19:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717836357",
      "id" : 717836357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzgzNjM1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T10:19:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717836357",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "thanks",
      "created_at" : "2020-10-28T10:21:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717837760",
      "id" : 717837760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzgzNzc2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T10:21:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717837760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
