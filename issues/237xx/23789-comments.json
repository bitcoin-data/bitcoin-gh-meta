[
   {
      "author_association" : "MEMBER",
      "body" : "Obviously this will fail tests and need docs fixed up. I'll do that unless there are NACKs.",
      "created_at" : "2021-12-15T20:17:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-995181272",
      "id" : 995181272,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847UULY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995181272/reactions"
      },
      "updated_at" : "2021-12-15T20:17:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995181272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-12-15T20:28:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-995189037",
      "id" : 995189037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847UWEt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995189037/reactions"
      },
      "updated_at" : "2021-12-15T20:28:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995189037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770029609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770029609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unknown witness versions should be included here too.",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-15T20:50:15Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770029609",
      "id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t5bgp",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833389512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770029609/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-15T20:50:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770029609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770033339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770033339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd say no. Otherwise, it will be trivial for chain-analysis to determine the change type if the outputs are {v2, v1, v0} and the input is {v1}",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-15T20:56:32Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770033339",
      "id" : 770033339,
      "in_reply_to_id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t5ca7",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833394975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770033339/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-15T20:56:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770033339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770041173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770041173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, but the intention is to use `OutputType::BECH32M` for future witness versions too. v2 outputs will have bech32m addresses. If you had a v2 descriptor as active, it would take the slot that tr descriptors would currently occupy so a tx with a taproot output would have a v2 as change under this logic.",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-15T21:09:19Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770041173",
      "id" : 770041173,
      "in_reply_to_id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t5eVV",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833406302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770041173/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-15T21:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770041173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770044571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770044571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is impossible to do unless the specification of v2 is known.\r\n\r\nIf I use UNKNOWN here and V2 is specified, then UNKNOWN will *not* match V2. Before V2 is defined, it is not possible to match it. As soon as V2 is defined, it can be matched. So this is something for a follow-up when the time is right.",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-15T21:14:51Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770044571",
      "id" : 770044571,
      "in_reply_to_id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t5fKb",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833411072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770044571/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-15T21:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770044571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770053349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770053349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, but I think we should handle UNKNOWN here too as one of the explicitly stated goals of bech32(m) is to allow sending to future segwit versions without needing to know about them. When a new version's TxoutType is added, it needs to be added here as well, but we should always handle UNKNOWN regardless.",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-15T21:29:11Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770053349",
      "id" : 770053349,
      "in_reply_to_id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t5hTl",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833422986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770053349/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-15T21:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770053349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-12-15T22:33:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-995266886",
      "id" : 995266886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847UpFG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995266886/reactions"
      },
      "updated_at" : "2021-12-15T22:33:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995266886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770268256"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770268256"
         }
      },
      "author_association" : "MEMBER",
      "body" : "UNKNOWN is handled. Obviously it is impossible to match, but it is treated like any other type that can't be matched (wsh, pk, raw multisig, raw data, ...).\r\n\r\nHappy to add a comment, but the algorithm is:\r\n\r\n* find any types that can theoretically be matched\r\n* try to match them if there is a spkman\r\n* fallback to bech32(m) (Note: This will happen if *all* outputs are unmatchable. For example all are v2)",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-16T06:59:06Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770268256",
      "id" : 770268256,
      "in_reply_to_id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t6Vxg",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833705982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770268256/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-16T06:59:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770268256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770269547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770269547"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure what to do here, but I think you'll have to send me a sketch of a diff to clarify what you mean.",
      "commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "created_at" : "2021-12-16T07:02:21Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r770269547",
      "id" : 770269547,
      "in_reply_to_id" : 770029609,
      "line" : 1951,
      "node_id" : "PRRC_kwDOABII584t6WFr",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1951,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 833707794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770269547/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-16T07:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770269547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-12-16T09:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-995578297",
      "id" : 995578297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847V1G5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995578297/reactions"
      },
      "updated_at" : "2021-12-16T09:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995578297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771121882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771121882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should the log line above also change to `bech32`? ",
      "commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "created_at" : "2021-12-17T05:56:22Z",
      "diff_hunk" : "@@ -348,9 +348,9 @@ def run_test(self):\n         if self.options.descriptors:\n             self.log.info(\"Nodes with addresstype=p2sh-segwit only use a bech32m change output if any destination address is bech32:\")\n             self.test_change_output_type(1, [to_address_p2sh], 'p2sh-segwit')\n-            self.test_change_output_type(1, [to_address_bech32_1], 'bech32m')\n-            self.test_change_output_type(1, [to_address_p2sh, to_address_bech32_1], 'bech32m')\n-            self.test_change_output_type(1, [to_address_bech32_1, to_address_bech32_2], 'bech32m')\n+            self.test_change_output_type(1, [to_address_bech32_1], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771121882",
      "id" : 771121882,
      "line" : 351,
      "node_id" : "PRRC_kwDOABII584t9mLa",
      "original_commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "original_line" : 351,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : 7,
      "pull_request_review_id" : 834859756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771121882/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T06:30:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771121882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771128713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771128713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The log comment above this lines aren't valid anymore.\r\n\r\n",
      "commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "created_at" : "2021-12-17T06:16:45Z",
      "diff_hunk" : "@@ -364,12 +364,12 @@ def run_test(self):\n \n         if self.options.descriptors:\n             self.log.info(\"Nodes with addresstype=bech32 always use either a bech32 or bech32m change output (unless changetype is set otherwise):\")\n-            self.test_change_output_type(3, [to_address_bech32_1], 'bech32m')\n-            self.test_change_output_type(3, [to_address_p2sh], 'bech32')\n+            self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+            self.test_change_output_type(3, [to_address_p2sh], 'p2sh-segwit')\n         else:\n             self.log.info(\"Nodes with addresstype=bech32 always use a P2WPKH change output (unless changetype is set otherwise):\")\n             self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n-            self.test_change_output_type(3, [to_address_p2sh], 'bech32')\n+            self.test_change_output_type(3, [to_address_p2sh], 'p2sh-segwit')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771128713",
      "id" : 771128713,
      "line" : 372,
      "node_id" : "PRRC_kwDOABII584t9n2J",
      "original_commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "original_line" : 372,
      "original_position" : 25,
      "original_start_line" : 367,
      "path" : "test/functional/wallet_address_types.py",
      "position" : 25,
      "pull_request_review_id" : 834859756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771128713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 367,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-17T06:30:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771128713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771132007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771132007"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems now the change type behavior for both type of wallets is same. So this can be removed?  ",
      "commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "created_at" : "2021-12-17T06:25:55Z",
      "diff_hunk" : "@@ -348,9 +348,9 @@ def run_test(self):\n         if self.options.descriptors:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771132007",
      "id" : 771132007,
      "line" : 348,
      "node_id" : "PRRC_kwDOABII584t9opn",
      "original_commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "original_line" : 348,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : 1,
      "pull_request_review_id" : 834859756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771132007/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T06:30:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771132007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771147634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771147634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thx, done",
      "commit_id" : "fada6c65d23f7bd4682fac281026612b835c4f8b",
      "created_at" : "2021-12-17T07:00:47Z",
      "diff_hunk" : "@@ -348,9 +348,9 @@ def run_test(self):\n         if self.options.descriptors:\n             self.log.info(\"Nodes with addresstype=p2sh-segwit only use a bech32m change output if any destination address is bech32:\")\n             self.test_change_output_type(1, [to_address_p2sh], 'p2sh-segwit')\n-            self.test_change_output_type(1, [to_address_bech32_1], 'bech32m')\n-            self.test_change_output_type(1, [to_address_p2sh, to_address_bech32_1], 'bech32m')\n-            self.test_change_output_type(1, [to_address_bech32_1, to_address_bech32_2], 'bech32m')\n+            self.test_change_output_type(1, [to_address_bech32_1], 'bech32')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771147634",
      "id" : 771147634,
      "in_reply_to_id" : 771121882,
      "line" : 351,
      "node_id" : "PRRC_kwDOABII584t9sdy",
      "original_commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "original_line" : 351,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : 10,
      "pull_request_review_id" : 834892467,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771147634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T07:00:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771147634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771147886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771147886"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the whole test needs to be re-written from scratch, but I want to keep the changes minimal here.",
      "commit_id" : "fada6c65d23f7bd4682fac281026612b835c4f8b",
      "created_at" : "2021-12-17T07:01:25Z",
      "diff_hunk" : "@@ -348,9 +348,9 @@ def run_test(self):\n         if self.options.descriptors:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771147886",
      "id" : 771147886,
      "in_reply_to_id" : 771132007,
      "line" : 348,
      "node_id" : "PRRC_kwDOABII584t9shu",
      "original_commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "original_line" : 348,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : 3,
      "pull_request_review_id" : 834892840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771147886/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T07:01:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771147886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771148002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771148002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thx, done",
      "commit_id" : "fada6c65d23f7bd4682fac281026612b835c4f8b",
      "created_at" : "2021-12-17T07:01:41Z",
      "diff_hunk" : "@@ -364,12 +364,12 @@ def run_test(self):\n \n         if self.options.descriptors:\n             self.log.info(\"Nodes with addresstype=bech32 always use either a bech32 or bech32m change output (unless changetype is set otherwise):\")\n-            self.test_change_output_type(3, [to_address_bech32_1], 'bech32m')\n-            self.test_change_output_type(3, [to_address_p2sh], 'bech32')\n+            self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n+            self.test_change_output_type(3, [to_address_p2sh], 'p2sh-segwit')\n         else:\n             self.log.info(\"Nodes with addresstype=bech32 always use a P2WPKH change output (unless changetype is set otherwise):\")\n             self.test_change_output_type(3, [to_address_bech32_1], 'bech32')\n-            self.test_change_output_type(3, [to_address_p2sh], 'bech32')\n+            self.test_change_output_type(3, [to_address_p2sh], 'p2sh-segwit')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771148002",
      "id" : 771148002,
      "in_reply_to_id" : 771128713,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584t9sji",
      "original_commit_id" : "faf495815e6cfca8969a3c3f0671ce6ec2351472",
      "original_line" : 372,
      "original_position" : 25,
      "original_start_line" : 367,
      "path" : "test/functional/wallet_address_types.py",
      "position" : null,
      "pull_request_review_id" : 834892976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771148002/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-17T07:01:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771148002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Force pushed to fix test logs",
      "created_at" : "2021-12-17T07:02:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996484384",
      "id" : 996484384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847ZSUg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996484384/reactions"
      },
      "updated_at" : "2021-12-17T07:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996484384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept & Approach ACK fada6c6. Also did light code review .",
      "created_at" : "2021-12-17T07:23:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996494561",
      "id" : 996494561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847ZUzh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996494561/reactions"
      },
      "updated_at" : "2021-12-17T07:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996494561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested with some transactions on testnet by using different types of address:\r\n\r\n1. P2PKH: [`dfaa147f5940c27e7a1cc1486bd612e49eb15b42d63b7045e5008bb8c7af2c5c`](https://mempool.space/testnet/tx/dfaa147f5940c27e7a1cc1486bd612e49eb15b42d63b7045e5008bb8c7af2c5c) â\r\n2. P2WPKH: [`df09bb5f59e4a74b5d6627f1ab191aa105e204dc1f37a977c9a603550ab82fdc`](https://mempool.space/testnet/tx/df09bb5f59e4a74b5d6627f1ab191aa105e204dc1f37a977c9a603550ab82fdc) â\r\n3. P2SH: [`68b216c5884e0b0107831768b263afdc947e2bf733bf54dd80ec1725f0d8de34`](https://mempool.space/testnet/tx/68b216c5884e0b0107831768b263afdc947e2bf733bf54dd80ec1725f0d8de34) â\r\n4. P2WSH: [`4740d4ee560e42b8537338147a30f9b7492b32e79667ce64a428989f06125488`](https://mempool.space/testnet/tx/4740d4ee560e42b8537338147a30f9b7492b32e79667ce64a428989f06125488) â ([Not Supported](https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996659905))\r\n5. P2TR: ~~[`f7fbf80856f3996cd2eba7efa3c2ce266c5f18c3115f2036106223afc7d0404a`](https://mempool.space/testnet/tx/f7fbf80856f3996cd2eba7efa3c2ce266c5f18c3115f2036106223afc7d0404a) â~~ https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996639880",
      "created_at" : "2021-12-17T10:12:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996597424",
      "id" : 996597424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847Zt6w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996597424/reactions"
      },
      "updated_at" : "2021-12-17T12:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996597424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Excellent. Thank you for testing. If you want to match P2TR, you need a descriptor wallet with a `tr` descriptor (created by default for new descriptor wallets).",
      "created_at" : "2021-12-17T10:24:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996606587",
      "id" : 996606587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847ZwJ7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996606587/reactions"
      },
      "updated_at" : "2021-12-17T10:24:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996606587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes that works for P2TR: [`64d300442ad4ccb726146b292658876040a1e230af0fd0236e5e83a5aaa33c8d`](https://mempool.space/testnet/tx/64d300442ad4ccb726146b292658876040a1e230af0fd0236e5e83a5aaa33c8d)",
      "created_at" : "2021-12-17T11:11:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996639880",
      "id" : 996639880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847Z4SI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996639880/reactions"
      },
      "updated_at" : "2021-12-17T11:11:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996639880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "and for completeness:  P2WSH is impossible to match, since the wallet doesn't support it",
      "created_at" : "2021-12-17T11:44:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996659905",
      "id" : 996659905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847Z9LB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996659905/reactions"
      },
      "updated_at" : "2021-12-17T11:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996659905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> and for completeness: P2WSH is impossible to match, since the wallet doesn't support it\r\n\r\nAnd it's useless even to try to match as it will likely differ on spend.",
      "created_at" : "2021-12-17T14:33:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996768083",
      "id" : 996768083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847aXlT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996768083/reactions"
      },
      "updated_at" : "2021-12-17T14:33:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996768083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "WSH is a corner case anyway (less than 5%) according to https://transactionfee.info/charts/output-type-distribution-count/",
      "created_at" : "2021-12-17T14:58:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996786288",
      "id" : 996786288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847acBw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996786288/reactions"
      },
      "updated_at" : "2021-12-17T14:58:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996786288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was assuming its used for multisig because of this note mentioned in [caravan](https://unchained-capital.github.io/caravan/#/address):\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/146571105-53811e30-e59c-4fe7-aea0-e90a4614df11.png)\r\n",
      "created_at" : "2021-12-17T15:49:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996826948",
      "id" : 996826948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847al9E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996826948/reactions"
      },
      "updated_at" : "2021-12-17T15:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996826948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771589938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771589938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was thinking something like\r\n\r\n```suggestion\r\n        if (type == TxoutType::WITNESS_V1_TAPROOT || type == TxoutType::WITNESS_UNKNOWN) {\r\n```\r\n\r\nBut looking at this further, I suppose the current implementation is fine. If the transaction contains any known address types, then we will match to those and privacy is still preserved. If they are all unknown, then we will try to use bech32(m) anyways, unless unavailable, in which case this wouldn't matter.",
      "commit_id" : "fada6c65d23f7bd4682fac281026612b835c4f8b",
      "created_at" : "2021-12-17T18:07:38Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771589938",
      "id" : 771589938,
      "in_reply_to_id" : 770029609,
      "line" : 1983,
      "node_id" : "PRRC_kwDOABII584t_Ycy",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1983,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 835511023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771589938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T18:07:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771589938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> and for completeness: P2WSH is impossible to match, since the wallet doesn't support it\r\n\r\nNot necessarily. A descriptor wallet can have an active `wsh(...)` descriptor, and it would be assigned to `OutputType::BECH32` (because P2WSH is bech32).",
      "created_at" : "2021-12-17T18:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996919858",
      "id" : 996919858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847a8oy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996919858/reactions"
      },
      "updated_at" : "2021-12-17T18:09:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996919858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK fada6c65d23f7bd4682fac281026612b835c4f8b",
      "created_at" : "2021-12-17T18:31:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996932800",
      "id" : 996932800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847a_zA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996932800/reactions"
      },
      "updated_at" : "2021-12-17T18:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996932800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not necessarily. A descriptor wallet can have an active wsh(...) descriptor, and it would be assigned to OutputType::BECH32 (because P2WSH is bech32).\r\n\r\nInteresting. Could the wallet also spend the created wsh change output?",
      "created_at" : "2021-12-18T08:25:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-997169028",
      "id" : 997169028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847b5eE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997169028/reactions"
      },
      "updated_at" : "2021-12-18T08:25:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997169028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771799716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771799716"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, on mismatch it'd try bech32(m)",
      "commit_id" : "fada6c65d23f7bd4682fac281026612b835c4f8b",
      "created_at" : "2021-12-18T08:26:02Z",
      "diff_hunk" : "@@ -1935,29 +1935,58 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         return *change_type;\n     }\n \n-    // if m_default_address_type is legacy, use legacy address as change (even\n-    // if some of the outputs are P2WPKH or P2WSH).\n+    // if m_default_address_type is legacy, use legacy address as change.\n     if (m_default_address_type == OutputType::LEGACY) {\n         return OutputType::LEGACY;\n     }\n \n-    // if any destination is P2WPKH or P2WSH, use P2WPKH for the change\n-    // output.\n+    bool any_tr{false};\n+    bool any_wpkh{false};\n+    bool any_sh{false};\n+    bool any_pkh{false};\n+\n     for (const auto& recipient : vecSend) {\n-        // Check if any destination contains a witness program:\n-        int witnessversion = 0;\n-        std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n-            if (GetScriptPubKeyMan(OutputType::BECH32M, true)) {\n-                return OutputType::BECH32M;\n-            } else if (GetScriptPubKeyMan(OutputType::BECH32, true)) {\n-                return OutputType::BECH32;\n-            } else {\n-                return m_default_address_type;\n-            }\n-        }\n+        std::vector<std::vector<uint8_t>> dummy;\n+        const TxoutType type{Solver(recipient.scriptPubKey, dummy)};\n+        if (type == TxoutType::WITNESS_V1_TAPROOT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#discussion_r771799716",
      "id" : 771799716,
      "in_reply_to_id" : 770029609,
      "line" : 1983,
      "node_id" : "PRRC_kwDOABII584uALqk",
      "original_commit_id" : "26682d5bf413189163b2aec0be9483f29a1cbb04",
      "original_line" : 1983,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : 835756513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771799716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-18T08:26:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771799716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 Ready for merge?",
      "created_at" : "2021-12-20T09:34:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-997753919",
      "id" : 997753919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847eIQ_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997753919/reactions"
      },
      "updated_at" : "2021-12-20T09:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997753919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This feels like an incredibly fast merge for a privacy related feature that requires careful consideration.\r\n\r\nI need to review the code specifically, but if I understand it correctly this will *majorly* slow the adoption of Taproot because you'll have transitive slowness to upgrade (e.g., I made a segwit change to be compatible with a old segwit destination I was paying to, now my change is segwit, now future users will make segwit change to pay me, etc).\r\n\r\nPlease revert and make a mailing list post.",
      "created_at" : "2021-12-20T20:48:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998258226",
      "id" : 998258226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gDYy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998258226/reactions"
      },
      "updated_at" : "2021-12-20T20:48:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998258226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I gues maybe part of what I'm missing is that only *outputs* are analyzed, not inputs, so it's not as bad as I thought it might be in terms of transitivity.\r\n\r\nI still think this could slow Tr adoption quite a bit, and I think that's worth getting a better idea of before deploying this.",
      "created_at" : "2021-12-20T20:53:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998261466",
      "id" : 998261466,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gELa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998261466/reactions"
      },
      "updated_at" : "2021-12-20T20:53:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998261466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> now my change is segwit, now future users will make segwit change to pay me, etc).\r\n\r\nNo, inputs are not considered.\r\n\r\n> Please revert and make a mailing list post.\r\n\r\nThis is a local wallet policy, it does not need to be discussed on the mailing list.\r\n\r\n> I still think this could slow Tr adoption quite a bit, and I think that's worth getting a better idea of before deploying this.\r\n\r\nI see that it could slow adoption a bit, but it is overall an improvement to how we determine change addresses IMO. We have plenty of time until 23.0 to change it, and changing the order of preferences would not be particularly difficult.",
      "created_at" : "2021-12-20T21:33:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998286836",
      "id" : 998286836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gKX0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998286836/reactions"
      },
      "updated_at" : "2021-12-20T21:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998286836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I still think this could slow Tr adoption quite a bit, and I think that's worth getting a better idea of before deploying this.\r\n\r\n1. Privacy > TR adoption\r\n2. IIUC change will be P2TR if sending to P2TR: https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-996639880 so I don't see issues with adoption if more people want to use P2TR they will eventually because of usecases.\r\n\r\nMaking it difficult to identify change in a transaction is a great improvement.",
      "created_at" : "2021-12-20T21:53:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998297888",
      "id" : 998297888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gNEg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998297888/reactions"
      },
      "updated_at" : "2021-12-20T21:53:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998297888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Well it still does worsen privacy since then my wallet will be spending a mix out output types rather than just all taproot.\r\n\r\nAnd the observability of this pattern (change matching) is also... pretty observable, especially if bitcoin core (and only upgraded wallets) are the ones doing it.\r\n\r\nThis becomes worse the slower taproot uptake is.\r\n\r\nFurther, when you do a subsequent spend, unless our coin selection algorithm is primed to only spend like-kind togehter (not sure it is?) we end up re-correlating the legacy output with the new format, linking the idea that that output was likely one from our wallet as it's with the upgraded type. In order to safely get taproot outputs you'd have to double-tap your old style outputs into a all taproot self-pay payout txn, or find an opportunity to do so nautrally as a payment. If you were to take your old outputs and pay to a new txn and make a Tr change, you also get screwed because then it's known that your wallet did really have Tr enabled and was faking. I think it's really hard to avoid these cases.\r\n\r\nThe main benefit here is decorrelation of change / payment at time of flight of txn. But privacy is a property that we also have to weigh the costs and benefits for future behaviors as well, and I think it's worth tightly considering this PR under that lens.\r\n\r\nI agree that privacy > all else, but this change should have IMO a pretty negative effect on the herd benefit. And privacy only can be created within the walls of an anonymity set. The only thing worse than no privacy is a false sense of one.\r\n\r\nI think the best path to build the anonymity set is to just go all-in taproot change.\r\n",
      "created_at" : "2021-12-20T22:04:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998303608",
      "id" : 998303608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gOd4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998303608/reactions"
      },
      "updated_at" : "2021-12-20T22:04:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998303608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> we end up re-correlating the legacy output with the new format, linking the idea that that output was likely one from our wallet as it's with the upgraded type.\r\n\r\nI don't see how this is any worse than a normal spend which is likely to correlate change to your wallet anyways. The purpose is to make it harder to determine which is change while the UTXOs are unspent. Hiding which outputs are change is already tenuous at best.\r\n\r\n> In order to safely get taproot outputs you'd have to double-tap your old style outputs into a all taproot self-pay payout txn, or find an opportunity to do so nautrally as a payment.\r\n\r\nOr just set `-addresstype=bech32m` and `-changetype=bech32m`? Those startup options, and any change address option given to transaction creation, will always take precedence over this automatic behavior.\r\n\r\n***\r\n\r\nThe behavior implemented here also is fairly similar to what we did for segwit. The default address type was p2sh-segwit, and we would only use bech32 if a p2wpkh or p2wsh recipient was observed.",
      "created_at" : "2021-12-20T22:17:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998312077",
      "id" : 998312077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gQiN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998312077/reactions"
      },
      "updated_at" : "2021-12-20T22:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998312077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > we end up re-correlating the legacy output with the new format, linking the idea that that output was likely one from our wallet as it's with the upgraded type.\r\n> \r\n> I don't see how this is any worse than a normal spend which is likely to correlate change to your wallet anyways. The purpose is to make it harder to determine which is change while the UTXOs are unspent. Hiding which outputs are change is already tenuous at best.\r\n\r\nIt's worse because the subsequent spend mixing inputs shows that our wallet did in fact support (other type) and is therefore likely to be the change address because it's unlikely we requested to be paid in (old type).\r\n\r\n\r\n> Or just set `-addresstype=bech32m` and `-changetype=bech32m`? Those startup options, and any change address option given to transaction creation will always take precedence over this automatic behavior.\r\n\r\nI'm analyzing the impact for a user who uses the default configuration, not what someone can do. If the default configuration isn't a good idea, it shouldn't be default. \r\n\r\n> The behavior implemented here also is fairly similar to what we did for segwit. The default address type was p2sh-segwit, and we would only use bech32 if a p2wpkh or p2wsh recipient was observed.\r\n\r\nI don't think that results from segwit v0 apply here since there was an entirely different mood around adoption which necessitated the segwit have 2 address types for p2sh wrapping and there was real risk of refusing to integrate.\r\n\r\nNoting also the negative scaling impact this has on a CISA future, for example, if a lot of the change outputs created are to be long lived.",
      "created_at" : "2021-12-20T22:23:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998315744",
      "id" : 998315744,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gRbg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998315744/reactions"
      },
      "updated_at" : "2021-12-20T22:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998315744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> And the observability of this pattern (change matching) is also... pretty observable, especially if bitcoin core (and only upgraded wallets) are the ones doing it.\r\n\r\nThere are few other wallets that do the same thing.\r\n\r\n> Further, when you do a subsequent spend, unless our coin selection algorithm is primed to only spend like-kind togehter (not sure it is?) we end up re-correlating the legacy output with the new format, linking the idea that that output was likely one from our wallet as it's with the upgraded type.\r\n\r\nGood point. Will have to test this. I think this can be improved but it would be out of scope for this PR.\r\n\r\n",
      "created_at" : "2021-12-20T22:31:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998319513",
      "id" : 998319513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gSWZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998319513/reactions"
      },
      "updated_at" : "2021-12-20T22:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998319513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "the best case we could do would probably be to draw output types from some distribution matching the chain data over the last 2 weeks and encode a small bias towards the newer type. The herd would move in unison towards new types, and you would *actually* not be able to learn more information than the bias amount.\r\n\r\nnote: this would have to apply to address creation too ",
      "created_at" : "2021-12-20T22:36:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998322092",
      "id" : 998322092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gS-s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998322092/reactions"
      },
      "updated_at" : "2021-12-20T22:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998322092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It's worse because the subsequent spend mixing inputs shows that our wallet did in fact support (other type) and is therefore likely to be the change address because it's unlikely we requested to be paid in (old type).\r\n\r\nNot true. The default output type is still bech32 - users using the current defaults will still give out bech32 addresses, and so they will be requesting payments to bech32 addresses. However, their wallet may have tr descriptors, in which case they support Taproot. So they would be giving out p2wpkh addresses, and potentially receiving change as p2tr if the recipient gives them a p2tr address.\r\n\r\nAdditionally, this is all about address type and not script type. Future witness versions (are expected to) use bech32m as well, so in the future, unless the recipient was asked to be paid in (really old type), the change is likely to be (future witness version) even if the recipient asked for (older witness version).\r\n\r\n> I'm analyzing the impact for a user who uses the default configuration, not what someone can do. If the default configuration isn't a good idea, it shouldn't be default.\r\n\r\nYou gave a scenario where the user is trying to use all taproot. If a user knows enough about address types and wants to only use a specific type, I think they can figure out how to set the option. We can also add a GUI setting for it too.",
      "created_at" : "2021-12-20T22:54:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998329588",
      "id" : 998329588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847gUz0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998329588/reactions"
      },
      "updated_at" : "2021-12-20T22:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998329588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@JeremyRubin For reference I implemented what you suggest first in #23731, but then decided to abandon it.\r\n\r\n**re: process**. I think that a pull request is ready to be merged if it was reviewed. Surely, a behaviour changing pull request should be open for a few days to let more eyes take a look at it. I think 11 days is more than enough for that, since it will never be possible to get *everyone's* eye on it. And this is \"just\" the master branch. If for some reason all reviewers messed up and did the wrong thing, there is still plenty of time to revisit before a release.\r\n\r\n**re: content**:\r\nSurely, using bech32m unconditionally for change is going to speed up tr adoption on chain. However, it also makes it trivial to spot the change output immediately (at broadcast time of the tx). Especially if the \"real\" tr usage is low.\r\n\r\nWith this patch, there should still be a bias toward \"promoting\" tr, since *any* tr output will lead to tr change.\r\n\r\nAlso, I am not sure if it makes sense to consider input-bundling here. If the analysis firm uses input-bundling as a heuristic, then it can determine the wallet inputs regardless of their type already. If they don't, since it might be a coinjoin, then it shouldn't matter.",
      "created_at" : "2021-12-21T08:54:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-998588588",
      "id" : 998588588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847hUCs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998588588/reactions"
      },
      "updated_at" : "2021-12-21T08:54:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998588588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The `-changetype` doc wasn't updated. Fixed in https://github.com/bitcoin/bitcoin/pull/23840",
      "created_at" : "2021-12-22T10:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23789#issuecomment-999453641",
      "id" : 999453641,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23789",
      "node_id" : "IC_kwDOABII5847knPJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999453641/reactions"
      },
      "updated_at" : "2021-12-22T10:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999453641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
