[
   {
      "author_association" : "MEMBER",
      "body" : "See also https://github.com/bitcoin-core/HWI/issues/305",
      "created_at" : "2021-12-08T16:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-988980626",
      "id" : 988980626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII58468qWS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988980626/reactions"
      },
      "updated_at" : "2021-12-08T16:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988980626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "One potential solution that I am investigating for HWI is to overwrite `hashlib.new` with our own implementation of it. This can then identify if the hash function is `ripemd160` and return a constructor to our own implementation of ripemd160 rather than delegating to openssl. This function can fallback to the actual `hashlib.new` too. Since imports are global per interpreter session, modifying the imported library in one module will affect all other subsequent uses of that library.\r\n\r\nHere is an example of how this overwrite operates:\r\n\r\nFirst a new module, I calling it `bitcoinhashes.py`:\r\n\r\n```\r\nimport hashlib\r\n\r\nhashlib_new = hashlib.new\r\n\r\ndef our_hashlib_new(name, data=b\"\", **kwargs):\r\n    print(\"OUR hashlib.new\")\r\n    return hashlib_new(name, data, **kwargs)\r\n\r\nhashlib.new = our_hashlib_new\r\n```\r\n\r\nThen observe what happens when this overwritten `hashlib.new` is used:\r\n\r\n```\r\nPython 3.9.7 (default, Oct 25 2021, 18:20:41) \r\n[GCC 11.1.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import hashlib\r\n>>> import bitcoinhashes\r\n>>> hashlib.new(\"sha256\")\r\nOUR hashlib.new\r\n<sha256 _hashlib.HASH object @ 0x7f0367fafc70>\r\n>>> \r\n```\r\n\r\nThe ripemd160 implementation would have to be in python though. I don't think this particularly matters, but it will be way slower than openssl's, or even our own c++ implementation.\r\n\r\n***\r\n\r\nThis approach is probably more suitable for the test framework rather than a library like HWI as there are no downstream consumers where changing the behavior of hashlib might be surprising.",
      "created_at" : "2021-12-08T18:08:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-989051165",
      "id" : 989051165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII584687kd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989051165/reactions"
      },
      "updated_at" : "2021-12-08T18:10:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989051165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ripemd160 is only used in one place, so I think we can just inline ripemd160 python code for that in that place.\r\n\r\nThe issue is that no python code seems to exists, since everyone was falling back to openssl?\r\n\r\nI don't really understand how to un-deprecate ripemd160 in openssl, but if there is an easy hack (for example via a config file), then that might be a good enough solution for the short term, also making our CI green again.",
      "created_at" : "2021-12-08T18:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-989074952",
      "id" : 989074952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII58469BYI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989074952/reactions"
      },
      "updated_at" : "2021-12-08T18:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989074952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I can write a pure-python ripemd160 if that's useful.",
      "created_at" : "2021-12-08T18:31:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-989076275",
      "id" : 989076275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII58469Bsz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989076275/reactions"
      },
      "updated_at" : "2021-12-08T18:31:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989076275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I can write a pure-python ripemd160 if that's useful.\r\n\r\nIt would (probably) be useful for HWI.",
      "created_at" : "2021-12-08T18:33:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-989077907",
      "id" : 989077907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII58469CGT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989077907/reactions"
      },
      "updated_at" : "2021-12-08T18:33:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989077907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> The issue is that no python code seems to exists, since everyone was falling back to openssl?\r\n\r\nElectrum has a fallback pure-python implementation.\r\n\r\nSee\r\nhttps://github.com/spesmilo/electrum/blob/0df05dd914c823acae1828cad3b20bdeb13150e9/electrum/crypto.py#L312-L324\r\nhttps://github.com/spesmilo/electrum/blob/0df05dd914c823acae1828cad3b20bdeb13150e9/electrum/ripemd.py\r\n\r\nBesides the license mentioned there, I can't find where it is from exactly. It was added in https://github.com/spesmilo/electrum/commit/ad6c0ab2736edd2d7d2f0871a6b6a4d716441ace.",
      "created_at" : "2021-12-09T00:03:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-989326255",
      "id" : 989326255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII58469-uv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989326255/reactions"
      },
      "updated_at" : "2021-12-09T00:03:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989326255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/29142493?v=4",
         "events_url" : "https://api.github.com/users/SomberNight/events{/privacy}",
         "followers_url" : "https://api.github.com/users/SomberNight/followers",
         "following_url" : "https://api.github.com/users/SomberNight/following{/other_user}",
         "gists_url" : "https://api.github.com/users/SomberNight/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/SomberNight",
         "id" : 29142493,
         "login" : "SomberNight",
         "node_id" : "MDQ6VXNlcjI5MTQyNDkz",
         "organizations_url" : "https://api.github.com/users/SomberNight/orgs",
         "received_events_url" : "https://api.github.com/users/SomberNight/received_events",
         "repos_url" : "https://api.github.com/users/SomberNight/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/SomberNight/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/SomberNight/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/SomberNight"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I don't think it's worth opening new issue.\r\n\r\nWe've had similar issue, we've stripped pycryptodome from everything, leaving just ripemd:\r\nhttps://github.com/symbol/ripemd\r\nhttps://pypi.org/project/ripemd-hash/\r\n",
      "created_at" : "2022-09-22T15:22:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23710#issuecomment-1255184239",
      "id" : 1255184239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23710",
      "node_id" : "IC_kwDOABII585K0Jdv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1255184239/reactions"
      },
      "updated_at" : "2022-09-22T15:22:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1255184239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6421169?v=4",
         "events_url" : "https://api.github.com/users/gimre-xymcity/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gimre-xymcity/followers",
         "following_url" : "https://api.github.com/users/gimre-xymcity/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gimre-xymcity/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gimre-xymcity",
         "id" : 6421169,
         "login" : "gimre-xymcity",
         "node_id" : "MDQ6VXNlcjY0MjExNjk=",
         "organizations_url" : "https://api.github.com/users/gimre-xymcity/orgs",
         "received_events_url" : "https://api.github.com/users/gimre-xymcity/received_events",
         "repos_url" : "https://api.github.com/users/gimre-xymcity/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gimre-xymcity/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gimre-xymcity/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gimre-xymcity"
      }
   }
]
