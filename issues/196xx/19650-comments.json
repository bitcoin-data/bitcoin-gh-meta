[
   {
      "author_association" : "NONE",
      "body" : "perhaps #19215 is causing this?",
      "created_at" : "2020-08-03T07:55:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-667869954",
      "id" : 667869954,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Nzg2OTk1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T07:55:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667869954",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30832395?v=4",
         "events_url" : "https://api.github.com/users/Fonta1n3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fonta1n3/followers",
         "following_url" : "https://api.github.com/users/Fonta1n3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fonta1n3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fonta1n3",
         "id" : 30832395,
         "login" : "Fonta1n3",
         "node_id" : "MDQ6VXNlcjMwODMyMzk1",
         "organizations_url" : "https://api.github.com/users/Fonta1n3/orgs",
         "received_events_url" : "https://api.github.com/users/Fonta1n3/received_events",
         "repos_url" : "https://api.github.com/users/Fonta1n3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fonta1n3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fonta1n3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fonta1n3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 Want to have a look? The input has both `witness_utxo` and `non_witness_utxo`, and a `partial_signatures` for the right key, but somehow doesn't get finalized. `analyzepsbt` says next is an updater step (?)\r\n",
      "created_at" : "2020-08-03T08:02:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-667873568",
      "id" : 667873568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Nzg3MzU2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T08:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667873568",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @achow101 Want to have a look? The input has both `witness_utxo` and `non_witness_utxo`, and a `partial_signatures` for the right key, but somehow doesn't get finalized. `analyzepsbt` says next is an updater step (?)\r\n\r\nWorth mentioning the wallet on the node was created with a `combo` prefixed descriptor which may explain why there are both `witness_utxo` and `non_witness_utxo`? I am not sure about that but it seemed odd to see \"2\" inputs in the `non_witness_utxo` when in fact there is only one input.",
      "created_at" : "2020-08-03T10:04:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-667934666",
      "id" : 667934666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NzkzNDY2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T10:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667934666",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30832395?v=4",
         "events_url" : "https://api.github.com/users/Fonta1n3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fonta1n3/followers",
         "following_url" : "https://api.github.com/users/Fonta1n3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fonta1n3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fonta1n3",
         "id" : 30832395,
         "login" : "Fonta1n3",
         "node_id" : "MDQ6VXNlcjMwODMyMzk1",
         "organizations_url" : "https://api.github.com/users/Fonta1n3/orgs",
         "received_events_url" : "https://api.github.com/users/Fonta1n3/received_events",
         "repos_url" : "https://api.github.com/users/Fonta1n3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fonta1n3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fonta1n3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fonta1n3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's most likely that the signature is invalid. How did you sign this transaction?\r\n\r\nThe changes from #19215 is to address a potential attack that some hardware wallets decided to address. It doesn't have anything to do with `combo` descriptors. However because both UTXOs are being provided, it is possible that the software you are using doesn't know how to handle that and is signing the segwit input with a non-segwit signature.",
      "created_at" : "2020-08-03T15:52:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-668099344",
      "id" : 668099344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODA5OTM0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T15:52:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668099344",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> It's most likely that the signature is invalid. How did you sign this transaction?\r\n> \r\n> The changes from #19215 is to address a potential attack that some hardware wallets decided to address. It doesn't have anything to do with `combo` descriptors. However because both UTXOs are being provided, it is possible that the software you are using doesn't know how to handle that and is signing the segwit input with a non-segwit signature.\r\n\r\nSigning with LibWally 0.7.7 \r\n\r\nThe thing is there is only one utxo, I do not understand why Bitcoin Core shows two?\r\n\r\n> it is possible that the software you are using doesn't know how to handle that and is signing the segwit input with a non-segwit signature\r\n\r\nIt is possible but I do not want to hack LibWally that much...\r\n\r\nAgain the signing works perfectly fine in conjunction with 0.20.0 (same wallet, same utxo), which is why I raised the issue here.",
      "created_at" : "2020-08-04T02:50:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-668349669",
      "id" : 668349669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODM0OTY2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-04T03:19:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668349669",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30832395?v=4",
         "events_url" : "https://api.github.com/users/Fonta1n3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fonta1n3/followers",
         "following_url" : "https://api.github.com/users/Fonta1n3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fonta1n3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fonta1n3",
         "id" : 30832395,
         "login" : "Fonta1n3",
         "node_id" : "MDQ6VXNlcjMwODMyMzk1",
         "organizations_url" : "https://api.github.com/users/Fonta1n3/orgs",
         "received_events_url" : "https://api.github.com/users/Fonta1n3/received_events",
         "repos_url" : "https://api.github.com/users/Fonta1n3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fonta1n3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fonta1n3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fonta1n3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think we're missing some steps here. What is the exact procedure you used to obtain the input PSBT?\n\nDoes the exact same PSBT finalize in 0.20? That would surprise me as it contains both the full creating transactions and the UTXO, which used to be illegal in PSBT.",
      "created_at" : "2020-08-04T16:16:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-668690954",
      "id" : 668690954,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODY5MDk1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-04T16:16:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668690954",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Here is what I suspect happened:\n\n* You create a PSBT with 0.20, signed it using libwally, and then try to finalize it with 0.20. This works.\n* You create a PSBT with 0.20.1, sign it using libwally (which now creates an invalid signature as it misinterprets the PSBT), which 0.20.1 now fails to finalize because the signature is invalid.\n\nI suspect:\n* If you create a PSBT with 0.20, sign with libwally, and then finalize with 0.20.1, it will still work.\n* If you create a PSBT with 0.20.1, sign with libwally, and then finalize with 0.20, it will fail in the last step, saying the PSBT file is invalid.\n\nIt seems libwally isn't compatible with the change that had to made to PSBT to support hardware wallets rolling out mitigations for the segwit value issue (CVE-2020-14199). I believe this will be fixed in an upcoming version of libwally.",
      "created_at" : "2020-08-04T16:21:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-668693513",
      "id" : 668693513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODY5MzUxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-04T16:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668693513",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Here is what I suspect happened:\r\n> \r\n> * You create a PSBT with 0.20, signed it using libwally, and then try to finalize it with 0.20. This works.\r\n> * You create a PSBT with 0.20.1, sign it using libwally (which now creates an invalid signature as it misinterprets the PSBT), which 0.20.1 now fails to finalize because the signature is invalid.\r\n> \r\n> I suspect:\r\n> \r\n> * If you create a PSBT with 0.20, sign with libwally, and then finalize with 0.20.1, it will still work.\r\n> * If you create a PSBT with 0.20.1, sign with libwally, and then finalize with 0.20, it will fail in the last step, saying the PSBT file is invalid.\r\n> \r\n> It seems libwally isn't compatible with the change that had to made to PSBT to support hardware wallets rolling out mitigations for the segwit value issue (CVE-2020-14199). I believe this will be fixed in an upcoming version of libwally.\r\n\r\n@sipa I think you have hit the nail on the head. I can definitely provide a detailed list of commands to reproduce the issue if that will be helpful, however I think it is just simply that LibWally psbt signing is not compatible with having both types of utxo's so I am not sure it is really necessary... Let me know if you would still like me to include detailed steps to reproduce the issue and I will happily do so.\r\n\r\nHow do you all recommend I be more in tune with changes that may break my apps in the future? All of the apps I develop utilize Bitcoin Core as a backend and I very much want to avoid surprises like this moving forward. IRC? ",
      "created_at" : "2020-08-05T10:10:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-669107464",
      "id" : 669107464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTEwNzQ2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T10:10:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669107464",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30832395?v=4",
         "events_url" : "https://api.github.com/users/Fonta1n3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fonta1n3/followers",
         "following_url" : "https://api.github.com/users/Fonta1n3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fonta1n3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fonta1n3",
         "id" : 30832395,
         "login" : "Fonta1n3",
         "node_id" : "MDQ6VXNlcjMwODMyMzk1",
         "organizations_url" : "https://api.github.com/users/Fonta1n3/orgs",
         "received_events_url" : "https://api.github.com/users/Fonta1n3/received_events",
         "repos_url" : "https://api.github.com/users/Fonta1n3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fonta1n3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fonta1n3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fonta1n3"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I managed to fix this thanks to some guidance from @jgriffiths, you can see details https://github.com/ElementsProject/libwally-core/issues/213\r\n\r\nfwiw I have also noticed this breaks Electrum's psbt as it rejects anything with both utxo types.\n\nCorrection, you can build Electrum from master branch and it no longer rejects psbt with both utxo types.",
      "created_at" : "2020-08-11T15:48:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-672029642",
      "id" : 672029642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjAyOTY0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-15T14:12:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672029642",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30832395?v=4",
         "events_url" : "https://api.github.com/users/Fonta1n3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fonta1n3/followers",
         "following_url" : "https://api.github.com/users/Fonta1n3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fonta1n3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fonta1n3",
         "id" : 30832395,
         "login" : "Fonta1n3",
         "node_id" : "MDQ6VXNlcjMwODMyMzk1",
         "organizations_url" : "https://api.github.com/users/Fonta1n3/orgs",
         "received_events_url" : "https://api.github.com/users/Fonta1n3/received_events",
         "repos_url" : "https://api.github.com/users/Fonta1n3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fonta1n3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fonta1n3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fonta1n3"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I am going to close this as it was totally unrelated to Bitcoin Core.",
      "created_at" : "2020-08-17T09:11:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19650#issuecomment-674761306",
      "id" : 674761306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19650",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDc2MTMwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T09:11:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674761306",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30832395?v=4",
         "events_url" : "https://api.github.com/users/Fonta1n3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fonta1n3/followers",
         "following_url" : "https://api.github.com/users/Fonta1n3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fonta1n3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fonta1n3",
         "id" : 30832395,
         "login" : "Fonta1n3",
         "node_id" : "MDQ6VXNlcjMwODMyMzk1",
         "organizations_url" : "https://api.github.com/users/Fonta1n3/orgs",
         "received_events_url" : "https://api.github.com/users/Fonta1n3/received_events",
         "repos_url" : "https://api.github.com/users/Fonta1n3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fonta1n3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fonta1n3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fonta1n3"
      }
   }
]
