[
   {
      "author_association" : "MEMBER",
      "body" : "I think technically -1 is correct?",
      "created_at" : "2020-08-11T21:19:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#issuecomment-672285302",
      "id" : 672285302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19655",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjI4NTMwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-11T21:19:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672285302",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The -1 is from a `CHECK_NONFATAL` so the error says an internal bug is detected. I was thinking that the -8 error is more helpful since it is consistent with the result when `target_confirmations = 0`.",
      "created_at" : "2020-08-11T22:13:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#issuecomment-672312663",
      "id" : 672312663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19655",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjMxMjY2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-11T22:13:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672312663",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/29065991?v=4",
         "events_url" : "https://api.github.com/users/adaminsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adaminsky/followers",
         "following_url" : "https://api.github.com/users/adaminsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adaminsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adaminsky",
         "id" : 29065991,
         "login" : "adaminsky",
         "node_id" : "MDQ6VXNlcjI5MDY1OTkx",
         "organizations_url" : "https://api.github.com/users/adaminsky/orgs",
         "received_events_url" : "https://api.github.com/users/adaminsky/received_events",
         "repos_url" : "https://api.github.com/users/adaminsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adaminsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adaminsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adaminsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "But `target_confirmations` 0 is in fact an invalid parameter. A too-large height just doesn't yield a useful result *yet*.",
      "created_at" : "2020-08-11T22:18:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#issuecomment-672318801",
      "id" : 672318801,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19655",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjMxODgwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-11T22:18:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672318801",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yeah, so I guess the problem mentioned in the issue has been fixed by returning a -1 error. Maybe giving the genesis block hash when `target_confirmations` is too large makes sense. ",
      "created_at" : "2020-08-11T22:57:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#issuecomment-672338095",
      "id" : 672338095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19655",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjMzODA5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-11T22:57:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672338095",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/29065991?v=4",
         "events_url" : "https://api.github.com/users/adaminsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adaminsky/followers",
         "following_url" : "https://api.github.com/users/adaminsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adaminsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adaminsky",
         "id" : 29065991,
         "login" : "adaminsky",
         "node_id" : "MDQ6VXNlcjI5MDY1OTkx",
         "organizations_url" : "https://api.github.com/users/adaminsky/orgs",
         "received_events_url" : "https://api.github.com/users/adaminsky/received_events",
         "repos_url" : "https://api.github.com/users/adaminsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adaminsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adaminsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adaminsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky thank you for the review. My commit message is actually incorrect because the problem with the 0 hash was already fixed from when it was reported by returning the -1 error. I'll update this to return genesis block hash instead.",
      "created_at" : "2020-08-12T16:38:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#issuecomment-672984261",
      "id" : 672984261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19655",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3Mjk4NDI2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-12T16:38:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672984261",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/29065991?v=4",
         "events_url" : "https://api.github.com/users/adaminsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adaminsky/followers",
         "following_url" : "https://api.github.com/users/adaminsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adaminsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adaminsky",
         "id" : 29065991,
         "login" : "adaminsky",
         "node_id" : "MDQ6VXNlcjI5MDY1OTkx",
         "organizations_url" : "https://api.github.com/users/adaminsky/orgs",
         "received_events_url" : "https://api.github.com/users/adaminsky/received_events",
         "repos_url" : "https://api.github.com/users/adaminsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adaminsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adaminsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adaminsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19655#discussion_r469529413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19655"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469529413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Return genesis hash\" (c0e57fe0d399235f3f2612c4972c597b34107509)\r\n\r\nI think this description is more confusing than before and there's no need to mention the special case here, since it's explained in lastblock documentation below. If you think it should be mentioned both places, maybe put the inserted text after \"e.g. 1 would mean the best block hash\" instead of before to avoid jumping topics.",
      "commit_id" : "c0e57fe0d399235f3f2612c4972c597b34107509",
      "created_at" : "2020-08-12T20:37:18Z",
      "diff_hunk" : "@@ -1447,7 +1447,7 @@ static UniValue listsinceblock(const JSONRPCRequest& request)\n                 \"Additionally, if include_removed is set, transactions affecting the wallet which were removed are returned in the \\\"removed\\\" array.\\n\",\n                 {\n                     {\"blockhash\", RPCArg::Type::STR, RPCArg::Optional::OMITTED_NAMED_ARG, \"If set, the block hash to list transactions since, otherwise list all transactions.\"},\n-                    {\"target_confirmations\", RPCArg::Type::NUM, /* default */ \"1\", \"Return the nth block hash from the main chain. e.g. 1 would mean the best block hash. Note: this is not used as a filter, but only affects [lastblock] in the return value\"},\n+                    {\"target_confirmations\", RPCArg::Type::NUM, /* default */ \"1\", \"Return the nth block hash from the main chain or the last block hash in case the nth block does not exist. e.g. 1 would mean the best block hash. Note: this is not used as a filter, but only affects [lastblock] in the return value\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#discussion_r469529413",
      "id" : 469529413,
      "line" : 1450,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUyOTQxMw==",
      "original_commit_id" : "c0e57fe0d399235f3f2612c4972c597b34107509",
      "original_line" : 1450,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 466258614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19655",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-12T20:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469529413",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19655#discussion_r469535285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19655"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469535285"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Return genesis hash\" (c0e57fe0d399235f3f2612c4972c597b34107509)\r\n\r\nMaybe test with a larger value like 1000 to be sure this isn't an edge case",
      "commit_id" : "c0e57fe0d399235f3f2612c4972c597b34107509",
      "created_at" : "2020-08-12T20:43:41Z",
      "diff_hunk" : "@@ -74,6 +75,27 @@ def test_invalid_blockhash(self):\n         assert_raises_rpc_error(-8, \"blockhash must be hexadecimal string (not 'Z000000000000000000000000000000000000000000000000000000000000000')\", self.nodes[0].listsinceblock,\n                                 \"Z000000000000000000000000000000000000000000000000000000000000000\")\n \n+    def test_targetconfirmations(self):\n+        '''\n+        This tests when the value of target_confirmations exceeds the number of\n+        blocks in the main chain. In this case, the genesis block hash should be\n+        given for the `lastblock` property. If target_confirmations is < 1, then\n+        a -8 invalid parameter error is thrown.\n+        '''\n+        self.log.info(\"Test target_confirmations\")\n+        blockhash, = self.nodes[2].generate(1)\n+        blockheight = self.nodes[2].getblockheader(blockhash)['height']\n+        self.sync_all()\n+\n+        assert_equal(\n+            self.nodes[0].getblockhash(0),\n+            self.nodes[0].listsinceblock(blockhash, blockheight + 1)['lastblock'])\n+        assert_equal(\n+            self.nodes[0].getblockhash(0),\n+            self.nodes[0].listsinceblock(blockhash, blockheight + 2)['lastblock'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#discussion_r469535285",
      "id" : 469535285,
      "line" : 95,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUzNTI4NQ==",
      "original_commit_id" : "c0e57fe0d399235f3f2612c4972c597b34107509",
      "original_line" : 95,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_listsinceblock.py",
      "position" : 29,
      "pull_request_review_id" : 466258614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19655",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-12T20:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469535285",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK c133cdcdc3397a734d57e05494682bf9bf6f4c15\r\nTest looks good too.",
      "created_at" : "2020-08-13T10:12:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19655#issuecomment-673391130",
      "id" : 673391130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19655",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzM5MTEzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T10:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673391130",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
