[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a trivial commit which de-duplicates some duplicated `for`-loops.",
      "created_at" : "2020-07-31T18:42:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-667294602",
      "id" : 667294602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NzI5NDYwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T18:42:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667294602",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466549930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466549930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any idea why these numbers changed but not the associated time period?",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T16:52:42Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466549930",
      "id" : 466549930,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU0OTkzMA==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 462698497,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466549930",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466551042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466551042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I personally prefer the old formulation here, with multiple lines instead of the multiple-ary `=`",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T16:54:32Z",
      "diff_hunk" : "@@ -172,68 +166,59 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,\n+                                         EstimationResult *result) const\n {\n     // Counters for a bucket (or range of buckets)\n     double nConf = 0; // Number of tx's confirmed within the confTarget\n     double totalNum = 0; // Total number of tx's that were ever confirmed\n     int extraNum = 0;  // Number of tx's still in mempool for confTarget or longer\n     double failNum = 0; // Number of tx's that were never confirmed but removed from the mempool after confTarget\n-    int periodTarget = (confTarget + scale - 1)/scale;\n-\n+    int periodTarget = (confTarget + scale - 1) / scale;\n     int maxbucketindex = buckets.size() - 1;\n \n-    // requireGreater means we are looking for the lowest feerate such that all higher\n-    // values pass, so we start at maxbucketindex (highest feerate) and look at successively\n-    // smaller buckets until we reach failure.  Otherwise, we are looking for the highest\n-    // feerate such that all lower values fail, and we go in the opposite direction.\n-    unsigned int startbucket = requireGreater ? maxbucketindex : 0;\n-    int step = requireGreater ? -1 : 1;\n-\n     // We'll combine buckets until we have enough samples.\n     // The near and far variables will define the range we've combined\n     // The best variables are the last range we saw which still had a high\n     // enough confirmation rate to count as success.\n     // The cur variables are the current range we're counting.\n-    unsigned int curNearBucket = startbucket;\n-    unsigned int bestNearBucket = startbucket;\n-    unsigned int curFarBucket = startbucket;\n-    unsigned int bestFarBucket = startbucket;\n+    unsigned int curNearBucket, bestNearBucket, curFarBucket, bestFarBucket;\n+    curNearBucket = bestNearBucket = curFarBucket = bestFarBucket = maxbucketindex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466551042",
      "id" : 466551042,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1MTA0Mg==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 221,
      "original_position" : 131,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 462699925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466551042",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466552665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466552665"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice catch that the `requireGreater` argument is unused",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T16:57:18Z",
      "diff_hunk" : "@@ -172,68 +166,59 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466552665",
      "id" : 466552665,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1MjY2NQ==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 204,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 101,
      "pull_request_review_id" : 462702023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466552665",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466553077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466553077"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe use `--bucket`, pre-in/decrement iis the standard in this project.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T16:58:02Z",
      "diff_hunk" : "@@ -242,8 +227,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n     EstimatorBucket passBucket;\n     EstimatorBucket failBucket;\n \n-    // Start counting from highest(default) or lowest feerate transactions\n-    for (int bucket = startbucket; bucket >= 0 && bucket <= maxbucketindex; bucket += step) {\n+    // Start counting from highest feerate transactions\n+    for (int bucket = maxbucketindex; bucket >= 0; bucket--) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466553077",
      "id" : 466553077,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1MzA3Nw==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 231,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 462702572,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466553077",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466553413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466553413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, the comment was wrong and I think morcos fixed the value but forgot about the comment. The comment change happened in this commit https://github.com/bitcoin/bitcoin/commit/b649e0395464a659f4b3485ec71d28dc95ba48bd , and the variable it refers to no longer exists. ",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T16:58:36Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466553413",
      "id" : 466553413,
      "in_reply_to_id" : 466549930,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1MzQxMw==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 462703004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466553413",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466553933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466553933"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T16:59:32Z",
      "diff_hunk" : "@@ -242,8 +227,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n     EstimatorBucket passBucket;\n     EstimatorBucket failBucket;\n \n-    // Start counting from highest(default) or lowest feerate transactions\n-    for (int bucket = startbucket; bucket >= 0 && bucket <= maxbucketindex; bucket += step) {\n+    // Start counting from highest feerate transactions\n+    for (int bucket = maxbucketindex; bucket >= 0; bucket--) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466553933",
      "id" : 466553933,
      "in_reply_to_id" : 466553077,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1MzkzMw==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 231,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 462703664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466553933",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466556072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466556072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T17:03:28Z",
      "diff_hunk" : "@@ -172,68 +166,59 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,\n+                                         EstimationResult *result) const\n {\n     // Counters for a bucket (or range of buckets)\n     double nConf = 0; // Number of tx's confirmed within the confTarget\n     double totalNum = 0; // Total number of tx's that were ever confirmed\n     int extraNum = 0;  // Number of tx's still in mempool for confTarget or longer\n     double failNum = 0; // Number of tx's that were never confirmed but removed from the mempool after confTarget\n-    int periodTarget = (confTarget + scale - 1)/scale;\n-\n+    int periodTarget = (confTarget + scale - 1) / scale;\n     int maxbucketindex = buckets.size() - 1;\n \n-    // requireGreater means we are looking for the lowest feerate such that all higher\n-    // values pass, so we start at maxbucketindex (highest feerate) and look at successively\n-    // smaller buckets until we reach failure.  Otherwise, we are looking for the highest\n-    // feerate such that all lower values fail, and we go in the opposite direction.\n-    unsigned int startbucket = requireGreater ? maxbucketindex : 0;\n-    int step = requireGreater ? -1 : 1;\n-\n     // We'll combine buckets until we have enough samples.\n     // The near and far variables will define the range we've combined\n     // The best variables are the last range we saw which still had a high\n     // enough confirmation rate to count as success.\n     // The cur variables are the current range we're counting.\n-    unsigned int curNearBucket = startbucket;\n-    unsigned int bestNearBucket = startbucket;\n-    unsigned int curFarBucket = startbucket;\n-    unsigned int bestFarBucket = startbucket;\n+    unsigned int curNearBucket, bestNearBucket, curFarBucket, bestFarBucket;\n+    curNearBucket = bestNearBucket = curFarBucket = bestFarBucket = maxbucketindex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466556072",
      "id" : 466556072,
      "in_reply_to_id" : 466551042,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1NjA3Mg==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 221,
      "original_position" : 131,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 462706523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466556072",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466557764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466557764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh I see, the bucket size was changed, thanks.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-06T17:06:30Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466557764",
      "id" : 466557764,
      "in_reply_to_id" : 466549930,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1Nzc2NA==",
      "original_commit_id" : "7f61299da7330f2ebb991acecc12a30da16106ef",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 462708709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466557764",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK besides some minor nits",
      "created_at" : "2020-08-06T17:07:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-670057638",
      "id" : 670057638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDA1NzYzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T17:07:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670057638",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Amended after review (the unnecessary variables declaration move and the pre-decrement).",
      "created_at" : "2020-08-06T17:15:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-670062373",
      "id" : 670062373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDA2MjM3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T17:15:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670062373",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FYI it looks the last usage of requireGreater=false went away in b2322e0fc6def0baf8581bbd2f4135e61c47d142",
      "created_at" : "2020-08-06T17:20:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-670065158",
      "id" : 670065158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDA2NTE1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T17:20:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670065158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466961420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466961420"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could simply put the \">\" directly into the format string instead of the \"%s\" and have one argument less",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-07T10:38:42Z",
      "diff_hunk" : "@@ -339,7 +329,7 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n     }\n \n     LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+             confTarget, \">\", 100.0 * successBreakPoint, decay,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466961420",
      "id" : 466961420,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk2MTQyMA==",
      "original_commit_id" : "ec5c7ae9dea6c63eae6b979fef92130cc1c4e8fb",
      "original_line" : 332,
      "original_position" : 80,
      "original_start_line" : 331,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 463211663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466961420",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466963277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466963277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah right",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-07T10:43:02Z",
      "diff_hunk" : "@@ -339,7 +329,7 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n     }\n \n     LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+             confTarget, \">\", 100.0 * successBreakPoint, decay,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466963277",
      "id" : 466963277,
      "in_reply_to_id" : 466961420,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk2MzI3Nw==",
      "original_commit_id" : "ec5c7ae9dea6c63eae6b979fef92130cc1c4e8fb",
      "original_line" : 332,
      "original_position" : 80,
      "original_start_line" : 331,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 463213980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466963277",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theStack i think the for loops unification are not \"small readability improvements\", and that the readability improvements are not \"unify some duplicated for loops\". Also, fixed the string format, thanks!",
      "created_at" : "2020-08-07T10:57:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-670459759",
      "id" : 670459759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDQ1OTc1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-07T10:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670459759",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466993757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466993757"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note that this adds an additional space after the \">\" that hasn't been there before. Could be problematic if e.g. some tests rely on a strict format",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-07T11:56:18Z",
      "diff_hunk" : "@@ -338,8 +328,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466993757",
      "id" : 466993757,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk5Mzc1Nw==",
      "original_commit_id" : "eda3f910d09c48641f69bc365a70aa205eefb5f4",
      "original_line" : 338,
      "original_position" : 82,
      "original_start_line" : 341,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 463252504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466993757",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466995528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466995528"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, it's on purpose...",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-07T12:00:27Z",
      "diff_hunk" : "@@ -338,8 +328,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r466995528",
      "id" : 466995528,
      "in_reply_to_id" : 466993757,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk5NTUyOA==",
      "original_commit_id" : "eda3f910d09c48641f69bc365a70aa205eefb5f4",
      "original_line" : 338,
      "original_position" : 82,
      "original_start_line" : 341,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 463254970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466995528",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tests pass but the s390X Travis build is always stuck and eventually results in a failure after one day (i've tried to force-push above but it won't trigger it).\r\n\r\nedit: reopened to kick it back..",
      "created_at" : "2020-08-08T14:47:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-670937409",
      "id" : 670937409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDkzNzQwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-10T11:26:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670937409",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r470716669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470716669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While not introduced in this PR we have an existing floating-point division by zero here that would be really nice to get rid of while you're touching these lines :)\r\n\r\nIn the case of `passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool == 0` that is.\r\n\r\nDepending on Clang version you may see it by running â¦\r\n\r\n```\r\n$ CC=clang CXX=clang++ ./configure --with-sanitizers=undefined\r\n$ make\r\n$ src/test/test_bitcoin\r\n```\r\n\r\n... and look for `policy/fees.cpp:â¦:â¦: runtime error: division by zero` in the output.\r\n\r\nWhen this has been addressed the following UBSan suppression can be removed:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/30dd562fd2c58536fa026fff9853b8d825216b01/test/sanitizer_suppressions/ubsan#L3",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-14T16:05:24Z",
      "diff_hunk" : "@@ -338,8 +325,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,\n              median, passBucket.start, passBucket.end,\n              100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r470716669",
      "id" : 470716669,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxNjY2OQ==",
      "original_commit_id" : "dd7f81d528eb88238f8e50f7a0c6744102a13dc1",
      "original_line" : 331,
      "original_position" : 184,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 467695625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470716669",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r470902972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470902972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice catch ! Will push a new commit, thanks :)",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-14T23:23:50Z",
      "diff_hunk" : "@@ -338,8 +325,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,\n              median, passBucket.start, passBucket.end,\n              100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r470902972",
      "id" : 470902972,
      "in_reply_to_id" : 470716669,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwMjk3Mg==",
      "original_commit_id" : "dd7f81d528eb88238f8e50f7a0c6744102a13dc1",
      "original_line" : 331,
      "original_position" : 184,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 467919488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470902972",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r470917615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470917615"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added in 24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-08-15T00:56:09Z",
      "diff_hunk" : "@@ -338,8 +325,8 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,\n              median, passBucket.start, passBucket.end,\n              100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r470917615",
      "id" : 470917615,
      "in_reply_to_id" : 470716669,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxNzYxNQ==",
      "original_commit_id" : "dd7f81d528eb88238f8e50f7a0c6744102a13dc1",
      "original_line" : 331,
      "original_position" : 184,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 467933713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470917615",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487122926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487122926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove the number entirely from the comment. No need for a comment that says \"x is x\"\r\n```suggestion\r\n    /** This decay gives a half-life of 144 blocks or about 1 day */\r\n```\r\nSame for other comments here.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-11T15:30:03Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487122926",
      "id" : 487122926,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMjkyNg==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 486909469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487122926",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487125893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487125893"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider making this `const`? (Same for `periodTarget` above)",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-11T15:35:03Z",
      "diff_hunk" : "@@ -172,68 +166,61 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,\n+                                         EstimationResult *result) const\n {\n     // Counters for a bucket (or range of buckets)\n     double nConf = 0; // Number of tx's confirmed within the confTarget\n     double totalNum = 0; // Total number of tx's that were ever confirmed\n     int extraNum = 0;  // Number of tx's still in mempool for confTarget or longer\n     double failNum = 0; // Number of tx's that were never confirmed but removed from the mempool after confTarget\n-    int periodTarget = (confTarget + scale - 1)/scale;\n-\n+    int periodTarget = (confTarget + scale - 1) / scale;\n     int maxbucketindex = buckets.size() - 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487125893",
      "id" : 487125893,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNTg5Mw==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 213,
      "original_position" : 112,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 486909469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487125893",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487127683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487127683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "current style guide is to name prefix member variable names with m_, so this would become `m_feerate_avg`. No need to update the other member variable names - just this one because you're already touching it.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-11T15:37:55Z",
      "diff_hunk" : "@@ -139,22 +137,18 @@ class TxConfirmStats\n TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets,\n                                 const std::map<double, unsigned int>& defaultBucketMap,\n                                unsigned int maxPeriods, double _decay, unsigned int _scale)\n-    : buckets(defaultBuckets), bucketMap(defaultBucketMap)\n+    : buckets(defaultBuckets), bucketMap(defaultBucketMap), decay(_decay), scale(_scale)\n {\n-    decay = _decay;\n     assert(_scale != 0 && \"_scale must be non-zero\");\n-    scale = _scale;\n     confAvg.resize(maxPeriods);\n-    for (unsigned int i = 0; i < maxPeriods; i++) {\n-        confAvg[i].resize(buckets.size());\n-    }\n     failAvg.resize(maxPeriods);\n     for (unsigned int i = 0; i < maxPeriods; i++) {\n+        confAvg[i].resize(buckets.size());\n         failAvg[i].resize(buckets.size());\n     }\n \n     txCtAvg.resize(buckets.size());\n-    avg.resize(buckets.size());\n+    feerate_avg.resize(buckets.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487127683",
      "id" : 487127683,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNzY4Mw==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 151,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 486909469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487127683",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487135510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487135510"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure if this is the correct fix. It's very difficult to parse what this log line is doing, and adding `std::numeric_limits<double>::min()` makes it harder still. How about taking these calculations out of the log line, putting them in temporary variables, and explicitly setting them to zero if `passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool` is equal to zero?",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-11T15:51:17Z",
      "diff_hunk" : "@@ -338,13 +325,13 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,\n              median, passBucket.start, passBucket.end,\n-             100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool),\n+             100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool + std::numeric_limits<double>::min()),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487135510",
      "id" : 487135510,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEzNTUxMA==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 331,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 486909469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487135510",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487939607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487939607"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it's a trivial \"x is x\" comment: it's not trivial to me that a decay of say `.99931` is equivalent to a half-life of 1008 blocks.\r\n",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T13:55:12Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487939607",
      "id" : 487939607,
      "in_reply_to_id" : 487122926,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkzOTYwNw==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 487793588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487939607",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487939762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487939762"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T13:55:22Z",
      "diff_hunk" : "@@ -172,68 +166,61 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,\n+                                         EstimationResult *result) const\n {\n     // Counters for a bucket (or range of buckets)\n     double nConf = 0; // Number of tx's confirmed within the confTarget\n     double totalNum = 0; // Total number of tx's that were ever confirmed\n     int extraNum = 0;  // Number of tx's still in mempool for confTarget or longer\n     double failNum = 0; // Number of tx's that were never confirmed but removed from the mempool after confTarget\n-    int periodTarget = (confTarget + scale - 1)/scale;\n-\n+    int periodTarget = (confTarget + scale - 1) / scale;\n     int maxbucketindex = buckets.size() - 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487939762",
      "id" : 487939762,
      "in_reply_to_id" : 487125893,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkzOTc2Mg==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 213,
      "original_position" : 112,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 487793738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487939762",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487939981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487939981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T13:55:33Z",
      "diff_hunk" : "@@ -139,22 +137,18 @@ class TxConfirmStats\n TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets,\n                                 const std::map<double, unsigned int>& defaultBucketMap,\n                                unsigned int maxPeriods, double _decay, unsigned int _scale)\n-    : buckets(defaultBuckets), bucketMap(defaultBucketMap)\n+    : buckets(defaultBuckets), bucketMap(defaultBucketMap), decay(_decay), scale(_scale)\n {\n-    decay = _decay;\n     assert(_scale != 0 && \"_scale must be non-zero\");\n-    scale = _scale;\n     confAvg.resize(maxPeriods);\n-    for (unsigned int i = 0; i < maxPeriods; i++) {\n-        confAvg[i].resize(buckets.size());\n-    }\n     failAvg.resize(maxPeriods);\n     for (unsigned int i = 0; i < maxPeriods; i++) {\n+        confAvg[i].resize(buckets.size());\n         failAvg[i].resize(buckets.size());\n     }\n \n     txCtAvg.resize(buckets.size());\n-    avg.resize(buckets.size());\n+    feerate_avg.resize(buckets.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487939981",
      "id" : 487939981,
      "in_reply_to_id" : 487127683,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkzOTk4MQ==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 151,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 487793907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487939981",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487943047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487943047"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree! That's why I'm saying remove the literal value that's in the code and leave the rest.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T13:58:25Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487943047",
      "id" : 487943047,
      "in_reply_to_id" : 487122926,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0MzA0Nw==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 487796804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487943047",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487971637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487971637"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm not sure if this is the correct fix\r\n\r\nIt's correct in the sense that it's not a division by 0 anymore :). Cleaned up by using temporary variables.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T14:22:50Z",
      "diff_hunk" : "@@ -338,13 +325,13 @@ double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n         failBucket.leftMempool = failNum;\n     }\n \n-    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d %s%.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n-             confTarget, requireGreater ? \">\" : \"<\", 100.0 * successBreakPoint, decay,\n+    LogPrint(BCLog::ESTIMATEFEE, \"FeeEst: %d > %.0f%% decay %.5f: feerate: %g from (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out) Fail: (%g - %g) %.2f%% %.1f/(%.1f %d mem %.1f out)\\n\",\n+             confTarget, 100.0 * successBreakPoint, decay,\n              median, passBucket.start, passBucket.end,\n-             100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool),\n+             100 * passBucket.withinTarget / (passBucket.totalConfirmed + passBucket.inMempool + passBucket.leftMempool + std::numeric_limits<double>::min()),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r487971637",
      "id" : 487971637,
      "in_reply_to_id" : 487135510,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk3MTYzNw==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 331,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 487822514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T14:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487971637",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review. Cleaned up the logprint, used the `m_` prefix, and made some variables `const`.",
      "created_at" : "2020-09-14T14:25:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-692089354",
      "id" : 692089354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjA4OTM1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-14T14:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692089354",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T15:20:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#issuecomment-692128679",
      "id" : 692128679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19630",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjEyODY3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-14T15:20:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692128679",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r488175457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488175457"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, ok: will remove if i have to retouch",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-14T19:39:26Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ class CBlockPolicyEstimator\n \n     /** Decay of .962 is a half-life of 18 blocks or about 3 hours */\n     static constexpr double SHORT_DECAY = .962;\n-    /** Decay of .998 is a half-life of 144 blocks or about 1 day */\n+    /** Decay of .9952 is a half-life of 144 blocks or about 1 day */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r488175457",
      "id" : 488175457,
      "in_reply_to_id" : 487122926,
      "line" : 141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE3NTQ1Nw==",
      "original_commit_id" : "24bcbbfb7b21641b6f2d00ae18d69c59a7c1f56e",
      "original_line" : 141,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 5,
      "pull_request_review_id" : 488084095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T19:39:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488175457",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r495103258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495103258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you feel it you can comment `scale` parameter usage at function declaration.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-25T16:32:53Z",
      "diff_hunk" : "@@ -139,22 +137,18 @@ class TxConfirmStats\n TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets,\n                                 const std::map<double, unsigned int>& defaultBucketMap,\n                                unsigned int maxPeriods, double _decay, unsigned int _scale)\n-    : buckets(defaultBuckets), bucketMap(defaultBucketMap)\n+    : buckets(defaultBuckets), bucketMap(defaultBucketMap), decay(_decay), scale(_scale)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r495103258",
      "id" : 495103258,
      "line" : 140,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEwMzI1OA==",
      "original_commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "original_line" : 140,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 28,
      "pull_request_review_id" : 496575680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-25T16:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495103258",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r495105223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495105223"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe you can keep comment first halve and precise what the highers values reference is about. I believe it means higher buckets of transactions.",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-25T16:36:43Z",
      "diff_hunk" : "@@ -172,68 +166,61 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    m_feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        m_feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,\n+                                         EstimationResult *result) const\n {\n     // Counters for a bucket (or range of buckets)\n     double nConf = 0; // Number of tx's confirmed within the confTarget\n     double totalNum = 0; // Total number of tx's that were ever confirmed\n     int extraNum = 0;  // Number of tx's still in mempool for confTarget or longer\n     double failNum = 0; // Number of tx's that were never confirmed but removed from the mempool after confTarget\n-    int periodTarget = (confTarget + scale - 1)/scale;\n-\n-    int maxbucketindex = buckets.size() - 1;\n-\n-    // requireGreater means we are looking for the lowest feerate such that all higher\n-    // values pass, so we start at maxbucketindex (highest feerate) and look at successively\n-    // smaller buckets until we reach failure.  Otherwise, we are looking for the highest\n-    // feerate such that all lower values fail, and we go in the opposite direction.\n-    unsigned int startbucket = requireGreater ? maxbucketindex : 0;\n-    int step = requireGreater ? -1 : 1;\n+    const int periodTarget = (confTarget + scale - 1) / scale;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r495105223",
      "id" : 495105223,
      "line" : 212,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEwNTIyMw==",
      "original_commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "original_line" : 212,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 119,
      "pull_request_review_id" : 496575680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-25T16:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495105223",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r495812179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495812179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit 5b8cb35621891b681f9b49a9de5f6d8da4ccdecc:\r\n\r\nI think this line in the comment can be kept",
      "commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "created_at" : "2020-09-28T09:38:12Z",
      "diff_hunk" : "@@ -172,68 +166,61 @@ void TxConfirmStats::resizeInMemoryCounters(size_t newbuckets) {\n void TxConfirmStats::ClearCurrent(unsigned int nBlockHeight)\n {\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        oldUnconfTxs[j] += unconfTxs[nBlockHeight%unconfTxs.size()][j];\n+        oldUnconfTxs[j] += unconfTxs[nBlockHeight % unconfTxs.size()][j];\n         unconfTxs[nBlockHeight%unconfTxs.size()][j] = 0;\n     }\n }\n \n \n-void TxConfirmStats::Record(int blocksToConfirm, double val)\n+void TxConfirmStats::Record(int blocksToConfirm, double feerate)\n {\n     // blocksToConfirm is 1-based\n     if (blocksToConfirm < 1)\n         return;\n-    int periodsToConfirm = (blocksToConfirm + scale - 1)/scale;\n-    unsigned int bucketindex = bucketMap.lower_bound(val)->second;\n+    int periodsToConfirm = (blocksToConfirm + scale - 1) / scale;\n+    unsigned int bucketindex = bucketMap.lower_bound(feerate)->second;\n     for (size_t i = periodsToConfirm; i <= confAvg.size(); i++) {\n         confAvg[i - 1][bucketindex]++;\n     }\n     txCtAvg[bucketindex]++;\n-    avg[bucketindex] += val;\n+    m_feerate_avg[bucketindex] += feerate;\n }\n \n void TxConfirmStats::UpdateMovingAverages()\n {\n+    assert(confAvg.size() == failAvg.size());\n     for (unsigned int j = 0; j < buckets.size(); j++) {\n-        for (unsigned int i = 0; i < confAvg.size(); i++)\n-            confAvg[i][j] = confAvg[i][j] * decay;\n-        for (unsigned int i = 0; i < failAvg.size(); i++)\n-            failAvg[i][j] = failAvg[i][j] * decay;\n-        avg[j] = avg[j] * decay;\n-        txCtAvg[j] = txCtAvg[j] * decay;\n+        for (unsigned int i = 0; i < confAvg.size(); i++) {\n+            confAvg[i][j] *= decay;\n+            failAvg[i][j] *= decay;\n+        }\n+        m_feerate_avg[j] *= decay;\n+        txCtAvg[j] *= decay;\n     }\n }\n \n // returns -1 on error conditions\n double TxConfirmStats::EstimateMedianVal(int confTarget, double sufficientTxVal,\n-                                         double successBreakPoint, bool requireGreater,\n-                                         unsigned int nBlockHeight, EstimationResult *result) const\n+                                         double successBreakPoint, unsigned int nBlockHeight,\n+                                         EstimationResult *result) const\n {\n     // Counters for a bucket (or range of buckets)\n     double nConf = 0; // Number of tx's confirmed within the confTarget\n     double totalNum = 0; // Total number of tx's that were ever confirmed\n     int extraNum = 0;  // Number of tx's still in mempool for confTarget or longer\n     double failNum = 0; // Number of tx's that were never confirmed but removed from the mempool after confTarget\n-    int periodTarget = (confTarget + scale - 1)/scale;\n-\n-    int maxbucketindex = buckets.size() - 1;\n-\n-    // requireGreater means we are looking for the lowest feerate such that all higher\n-    // values pass, so we start at maxbucketindex (highest feerate) and look at successively",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19630#discussion_r495812179",
      "id" : 495812179,
      "line" : 222,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgxMjE3OQ==",
      "original_commit_id" : "a3abeec33a6ae903e514c7a7b6f587b7c17288a0",
      "original_line" : 222,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 114,
      "pull_request_review_id" : 497345684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19630",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-28T09:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495812179",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
