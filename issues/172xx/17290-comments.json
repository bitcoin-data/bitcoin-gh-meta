[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17526](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17526.html) (Use Single Random Draw In addition to knapsack as coin selection fallback by achow101)\n* [#17458](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17458.html) (Refactor OutputGroup effective value calculations and filtering to occur within the struct by achow101)\n* [#17331](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17331.html) (Use effective values throughout coin selection by achow101)\n* [#17211](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17211.html) (Allow fundrawtransaction and walletcreatefundedpsbt to take external inputs by achow101)\n* [#16910](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16910.html) (wallet: reduce loading time by using unordered maps by achow101)\n* [#9381](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/9381.html) (Remove CWalletTx merging logic from AddToWallet by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-10-29T00:33:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-547205040",
      "id" : 547205040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzIwNTA0MA==",
      "updated_at" : "2019-11-20T03:30:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547205040",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340302591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340302591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "are these `bnb_used` lines really necessary? We aren't using knapsack solver either on `SelectCoins` failure",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-29T20:17:13Z",
      "diff_hunk" : "@@ -2699,22 +2700,29 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     coin_control.ListSelected(vPresetInputs);\n     for (const COutPoint& outpoint : vPresetInputs)\n     {\n-        // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n-        bnb_used = false;\n-        coin_selection_params.use_bnb = false;\n-\n         std::map<uint256, CWalletTx>::const_iterator it = mapWallet.find(outpoint.hash);\n         if (it != mapWallet.end())\n         {\n             const CWalletTx& wtx = it->second;\n             // Clearly invalid input, fail\n-            if (wtx.tx->vout.size() <= outpoint.n)\n+            if (wtx.tx->vout.size() <= outpoint.n) {\n+                bnb_used = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340302591",
      "id" : 340302591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDMwMjU5MQ==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 308804955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340302591",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340303721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340303721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `value_to_select`",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-29T20:19:33Z",
      "diff_hunk" : "@@ -2674,6 +2674,7 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, const CoinEligibil\n bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, bool& bnb_used) const\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n+    CAmount value_select = nTargetValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340303721",
      "id" : 340303721,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDMwMzcyMQ==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 308804955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340303721",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340305893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340305893"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/are/can/",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-29T20:24:21Z",
      "diff_hunk" : "@@ -250,17 +260,24 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     vCoins.at(0).nInputBytes = 40; // Make sure that it has a negative effective value. The next check should assert if this somehow got through. Otherwise it will fail\n     BOOST_CHECK(!testWallet.SelectCoinsMinConf( 1 * CENT, filter_standard, GroupCoins(vCoins), setCoinsRet, nValueRet, coin_selection_params_bnb, bnb_used));\n \n-    // Make sure that we aren't using BnB when there are preset inputs\n+    // Make sure that we are using BnB when there are preset inputs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340305893",
      "id" : 340305893,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDMwNTg5Mw==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 48,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 308804955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340305893",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340327670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340327670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. The `CreateTransaction` loop ends up infinitely looping without them",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-29T21:11:46Z",
      "diff_hunk" : "@@ -2699,22 +2700,29 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     coin_control.ListSelected(vPresetInputs);\n     for (const COutPoint& outpoint : vPresetInputs)\n     {\n-        // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n-        bnb_used = false;\n-        coin_selection_params.use_bnb = false;\n-\n         std::map<uint256, CWalletTx>::const_iterator it = mapWallet.find(outpoint.hash);\n         if (it != mapWallet.end())\n         {\n             const CWalletTx& wtx = it->second;\n             // Clearly invalid input, fail\n-            if (wtx.tx->vout.size() <= outpoint.n)\n+            if (wtx.tx->vout.size() <= outpoint.n) {\n+                bnb_used = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340327670",
      "id" : 340327670,
      "in_reply_to_id" : 340302591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDMyNzY3MA==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 308837114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340327670",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340366077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340366077"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-29T23:02:30Z",
      "diff_hunk" : "@@ -2674,6 +2674,7 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, const CoinEligibil\n bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, bool& bnb_used) const\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n+    CAmount value_select = nTargetValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340366077",
      "id" : 340366077,
      "in_reply_to_id" : 340303721,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDM2NjA3Nw==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 308884948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340366077",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340366102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340366102"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-29T23:02:34Z",
      "diff_hunk" : "@@ -250,17 +260,24 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     vCoins.at(0).nInputBytes = 40; // Make sure that it has a negative effective value. The next check should assert if this somehow got through. Otherwise it will fail\n     BOOST_CHECK(!testWallet.SelectCoinsMinConf( 1 * CENT, filter_standard, GroupCoins(vCoins), setCoinsRet, nValueRet, coin_selection_params_bnb, bnb_used));\n \n-    // Make sure that we aren't using BnB when there are preset inputs\n+    // Make sure that we are using BnB when there are preset inputs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340366102",
      "id" : 340366102,
      "in_reply_to_id" : 340305893,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDM2NjEwMg==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 48,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 308884974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340366102",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This change might have broken wallet_bumpfee.py somewhat randomly: https://travis-ci.org/bitcoin/bitcoin/jobs/604712627?utm_medium=notification&utm_source=github_status\r\n\r\nN.B. bumpfee uses preselected inputs to create the transaction, so it might be the case that BnB ended up \"hitting\" where it previously hadn't and got rid of the change output earlier than expected in the test.",
      "created_at" : "2019-10-30T13:32:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-547904173",
      "id" : 547904173,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzkwNDE3Mw==",
      "updated_at" : "2019-10-30T13:32:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547904173",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This change might have broken wallet_bumpfee.py somewhat randomly:\r\n\r\nI'm not sure why it would fail randomly since BnB should be deterministic. I also can't reproduce this at all..",
      "created_at" : "2019-10-30T16:19:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-547989385",
      "id" : 547989385,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0Nzk4OTM4NQ==",
      "updated_at" : "2019-10-30T16:19:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547989385",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Honestly I do not understand the error either. It seems either the original input was dropped somehow, or that it picked up additional inputs too early. I'll try to reproduce locally.\r\n",
      "created_at" : "2019-10-30T17:23:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-548020506",
      "id" : 548020506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODAyMDUwNg==",
      "updated_at" : "2019-10-30T17:23:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548020506",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ok I'm able to reproduce consistently.... it's adding 15 inputs for some reason when it shouldn't be adding any. investigating",
      "created_at" : "2019-10-30T17:52:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-548034341",
      "id" : 548034341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODAzNDM0MQ==",
      "updated_at" : "2019-10-30T17:52:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548034341",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340785052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340785052"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n-            value_to_select -= coin.effective_value;\r\n+            if (coin_selection_params.use_bnb) {\r\n+                value_to_select -= coin.effective_value;\r\n+            } else {\r\n+                value_to_select -= coin.txout.nValue;\r\n+            }\r\n```",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-30T18:21:36Z",
      "diff_hunk" : "@@ -2699,22 +2704,29 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     coin_control.ListSelected(vPresetInputs);\n     for (const COutPoint& outpoint : vPresetInputs)\n     {\n-        // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n-        bnb_used = false;\n-        coin_selection_params.use_bnb = false;\n-\n         std::map<uint256, CWalletTx>::const_iterator it = mapWallet.find(outpoint.hash);\n         if (it != mapWallet.end())\n         {\n             const CWalletTx& wtx = it->second;\n             // Clearly invalid input, fail\n-            if (wtx.tx->vout.size() <= outpoint.n)\n+            if (wtx.tx->vout.size() <= outpoint.n) {\n+                bnb_used = false;\n                 return false;\n+            }\n             // Just to calculate the marginal byte size\n-            nValueFromPresetInputs += wtx.tx->vout[outpoint.n].nValue;\n-            setPresetCoins.insert(CInputCoin(wtx.tx, outpoint.n));\n-        } else\n+            CInputCoin coin(wtx.tx, outpoint.n, wtx.GetSpendSize(outpoint.n, false));\n+            nValueFromPresetInputs += coin.txout.nValue;\n+            if (coin.m_input_bytes <= 0) {\n+                bnb_used = false;\n+                return false; // Not solvable, can't estimate size for fee\n+            }\n+            coin.effective_value = coin.txout.nValue - coin_selection_params.effective_fee.GetFee(coin.m_input_bytes);\n+            value_to_select -= coin.effective_value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340785052",
      "id" : 340785052,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDc4NTA1Mg==",
      "original_commit_id" : "34a31b22860b63a2fc87262250b379160f451385",
      "original_position" : 50,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 309425110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340785052",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340790842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340790842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed.",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-10-30T18:32:19Z",
      "diff_hunk" : "@@ -2699,22 +2704,29 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     coin_control.ListSelected(vPresetInputs);\n     for (const COutPoint& outpoint : vPresetInputs)\n     {\n-        // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n-        bnb_used = false;\n-        coin_selection_params.use_bnb = false;\n-\n         std::map<uint256, CWalletTx>::const_iterator it = mapWallet.find(outpoint.hash);\n         if (it != mapWallet.end())\n         {\n             const CWalletTx& wtx = it->second;\n             // Clearly invalid input, fail\n-            if (wtx.tx->vout.size() <= outpoint.n)\n+            if (wtx.tx->vout.size() <= outpoint.n) {\n+                bnb_used = false;\n                 return false;\n+            }\n             // Just to calculate the marginal byte size\n-            nValueFromPresetInputs += wtx.tx->vout[outpoint.n].nValue;\n-            setPresetCoins.insert(CInputCoin(wtx.tx, outpoint.n));\n-        } else\n+            CInputCoin coin(wtx.tx, outpoint.n, wtx.GetSpendSize(outpoint.n, false));\n+            nValueFromPresetInputs += coin.txout.nValue;\n+            if (coin.m_input_bytes <= 0) {\n+                bnb_used = false;\n+                return false; // Not solvable, can't estimate size for fee\n+            }\n+            coin.effective_value = coin.txout.nValue - coin_selection_params.effective_fee.GetFee(coin.m_input_bytes);\n+            value_to_select -= coin.effective_value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r340790842",
      "id" : 340790842,
      "in_reply_to_id" : 340785052,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MDc5MDg0Mg==",
      "original_commit_id" : "34a31b22860b63a2fc87262250b379160f451385",
      "original_position" : 50,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 309432537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/340790842",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review ACK https://github.com/bitcoin/bitcoin/pull/17290/commits/7e6cf109c2bc3f824f23fa58cad0bf5fe8184a9f",
      "created_at" : "2019-10-31T14:23:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-548399595",
      "id" : 548399595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODM5OTU5NQ==",
      "updated_at" : "2019-10-31T14:23:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548399595",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r342011583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342011583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find it a bit concerning that no test breaks when I remove this: https://github.com/Sjors/bitcoin/commit/398877e79bafb6d96bb4d2602568621d759eaf2d",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-04T11:48:38Z",
      "diff_hunk" : "@@ -2699,22 +2700,29 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     coin_control.ListSelected(vPresetInputs);\n     for (const COutPoint& outpoint : vPresetInputs)\n     {\n-        // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n-        bnb_used = false;\n-        coin_selection_params.use_bnb = false;\n-\n         std::map<uint256, CWalletTx>::const_iterator it = mapWallet.find(outpoint.hash);\n         if (it != mapWallet.end())\n         {\n             const CWalletTx& wtx = it->second;\n             // Clearly invalid input, fail\n-            if (wtx.tx->vout.size() <= outpoint.n)\n+            if (wtx.tx->vout.size() <= outpoint.n) {\n+                bnb_used = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r342011583",
      "id" : 342011583,
      "in_reply_to_id" : 340302591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjAxMTU4Mw==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 311018603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342011583",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r342028224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342028224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be nice to cover this case as well (used by the GUI and #16377), where coins are selected, but no extra inputs are allowed. Can wait for a followup though.",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-04T12:37:32Z",
      "diff_hunk" : "@@ -2674,6 +2678,7 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, const CoinEligibil\n bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, bool& bnb_used) const\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n+    CAmount value_to_select = nTargetValue;\n \n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r342028224",
      "id" : 342028224,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjAyODIyNA==",
      "original_commit_id" : "7e6cf109c2bc3f824f23fa58cad0bf5fe8184a9f",
      "original_position" : 20,
      "path" : "src/wallet/wallet.cpp",
      "position" : 20,
      "pull_request_review_id" : 311018603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342028224",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I find it a bit concerning that no test breaks when I remove this\r\n\r\nThat's a sanity check where the transaction in the wallet somehow doesn't match the coin requested. Maybe it warrants a log print statement, but that can be done later.",
      "created_at" : "2019-11-04T14:04:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-549367860",
      "id" : 549367860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTM2Nzg2MA==",
      "updated_at" : "2019-11-04T14:04:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549367860",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r342150029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342150029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since the same boolean variable is used throughout the tests, it carries over whatever value it had previously. We are expecting SelectCoins and SelectCoinsMinConf to modify it.",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-04T16:41:05Z",
      "diff_hunk" : "@@ -2699,22 +2700,29 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     coin_control.ListSelected(vPresetInputs);\n     for (const COutPoint& outpoint : vPresetInputs)\n     {\n-        // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n-        bnb_used = false;\n-        coin_selection_params.use_bnb = false;\n-\n         std::map<uint256, CWalletTx>::const_iterator it = mapWallet.find(outpoint.hash);\n         if (it != mapWallet.end())\n         {\n             const CWalletTx& wtx = it->second;\n             // Clearly invalid input, fail\n-            if (wtx.tx->vout.size() <= outpoint.n)\n+            if (wtx.tx->vout.size() <= outpoint.n) {\n+                bnb_used = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r342150029",
      "id" : 342150029,
      "in_reply_to_id" : 340302591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjE1MDAyOQ==",
      "original_commit_id" : "3da4aef785ea569b258d74bd4e8192be23761528",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 311202501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342150029",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r348320936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348320936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`spendable`?",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-20T07:14:29Z",
      "diff_hunk" : "@@ -53,29 +53,39 @@ static void add_coin(const CAmount& nValue, int nInput, CoinSet& set)\n     set.emplace(MakeTransactionRef(tx), nInput);\n }\n \n-static void add_coin(const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = false, int nInput=0)\n+static void add_coin(CWallet& wallet, const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = false, int nInput=0, bool spendable = false)\n {\n     balance += nValue;\n     static int nextLockTime = 0;\n     CMutableTransaction tx;\n     tx.nLockTime = nextLockTime++;        // so all transactions get different hashes\n     tx.vout.resize(nInput + 1);\n     tx.vout[nInput].nValue = nValue;\n+    if (spendable) {\n+        CTxDestination dest;\n+        std::string error;\n+        assert(wallet.GetNewDestination(OutputType::BECH32, \"\", dest, error));\n+        tx.vout[nInput].scriptPubKey = GetScriptForDestination(dest);\n+    }\n     if (fIsFromMe) {\n         // IsFromMe() returns (GetDebit() > 0), and GetDebit() is 0 if vin.empty(),\n         // so stop vin being empty, and cache a non-zero Debit to fake out IsFromMe()\n         tx.vin.resize(1);\n     }\n-    std::unique_ptr<CWalletTx> wtx = MakeUnique<CWalletTx>(&testWallet, MakeTransactionRef(std::move(tx)));\n+    std::unique_ptr<CWalletTx> wtx = MakeUnique<CWalletTx>(&wallet, MakeTransactionRef(std::move(tx)));\n     if (fIsFromMe)\n     {\n         wtx->m_amounts[CWalletTx::DEBIT].Set(ISMINE_SPENDABLE, 1);\n     }\n     COutput output(wtx.get(), nInput, nAge, true /* spendable */, true /* solvable */, true /* safe */);\n     vCoins.push_back(output);\n-    testWallet.AddToWallet(*wtx.get());\n+    wallet.AddToWallet(*wtx.get());\n     wtxn.emplace_back(std::move(wtx));\n }\n+static void add_coin(const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = false, int nInput=0, bool spendable = false)\n+{\n+    add_coin(testWallet, nValue, nAge, fIsFromMe, nInput);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r348320936",
      "id" : 348320936,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODMyMDkzNg==",
      "original_commit_id" : "299373ce61754cbf1e0f9a665e40f837f3ba6026",
      "original_position" : 38,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 319589793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348320936",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r348637294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348637294"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added",
      "commit_id" : "b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-20T17:12:22Z",
      "diff_hunk" : "@@ -53,29 +53,39 @@ static void add_coin(const CAmount& nValue, int nInput, CoinSet& set)\n     set.emplace(MakeTransactionRef(tx), nInput);\n }\n \n-static void add_coin(const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = false, int nInput=0)\n+static void add_coin(CWallet& wallet, const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = false, int nInput=0, bool spendable = false)\n {\n     balance += nValue;\n     static int nextLockTime = 0;\n     CMutableTransaction tx;\n     tx.nLockTime = nextLockTime++;        // so all transactions get different hashes\n     tx.vout.resize(nInput + 1);\n     tx.vout[nInput].nValue = nValue;\n+    if (spendable) {\n+        CTxDestination dest;\n+        std::string error;\n+        assert(wallet.GetNewDestination(OutputType::BECH32, \"\", dest, error));\n+        tx.vout[nInput].scriptPubKey = GetScriptForDestination(dest);\n+    }\n     if (fIsFromMe) {\n         // IsFromMe() returns (GetDebit() > 0), and GetDebit() is 0 if vin.empty(),\n         // so stop vin being empty, and cache a non-zero Debit to fake out IsFromMe()\n         tx.vin.resize(1);\n     }\n-    std::unique_ptr<CWalletTx> wtx = MakeUnique<CWalletTx>(&testWallet, MakeTransactionRef(std::move(tx)));\n+    std::unique_ptr<CWalletTx> wtx = MakeUnique<CWalletTx>(&wallet, MakeTransactionRef(std::move(tx)));\n     if (fIsFromMe)\n     {\n         wtx->m_amounts[CWalletTx::DEBIT].Set(ISMINE_SPENDABLE, 1);\n     }\n     COutput output(wtx.get(), nInput, nAge, true /* spendable */, true /* solvable */, true /* safe */);\n     vCoins.push_back(output);\n-    testWallet.AddToWallet(*wtx.get());\n+    wallet.AddToWallet(*wtx.get());\n     wtxn.emplace_back(std::move(wtx));\n }\n+static void add_coin(const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = false, int nInput=0, bool spendable = false)\n+{\n+    add_coin(testWallet, nValue, nAge, fIsFromMe, nInput);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#discussion_r348637294",
      "id" : 348637294,
      "in_reply_to_id" : 348320936,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYzNzI5NA==",
      "original_commit_id" : "299373ce61754cbf1e0f9a665e40f837f3ba6026",
      "original_position" : 38,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 320134020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17290",
      "updated_at" : "2019-11-20T17:12:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348637294",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK https://github.com/bitcoin/bitcoin/pull/17290/commits/b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-20T17:14:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-556122561",
      "id" : 556122561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NjEyMjU2MQ==",
      "updated_at" : "2019-11-20T17:14:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/556122561",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK b007efdf1910db1d38671d6435d2f379bbf847d2",
      "created_at" : "2019-11-22T09:12:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17290#issuecomment-557453832",
      "id" : 557453832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17290",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzQ1MzgzMg==",
      "updated_at" : "2019-11-22T09:12:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557453832",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
