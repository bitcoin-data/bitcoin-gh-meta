[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt ping\n",
      "created_at" : "2014-11-26T00:34:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64496962",
      "id" : 64496962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDk2OTYy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64496962/reactions"
      },
      "updated_at" : "2014-11-26T00:34:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64496962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I worry about the increased block access, and the resulting 100 extra blocks that can't be pruned.\n\nIsn't it easier to just allow immature spends in the mempool? Typically in a reorganization, after the disconnect, a reconnect follows that will make most of the removed transaction in the mempool valid again anyway.\n",
      "created_at" : "2014-11-26T00:53:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64498717",
      "id" : 64498717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDk4NzE3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64498717/reactions"
      },
      "updated_at" : "2014-11-26T00:55:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64498717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, there are several ways to fix this, and this one was discussed a bit. However, I'd highly prefer to hit coinsdb for this as inputs to mempool txn are likely to be cached anyway, which is preferable to hitting disk for a second block. (this also has potentially significant implications for pruning, as you now need to keep 100 extra blocks for any given reorg depth).\n\nAlso, could you include \"Make CTxMemPool::check more thourough by using CheckInputs 3215e5a\"? This should make the code much more robust in the future, though currently this branch fails those checks.\n",
      "created_at" : "2014-11-26T09:26:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64536058",
      "id" : 64536058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM2MDU4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64536058/reactions"
      },
      "updated_at" : "2014-11-26T09:26:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64536058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa Yes, if it weren't for your invalidateblock/reconsiderblock RPC additions then we could just only run check() after reorgs instead of during and all would be OK.\n",
      "created_at" : "2014-11-26T09:27:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64536176",
      "id" : 64536176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM2MTc2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64536176/reactions"
      },
      "updated_at" : "2014-11-26T09:27:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64536176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa : a re-org happens on the main network on average once or twice a day. Extra block access is really NOT an issue.\n\nRE: not being able to prune to less than 100+plausible-re-org-depth: I'm OK with 120 being the minimum number of blocks a pruning node needs to keep. If we REALLY want to support pruning down lower, then storing the hash of the coinbase transactions in the block indices would be sufficient.\n\nRE: easier to allow immature in mempool: I really don't like the idea of relaxing the invariant of \"every transaction in the mempool is ready to be mined.\" Certainly this code is simpler than that alternative. I also think we'll have to optimize CreateBlock fairly soon, which will probably mean a mempool rewrite to maintain a priority queue of transactions-- so creating a block is just \"pop off queue until block full.\"\n\n@TheBlueMatt : including more thorough CheckInputs is a good idea, but I don't think I'll have time to do that until Monday (out for Thanksgiving).\n\nRE: run check() after reorgs are complete comment:  theoretically, you can reorg onto a more-work chain that has a lower height. That will never happen on the main network, but I hate to say never and I think we should be as robust as possible at all the edge cases we can think up.\n",
      "created_at" : "2014-11-26T10:57:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64546854",
      "id" : 64546854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTQ2ODU0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64546854/reactions"
      },
      "updated_at" : "2014-11-26T10:59:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64546854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm worried about the extra block propagation latency of reorgs. Not about\nkilling people's disks.\n",
      "created_at" : "2014-11-26T11:04:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64547661",
      "id" : 64547661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTQ3NjYx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64547661/reactions"
      },
      "updated_at" : "2014-11-26T11:04:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64547661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "And the requirement in the pruning code is already limited to 1 or 2 days,\nif I recall correctly. Whatever we are or were comfortable with, this adds\nanother 100 nonprunable blocks.\n",
      "created_at" : "2014-11-26T11:05:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64547807",
      "id" : 64547807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTQ3ODA3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64547807/reactions"
      },
      "updated_at" : "2014-11-26T11:05:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64547807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Idea for if we decide to care about resurrecting coinbase spends that are invalidated during a re-org but become valid when it is finished:\n\nMove the coinbase spends to the orphan transaction list instead of dropping them. And add code when extending the tip to look for any \"now mature\" coinbase spends in mapOrphans, and move them to the mempool.\n\n(but I still don't think we need to care about this case)\n",
      "created_at" : "2014-11-26T11:07:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64548017",
      "id" : 64548017,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTQ4MDE3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64548017/reactions"
      },
      "updated_at" : "2014-11-26T11:07:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64548017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Well, I definitely prefer having a fix than not having one, and pruning isn't exactly a blocker right now.\n\nGiven that this also adds a test to detect the incorrect behaviour, I think we should merge it, and work on better solutions later.\n",
      "created_at" : "2014-11-26T16:05:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64667968",
      "id" : 64667968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjY3OTY4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64667968/reactions"
      },
      "updated_at" : "2014-11-26T16:05:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64667968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, can you rebase on top of the new #5316?\n",
      "created_at" : "2014-11-26T16:07:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64668290",
      "id" : 64668290,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjY4Mjkw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64668290/reactions"
      },
      "updated_at" : "2014-11-26T16:07:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64668290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re: minimum block count for pruning: you really need to have enough blocks to make human-timescale-fixes possible (ie I'd say a week of blocks, at least, ie 1008 blocks), and while an extra 100 blocks isnt a huge deal to me either, going from 1000 to 1100 is not a trivial difference, though I'm not sure who it'd effect practically.\n\nAnyway, I'll try to find some time this week to figure out why my pull fails your tests and your pull fails my tests :)\n",
      "created_at" : "2014-11-27T01:25:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64734242",
      "id" : 64734242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzM0MjQy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64734242/reactions"
      },
      "updated_at" : "2014-11-27T01:25:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64734242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "RE: requiring 100 MORE blocks when pruned:\n\nI must be missing something, I don't understand why this would be number pruned PLUS 100 more blocks, rather than just \"at least 100 most-recent blocks plus plausible re-org depth must be maintained\").\n\nCan @sipa or @TheBlueMatt explain why you're thinking this means pruning needs 100 more blocks than it would without this?\n",
      "created_at" : "2014-11-28T16:40:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64911803",
      "id" : 64911803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTExODAz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64911803/reactions"
      },
      "updated_at" : "2014-11-28T16:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64911803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Say you want to be sure you can reorg 111 blocks back, so down to height-111. This code here will fail if it can't read block B-100 if B is being reorged, so to reorg down to height-111, you need to have block height-211 available. Thus, you can only prune up to block height-211 rather than height-111.\n",
      "created_at" : "2014-11-28T16:45:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64912199",
      "id" : 64912199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTEyMTk5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64912199/reactions"
      },
      "updated_at" : "2014-11-28T16:45:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64912199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa: ok, misunderstanding was that anybody would think that a 100+ block re-org was plausible, or would want to plan for a multi-hundred-block re-org. We're saying the same thing, I just think it is silly to think that if a 100+ blockchain re-org happens having your mempool messed up will be an issue anybody cares about.\n",
      "created_at" : "2014-11-28T17:19:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64914998",
      "id" : 64914998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTE0OTk4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64914998/reactions"
      },
      "updated_at" : "2014-11-28T17:19:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64914998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "A 100+ block reorg isnt the issue, but /any/ reorg will require an extra 100 blocks to complete. As mentioned above in this thread, with pruning, its important to maintain enough reorg-able blocks to allow for human-scale issues (ie when there's an issue, we need to be able to get miners to upgrade and ensure people will eventually reorg to the best chain, ala the bdb locks fork)...Even ignoring that, hitting disk for this instead of iterating over the mempool and only hitting memory (in reasonable caches) is a huge difference, at least for those with spinning disks.\n",
      "created_at" : "2014-11-28T17:28:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64915665",
      "id" : 64915665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTE1NjY1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64915665/reactions"
      },
      "updated_at" : "2014-11-28T17:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64915665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There appears to be some misunderstanding here...I bring up the issue of hitting disk only as a way to say that I dont think #5267 is going to perform any worse than this in most cases, which it appears to at first glance, not because I'm necessarily concerned about relay times across nodes or anything like that (we have better solutions to that problem already). My point is more that I see #5267 as more obviously robust (instead of removing just the transactions we know we need to with a scalpel, we use a hammer and scan through the whole mempool to find the ones we need to remove) and performance isnt really a reason to chose this over that.\n",
      "created_at" : "2014-11-28T18:46:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-64920769",
      "id" : 64920769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTIwNzY5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64920769/reactions"
      },
      "updated_at" : "2014-11-28T18:46:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64920769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed off-by-one error found by @TheBlueMatt, and now includes his \"Make CTxMemPool::check more thorough\" commit.\n\nAnd rebased.\n",
      "created_at" : "2014-12-02T19:23:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-65288180",
      "id" : 65288180,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1Mjg4MTgw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65288180/reactions"
      },
      "updated_at" : "2014-12-02T19:37:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65288180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK. I believe the code and solution here are correct, assuming the block 100 back can be correctly read.\n\nI would still prefer a solution that does not rely on that assumption, but that can be done later.\n",
      "created_at" : "2014-12-03T16:09:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-65435503",
      "id" : 65435503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NDM1NTAz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65435503/reactions"
      },
      "updated_at" : "2014-12-03T16:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65435503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21291693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21291693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Isn't it a fatal error if this ReadBlockFromDisk fails?\n",
      "commit_id" : "cdc176bfc94dd7ff2ff5ad398d03b2b69f71abdb",
      "created_at" : "2014-12-04T08:46:17Z",
      "diff_hunk" : "@@ -1873,6 +1873,21 @@ bool static DisconnectTip(CValidationState &state) {\n     CBlock block;\n     if (!ReadBlockFromDisk(block, pindexDelete))\n         return state.Abort(\"Failed to read block\");\n+\n+    // Remove any will-be-too-immature-to-include-in-next-block spends from mempool:\n+    list<CTransaction> removedFromMempool;\n+    int immatureHeight = pindexDelete->nHeight-COINBASE_MATURITY+1;\n+    if (immatureHeight > 0)\n+    {\n+        const CBlockIndex* immatureIndex = pindexDelete->GetAncestor(immatureHeight);\n+        CBlock immatureBlock;\n+        if (ReadBlockFromDisk(immatureBlock, immatureIndex))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21291693",
      "id" : 21291693,
      "line" : 1884,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjkxNjkz",
      "original_commit_id" : "7268566aa3e7ede0d2a4d60fbc52d4405272e782",
      "original_line" : null,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : 12,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21291693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-12-04T14:48:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21291693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa: HUH? Why should it be done later? Do you have any specific objections to #5267?\n",
      "created_at" : "2014-12-04T09:21:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-65556547",
      "id" : 65556547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTU2NTQ3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65556547/reactions"
      },
      "updated_at" : "2014-12-04T09:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65556547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21298378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21298378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To mimic the old behavior, you actually need to push_back here. Though, again, I dont think this code is even necessary.\n",
      "commit_id" : "cdc176bfc94dd7ff2ff5ad398d03b2b69f71abdb",
      "created_at" : "2014-12-04T11:14:48Z",
      "diff_hunk" : "@@ -426,30 +427,41 @@ bool CTxMemPool::addUnchecked(const uint256& hash, const CTxMemPoolEntry &entry)\n }\n \n \n-void CTxMemPool::remove(const CTransaction &tx, std::list<CTransaction>& removed, bool fRecursive)\n+void CTxMemPool::remove(const CTransaction &origTx, std::list<CTransaction>& removed, bool fRecursive)\n {\n     // Remove transaction from memory pool\n+    LOCK(cs);\n+    std::deque<uint256> txToRemove;\n+    txToRemove.push_back(origTx.GetHash());\n+    if (fRecursive) {\n+        uint256 hash = origTx.GetHash();\n+        for (unsigned int i = 0; i < origTx.vout.size(); i++) {\n+            std::map<COutPoint, CInPoint>::iterator it = mapNextTx.find(COutPoint(hash, i));\n+            if (it != mapNextTx.end())\n+                txToRemove.push_back(it->second.ptx->GetHash());\n+        }\n+    }\n+    while (txToRemove.size())\n     {\n-        LOCK(cs);\n-        uint256 hash = tx.GetHash();\n+        uint256 hash = txToRemove.front();\n+        txToRemove.pop_front();\n+        if (!mapTx.count(hash))\n+            continue;\n+        const CTransaction& tx = mapTx[hash].GetTx();\n+        removed.push_front(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21298378",
      "id" : 21298378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjk4Mzc4",
      "original_commit_id" : "7268566aa3e7ede0d2a4d60fbc52d4405272e782",
      "original_line" : null,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21298378/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-12-04T14:48:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21298378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt I have one objection against it: it isn't passing Travis. \n",
      "created_at" : "2014-12-04T11:23:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-65618486",
      "id" : 65618486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjE4NDg2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65618486/reactions"
      },
      "updated_at" : "2014-12-04T15:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65618486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21307336"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21307336"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Very good question, the answer isn't obvious to me.\n\nreturn state.Abort() if block-100 couldn't be read would be trivial, but it seems a shame to get stuck on a bad fork if you can't read block-100 because your disk went bad.  Although I suppose if your disk is going bad you want to know sooner rather than later. \n\nA safe alternative would be to mempool.clear() if this read fails.\n",
      "commit_id" : "cdc176bfc94dd7ff2ff5ad398d03b2b69f71abdb",
      "created_at" : "2014-12-04T14:42:16Z",
      "diff_hunk" : "@@ -1873,6 +1873,21 @@ bool static DisconnectTip(CValidationState &state) {\n     CBlock block;\n     if (!ReadBlockFromDisk(block, pindexDelete))\n         return state.Abort(\"Failed to read block\");\n+\n+    // Remove any will-be-too-immature-to-include-in-next-block spends from mempool:\n+    list<CTransaction> removedFromMempool;\n+    int immatureHeight = pindexDelete->nHeight-COINBASE_MATURITY+1;\n+    if (immatureHeight > 0)\n+    {\n+        const CBlockIndex* immatureIndex = pindexDelete->GetAncestor(immatureHeight);\n+        CBlock immatureBlock;\n+        if (ReadBlockFromDisk(immatureBlock, immatureIndex))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21307336",
      "id" : 21307336,
      "line" : 1884,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzA3MzM2",
      "original_commit_id" : "7268566aa3e7ede0d2a4d60fbc52d4405272e782",
      "original_line" : null,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : 12,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21307336/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-12-04T14:48:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21307336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21308048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21308048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think stopping the node (with a state.Abort) is the acceptable when expected information cannot be read from disk. It means something is wrong on a lower level than we can handle.\nOn the other hand you're right that the mempool is not ciritical, and clearing it would be enough to get past this with consistent state.\n",
      "commit_id" : "cdc176bfc94dd7ff2ff5ad398d03b2b69f71abdb",
      "created_at" : "2014-12-04T14:53:28Z",
      "diff_hunk" : "@@ -1873,6 +1873,21 @@ bool static DisconnectTip(CValidationState &state) {\n     CBlock block;\n     if (!ReadBlockFromDisk(block, pindexDelete))\n         return state.Abort(\"Failed to read block\");\n+\n+    // Remove any will-be-too-immature-to-include-in-next-block spends from mempool:\n+    list<CTransaction> removedFromMempool;\n+    int immatureHeight = pindexDelete->nHeight-COINBASE_MATURITY+1;\n+    if (immatureHeight > 0)\n+    {\n+        const CBlockIndex* immatureIndex = pindexDelete->GetAncestor(immatureHeight);\n+        CBlock immatureBlock;\n+        if (ReadBlockFromDisk(immatureBlock, immatureIndex))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#discussion_r21308048",
      "id" : 21308048,
      "line" : 1884,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzA4MDQ4",
      "original_commit_id" : "7268566aa3e7ede0d2a4d60fbc52d4405272e782",
      "original_line" : null,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : 12,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21308048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-12-04T14:53:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21308048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ReadFromDisk(block-100) failure will now state.abort().\n\nAnd picked the push_front versus back nit pointed out by @TheBlueMatt .\n",
      "created_at" : "2014-12-04T14:58:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-65643488",
      "id" : 65643488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjQzNDg4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65643488/reactions"
      },
      "updated_at" : "2014-12-04T14:58:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65643488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK (for 0.10) commithash cdc176bfc94dd7ff2ff5ad398d03b2b69f71abdb ([signature](https://dev.visucore.com/bitcoin/acks/5386))\n",
      "created_at" : "2014-12-04T15:32:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-65649076",
      "id" : 65649076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjQ5MDc2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65649076/reactions"
      },
      "updated_at" : "2014-12-04T15:32:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65649076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Merged #5267 instead, to have one fix in. If it turns out that this solution was better we can change it again.\n",
      "created_at" : "2014-12-11T14:27:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5368#issuecomment-66625524",
      "id" : 66625524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5368",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjI1NTI0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66625524/reactions"
      },
      "updated_at" : "2014-12-11T14:27:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66625524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
