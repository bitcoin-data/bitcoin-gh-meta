[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5307#discussion_r27192502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/27192502"
         }
      },
      "body" : "In the moved line, this variable was initialized to NULL, but no more. Maybe better to do so just in case so that potential bugs result in more predictable outcomes (same for `pindexFork` on the line below).",
      "commit_id" : "60d066584ebd29249e24e9fb0a7e3730ef049e69",
      "created_at" : "2015-03-26T07:27:35Z",
      "diff_hunk" : "@@ -2086,14 +2086,16 @@ static bool ActivateBestChainStep(CValidationState &state, CBlockIndex *pindexMo\n // or an activated best chain. pblock is either NULL or a pointer to a block\n // that is already loaded (to avoid loading it again from disk).\n bool ActivateBestChain(CValidationState &state, CBlock *pblock) {\n-    CBlockIndex *pindexNewTip = NULL;\n     CBlockIndex *pindexMostWork = NULL;\n     do {\n         boost::this_thread::interruption_point();\n \n+        CBlockIndex *pindexNewTip;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#discussion_r27192502",
      "id" : 27192502,
      "original_commit_id" : "3ed7f8e070920a62a645914b8d9aa87051bf0908",
      "original_position" : 9,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5307",
      "updated_at" : "2015-04-08T17:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/27192502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5307#discussion_r27993490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/27993490"
         }
      },
      "body" : "I'm not sure I agree with this as best practice (initializing variables may hide bugs too that uninitialized memory and eg valgrind could show), but: done.",
      "commit_id" : "60d066584ebd29249e24e9fb0a7e3730ef049e69",
      "created_at" : "2015-04-08T17:40:16Z",
      "diff_hunk" : "@@ -2086,14 +2086,16 @@ static bool ActivateBestChainStep(CValidationState &state, CBlockIndex *pindexMo\n // or an activated best chain. pblock is either NULL or a pointer to a block\n // that is already loaded (to avoid loading it again from disk).\n bool ActivateBestChain(CValidationState &state, CBlock *pblock) {\n-    CBlockIndex *pindexNewTip = NULL;\n     CBlockIndex *pindexMostWork = NULL;\n     do {\n         boost::this_thread::interruption_point();\n \n+        CBlockIndex *pindexNewTip;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#discussion_r27993490",
      "id" : 27993490,
      "original_commit_id" : "3ed7f8e070920a62a645914b8d9aa87051bf0908",
      "original_position" : 9,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5307",
      "updated_at" : "2015-04-08T17:40:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/27993490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Updated.",
      "created_at" : "2015-04-08T17:40:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-90984476",
      "id" : 90984476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-04-08T17:40:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/90984476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Did some basic testing, and looks good to me.",
      "created_at" : "2015-04-10T23:26:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-91715314",
      "id" : 91715314,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-04-10T23:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/91715314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Mental note: perhaps this should limit itself to 8-16 new entries or so. If it's more, rely on peer's incremental synchronization to catch up (inspired by a comment by @sdaftuar in #5982).\r\n\r\nEDIT: implemented",
      "created_at" : "2015-04-11T10:02:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-91816101",
      "id" : 91816101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-04-12T14:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/91816101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I guess one side effect of this is that when announcing a reorg to an 0.10 peer, this increases the overhead.  Say there are N blocks announced in the inv generated here.  Then an 0.10 peer will generate N getheaders messages (with the same locator in each, but with a different hashstop), and the 0.10 peer will therefore receive N headers responses, with {0,1,...,(N-1)} headers in each message.\r\n\r\nThe total overhead is still not that large in absolute terms I think, but with N^2 behavior here, maybe this argues for the cap being more like 4 or 6, rather than 16?\r\n\r\nAlso I think in the case that we are truncating the inv's, perhaps it would be better to revert to only inv'ing the tip, rather than announcing up to our cap (whatever we pick for that value), since 0.10 nodes would otherwise be requesting the same long chain of headers multiple times.",
      "created_at" : "2015-04-16T17:01:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-93785348",
      "id" : 93785348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-04-16T17:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93785348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar Hmm, maybe that's a reason to only send all hashes when using 'headers' announcements, not 'inv' announcement (#5982)?",
      "created_at" : "2015-04-17T15:21:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-94007506",
      "id" : 94007506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-04-17T15:21:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/94007506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Yes I think that's reasonable, and that's the approach I'm trying for #5982 -- when inv-ing, only announce the tip; but when announcing headers, be willing to announce everything back to the last fork point (with some limits, as discussed in that issue).",
      "created_at" : "2015-04-29T18:49:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-97538089",
      "id" : 97538089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-04-29T18:49:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/97538089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "concept and light review ACK.\r\n\r\nMain comment:  If many nodes on the network are re-org'ing at once, doesn't this cause traffic to spike?\r\n\r\nI'll see if I can queue up some worst case local testing in a week or so, if nobody beats me to it.\r\n",
      "created_at" : "2015-07-23T18:40:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-124205598",
      "id" : 124205598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-07-23T18:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/124205598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Superseded by #6494.",
      "created_at" : "2015-09-22T16:40:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5307#issuecomment-142343749",
      "id" : 142343749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5307",
      "updated_at" : "2015-09-22T16:40:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/142343749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
