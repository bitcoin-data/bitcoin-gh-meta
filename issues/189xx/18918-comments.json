[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r422424816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422424816"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be nice to keep this test or at least document that salvagewallet will throw away your keys: #7379 ",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-09T00:02:37Z",
      "diff_hunk" : "@@ -404,8 +404,6 @@ def run_test(self):\n             '-reindex',\n             '-zapwallettxes=1',\n             '-zapwallettxes=2',\n-            # disabled until issue is fixed: https://github.com/bitcoin/bitcoin/issues/7463\n-            # '-salvagewallet',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r422424816",
      "id" : 422424816,
      "line" : 408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyNDgxNg==",
      "original_commit_id" : "a7274c441ae21ef4b52a258a038d5b28f5469036",
      "original_line" : 408,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 5,
      "pull_request_review_id" : 408584972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/422424816",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-09T00:03:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-626069441",
      "id" : 626069441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNjA2OTQ0MQ==",
      "updated_at" : "2020-05-09T00:03:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/626069441",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18971 (wallet: Refactor the classes in wallet/db.{cpp/h} by achow101)\n* #18836 (wallet: upgradewallet fixes and additional tests by achow101)\n* #18618 (gui: Drop RecentRequestsTableModel dependency to WalletModel by promag)\n* #18608 (refactor: Remove CAddressBookData::destdata by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-09T07:22:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-626121060",
      "id" : 626121060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNjEyMTA2MA==",
      "updated_at" : "2020-05-24T10:04:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/626121060",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Agree that this belongs in the wallet tool, not bitcoind.",
      "created_at" : "2020-05-13T18:25:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-628166195",
      "id" : 628166195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODE2NjE5NQ==",
      "updated_at" : "2020-05-13T18:25:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628166195",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, ... finally.\r\nFollows the concept of #8745. There was already an attempt to add salvage to the wallet tool in #15307",
      "created_at" : "2020-05-13T18:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-628170919",
      "id" : 628170919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODE3MDkxOQ==",
      "updated_at" : "2020-05-13T18:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628170919",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-13T18:52:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-628179885",
      "id" : 628179885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODE3OTg4NQ==",
      "updated_at" : "2020-05-13T18:52:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628179885",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426013039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426013039"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: remove -salvagewallet\" (8ef1b45b4d3de71214da1a6bc6e09f6e9a14d7d4)\r\n\r\n> Would be nice to keep this test or at least document that salvagewallet will throw away your keys: #7379\r\n\r\n@MarcoFalke could you describe the test or comment you would add? It sounds there is a good suggestion here, but I don't understand it's asking for",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-15T19:46:04Z",
      "diff_hunk" : "@@ -404,8 +404,6 @@ def run_test(self):\n             '-reindex',\n             '-zapwallettxes=1',\n             '-zapwallettxes=2',\n-            # disabled until issue is fixed: https://github.com/bitcoin/bitcoin/issues/7463\n-            # '-salvagewallet',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426013039",
      "id" : 426013039,
      "in_reply_to_id" : 422424816,
      "line" : 408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAxMzAzOQ==",
      "original_commit_id" : "a7274c441ae21ef4b52a258a038d5b28f5469036",
      "original_line" : 408,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 5,
      "pull_request_review_id" : 412922697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426013039",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426030169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426030169"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletool: Move salvage wallet implementation into wallettool\" (67e30b2b42b4d710739e6fe303cbca69be68032c)\r\n\r\nWould be nice to move this to src/wallet/salvage.{h,cpp} so wallet tool file does not become monolithic and so salvage functionality can be more easily tested and improved and perhaps accessible to future RPC or GUI recovery features",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-15T20:25:24Z",
      "diff_hunk" : "@@ -103,11 +104,205 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+\n static bool SalvageWallet(fs::path path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426030169",
      "id" : 426030169,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMDE2OQ==",
      "original_commit_id" : "67e30b2b42b4d710739e6fe303cbca69be68032c",
      "original_line" : 112,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 412922697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426030169",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426055478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426055478"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> @MarcoFalke could you describe the test or comment you would add? It sounds there is a good suggestion here, but I don't understand it's asking for\r\n\r\nThe new functionality has zero tests. I was hoping we could call `wallet-tool salvage` instead of `bitcoind -salvagewallet` here. Just because the test is commented out, doesn't mean it should be removed.\r\n\r\nIf the test still fails occasionally with the wallet-tool, then it can be commented out again.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-15T21:28:41Z",
      "diff_hunk" : "@@ -404,8 +404,6 @@ def run_test(self):\n             '-reindex',\n             '-zapwallettxes=1',\n             '-zapwallettxes=2',\n-            # disabled until issue is fixed: https://github.com/bitcoin/bitcoin/issues/7463\n-            # '-salvagewallet',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426055478",
      "id" : 426055478,
      "in_reply_to_id" : 422424816,
      "line" : 408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA1NTQ3OA==",
      "original_commit_id" : "a7274c441ae21ef4b52a258a038d5b28f5469036",
      "original_line" : 408,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 5,
      "pull_request_review_id" : 412978838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426055478",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426067115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426067115"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The behavior of salvage shouldn't be any different, so it will probably still fail as the previous `-salvagewallet` did.\r\n\r\nIt's also not clear to me what a salvage test should even look like.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-15T22:05:07Z",
      "diff_hunk" : "@@ -404,8 +404,6 @@ def run_test(self):\n             '-reindex',\n             '-zapwallettxes=1',\n             '-zapwallettxes=2',\n-            # disabled until issue is fixed: https://github.com/bitcoin/bitcoin/issues/7463\n-            # '-salvagewallet',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426067115",
      "id" : 426067115,
      "in_reply_to_id" : 422424816,
      "line" : 408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2NzExNQ==",
      "original_commit_id" : "a7274c441ae21ef4b52a258a038d5b28f5469036",
      "original_line" : 408,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 5,
      "pull_request_review_id" : 412993354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426067115",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426090798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426090798"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a salvage.{cpp/h} and put the salvage stuff in there.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-15T23:46:53Z",
      "diff_hunk" : "@@ -103,11 +104,205 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+\n static bool SalvageWallet(fs::path path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426090798",
      "id" : 426090798,
      "in_reply_to_id" : 426030169,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA5MDc5OA==",
      "original_commit_id" : "67e30b2b42b4d710739e6fe303cbca69be68032c",
      "original_line" : 112,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 413021252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426090798",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've changed the final refactor commit into several smaller moves and changes. The final approach for salvage is also slightly different.\r\n\r\nInstead of having all of the salvage logic `wallettool.cpp`, I've moved instead put it in a `RecoverDatabaseFile` function in new `salvage.{cpp/h}` files. Additionally, instead of copying `ReadKeyValue`, I've exposed it and `CWalletScanState` in `walletdb.h` so that they can be called from `salvage.cpp`. Lastly these changes are done in separate commits to make it easier to review.",
      "created_at" : "2020-05-15T23:49:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-629551855",
      "id" : 629551855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTU1MTg1NQ==",
      "updated_at" : "2020-05-15T23:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629551855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426092501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426092501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a placeholder test with a todo that mentions the issue in `tool_wallet.py`.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-15T23:56:46Z",
      "diff_hunk" : "@@ -404,8 +404,6 @@ def run_test(self):\n             '-reindex',\n             '-zapwallettxes=1',\n             '-zapwallettxes=2',\n-            # disabled until issue is fixed: https://github.com/bitcoin/bitcoin/issues/7463\n-            # '-salvagewallet',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426092501",
      "id" : 426092501,
      "in_reply_to_id" : 422424816,
      "line" : 408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA5MjUwMQ==",
      "original_commit_id" : "a7274c441ae21ef4b52a258a038d5b28f5469036",
      "original_line" : 408,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 5,
      "pull_request_review_id" : 413023069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426092501",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426104866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426104866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`WalletBatch::Recover` two-argument version is unused as of commit: 1372aba35fa91dd2fb4103ed7081a057f9794564",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-16T01:38:45Z",
      "diff_hunk" : "@@ -924,7 +924,7 @@ bool WalletBatch::VerifyEnvironment(const fs::path& wallet_path, bilingual_str&\n \n bool WalletBatch::VerifyDatabaseFile(const fs::path& wallet_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)\n {\n-    return BerkeleyBatch::VerifyDatabaseFile(wallet_path, warnings, errorStr, WalletBatch::Recover);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426104866",
      "id" : 426104866,
      "line" : 927,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEwNDg2Ng==",
      "original_commit_id" : "1372aba35fa91dd2fb4103ed7081a057f9794564",
      "original_line" : 927,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 65,
      "pull_request_review_id" : 413035802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426104866",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426105502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426105502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nevermind, I see you got it in 61a1e5702d0dfd3cfb6d4deb28df516a7243e196",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-16T01:44:55Z",
      "diff_hunk" : "@@ -924,7 +924,7 @@ bool WalletBatch::VerifyEnvironment(const fs::path& wallet_path, bilingual_str&\n \n bool WalletBatch::VerifyDatabaseFile(const fs::path& wallet_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)\n {\n-    return BerkeleyBatch::VerifyDatabaseFile(wallet_path, warnings, errorStr, WalletBatch::Recover);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426105502",
      "id" : 426105502,
      "in_reply_to_id" : 426104866,
      "line" : 927,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEwNTUwMg==",
      "original_commit_id" : "1372aba35fa91dd2fb4103ed7081a057f9794564",
      "original_line" : 927,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 65,
      "pull_request_review_id" : 413036331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426105502",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426105705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426105705"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Given the `CWalletScanState` isn't used, how about exposing a more limited version of `ReadKeyValue` instead?",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-16T01:47:04Z",
      "diff_hunk" : "@@ -0,0 +1,146 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <fs.h>\n+#include <streams.h>\n+#include <wallet/salvage.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n+\n+bool RecoverDatabaseFile(const fs::path& file_path)\n+{\n+    std::string filename;\n+    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n+\n+    // Recovery procedure:\n+    // move wallet file to walletfilename.timestamp.bak\n+    // Call Salvage with fAggressive=true to\n+    // get as much data as possible.\n+    // Rewrite salvaged data to fresh wallet file\n+    // Set -rescan so any missing transactions will be\n+    // found.\n+    int64_t now = GetTime();\n+    std::string newFilename = strprintf(\"%s.%d.bak\", filename, now);\n+\n+    int result = env->dbenv->dbrename(nullptr, filename.c_str(), nullptr,\n+                                       newFilename.c_str(), DB_AUTO_COMMIT);\n+    if (result == 0)\n+        LogPrintf(\"Renamed %s to %s\\n\", filename, newFilename);\n+    else\n+    {\n+        LogPrintf(\"Failed to rename %s to %s\\n\", filename, newFilename);\n+        return false;\n+    }\n+\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false; //env->Salvage(newFilename, salvagedData);\n+\n+    std::stringstream strDump;\n+\n+    Db db(env->dbenv.get(), 0);\n+    result = db.verify(newFilename.c_str(), nullptr, &strDump, DB_SALVAGE | DB_AGGRESSIVE);\n+    if (result == DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage found errors, all data may not be recoverable.\\n\");\n+    }\n+    if (result != 0 && result != DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage failed with result %d.\\n\", result);\n+        return false;\n+    }\n+\n+    // Format of bdb dump is ascii lines:\n+    // header lines...\n+    // HEADER=END\n+    //  hexadecimal key\n+    //  hexadecimal value\n+    //  ... repeated\n+    // DATA=END\n+\n+    std::string strLine;\n+    while (!strDump.eof() && strLine != HEADER_END)\n+        getline(strDump, strLine); // Skip past header\n+\n+    std::string keyHex, valueHex;\n+    while (!strDump.eof() && keyHex != DATA_END) {\n+        getline(strDump, keyHex);\n+        if (keyHex != DATA_END) {\n+            if (strDump.eof())\n+                break;\n+            getline(strDump, valueHex);\n+            if (valueHex == DATA_END) {\n+                LogPrintf(\"Salvage: WARNING: Number of keys in data does not match number of values.\\n\");\n+                break;\n+            }\n+            salvagedData.push_back(make_pair(ParseHex(keyHex), ParseHex(valueHex)));\n+        }\n+    }\n+\n+    if (keyHex != DATA_END) {\n+        LogPrintf(\"Salvage: WARNING: Unexpected end of file while reading salvage output.\\n\");\n+        fSuccess = false;\n+    } else {\n+        fSuccess = (result == 0);\n+    }\n+\n+    if (salvagedData.empty())\n+    {\n+        LogPrintf(\"Salvage(aggressive) found no records in %s.\\n\", newFilename);\n+        return false;\n+    }\n+    LogPrintf(\"Salvage(aggressive) found %u records\\n\", salvagedData.size());\n+\n+    std::unique_ptr<Db> pdbCopy = MakeUnique<Db>(env->dbenv.get(), 0);\n+    int ret = pdbCopy->open(nullptr,               // Txn pointer\n+                            filename.c_str(),   // Filename\n+                            \"main\",             // Logical db name\n+                            DB_BTREE,           // Database type\n+                            DB_CREATE,          // Flags\n+                            0);\n+    if (ret > 0) {\n+        LogPrintf(\"Cannot create database file %s\\n\", filename);\n+        pdbCopy->close(0);\n+        return false;\n+    }\n+\n+    DbTxn* ptxn = env->TxnBegin();\n+    CWallet dummyWallet(nullptr, WalletLocation(), WalletDatabase::CreateDummy());\n+    CWalletScanState dummyWss;\n+    for (KeyValPair& row : salvagedData)\n+    {\n+        /* Filter for only private key type KV pairs to be added to the salvaged wallet */\n+        CDataStream ssKey(row.first, SER_DISK, CLIENT_VERSION);\n+        CDataStream ssValue(row.second, SER_DISK, CLIENT_VERSION);\n+        std::string strType, strErr;\n+        bool fReadOK;\n+        {\n+            // Required in LoadKeyMetadata():\n+            LOCK(dummyWallet.cs_wallet);\n+            fReadOK = ReadKeyValue(&dummyWallet, ssKey, ssValue,\n+                                   dummyWss, strType, strErr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426105705",
      "id" : 426105705,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEwNTcwNQ==",
      "original_commit_id" : "2dc91a80b2d674e9bc42f969effbda95163d685a",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 413036490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426105705",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426524966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426524966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1372aba35fa91dd2fb4103ed7081a057f9794564: maybe add \"or restore from a backup.\"",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T10:25:44Z",
      "diff_hunk" : "@@ -419,18 +412,8 @@ bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bi\n     if (fs::exists(walletDir / walletFile))\n     {\n         std::string backup_filename;\n-        BerkeleyEnvironment::VerifyResult r = env->Verify(walletFile, recoverFunc, backup_filename);\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_OK)\n-        {\n-            warnings.push_back(strprintf(_(\"Warning: Wallet file corrupt, data salvaged!\"\n-                                     \" Original %s saved as %s in %s; if\"\n-                                     \" your balance or transactions are incorrect you should\"\n-                                     \" restore from a backup.\"),\n-                walletFile, backup_filename, walletDir));\n-        }\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_FAIL)\n-        {\n-            errorStr = strprintf(_(\"%s corrupt, salvage failed\"), walletFile);\n+        if (!env->Verify(walletFile)) {\n+            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage\"), walletFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426524966",
      "id" : 426524966,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUyNDk2Ng==",
      "original_commit_id" : "1372aba35fa91dd2fb4103ed7081a057f9794564",
      "original_line" : 416,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 413464889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426524966",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-18T15:53:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-630273946",
      "id" : 630273946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDI3Mzk0Ng==",
      "updated_at" : "2020-05-18T15:53:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630273946",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426761634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426761634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've done that instead.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T16:46:12Z",
      "diff_hunk" : "@@ -0,0 +1,146 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <fs.h>\n+#include <streams.h>\n+#include <wallet/salvage.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n+\n+bool RecoverDatabaseFile(const fs::path& file_path)\n+{\n+    std::string filename;\n+    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n+\n+    // Recovery procedure:\n+    // move wallet file to walletfilename.timestamp.bak\n+    // Call Salvage with fAggressive=true to\n+    // get as much data as possible.\n+    // Rewrite salvaged data to fresh wallet file\n+    // Set -rescan so any missing transactions will be\n+    // found.\n+    int64_t now = GetTime();\n+    std::string newFilename = strprintf(\"%s.%d.bak\", filename, now);\n+\n+    int result = env->dbenv->dbrename(nullptr, filename.c_str(), nullptr,\n+                                       newFilename.c_str(), DB_AUTO_COMMIT);\n+    if (result == 0)\n+        LogPrintf(\"Renamed %s to %s\\n\", filename, newFilename);\n+    else\n+    {\n+        LogPrintf(\"Failed to rename %s to %s\\n\", filename, newFilename);\n+        return false;\n+    }\n+\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false; //env->Salvage(newFilename, salvagedData);\n+\n+    std::stringstream strDump;\n+\n+    Db db(env->dbenv.get(), 0);\n+    result = db.verify(newFilename.c_str(), nullptr, &strDump, DB_SALVAGE | DB_AGGRESSIVE);\n+    if (result == DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage found errors, all data may not be recoverable.\\n\");\n+    }\n+    if (result != 0 && result != DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage failed with result %d.\\n\", result);\n+        return false;\n+    }\n+\n+    // Format of bdb dump is ascii lines:\n+    // header lines...\n+    // HEADER=END\n+    //  hexadecimal key\n+    //  hexadecimal value\n+    //  ... repeated\n+    // DATA=END\n+\n+    std::string strLine;\n+    while (!strDump.eof() && strLine != HEADER_END)\n+        getline(strDump, strLine); // Skip past header\n+\n+    std::string keyHex, valueHex;\n+    while (!strDump.eof() && keyHex != DATA_END) {\n+        getline(strDump, keyHex);\n+        if (keyHex != DATA_END) {\n+            if (strDump.eof())\n+                break;\n+            getline(strDump, valueHex);\n+            if (valueHex == DATA_END) {\n+                LogPrintf(\"Salvage: WARNING: Number of keys in data does not match number of values.\\n\");\n+                break;\n+            }\n+            salvagedData.push_back(make_pair(ParseHex(keyHex), ParseHex(valueHex)));\n+        }\n+    }\n+\n+    if (keyHex != DATA_END) {\n+        LogPrintf(\"Salvage: WARNING: Unexpected end of file while reading salvage output.\\n\");\n+        fSuccess = false;\n+    } else {\n+        fSuccess = (result == 0);\n+    }\n+\n+    if (salvagedData.empty())\n+    {\n+        LogPrintf(\"Salvage(aggressive) found no records in %s.\\n\", newFilename);\n+        return false;\n+    }\n+    LogPrintf(\"Salvage(aggressive) found %u records\\n\", salvagedData.size());\n+\n+    std::unique_ptr<Db> pdbCopy = MakeUnique<Db>(env->dbenv.get(), 0);\n+    int ret = pdbCopy->open(nullptr,               // Txn pointer\n+                            filename.c_str(),   // Filename\n+                            \"main\",             // Logical db name\n+                            DB_BTREE,           // Database type\n+                            DB_CREATE,          // Flags\n+                            0);\n+    if (ret > 0) {\n+        LogPrintf(\"Cannot create database file %s\\n\", filename);\n+        pdbCopy->close(0);\n+        return false;\n+    }\n+\n+    DbTxn* ptxn = env->TxnBegin();\n+    CWallet dummyWallet(nullptr, WalletLocation(), WalletDatabase::CreateDummy());\n+    CWalletScanState dummyWss;\n+    for (KeyValPair& row : salvagedData)\n+    {\n+        /* Filter for only private key type KV pairs to be added to the salvaged wallet */\n+        CDataStream ssKey(row.first, SER_DISK, CLIENT_VERSION);\n+        CDataStream ssValue(row.second, SER_DISK, CLIENT_VERSION);\n+        std::string strType, strErr;\n+        bool fReadOK;\n+        {\n+            // Required in LoadKeyMetadata():\n+            LOCK(dummyWallet.cs_wallet);\n+            fReadOK = ReadKeyValue(&dummyWallet, ssKey, ssValue,\n+                                   dummyWss, strType, strErr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426761634",
      "id" : 426761634,
      "in_reply_to_id" : 426105705,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc2MTYzNA==",
      "original_commit_id" : "2dc91a80b2d674e9bc42f969effbda95163d685a",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 413768351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426761634",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426762807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426762807"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T16:48:16Z",
      "diff_hunk" : "@@ -419,18 +412,8 @@ bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bi\n     if (fs::exists(walletDir / walletFile))\n     {\n         std::string backup_filename;\n-        BerkeleyEnvironment::VerifyResult r = env->Verify(walletFile, recoverFunc, backup_filename);\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_OK)\n-        {\n-            warnings.push_back(strprintf(_(\"Warning: Wallet file corrupt, data salvaged!\"\n-                                     \" Original %s saved as %s in %s; if\"\n-                                     \" your balance or transactions are incorrect you should\"\n-                                     \" restore from a backup.\"),\n-                walletFile, backup_filename, walletDir));\n-        }\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_FAIL)\n-        {\n-            errorStr = strprintf(_(\"%s corrupt, salvage failed\"), walletFile);\n+        if (!env->Verify(walletFile)) {\n+            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage\"), walletFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426762807",
      "id" : 426762807,
      "in_reply_to_id" : 426524966,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc2MjgwNw==",
      "original_commit_id" : "1372aba35fa91dd2fb4103ed7081a057f9794564",
      "original_line" : 416,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 413769830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426762807",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426788261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426788261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could pass this through by reference",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T17:34:20Z",
      "diff_hunk" : "@@ -103,6 +104,11 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+static bool SalvageWallet(const fs::path path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426788261",
      "id" : 426788261,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODI2MQ==",
      "original_commit_id" : "e3fe3391482252dc42b2541822b1e4e780540166",
      "original_line" : 107,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 413802074,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426788261",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426791865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426791865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: this is no longer used",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T17:41:16Z",
      "diff_hunk" : "@@ -419,18 +412,8 @@ bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bi\n     if (fs::exists(walletDir / walletFile))\n     {\n         std::string backup_filename;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426791865",
      "id" : 426791865,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MTg2NQ==",
      "original_commit_id" : "259a7440965be49a6876184b8596422ce61093a9",
      "original_line" : 414,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 413806448,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426791865",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426792345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426792345"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: How about returning the `verify` result so we can log the error:\r\nhttps://docs.oracle.com/cd/E17276_01/html/api_reference/C/dbverify.html",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T17:42:15Z",
      "diff_hunk" : "@@ -419,18 +412,8 @@ bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bi\n     if (fs::exists(walletDir / walletFile))\n     {\n         std::string backup_filename;\n-        BerkeleyEnvironment::VerifyResult r = env->Verify(walletFile, recoverFunc, backup_filename);\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_OK)\n-        {\n-            warnings.push_back(strprintf(_(\"Warning: Wallet file corrupt, data salvaged!\"\n-                                     \" Original %s saved as %s in %s; if\"\n-                                     \" your balance or transactions are incorrect you should\"\n-                                     \" restore from a backup.\"),\n-                walletFile, backup_filename, walletDir));\n-        }\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_FAIL)\n-        {\n-            errorStr = strprintf(_(\"%s corrupt, salvage failed\"), walletFile);\n+        if (!env->Verify(walletFile)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426792345",
      "id" : 426792345,
      "line" : 345,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MjM0NQ==",
      "original_commit_id" : "259a7440965be49a6876184b8596422ce61093a9",
      "original_line" : 345,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 126,
      "pull_request_review_id" : 413807114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426792345",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426794279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426794279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I'm not sure this comment is helpful",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-18T17:45:47Z",
      "diff_hunk" : "@@ -342,8 +348,55 @@ bool BerkeleyBatch::Recover(const fs::path& file_path, void *callbackDataIn, boo\n         return false;\n     }\n \n-    std::vector<BerkeleyEnvironment::KeyValPair> salvagedData;\n-    bool fSuccess = env->Salvage(newFilename, salvagedData);\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false; //env->Salvage(newFilename, salvagedData);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r426794279",
      "id" : 426794279,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NDI3OQ==",
      "original_commit_id" : "dca31bd5bc820da889394d15a9337ef96262ee4c",
      "original_line" : 352,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 413809455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426794279",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-18T17:59:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-630344474",
      "id" : 630344474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDM0NDQ3NA==",
      "updated_at" : "2020-05-18T17:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630344474",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\nwallet/walletdb.cpp:594:12: error: calling function 'ReadKeyValue' requires holding mutex 'pwallet->cs_wallet' exclusively [-Werror,-Wthread-safety-analysis]\r\n1647    return ReadKeyValue(pwallet, ssKey, ssValue, dummy_wss, strType, strErr);\r\n```",
      "created_at" : "2020-05-19T08:42:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-630676951",
      "id" : 630676951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDY3Njk1MQ==",
      "updated_at" : "2020-05-19T08:42:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630676951",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r427627923"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427627923"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add a salvage command\" (502024795a32c4600a294da10ad908f796e0cdac)\r\n\r\nNote for reviewers: this is just a copy of existing `CWallet::Verify` code\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/51825aea7fa068877ea77e3121def58005df3510/src/wallet/wallet.cpp#L3697-L3704\r\n\r\nremoved in the next commit \"wallet: remove -salvagewallet\" (7116e0c73514438ba240827aaddf922d0c1c9d84)",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-19T22:06:21Z",
      "diff_hunk" : "@@ -103,6 +103,13 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+static bool SalvageWallet(const fs::path path)\n+{\n+    CWallet dummy_wallet(nullptr, WalletLocation(), WalletDatabase::CreateDummy());\n+    std::string backup_filename;\n+    return WalletBatch::Recover(path, (void*)&dummy_wallet, WalletBatch::RecoverKeysOnlyFilter, backup_filename);\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r427627923",
      "id" : 427627923,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNzkyMw==",
      "original_commit_id" : "502024795a32c4600a294da10ad908f796e0cdac",
      "original_line" : 127,
      "original_position" : 10,
      "original_start_line" : 106,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 414857597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427627923",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r427631232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427631232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: remove -salvagewallet\" (7116e0c73514438ba240827aaddf922d0c1c9d84)\r\n\r\nThis is ok, but it'd be possible (and nice) to have a test that invokes salvagewallet tool doing basic checks like does it exit successfully.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-19T22:14:25Z",
      "diff_hunk" : "@@ -203,6 +203,10 @@ def test_getwalletinfo_on_different_wallet(self):\n         assert_equal(shasum_after, shasum_before)\n         self.log.debug('Wallet file shasum unchanged\\n')\n \n+    def test_salvage(self):\n+        # TODO: We should implement a test for this. But such a test should be after we fix https://github.com/bitcoin/bitcoin/issues/7463",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r427631232",
      "id" : 427631232,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYzMTIzMg==",
      "original_commit_id" : "7116e0c73514438ba240827aaddf922d0c1c9d84",
      "original_line" : 207,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 414857597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427631232",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r427638507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427638507"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Move BerkeleyEnvironment::Salvage into BerkeleyBatch::Recover\" (dca31bd5bc820da889394d15a9337ef96262ee4c)\r\n\r\nThis comment (especially the part about loading to memory) makes code easier to understand and IMO would be good to move to the new location in the verify function. Skip if it is a pain though",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-19T22:34:12Z",
      "diff_hunk" : "@@ -67,15 +67,6 @@ class BerkeleyEnvironment\n     fs::path Directory() const { return strPath; }\n \n     bool Verify(const std::string& strFile);\n-    /**\n-     * Salvage data from a file that Verify says is bad.\n-     * fAggressive sets the DB_AGGRESSIVE flag (see berkeley DB->verify() method documentation).\n-     * Appends binary key/value pairs to vResult, returns true if successful.\n-     * NOTE: reads the entire database into memory, so cannot be used\n-     * for huge databases.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r427638507",
      "id" : 427638507,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYzODUwNw==",
      "original_commit_id" : "dca31bd5bc820da889394d15a9337ef96262ee4c",
      "original_line" : 85,
      "original_position" : 9,
      "original_start_line" : 71,
      "path" : "src/wallet/db.h",
      "position" : 20,
      "pull_request_review_id" : 414857597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : 81,
      "start_side" : "LEFT",
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427638507",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "To all reviewers who concepted ACKed here, I'd encourage reviewing the code, too. This PR is really well structured and easy to understand and after the first commit is just a series of moves and simplifications with no other changes. Very easy.",
      "created_at" : "2020-05-19T23:17:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-631137009",
      "id" : 631137009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTEzNzAwOQ==",
      "updated_at" : "2020-05-19T23:17:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631137009",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> To all reviewers who concepted ACKed here\r\n\r\nOk, I hereby commit to reviewing this when the previous review comments have been addressed.",
      "created_at" : "2020-05-21T17:40:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-632245937",
      "id" : 632245937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjI0NTkzNw==",
      "updated_at" : "2020-05-21T17:40:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632245937",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428811885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428811885"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think the results of `verify` are meaningful.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-21T17:46:34Z",
      "diff_hunk" : "@@ -419,18 +412,8 @@ bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bi\n     if (fs::exists(walletDir / walletFile))\n     {\n         std::string backup_filename;\n-        BerkeleyEnvironment::VerifyResult r = env->Verify(walletFile, recoverFunc, backup_filename);\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_OK)\n-        {\n-            warnings.push_back(strprintf(_(\"Warning: Wallet file corrupt, data salvaged!\"\n-                                     \" Original %s saved as %s in %s; if\"\n-                                     \" your balance or transactions are incorrect you should\"\n-                                     \" restore from a backup.\"),\n-                walletFile, backup_filename, walletDir));\n-        }\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_FAIL)\n-        {\n-            errorStr = strprintf(_(\"%s corrupt, salvage failed\"), walletFile);\n+        if (!env->Verify(walletFile)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428811885",
      "id" : 428811885,
      "in_reply_to_id" : 426792345,
      "line" : 345,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgxMTg4NQ==",
      "original_commit_id" : "259a7440965be49a6876184b8596422ce61093a9",
      "original_line" : 345,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 126,
      "pull_request_review_id" : 416359725,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428811885",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428837781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428837781"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-21T18:34:15Z",
      "diff_hunk" : "@@ -103,6 +104,11 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+static bool SalvageWallet(const fs::path path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428837781",
      "id" : 428837781,
      "in_reply_to_id" : 426788261,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzNzc4MQ==",
      "original_commit_id" : "e3fe3391482252dc42b2541822b1e4e780540166",
      "original_line" : 107,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 416392800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428837781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428837845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428837845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-21T18:34:23Z",
      "diff_hunk" : "@@ -419,18 +412,8 @@ bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bi\n     if (fs::exists(walletDir / walletFile))\n     {\n         std::string backup_filename;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428837845",
      "id" : 428837845,
      "in_reply_to_id" : 426791865,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzNzg0NQ==",
      "original_commit_id" : "259a7440965be49a6876184b8596422ce61093a9",
      "original_line" : 414,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 416392879,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428837845",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428837898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428837898"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-21T18:34:30Z",
      "diff_hunk" : "@@ -342,8 +348,55 @@ bool BerkeleyBatch::Recover(const fs::path& file_path, void *callbackDataIn, boo\n         return false;\n     }\n \n-    std::vector<BerkeleyEnvironment::KeyValPair> salvagedData;\n-    bool fSuccess = env->Salvage(newFilename, salvagedData);\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false; //env->Salvage(newFilename, salvagedData);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428837898",
      "id" : 428837898,
      "in_reply_to_id" : 426794279,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzNzg5OA==",
      "original_commit_id" : "dca31bd5bc820da889394d15a9337ef96262ee4c",
      "original_line" : 352,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 416392954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428837898",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428840595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428840595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a rewording of this comment back in.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-21T18:39:35Z",
      "diff_hunk" : "@@ -67,15 +67,6 @@ class BerkeleyEnvironment\n     fs::path Directory() const { return strPath; }\n \n     bool Verify(const std::string& strFile);\n-    /**\n-     * Salvage data from a file that Verify says is bad.\n-     * fAggressive sets the DB_AGGRESSIVE flag (see berkeley DB->verify() method documentation).\n-     * Appends binary key/value pairs to vResult, returns true if successful.\n-     * NOTE: reads the entire database into memory, so cannot be used\n-     * for huge databases.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r428840595",
      "id" : 428840595,
      "in_reply_to_id" : 427638507,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg0MDU5NQ==",
      "original_commit_id" : "dca31bd5bc820da889394d15a9337ef96262ee4c",
      "original_line" : 85,
      "original_position" : 9,
      "original_start_line" : 71,
      "path" : "src/wallet/db.h",
      "position" : 20,
      "pull_request_review_id" : 416396375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "LEFT",
      "start_line" : 81,
      "start_side" : "LEFT",
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428840595",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429224090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429224090"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 7f6a5f3fff6e71108289ba9c9bfc5a938a081a79:\r\n\r\nWhy ignore the return value?",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T12:44:33Z",
      "diff_hunk" : "@@ -123,10 +130,15 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n             return false;\n         }\n-        std::shared_ptr<CWallet> wallet_instance = LoadWallet(name, path);\n-        if (!wallet_instance) return false;\n-        WalletShowInfo(wallet_instance.get());\n-        wallet_instance->Flush(true);\n+\n+        if (command == \"info\") {\n+            std::shared_ptr<CWallet> wallet_instance = LoadWallet(name, path);\n+            if (!wallet_instance) return false;\n+            WalletShowInfo(wallet_instance.get());\n+            wallet_instance->Flush(true);\n+        } else if (command == \"salvage\") {\n+            SalvageWallet(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429224090",
      "id" : 429224090,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNDA5MA==",
      "original_commit_id" : "7f6a5f3fff6e71108289ba9c9bfc5a938a081a79",
      "original_line" : 140,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 416880835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429224090",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429235553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429235553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 6c3afd67d2:\r\n\r\nWhy is this set all the way up here? The outcome is only needed to remember whether the end of the stream was reached or not. I think it should be defined after the last write to `keyHex`, but still before this code block:\r\n\r\nAlso, you could leave it uninitialized because every if branch will initialize it. If none does the initialization, at least a sanitizer could yell at us and hint at the bug.\r\n```cpp\r\n    bool fSuccess;\r\n    if (keyHex != DATA_END) {\r\n        LogPrintf(\"Salvage: WARNING: Unexpected end of file while reading salvage output.\\n\");\r\n        fSuccess = false;\r\n    } else {\r\n        fSuccess = (result == 0);\r\n    }",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T13:08:47Z",
      "diff_hunk" : "@@ -342,8 +348,61 @@ bool BerkeleyBatch::Recover(const fs::path& file_path, void *callbackDataIn, boo\n         return false;\n     }\n \n-    std::vector<BerkeleyEnvironment::KeyValPair> salvagedData;\n-    bool fSuccess = env->Salvage(newFilename, salvagedData);\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.\n+     * NOTE: reads the entire database into memory, so cannot be used\n+     * for huge databases.\n+     */\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429235553",
      "id" : 429235553,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNTU1Mw==",
      "original_commit_id" : "6c3afd67d28475ed4e2ee655559503971db7cff7",
      "original_line" : 358,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 416880835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429235553",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429237809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429237809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 6d05dff02b:\r\n\r\nwallet is a reference to an object (like all other params in this function), so it should probably be passed as one.\r\n\r\nNot sure about the lock annotation, but it is a bit confusing to lock cs_wallet, and then call a function that locks it again immediately after\r\n\r\n```suggestion\r\nbool ReadKeyValue(CWallet& wallet, CDataStream& ssKey, CDataStream& ssValue, std::string& strType, std::string& strErr) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\r\n```",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T13:13:25Z",
      "diff_hunk" : "@@ -294,4 +294,7 @@ class WalletBatch\n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! Unserialize a give Key-Value pair and load it into the wallet\n+bool ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue, std::string& strType, std::string& strErr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429237809",
      "id" : 429237809,
      "line" : 292,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNzgwOQ==",
      "original_commit_id" : "6d05dff02be9e113ac6f8356fdcc35c1f45c3aa2",
      "original_line" : 292,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : 25,
      "pull_request_review_id" : 416880835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429237809",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429240474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429240474"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 6d05dff02be9e113ac6f835:\r\n\r\nThe now unused `CWalletScanState dummyWss;` a few lines up should now be removed.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T13:18:49Z",
      "diff_hunk" : "@@ -902,8 +909,7 @@ bool WalletBatch::RecoverKeysOnlyFilter(void *callbackData, CDataStream ssKey, C\n     {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429240474",
      "id" : 429240474,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MDQ3NA==",
      "original_commit_id" : "6d05dff02be9e113ac6f8356fdcc35c1f45c3aa2",
      "original_line" : 909,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 416880835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429240474",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429346864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429346864"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It was to reduce the amount of changes being done in a move commit.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T16:39:15Z",
      "diff_hunk" : "@@ -342,8 +348,61 @@ bool BerkeleyBatch::Recover(const fs::path& file_path, void *callbackDataIn, boo\n         return false;\n     }\n \n-    std::vector<BerkeleyEnvironment::KeyValPair> salvagedData;\n-    bool fSuccess = env->Salvage(newFilename, salvagedData);\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.\n+     * NOTE: reads the entire database into memory, so cannot be used\n+     * for huge databases.\n+     */\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429346864",
      "id" : 429346864,
      "in_reply_to_id" : 429235553,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM0Njg2NA==",
      "original_commit_id" : "6c3afd67d28475ed4e2ee655559503971db7cff7",
      "original_line" : 358,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417043774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429346864",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429347520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429347520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The annotation causes a compile error as `CWallet` is not yet defined.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T16:40:43Z",
      "diff_hunk" : "@@ -294,4 +294,7 @@ class WalletBatch\n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! Unserialize a give Key-Value pair and load it into the wallet\n+bool ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue, std::string& strType, std::string& strErr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429347520",
      "id" : 429347520,
      "in_reply_to_id" : 429237809,
      "line" : 292,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM0NzUyMA==",
      "original_commit_id" : "6d05dff02be9e113ac6f8356fdcc35c1f45c3aa2",
      "original_line" : 292,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : 25,
      "pull_request_review_id" : 417045714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429347520",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429357280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429357280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fair enough",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T16:58:51Z",
      "diff_hunk" : "@@ -294,4 +294,7 @@ class WalletBatch\n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! Unserialize a give Key-Value pair and load it into the wallet\n+bool ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue, std::string& strType, std::string& strErr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429357280",
      "id" : 429357280,
      "in_reply_to_id" : 429237809,
      "line" : 292,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM1NzI4MA==",
      "original_commit_id" : "6d05dff02be9e113ac6f8356fdcc35c1f45c3aa2",
      "original_line" : 292,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : 25,
      "pull_request_review_id" : 417058761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429357280",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429399582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429399582"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This `warnings` argument is now unused.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-22T18:38:40Z",
      "diff_hunk" : "@@ -410,100 +334,23 @@ bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str&\n     return true;\n }\n \n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr, BerkeleyEnvironment::recoverFunc_type recoverFunc)\n+bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429399582",
      "id" : 429399582,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5OTU4Mg==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 337,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417114332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429399582",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429951866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429951866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "521e731 user-facing nit if you retouch: s/backup/backup./",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T14:03:20Z",
      "diff_hunk" : "@@ -410,100 +334,23 @@ bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str&\n     return true;\n }\n \n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr, BerkeleyEnvironment::recoverFunc_type recoverFunc)\n+bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)\n {\n     std::string walletFile;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n     fs::path walletDir = env->Directory();\n \n     if (fs::exists(walletDir / walletFile))\n     {\n-        std::string backup_filename;\n-        BerkeleyEnvironment::VerifyResult r = env->Verify(walletFile, recoverFunc, backup_filename);\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_OK)\n-        {\n-            warnings.push_back(strprintf(_(\"Warning: Wallet file corrupt, data salvaged!\"\n-                                     \" Original %s saved as %s in %s; if\"\n-                                     \" your balance or transactions are incorrect you should\"\n-                                     \" restore from a backup.\"),\n-                walletFile, backup_filename, walletDir));\n-        }\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_FAIL)\n-        {\n-            errorStr = strprintf(_(\"%s corrupt, salvage failed\"), walletFile);\n+        if (!env->Verify(walletFile)) {\n+            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage or restoring a backup\"), walletFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429951866",
      "id" : 429951866,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1MTg2Ng==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 346,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417731902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429951866",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429957071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429957071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6c3afd67 nit: s/appendedto/appended to/",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T14:14:00Z",
      "diff_hunk" : "@@ -0,0 +1,150 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <fs.h>\n+#include <streams.h>\n+#include <wallet/salvage.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n+\n+bool RecoverDatabaseFile(const fs::path& file_path)\n+{\n+    std::string filename;\n+    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n+\n+    // Recovery procedure:\n+    // move wallet file to walletfilename.timestamp.bak\n+    // Call Salvage with fAggressive=true to\n+    // get as much data as possible.\n+    // Rewrite salvaged data to fresh wallet file\n+    // Set -rescan so any missing transactions will be\n+    // found.\n+    int64_t now = GetTime();\n+    std::string newFilename = strprintf(\"%s.%d.bak\", filename, now);\n+\n+    int result = env->dbenv->dbrename(nullptr, filename.c_str(), nullptr,\n+                                       newFilename.c_str(), DB_AUTO_COMMIT);\n+    if (result == 0)\n+        LogPrintf(\"Renamed %s to %s\\n\", filename, newFilename);\n+    else\n+    {\n+        LogPrintf(\"Failed to rename %s to %s\\n\", filename, newFilename);\n+        return false;\n+    }\n+\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429957071",
      "id" : 429957071,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1NzA3MQ==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 417731902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429957071",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429961257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429961257"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6d05dff nit: s/give/given/",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T14:22:41Z",
      "diff_hunk" : "@@ -294,4 +288,7 @@ class WalletBatch\n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! Unserialize a give Key-Value pair and load it into the wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429961257",
      "id" : 429961257,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2MTI1Nw==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 291,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 417731902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429961257",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429967147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429967147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "39a82fed nit: sort",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T14:35:01Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #include <util/translation.h>\n #include <wallet/wallet.h>\n #include <wallet/walletutil.h>\n+#include <wallet/salvage.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429967147",
      "id" : 429967147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NzE0Nw==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 417731902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429967147",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429975677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429975677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "521e731e seconding @Empact's observation that `warnings` can be removed with the other changes to `VerifyDatabaseFile` in this commit",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T14:53:20Z",
      "diff_hunk" : "@@ -410,100 +334,23 @@ bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str&\n     return true;\n }\n \n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr, BerkeleyEnvironment::recoverFunc_type recoverFunc)\n+bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429975677",
      "id" : 429975677,
      "in_reply_to_id" : 429399582,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk3NTY3Nw==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 337,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417731902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429975677",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429981672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429981672"
         }
      },
      "author_association" : "MEMBER",
      "body" : "35a1f948 `RecoverDatabaseFile` contains a fair amount of code to set and return bool `fSuccess`, but the value returned doesn't appear to be used. Is this logic needed?",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T15:06:53Z",
      "diff_hunk" : "@@ -0,0 +1,150 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <fs.h>\n+#include <streams.h>\n+#include <wallet/salvage.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n+\n+bool RecoverDatabaseFile(const fs::path& file_path)\n+{\n+    std::string filename;\n+    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n+\n+    // Recovery procedure:\n+    // move wallet file to walletfilename.timestamp.bak\n+    // Call Salvage with fAggressive=true to\n+    // get as much data as possible.\n+    // Rewrite salvaged data to fresh wallet file\n+    // Set -rescan so any missing transactions will be\n+    // found.\n+    int64_t now = GetTime();\n+    std::string newFilename = strprintf(\"%s.%d.bak\", filename, now);\n+\n+    int result = env->dbenv->dbrename(nullptr, filename.c_str(), nullptr,\n+                                       newFilename.c_str(), DB_AUTO_COMMIT);\n+    if (result == 0)\n+        LogPrintf(\"Renamed %s to %s\\n\", filename, newFilename);\n+    else\n+    {\n+        LogPrintf(\"Failed to rename %s to %s\\n\", filename, newFilename);\n+        return false;\n+    }\n+\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.\n+     * NOTE: reads the entire database into memory, so cannot be used\n+     * for huge databases.\n+     */\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false;\n+\n+    std::stringstream strDump;\n+\n+    Db db(env->dbenv.get(), 0);\n+    result = db.verify(newFilename.c_str(), nullptr, &strDump, DB_SALVAGE | DB_AGGRESSIVE);\n+    if (result == DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage found errors, all data may not be recoverable.\\n\");\n+    }\n+    if (result != 0 && result != DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage failed with result %d.\\n\", result);\n+        return false;\n+    }\n+\n+    // Format of bdb dump is ascii lines:\n+    // header lines...\n+    // HEADER=END\n+    //  hexadecimal key\n+    //  hexadecimal value\n+    //  ... repeated\n+    // DATA=END\n+\n+    std::string strLine;\n+    while (!strDump.eof() && strLine != HEADER_END)\n+        getline(strDump, strLine); // Skip past header\n+\n+    std::string keyHex, valueHex;\n+    while (!strDump.eof() && keyHex != DATA_END) {\n+        getline(strDump, keyHex);\n+        if (keyHex != DATA_END) {\n+            if (strDump.eof())\n+                break;\n+            getline(strDump, valueHex);\n+            if (valueHex == DATA_END) {\n+                LogPrintf(\"Salvage: WARNING: Number of keys in data does not match number of values.\\n\");\n+                break;\n+            }\n+            salvagedData.push_back(make_pair(ParseHex(keyHex), ParseHex(valueHex)));\n+        }\n+    }\n+\n+    if (keyHex != DATA_END) {\n+        LogPrintf(\"Salvage: WARNING: Unexpected end of file while reading salvage output.\\n\");\n+        fSuccess = false;\n+    } else {\n+        fSuccess = (result == 0);\n+    }\n+\n+    if (salvagedData.empty())\n+    {\n+        LogPrintf(\"Salvage(aggressive) found no records in %s.\\n\", newFilename);\n+        return false;\n+    }\n+    LogPrintf(\"Salvage(aggressive) found %u records\\n\", salvagedData.size());\n+\n+    std::unique_ptr<Db> pdbCopy = MakeUnique<Db>(env->dbenv.get(), 0);\n+    int ret = pdbCopy->open(nullptr,               // Txn pointer\n+                            filename.c_str(),   // Filename\n+                            \"main\",             // Logical db name\n+                            DB_BTREE,           // Database type\n+                            DB_CREATE,          // Flags\n+                            0);\n+    if (ret > 0) {\n+        LogPrintf(\"Cannot create database file %s\\n\", filename);\n+        pdbCopy->close(0);\n+        return false;\n+    }\n+\n+    DbTxn* ptxn = env->TxnBegin();\n+    CWallet dummyWallet(nullptr, WalletLocation(), WalletDatabase::CreateDummy());\n+    for (KeyValPair& row : salvagedData)\n+    {\n+        /* Filter for only private key type KV pairs to be added to the salvaged wallet */\n+        CDataStream ssKey(row.first, SER_DISK, CLIENT_VERSION);\n+        CDataStream ssValue(row.second, SER_DISK, CLIENT_VERSION);\n+        std::string strType, strErr;\n+        bool fReadOK;\n+        {\n+            // Required in LoadKeyMetadata():\n+            LOCK(dummyWallet.cs_wallet);\n+            fReadOK = ReadKeyValue(&dummyWallet, ssKey, ssValue, strType, strErr);\n+        }\n+        if (!WalletBatch::IsKeyType(strType) && strType != DBKeys::HDCHAIN) {\n+            continue;\n+        }\n+        if (!fReadOK)\n+        {\n+            LogPrintf(\"WARNING: WalletBatch::Recover skipping %s: %s\\n\", strType, strErr);\n+            continue;\n+        }\n+        Dbt datKey(&row.first[0], row.first.size());\n+        Dbt datValue(&row.second[0], row.second.size());\n+        int ret2 = pdbCopy->put(ptxn, &datKey, &datValue, DB_NOOVERWRITE);\n+        if (ret2 > 0)\n+            fSuccess = false;\n+    }\n+    ptxn->commit(0);\n+    pdbCopy->close(0);\n+\n+    return fSuccess;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r429981672",
      "id" : 429981672,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4MTY3Mg==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 149,
      "original_position" : 149,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 149,
      "pull_request_review_id" : 417731902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/429981672",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a very basic test that  just checks it runs and exits without error on a new wallet.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:16:36Z",
      "diff_hunk" : "@@ -203,6 +203,10 @@ def test_getwalletinfo_on_different_wallet(self):\n         assert_equal(shasum_after, shasum_before)\n         self.log.debug('Wallet file shasum unchanged\\n')\n \n+    def test_salvage(self):\n+        # TODO: We should implement a test for this. But such a test should be after we fix https://github.com/bitcoin/bitcoin/issues/7463",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024240",
      "id" : 430024240,
      "in_reply_to_id" : 427631232,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDI0MA==",
      "original_commit_id" : "7116e0c73514438ba240827aaddf922d0c1c9d84",
      "original_line" : 207,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 417818462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024240",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed to return it.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:16:46Z",
      "diff_hunk" : "@@ -123,10 +130,15 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n             return false;\n         }\n-        std::shared_ptr<CWallet> wallet_instance = LoadWallet(name, path);\n-        if (!wallet_instance) return false;\n-        WalletShowInfo(wallet_instance.get());\n-        wallet_instance->Flush(true);\n+\n+        if (command == \"info\") {\n+            std::shared_ptr<CWallet> wallet_instance = LoadWallet(name, path);\n+            if (!wallet_instance) return false;\n+            WalletShowInfo(wallet_instance.get());\n+            wallet_instance->Flush(true);\n+        } else if (command == \"salvage\") {\n+            SalvageWallet(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024279",
      "id" : 430024279,
      "in_reply_to_id" : 429224090,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDI3OQ==",
      "original_commit_id" : "7f6a5f3fff6e71108289ba9c9bfc5a938a081a79",
      "original_line" : 140,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 417818506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:16:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024279",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:18:18Z",
      "diff_hunk" : "@@ -342,8 +348,61 @@ bool BerkeleyBatch::Recover(const fs::path& file_path, void *callbackDataIn, boo\n         return false;\n     }\n \n-    std::vector<BerkeleyEnvironment::KeyValPair> salvagedData;\n-    bool fSuccess = env->Salvage(newFilename, salvagedData);\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.\n+     * NOTE: reads the entire database into memory, so cannot be used\n+     * for huge databases.\n+     */\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024704",
      "id" : 430024704,
      "in_reply_to_id" : 429235553,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDcwNA==",
      "original_commit_id" : "6c3afd67d28475ed4e2ee655559503971db7cff7",
      "original_line" : 358,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417818991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024704",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024803"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:18:41Z",
      "diff_hunk" : "@@ -902,8 +909,7 @@ bool WalletBatch::RecoverKeysOnlyFilter(void *callbackData, CDataStream ssKey, C\n     {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024803",
      "id" : 430024803,
      "in_reply_to_id" : 429240474,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDgwMw==",
      "original_commit_id" : "6d05dff02be9e113ac6f8356fdcc35c1f45c3aa2",
      "original_line" : 909,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 417819110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:18:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024803",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024832"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:18:49Z",
      "diff_hunk" : "@@ -410,100 +334,23 @@ bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str&\n     return true;\n }\n \n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr, BerkeleyEnvironment::recoverFunc_type recoverFunc)\n+bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024832",
      "id" : 430024832,
      "in_reply_to_id" : 429399582,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDgzMg==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 337,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417819145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024832",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:19:02Z",
      "diff_hunk" : "@@ -410,100 +334,23 @@ bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str&\n     return true;\n }\n \n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr, BerkeleyEnvironment::recoverFunc_type recoverFunc)\n+bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, std::vector<bilingual_str>& warnings, bilingual_str& errorStr)\n {\n     std::string walletFile;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n     fs::path walletDir = env->Directory();\n \n     if (fs::exists(walletDir / walletFile))\n     {\n-        std::string backup_filename;\n-        BerkeleyEnvironment::VerifyResult r = env->Verify(walletFile, recoverFunc, backup_filename);\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_OK)\n-        {\n-            warnings.push_back(strprintf(_(\"Warning: Wallet file corrupt, data salvaged!\"\n-                                     \" Original %s saved as %s in %s; if\"\n-                                     \" your balance or transactions are incorrect you should\"\n-                                     \" restore from a backup.\"),\n-                walletFile, backup_filename, walletDir));\n-        }\n-        if (r == BerkeleyEnvironment::VerifyResult::RECOVER_FAIL)\n-        {\n-            errorStr = strprintf(_(\"%s corrupt, salvage failed\"), walletFile);\n+        if (!env->Verify(walletFile)) {\n+            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage or restoring a backup\"), walletFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024868",
      "id" : 430024868,
      "in_reply_to_id" : 429951866,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDg2OA==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 346,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 417819193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024868",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:19:06Z",
      "diff_hunk" : "@@ -0,0 +1,150 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <fs.h>\n+#include <streams.h>\n+#include <wallet/salvage.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n+\n+bool RecoverDatabaseFile(const fs::path& file_path)\n+{\n+    std::string filename;\n+    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n+\n+    // Recovery procedure:\n+    // move wallet file to walletfilename.timestamp.bak\n+    // Call Salvage with fAggressive=true to\n+    // get as much data as possible.\n+    // Rewrite salvaged data to fresh wallet file\n+    // Set -rescan so any missing transactions will be\n+    // found.\n+    int64_t now = GetTime();\n+    std::string newFilename = strprintf(\"%s.%d.bak\", filename, now);\n+\n+    int result = env->dbenv->dbrename(nullptr, filename.c_str(), nullptr,\n+                                       newFilename.c_str(), DB_AUTO_COMMIT);\n+    if (result == 0)\n+        LogPrintf(\"Renamed %s to %s\\n\", filename, newFilename);\n+    else\n+    {\n+        LogPrintf(\"Failed to rename %s to %s\\n\", filename, newFilename);\n+        return false;\n+    }\n+\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024890",
      "id" : 430024890,
      "in_reply_to_id" : 429957071,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDg5MA==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : null,
      "pull_request_review_id" : 417819216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024890",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:19:11Z",
      "diff_hunk" : "@@ -294,4 +288,7 @@ class WalletBatch\n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! Unserialize a give Key-Value pair and load it into the wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024907",
      "id" : 430024907,
      "in_reply_to_id" : 429961257,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDkwNw==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 291,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 417819237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:19:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024907",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024931"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:19:19Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #include <util/translation.h>\n #include <wallet/wallet.h>\n #include <wallet/walletutil.h>\n+#include <wallet/salvage.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024931",
      "id" : 430024931,
      "in_reply_to_id" : 429967147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDkzMQ==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 417819269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:19:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024931",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024967"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The return value is being checked now.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-25T17:19:29Z",
      "diff_hunk" : "@@ -0,0 +1,150 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <fs.h>\n+#include <streams.h>\n+#include <wallet/salvage.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+typedef std::pair<std::vector<unsigned char>, std::vector<unsigned char> > KeyValPair;\n+\n+bool RecoverDatabaseFile(const fs::path& file_path)\n+{\n+    std::string filename;\n+    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n+\n+    // Recovery procedure:\n+    // move wallet file to walletfilename.timestamp.bak\n+    // Call Salvage with fAggressive=true to\n+    // get as much data as possible.\n+    // Rewrite salvaged data to fresh wallet file\n+    // Set -rescan so any missing transactions will be\n+    // found.\n+    int64_t now = GetTime();\n+    std::string newFilename = strprintf(\"%s.%d.bak\", filename, now);\n+\n+    int result = env->dbenv->dbrename(nullptr, filename.c_str(), nullptr,\n+                                       newFilename.c_str(), DB_AUTO_COMMIT);\n+    if (result == 0)\n+        LogPrintf(\"Renamed %s to %s\\n\", filename, newFilename);\n+    else\n+    {\n+        LogPrintf(\"Failed to rename %s to %s\\n\", filename, newFilename);\n+        return false;\n+    }\n+\n+    /**\n+     * Salvage data from a file. The DB_AGGRESSIVE flag is being used (see berkeley DB->verify() method documentation).\n+     * key/value pairs are appendedto salvagedData which are then written out to a new wallet file.\n+     * NOTE: reads the entire database into memory, so cannot be used\n+     * for huge databases.\n+     */\n+    std::vector<KeyValPair> salvagedData;\n+    bool fSuccess = false;\n+\n+    std::stringstream strDump;\n+\n+    Db db(env->dbenv.get(), 0);\n+    result = db.verify(newFilename.c_str(), nullptr, &strDump, DB_SALVAGE | DB_AGGRESSIVE);\n+    if (result == DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage found errors, all data may not be recoverable.\\n\");\n+    }\n+    if (result != 0 && result != DB_VERIFY_BAD) {\n+        LogPrintf(\"Salvage: Database salvage failed with result %d.\\n\", result);\n+        return false;\n+    }\n+\n+    // Format of bdb dump is ascii lines:\n+    // header lines...\n+    // HEADER=END\n+    //  hexadecimal key\n+    //  hexadecimal value\n+    //  ... repeated\n+    // DATA=END\n+\n+    std::string strLine;\n+    while (!strDump.eof() && strLine != HEADER_END)\n+        getline(strDump, strLine); // Skip past header\n+\n+    std::string keyHex, valueHex;\n+    while (!strDump.eof() && keyHex != DATA_END) {\n+        getline(strDump, keyHex);\n+        if (keyHex != DATA_END) {\n+            if (strDump.eof())\n+                break;\n+            getline(strDump, valueHex);\n+            if (valueHex == DATA_END) {\n+                LogPrintf(\"Salvage: WARNING: Number of keys in data does not match number of values.\\n\");\n+                break;\n+            }\n+            salvagedData.push_back(make_pair(ParseHex(keyHex), ParseHex(valueHex)));\n+        }\n+    }\n+\n+    if (keyHex != DATA_END) {\n+        LogPrintf(\"Salvage: WARNING: Unexpected end of file while reading salvage output.\\n\");\n+        fSuccess = false;\n+    } else {\n+        fSuccess = (result == 0);\n+    }\n+\n+    if (salvagedData.empty())\n+    {\n+        LogPrintf(\"Salvage(aggressive) found no records in %s.\\n\", newFilename);\n+        return false;\n+    }\n+    LogPrintf(\"Salvage(aggressive) found %u records\\n\", salvagedData.size());\n+\n+    std::unique_ptr<Db> pdbCopy = MakeUnique<Db>(env->dbenv.get(), 0);\n+    int ret = pdbCopy->open(nullptr,               // Txn pointer\n+                            filename.c_str(),   // Filename\n+                            \"main\",             // Logical db name\n+                            DB_BTREE,           // Database type\n+                            DB_CREATE,          // Flags\n+                            0);\n+    if (ret > 0) {\n+        LogPrintf(\"Cannot create database file %s\\n\", filename);\n+        pdbCopy->close(0);\n+        return false;\n+    }\n+\n+    DbTxn* ptxn = env->TxnBegin();\n+    CWallet dummyWallet(nullptr, WalletLocation(), WalletDatabase::CreateDummy());\n+    for (KeyValPair& row : salvagedData)\n+    {\n+        /* Filter for only private key type KV pairs to be added to the salvaged wallet */\n+        CDataStream ssKey(row.first, SER_DISK, CLIENT_VERSION);\n+        CDataStream ssValue(row.second, SER_DISK, CLIENT_VERSION);\n+        std::string strType, strErr;\n+        bool fReadOK;\n+        {\n+            // Required in LoadKeyMetadata():\n+            LOCK(dummyWallet.cs_wallet);\n+            fReadOK = ReadKeyValue(&dummyWallet, ssKey, ssValue, strType, strErr);\n+        }\n+        if (!WalletBatch::IsKeyType(strType) && strType != DBKeys::HDCHAIN) {\n+            continue;\n+        }\n+        if (!fReadOK)\n+        {\n+            LogPrintf(\"WARNING: WalletBatch::Recover skipping %s: %s\\n\", strType, strErr);\n+            continue;\n+        }\n+        Dbt datKey(&row.first[0], row.first.size());\n+        Dbt datValue(&row.second[0], row.second.size());\n+        int ret2 = pdbCopy->put(ptxn, &datKey, &datValue, DB_NOOVERWRITE);\n+        if (ret2 > 0)\n+            fSuccess = false;\n+    }\n+    ptxn->commit(0);\n+    pdbCopy->close(0);\n+\n+    return fSuccess;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430024967",
      "id" : 430024967,
      "in_reply_to_id" : 429981672,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyNDk2Nw==",
      "original_commit_id" : "94541050b84e166b6fcbaf6c30b263903dcc25f5",
      "original_line" : 149,
      "original_position" : 149,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 149,
      "pull_request_review_id" : 417819315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-25T17:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430024967",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> but attempting to run `bitcoin-wallet -regtest -wallet=test salvage` returns `DB_ENV->dbrename: method not permitted before handle's open method`.\r\n\r\nFixed. Turns out we still have to go through the whole `WalletDatbase::Create` and `VerifyEnvironment` song and dance before recovery can be done.\r\n\r\nAlso added a basic functional test to check that salvage on a new wallet does not have issues. It does not check whether salvaged actually worked or did anything useful.",
      "created_at" : "2020-05-25T17:21:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-633659174",
      "id" : 633659174,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzY1OTE3NA==",
      "updated_at" : "2020-05-25T17:21:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633659174",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks -- at 84ae0578b6c the bitcoin-wallet salvage command now runs and exits. Yay! but it doesn't leave any feedback. A message that the wallet was successfully salvaged might be reassuring?",
      "created_at" : "2020-05-25T17:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-633665901",
      "id" : 633665901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzY2NTkwMQ==",
      "updated_at" : "2020-05-25T17:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633665901",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The new test passes at both 9454105 and 84ae057 so as a sanity check I'd agree there is room for improvement, if possible.",
      "created_at" : "2020-05-25T17:54:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-633668307",
      "id" : 633668307,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzY2ODMwNw==",
      "updated_at" : "2020-05-25T17:54:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633668307",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430259244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430259244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Tests for the different exceptions would be great. Not sure on this, or on the need for an EOL `\\n` in line 117 just above.\r\n```suggestion\r\n        tfm::format(std::cerr, \"Failed to open wallet for salvage: %s\\n\", error_string.original);\r\n```",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-26T08:56:45Z",
      "diff_hunk" : "@@ -103,6 +104,27 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+static bool SalvageWallet(const fs::path& path)\n+{\n+    // Create a Database handle to allow for the db to be initialized before recovery\n+    std::unique_ptr<WalletDatabase> database = WalletDatabase::Create(path);\n+\n+    // Initialize the environment before recovery\n+    bilingual_str error_string;\n+    try {\n+        WalletBatch::VerifyEnvironment(path, error_string);\n+    } catch (const fs::filesystem_error& e) {\n+        error_string = Untranslated(strprintf(\"Error loading wallet. %s\", fsbridge::get_filesystem_error_message(e)));\n+    }\n+    if (!error_string.original.empty()) {\n+        tfm::format(std::cerr, \"Failed to open wallet for salvage :%s\\n\", error_string.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430259244",
      "id" : 430259244,
      "line" : 120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1OTI0NA==",
      "original_commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "original_line" : 120,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 25,
      "pull_request_review_id" : 418100419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T08:59:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430259244",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 84ae0578b6 ð\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK 84ae0578b6 ð\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjebwv/XkWDTfbKudR9e0H8atjyYFTG7ra0mC6wBPs6Apbj4CIhGGrrVeT/zEYu\r\nPUPAUO6/RJVD+nBPQTCajQ+/a7kkaRzR9W+Huu+1xXXJEbTzCME7Zld8uMMY750F\r\n9X9VSKOR9JAqmaICejkZ6bk6lMY9HL2+VumYejhYKX0UTYiGAOspBX0hND68EFuR\r\neSh+OF5BnFj0g89kiZpp8QNDZGXAQ94Tl9tOV5SSD8I941Ncwgnt0LG20hTGOZ04\r\nXN19zVW+f27yN/SuHO9powmwwIq/G3urif6eCnRxDHSGkc+9r/xa4SPXnv/SRcxn\r\ni82alb+6+4N0UoNIr3gPtaxZQ/fhGHiWO9Q8s+p+/Tk2gK4ssjobBwrc4uAMhVmN\r\ndmmQSQPmaR5Hi0PLKtiM3z98lXI29kbUxk/51vEhLH4sNs1i0TyEcwLgMcezO5/q\r\nRIYhBStpCVQtJ+LxVUzB0zHK+A/jCM9Q56aw7ZS0ly6LHwmVPD1VvzNDQKhCWUpm\r\nAANRPTgR\r\n=FqzM\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `c579e4ed85c7c252470d4ad60a04790a109bf7cc4aabcc2e2094bbf1b5c53880  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e892940108c579e4ed85c7c252470d4ad60a04790a109bf7cc4aabcc2e2094bbf1b5c53880f010098a8b7fe7d98d8b8e106f8d6e137d1708fff01003e2f488e533a9a6605729a725cd86c908f1045ecd02bcf0089fd024852dea29a70083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff0101c2b7ee715384a6658739c76fa986b5008f1045ecd02bbf0085f8a136f93760fb80083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff0103cb2098421d9043bf95353eb0b7888b808f1045ecd02bbf008f47a3709beb4e57b0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f01068833b45dd652a82f027ec23c86b254708f1045ecd02bbf008a3bafb1dfada5e5f0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>",
      "created_at" : "2020-05-26T11:51:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-633977107",
      "id" : 633977107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzk3NzEwNw==",
      "updated_at" : "2020-05-26T11:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633977107",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430560436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430560436"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will fix if I have to push another change.",
      "commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-26T16:47:56Z",
      "diff_hunk" : "@@ -103,6 +104,27 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+static bool SalvageWallet(const fs::path& path)\n+{\n+    // Create a Database handle to allow for the db to be initialized before recovery\n+    std::unique_ptr<WalletDatabase> database = WalletDatabase::Create(path);\n+\n+    // Initialize the environment before recovery\n+    bilingual_str error_string;\n+    try {\n+        WalletBatch::VerifyEnvironment(path, error_string);\n+    } catch (const fs::filesystem_error& e) {\n+        error_string = Untranslated(strprintf(\"Error loading wallet. %s\", fsbridge::get_filesystem_error_message(e)));\n+    }\n+    if (!error_string.original.empty()) {\n+        tfm::format(std::cerr, \"Failed to open wallet for salvage :%s\\n\", error_string.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#discussion_r430560436",
      "id" : 430560436,
      "in_reply_to_id" : 430259244,
      "line" : 120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2MDQzNg==",
      "original_commit_id" : "84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "original_line" : 120,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 25,
      "pull_request_review_id" : 418489792,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18918",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-26T16:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430560436",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK: thanks for doing this! :)",
      "created_at" : "2020-05-26T18:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-634190224",
      "id" : 634190224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDE5MDIyNA==",
      "updated_at" : "2020-05-26T18:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634190224",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code Review ACK https://github.com/bitcoin/bitcoin/pull/18918/commits/84ae0578b6c68dda145ca65fef510ce0fdac0d7b",
      "created_at" : "2020-05-26T18:35:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18918#issuecomment-634202268",
      "id" : 634202268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDIwMjI2OA==",
      "updated_at" : "2020-05-26T18:35:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634202268",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   }
]
