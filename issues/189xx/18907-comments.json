[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK c1029c6ff3e58a64d0b07515f92938a717a42a02. This removes [database loading with no logs](https://www.youtube.com/watch?v=eUFY8Zw0Bag) behavior implemented in #2558 1859aafef0a273e27e886646e36140cc5e375ee1, which hopefully should be unnecessary now that the wallet flushes very frequently.\r\n\r\nThis change should reduce chances for data loss and provide better error feedback if there's an unsuccessful attempt to load newer bdb logs with an older version of bdb. It also simplifies the wallet opening code.\r\n\r\nIt's possible this PR could cause new errors for users who weren't seeing errors before. If this happens we could add an easier to use manual recovery option, or implement a middle-ground automatic approach like https://github.com/bitcoin/bitcoin/pull/18870#discussion_r421698704 that will retry loading the wallet without log files as long as the log files came from a compatible bdb version.",
      "created_at" : "2020-05-07T19:39:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-625456981",
      "id" : 625456981,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTQ1Njk4MQ==",
      "updated_at" : "2020-05-07T19:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625456981",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19457 (wallet: Cleanup wallettool salvage and walletdb extraneous declarations by achow101)\n* #19335 (wallet: Cleanup and separate BerkeleyDatabase and BerkeleyBatch by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-14T03:49:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-628369770",
      "id" : 628369770,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODM2OTc3MA==",
      "updated_at" : "2020-07-11T21:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628369770",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some travis failures here. One in rpc_rawtransaction appears to be spurious https://travis-ci.org/github/bitcoin/bitcoin/jobs/684393890#L5036:\r\n\r\n```\r\n2020-05-07T18:54:10.222000Z TestFramework (ERROR): Unexpected exception caught during testing\r\nTraceback (most recent call last):\r\n  File \"/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 114, in main\r\n    self.run_test()\r\n  File \"/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/rpc_rawtransaction.py\", line 299, in run_test\r\n    vout = next(o for o in rawTx['vout'] if o['value'] == Decimal('2.20000000'))\r\nStopIteration\r\n```\r\n\r\nOther two failures in wallet_tool test seem to be the result of changed error strings https://travis-ci.org/github/bitcoin/bitcoin/jobs/684393889#L3118 and https://travis-ci.org/github/bitcoin/bitcoin/jobs/684393892#L4350:\r\n\r\n```\r\nAssertionError: not(Error loading wallet.dat. Is wallet being used by other process? == Error initializing wallet database environment \"/home/travis/build/bitcoin/bitcoin/ci/scratch/test_runner/test_runner_â¿_ð_20200507_184719/tool_wallet_117/node0/regtest/wallets\"!\r\n```\r\n\r\n```\r\n  File \"/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/tool_wallet.py\", line 39, in assert_raises_tool_error\r\n    assert_equal(stderr.strip(), error)\r\n```",
      "created_at" : "2020-05-19T19:14:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631027177",
      "id" : 631027177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTAyNzE3Nw==",
      "updated_at" : "2020-05-19T19:15:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631027177",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Cherrypicked the test and I think I've fixed the other test failures.",
      "created_at" : "2020-05-19T19:18:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631029099",
      "id" : 631029099,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTAyOTA5OQ==",
      "updated_at" : "2020-05-19T19:18:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631029099",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Travis is failing again currently because test_runner test list is o\r\n\r\nFixed",
      "created_at" : "2020-05-19T21:49:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631102297",
      "id" : 631102297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTEwMjI5Nw==",
      "updated_at" : "2020-05-19T21:49:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631102297",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ci is failing. You might have to add a suppression to `./test/sanitizer_suppressions/lsan`",
      "created_at" : "2020-05-20T00:00:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631152346",
      "id" : 631152346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTE1MjM0Ng==",
      "updated_at" : "2020-05-20T00:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631152346",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Apparently the new wallet_db.py test exposes a memory leak that happens when BerkeleyEnvironment::Open fails: https://travis-ci.org/github/bitcoin/bitcoin/jobs/689013660#L4659\r\n\r\nI didn't look closely, but in case the leak does not seem to be something obvious, I'd forgive you if you just want to drop the test here and pretend the leak isn't happening. (I'm assuming it is pre-existing.) I can follow up with the test in another PR.",
      "created_at" : "2020-05-20T00:02:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631153346",
      "id" : 631153346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTE1MzM0Ng==",
      "updated_at" : "2020-05-20T00:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631153346",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think I've fixed the memory leak.",
      "created_at" : "2020-05-20T17:31:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631618171",
      "id" : 631618171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTYxODE3MQ==",
      "updated_at" : "2020-05-20T17:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631618171",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hmm. Guess that didn't fix it. I think I'll just ignore this leak for now. I think this leak also exists on master, so it's not a regression.",
      "created_at" : "2020-05-20T20:03:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631696053",
      "id" : 631696053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTY5NjA1Mw==",
      "updated_at" : "2020-05-20T20:03:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631696053",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/18907#pullrequestreview-415756008\r\n\r\n> I'll file an issue for fixing the memory leak and adding back the test\r\n\r\nFiled #19034",
      "created_at" : "2020-05-20T22:39:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631766158",
      "id" : 631766158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTc2NjE1OA==",
      "updated_at" : "2020-05-20T22:39:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631766158",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r428633987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428633987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            err += Untranslated(\" \") + _(\"This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newer version of Berkeley DB. If so, please use the software that last loaded this wallet\");\r\n```\r\n\r\nThere is a typo in the translation message. Also, this can be written shorter by just appending the more precise reason. (You might have to rebase, to get the + operators)",
      "commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-05-21T12:56:12Z",
      "diff_hunk" : "@@ -213,23 +214,11 @@ bool BerkeleyEnvironment::Open(bool retry)\n             LogPrintf(\"BerkeleyEnvironment::Open: Error %d closing failed database environment: %s\\n\", ret2, DbEnv::strerror(ret2));\n         }\n         Reset();\n-        if (retry) {\n-            // try moving the database env out of the way\n-            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n-            try {\n-                fs::rename(pathLogDir, pathDatabaseBak);\n-                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathLogDir.string(), pathDatabaseBak.string());\n-            } catch (const fs::filesystem_error&) {\n-                // failure is ok (well, not really, but it's not worse than what we started with)\n-            }\n-            // try opening it again one more time\n-            if (!Open(false /* retry */)) {\n-                // if it still fails, it probably means we can't even create the database env\n-                return false;\n-            }\n-        } else {\n-            return false;\n+        err = strprintf(_(\"Error initializing wallet database environment %s!\"), Directory());\n+        if (ret == DB_RUNRECOVERY) {\n+            err = strprintf(_(\"Error initializing wallet database environment %s! This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newver version of Berkeley DB. If so, please use the software that last loaded this wallet\"), Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r428633987",
      "id" : 428633987,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMzk4Nw==",
      "original_commit_id" : "274b9909f64aa617eb322850b799bc38c04f5f0c",
      "original_line" : 219,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 416121045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-13T15:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428633987",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r428794856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428794856"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will fix if I have to push another change.",
      "commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-05-21T17:16:04Z",
      "diff_hunk" : "@@ -213,23 +214,11 @@ bool BerkeleyEnvironment::Open(bool retry)\n             LogPrintf(\"BerkeleyEnvironment::Open: Error %d closing failed database environment: %s\\n\", ret2, DbEnv::strerror(ret2));\n         }\n         Reset();\n-        if (retry) {\n-            // try moving the database env out of the way\n-            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n-            try {\n-                fs::rename(pathLogDir, pathDatabaseBak);\n-                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathLogDir.string(), pathDatabaseBak.string());\n-            } catch (const fs::filesystem_error&) {\n-                // failure is ok (well, not really, but it's not worse than what we started with)\n-            }\n-            // try opening it again one more time\n-            if (!Open(false /* retry */)) {\n-                // if it still fails, it probably means we can't even create the database env\n-                return false;\n-            }\n-        } else {\n-            return false;\n+        err = strprintf(_(\"Error initializing wallet database environment %s!\"), Directory());\n+        if (ret == DB_RUNRECOVERY) {\n+            err = strprintf(_(\"Error initializing wallet database environment %s! This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newver version of Berkeley DB. If so, please use the software that last loaded this wallet\"), Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r428794856",
      "id" : 428794856,
      "in_reply_to_id" : 428633987,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc5NDg1Ng==",
      "original_commit_id" : "274b9909f64aa617eb322850b799bc38c04f5f0c",
      "original_line" : 219,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 416337895,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-13T15:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/428794856",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-17T10:01:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-645279306",
      "id" : 645279306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI3OTMwNg==",
      "updated_at" : "2020-06-17T10:01:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645279306",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r441604742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441604742"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-06-17T14:49:10Z",
      "diff_hunk" : "@@ -213,23 +214,11 @@ bool BerkeleyEnvironment::Open(bool retry)\n             LogPrintf(\"BerkeleyEnvironment::Open: Error %d closing failed database environment: %s\\n\", ret2, DbEnv::strerror(ret2));\n         }\n         Reset();\n-        if (retry) {\n-            // try moving the database env out of the way\n-            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n-            try {\n-                fs::rename(pathLogDir, pathDatabaseBak);\n-                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathLogDir.string(), pathDatabaseBak.string());\n-            } catch (const fs::filesystem_error&) {\n-                // failure is ok (well, not really, but it's not worse than what we started with)\n-            }\n-            // try opening it again one more time\n-            if (!Open(false /* retry */)) {\n-                // if it still fails, it probably means we can't even create the database env\n-                return false;\n-            }\n-        } else {\n-            return false;\n+        err = strprintf(_(\"Error initializing wallet database environment %s!\"), Directory());\n+        if (ret == DB_RUNRECOVERY) {\n+            err = strprintf(_(\"Error initializing wallet database environment %s! This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newver version of Berkeley DB. If so, please use the software that last loaded this wallet\"), Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r441604742",
      "id" : 441604742,
      "in_reply_to_id" : 428633987,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNDc0Mg==",
      "original_commit_id" : "274b9909f64aa617eb322850b799bc38c04f5f0c",
      "original_line" : 219,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 432481514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-13T15:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441604742",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r446873740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446873740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `newver` typo",
      "commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-06-29T08:56:52Z",
      "diff_hunk" : "@@ -188,23 +189,11 @@ bool BerkeleyEnvironment::Open(bool retry)\n             LogPrintf(\"BerkeleyEnvironment::Open: Error %d closing failed database environment: %s\\n\", ret2, DbEnv::strerror(ret2));\n         }\n         Reset();\n-        if (retry) {\n-            // try moving the database env out of the way\n-            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n-            try {\n-                fs::rename(pathLogDir, pathDatabaseBak);\n-                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathLogDir.string(), pathDatabaseBak.string());\n-            } catch (const fs::filesystem_error&) {\n-                // failure is ok (well, not really, but it's not worse than what we started with)\n-            }\n-            // try opening it again one more time\n-            if (!Open(false /* retry */)) {\n-                // if it still fails, it probably means we can't even create the database env\n-                return false;\n-            }\n-        } else {\n-            return false;\n+        err = strprintf(_(\"Error initializing wallet database environment %s!\"), Directory());\n+        if (ret == DB_RUNRECOVERY) {\n+            err += Untranslated(\" \") + _(\"This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newver version of Berkeley DB. If so, please use the software that last loaded this wallet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r446873740",
      "id" : 446873740,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg3Mzc0MA==",
      "original_commit_id" : "c2faa3432241d15f8d0a9968ba46cc0eef7fe21f",
      "original_line" : 194,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 439009936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-13T15:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446873740",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Same error with or without this commit; bdb 18 is probably just too new.\r\n\r\nIt is. The best version to test with is probably 5.x as it will produce compatible/identical wallet.dat files but incompatible logs.",
      "created_at" : "2020-06-29T15:13:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-651185501",
      "id" : 651185501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE4NTUwMQ==",
      "updated_at" : "2020-06-29T15:14:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651185501",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r453204758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453204758"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-07-11T15:18:53Z",
      "diff_hunk" : "@@ -188,23 +189,11 @@ bool BerkeleyEnvironment::Open(bool retry)\n             LogPrintf(\"BerkeleyEnvironment::Open: Error %d closing failed database environment: %s\\n\", ret2, DbEnv::strerror(ret2));\n         }\n         Reset();\n-        if (retry) {\n-            // try moving the database env out of the way\n-            fs::path pathDatabaseBak = pathIn / strprintf(\"database.%d.bak\", GetTime());\n-            try {\n-                fs::rename(pathLogDir, pathDatabaseBak);\n-                LogPrintf(\"Moved old %s to %s. Retrying.\\n\", pathLogDir.string(), pathDatabaseBak.string());\n-            } catch (const fs::filesystem_error&) {\n-                // failure is ok (well, not really, but it's not worse than what we started with)\n-            }\n-            // try opening it again one more time\n-            if (!Open(false /* retry */)) {\n-                // if it still fails, it probably means we can't even create the database env\n-                return false;\n-            }\n-        } else {\n-            return false;\n+        err = strprintf(_(\"Error initializing wallet database environment %s!\"), Directory());\n+        if (ret == DB_RUNRECOVERY) {\n+            err += Untranslated(\" \") + _(\"This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newver version of Berkeley DB. If so, please use the software that last loaded this wallet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r453204758",
      "id" : 453204758,
      "in_reply_to_id" : 446873740,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDc1OA==",
      "original_commit_id" : "c2faa3432241d15f8d0a9968ba46cc0eef7fe21f",
      "original_line" : 194,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 446809208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-13T15:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453204758",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Had to rebase. Fixed the typo and added a bit to the commit message.",
      "created_at" : "2020-07-11T15:19:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-657079713",
      "id" : 657079713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NzA3OTcxMw==",
      "updated_at" : "2020-07-11T15:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/657079713",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-07-14T19:00:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-658355692",
      "id" : 658355692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODM1NTY5Mg==",
      "updated_at" : "2020-07-14T19:00:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658355692",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested:\r\n\r\n```\r\n$  ./src/bitcoin-cli -regtest getnewaddress\r\n2020-07-22T06:50:11Z [default wallet] keypool reserve 2\r\n2020-07-22T06:50:11Z [default wallet] keypool keep 2\r\nbitcoind: wallet/rpcwallet.cpp:278: UniValue getnewaddress(const JSONRPCRequest&): Assertion `false' failed.\r\nerror: Could not connect to the server 127.0.0.1:18443 (error code 1 - \"EOF reached\")\r\n\r\nMake sure the bitcoind server is running and that you are connecting to the correct RPC port.\r\n[2]-  Aborted                 (core dumped) ./src/bitcoind -regtest\r\n\r\n\r\n\r\n$ ls ~/.bitcoin/regtest/wallets/\r\ndatabase  db.log  wallet.dat\r\n\r\n\r\n$ ./src/bitcoind-with-older-bdb -regtest  \r\n...\r\n2020-07-22T06:55:42Z Using wallet directory /root/.bitcoin/regtest/wallets\r\n2020-07-22T06:55:42Z init message: Verifying wallet(s)...\r\n2020-07-22T06:55:42Z Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2020-07-22T06:55:42Z Using wallet /root/.bitcoin/regtest/wallets/wallet.dat\r\n2020-07-22T06:55:42Z BerkeleyEnvironment::Open: LogDir=/root/.bitcoin/regtest/wallets/database ErrorFile=/root/.bitcoin/regtest/wallets/db.log\r\n2020-07-22T06:55:42Z BerkeleyEnvironment::Open: Error -30974 opening database environment: DB_RUNRECOVERY: Fatal error, run database recovery\r\n2020-07-22T06:55:42Z Error: Error initializing wallet database environment \"/root/.bitcoin/regtest/wallets\"! This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newer version of Berkeley DB. If so, please use the software that last loaded this wallet\r\nError: Error initializing wallet database environment \"/root/.bitcoin/regtest/wallets\"! This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newer version of Berkeley DB. If so, please use the software that last loaded this wallet\r\n2020-07-22T06:55:42Z Shutdown: In progress...\r\n2020-07-22T06:55:42Z scheduler thread exit\r\n2020-07-22T06:55:42Z Shutdown: done\r\n",
      "created_at" : "2020-07-22T06:56:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-662278993",
      "id" : 662278993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18907",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MjI3ODk5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-22T06:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662278993",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r458576029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458576029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: Could upgrade to the new style while touching the line\r\n```suggestion\r\n        if (!env->Open(open_err)) {\r\n```",
      "commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "created_at" : "2020-07-22T06:59:38Z",
      "diff_hunk" : "@@ -342,7 +330,8 @@ BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bo\n \n     {\n         LOCK(cs_db);\n-        if (!env->Open(false /* retry */))\n+        bilingual_str open_err;\n+        if (!env->Open(open_err))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18907#discussion_r458576029",
      "id" : 458576029,
      "line" : 334,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU3NjAyOQ==",
      "original_commit_id" : "d0ea9bab2804928c9f40def61fd99064d2d8f9b8",
      "original_line" : 334,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 61,
      "pull_request_review_id" : 453043518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18907",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-22T06:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458576029",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
