[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> After=network.target can be sure that it is stopped before the network is shut down when the system is going down. This allows services to cleanly terminate connections before going down, instead of losing ongoing connections leaving the other side in an undefined state.\r\n\r\nPresumably `After=network-online.target` service is afforded the same graceful shutdown time before the network is brought down?\r\n\r\nAnyway, speeding up system boot time certainly seems worthwhile, and Bitcoin Core can handle being offline just fine, so i think I'd agree that this change was a net positive. My own systemd file for Bitcoind has always just contained a simple `After=network.target` and it's worked for a few years without issue.",
      "created_at" : "2022-11-14T08:17:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1313262563",
      "id" : 1313262563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585ORsvj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1313262563/reactions"
      },
      "updated_at" : "2022-11-14T08:17:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1313262563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Presumably `After=network-online.target` service is afforded the same graceful shutdown time before the network is brought down?\r\n\r\nYea, my understanding is that it reverses the order of those targets during shutdown :\r\n\r\n```\r\nnetwork-pre.target UP -> network.target UP -> network-online.target UP\r\n```\r\n\r\n```\r\nnetwork-online.target DOWN -> network.target DOWN -> network-pre.target DOWN\r\n```\r\n\r\n> My own systemd file for Bitcoind has always just contained a simple After=network.target and it's worked for a few years without issue.\r\n\r\nThat's good to know, changing things is always risky. I'm doing some testing too.",
      "created_at" : "2022-11-14T11:30:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1313537955",
      "id" : 1313537955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585OSv-j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1313537955/reactions"
      },
      "updated_at" : "2022-11-14T11:30:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1313537955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1189245?v=4",
         "events_url" : "https://api.github.com/users/bubelov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bubelov/followers",
         "following_url" : "https://api.github.com/users/bubelov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bubelov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bubelov",
         "id" : 1189245,
         "login" : "bubelov",
         "node_id" : "MDQ6VXNlcjExODkyNDU=",
         "organizations_url" : "https://api.github.com/users/bubelov/orgs",
         "received_events_url" : "https://api.github.com/users/bubelov/received_events",
         "repos_url" : "https://api.github.com/users/bubelov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bubelov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bubelov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bubelov"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "See @luke-jr's [comment](https://github.com/bitcoin/bitcoin/pull/26495#issuecomment-1314551734) on the PR.\r\n\r\nBut also, we read `anchors.dat` very early in the process in order to reestablish two earlier connections. If we fail to connect because we're still offline we immediately give up on them. That (slightly) increases the risk of an eclipse attack.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/48174c0f287b19931ca110670610bd03a03eb914/src/net.cpp#L1766-L1773\r\n\r\nThis could perhaps be made more robust, if we had a way of detecting online-ness, but arguably that's better left to systemd to figure out.",
      "created_at" : "2022-11-15T11:05:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1315151072",
      "id" : 1315151072,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585OY5zg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1315151072/reactions"
      },
      "updated_at" : "2022-11-15T11:05:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1315151072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors it seems like `systemd` doesn't really know what it means to be online, too, and it delegates it to the network manager, giving us no hard guarantees. Their official recommendation is not to trust them blindly and to use `rtnetlink` instead, if possible.\r\n\r\n> A robust system boots up independently of external services. More specifically, if a network DHCP server does not react, this should not slow down boot on most setups, but only for those where network connectivity is strictly needed (for example, because the host actually boots from the network).",
      "created_at" : "2022-11-15T12:01:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1315211197",
      "id" : 1315211197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585OZIe9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1315211197/reactions"
      },
      "updated_at" : "2022-11-15T12:01:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1315211197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1189245?v=4",
         "events_url" : "https://api.github.com/users/bubelov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bubelov/followers",
         "following_url" : "https://api.github.com/users/bubelov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bubelov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bubelov",
         "id" : 1189245,
         "login" : "bubelov",
         "node_id" : "MDQ6VXNlcjExODkyNDU=",
         "organizations_url" : "https://api.github.com/users/bubelov/orgs",
         "received_events_url" : "https://api.github.com/users/bubelov/received_events",
         "repos_url" : "https://api.github.com/users/bubelov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bubelov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bubelov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bubelov"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> But also, we read anchors.dat very early in the process in order to reestablish two earlier connections. If we fail to connect because we're still offline we immediately give up on them. That (slightly) increases the risk of an eclipse attack.\r\n\r\nThis is something I didn't consider and a good argument for leaving the service file as it currently is for now IMO.\r\n\r\nIt also leads me to wonder whether it would make sense to delay making our \"best\" (anchor) connections until after we have connected at least one other node, as a proxy for online-ness, specifically so that we can avoid them being missed like this...",
      "created_at" : "2022-11-15T13:43:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1315328957",
      "id" : 1315328957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585OZlO9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1315328957/reactions"
      },
      "updated_at" : "2022-11-15T13:43:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1315328957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> My own systemd file for Bitcoind has always just contained a simple `After=network.target` and it's worked for a few years without issue.\r\n\r\nAnd yet nix-bitcoin changed `network.target` to `network-online.target` recently in https://github.com/fort-nix/nix-bitcoin/pull/567, which fixed the following error:\r\n\r\n```\r\nbitcoind: libevent: getaddrinfo: address family for nodename not supported\r\nbitcoind: Binding RPC on address 127.0.0.1 port 8332 failed.\r\nbitcoind: Unable to bind any endpoint for\r\n```\r\n\r\nwhen dhcpcd and bitcoind were started in parallel.\r\n",
      "created_at" : "2022-11-24T21:56:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1326857796",
      "id" : 1326857796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585PFj5E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1326857796/reactions"
      },
      "updated_at" : "2022-11-24T21:56:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1326857796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The change from `network.target` to `network-online.target` (in this repo) was introduced in https://github.com/bitcoin/bitcoin/commit/d9392b724cae53b7a16fa5f84ebe152eea496502 by @hebasto ",
      "created_at" : "2022-11-24T21:58:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1326858989",
      "id" : 1326858989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585PFkLt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1326858989/reactions"
      },
      "updated_at" : "2022-11-24T21:58:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1326858989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Binding RPC on address 127.0.0.1 port 8332 failed\r\n\r\nThat's interesting, and it seems to contradict this quote from the official systemd doc:\r\n\r\n> It is strongly recommended not to make use of this target too liberally: for example network server software should generally not pull this in (since server software generally is happy to accept local connections even before any routable network interface is up). Its primary purpose is network client software that cannot operate without network.\r\n\r\nBinding to `127.0.0.1` sounds like a normal thing for \"server software\" to do, why would it need to be online (whatever it means) to bind to a local port?",
      "created_at" : "2022-11-25T04:47:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1327017931",
      "id" : 1327017931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585PGK_L",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327017931/reactions"
      },
      "updated_at" : "2022-11-25T04:47:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327017931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1189245?v=4",
         "events_url" : "https://api.github.com/users/bubelov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bubelov/followers",
         "following_url" : "https://api.github.com/users/bubelov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bubelov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bubelov",
         "id" : 1189245,
         "login" : "bubelov",
         "node_id" : "MDQ6VXNlcjExODkyNDU=",
         "organizations_url" : "https://api.github.com/users/bubelov/orgs",
         "received_events_url" : "https://api.github.com/users/bubelov/received_events",
         "repos_url" : "https://api.github.com/users/bubelov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bubelov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bubelov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bubelov"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> But also, we read anchors.dat very early in the process in order to reestablish two earlier connections. If we fail to connect because we're still offline we immediately give up on them. That (slightly) increases the risk of an eclipse attack.\r\n\r\nThis seems worth preserving using `network-online.target` for. However perhaps we should think about changing the anchor connection logic so that it does not give up on them until we have at least one remote connection, to avoid this more robustly.",
      "created_at" : "2022-11-25T10:45:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26493#issuecomment-1327315827",
      "id" : 1327315827,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26493",
      "node_id" : "IC_kwDOABII585PHTtz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327315827/reactions"
      },
      "updated_at" : "2022-11-25T10:45:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327315827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
