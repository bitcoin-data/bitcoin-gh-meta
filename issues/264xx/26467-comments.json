[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-11-08T22:51:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1307943934",
      "id" : 1307943934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585N9aP-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1307943934/reactions"
      },
      "updated_at" : "2022-11-08T22:51:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1307943934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [ghost](https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1307943934), [john-moffett](https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1317276599), [furszy](https://github.com/bitcoin/bitcoin/pull/26467#pullrequestreview-1316555886) |\n| Stale ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1440197785), [pinheadmz](https://github.com/bitcoin/bitcoin/pull/26467#pullrequestreview-1313813959) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27195](https://github.com/bitcoin/bitcoin/pull/27195) (bumpfee: allow send coins back to yourself by furszy)\n* [#26485](https://github.com/bitcoin/bitcoin/pull/26485) (RPC: Accept options as named-only parameters by ryanofsky)\n* [#25979](https://github.com/bitcoin/bitcoin/pull/25979) ([WIP] wallet: standardize change output detection process by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-11-09T16:05:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1308987193",
      "id" : 1308987193,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585OBY85",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1308987193/reactions"
      },
      "updated_at" : "2023-04-21T04:45:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1308987193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. \r\n\r\nTested and code reviewed 73d4ba2. Suggest changing the dialog UI to support scrolling and resizing in case there are lots of outputs:\r\n\r\n<details><summary>Screenshot</summary>\r\n<img width=\"729\" alt=\"image\" src=\"https://user-images.githubusercontent.com/116917595/202218629-b38968bc-26ca-40f0-8861-eee859c99b86.png\">\r\n</details>\r\n\r\n[Here is a drop-in gist](https://gist.github.com/john-moffett/87c0cf77ed9827e05c92066254335c0a) to implement scrolling and resizing, which changes it to:\r\n\r\n<details><summary>Screenshot</summary>\r\n<img width=\"728\" alt=\"image\" src=\"https://user-images.githubusercontent.com/116917595/202220127-75c9cb3b-7a0f-4920-875c-581475246bb0.png\">\r\n</details>\r\n\r\nIf a user creates a single-output tx and chooses that output as \"change\" to fee-bump, it will fail with the \"Transaction must have at least one recipient\" message. This makes sense if the user always expects the \"payment\" output to remain the same value, but if they're consolidating UTXOs or something, this may be desirable to allow. \r\n\r\n\r\n",
      "created_at" : "2022-11-16T16:16:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1317276599",
      "id" : 1317276599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585OhAu3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1317276599/reactions"
      },
      "updated_at" : "2022-11-16T16:26:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1317276599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/116917595?v=4",
         "events_url" : "https://api.github.com/users/john-moffett/events{/privacy}",
         "followers_url" : "https://api.github.com/users/john-moffett/followers",
         "following_url" : "https://api.github.com/users/john-moffett/following{/other_user}",
         "gists_url" : "https://api.github.com/users/john-moffett/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/john-moffett",
         "id" : 116917595,
         "login" : "john-moffett",
         "node_id" : "U_kgDOBvgFWw",
         "organizations_url" : "https://api.github.com/users/john-moffett/orgs",
         "received_events_url" : "https://api.github.com/users/john-moffett/received_events",
         "repos_url" : "https://api.github.com/users/john-moffett/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/john-moffett/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/john-moffett/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/john-moffett"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> We support subtracting fee from output, so I think the `\"reduce_output\"` name used in #12096 was better.\r\n\r\nAgreed. The help text could clarify that in the general case you should pick the change address output for this.",
      "created_at" : "2022-12-12T20:06:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1347229350",
      "id" : 1347229350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585QTRam",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1347229350/reactions"
      },
      "updated_at" : "2022-12-12T20:06:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1347229350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> We support subtracting fee from output, so I think the `\"reduce_output\"` name used in #12096 was better. (Would be nice if that situation could be detected, but I don't think we save the metadata needed for that.)\r\n\r\nI've taken the name, but I'm not entirely sure that it is accurate. While we will most likely reduce the amount of the specified output, it's not the only outcome. It could be that specified output does not provide enough value, in which case we will add additional inputs and set the output's value as the resulting change value, which will be higher than the original value.\r\n\r\n> Also, might make sense to split the GUI part off to the GUI repo after the rest is merged. Seems like a hard thing to get a good UX for.\r\n\r\nDone, moved the GUI commits to https://github.com/bitcoin-core/gui/pull/700\r\n\r\n> Suggest changing the dialog UI to support scrolling and resizing in case there are lots of outputs:\r\n\r\nTook this suggestion in the PR to the GUI repo.\r\n\r\n> If a user creates a single-output tx and chooses that output as \"change\" to fee-bump, it will fail with the \"Transaction must have at least one recipient\" message. This makes sense if the user always expects the \"payment\" output to remain the same value, but if they're consolidating UTXOs or something, this may be desirable to allow.\r\n\r\nAdded a commit which handles that case.",
      "created_at" : "2023-01-23T21:15:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1400990091",
      "id" : 1400990091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585TgWmL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400990091/reactions"
      },
      "updated_at" : "2023-01-23T21:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400990091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nDid you mean for the middle commit to have `txid:` as its prefix?\r\n\r\nOn signet with an empty mempool, when I send a transaction with a single input at 1 sat/vbyte and then try to bump it to 2 sat/byte, it complains:\r\n\r\n```\r\nInsufficient total fee 0.00000222, must be at least 0.00000666 (oldFee 0.00000111 + incrementalFee 0.00000555)\r\n```\r\n\r\n```getnetworkinfo``` says `\"incrementalfee\": 0.00001000`\r\n\r\nMaybe `maxTxSize` is too pessimistic?",
      "created_at" : "2023-01-24T13:31:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1401954296",
      "id" : 1401954296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585TkB_4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1401954296/reactions"
      },
      "updated_at" : "2023-01-24T14:43:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1401954296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Did you mean for the middle commit to have `txid:` as its prefix?\r\n\r\nNope, fixed.\r\n\r\n> On signet with an empty mempool, when I send a transaction with a single input at 1 sat/vbyte and then try to bump it to 2 sat/byte, it complains:\r\n> \r\n> ```\r\n> Insufficient total fee 0.00000222, must be at least 0.00000666 (oldFee 0.00000111 + incrementalFee 0.00000555)\r\n> ```\r\n> \r\n> `getnetworkinfo` says `\"incrementalfee\": 0.00001000`\r\n> \r\n> Maybe `maxTxSize` is too pessimistic?\r\n\r\nI'm going to say that this is an orthogonal issue. It looks like the wallet has a minimum incremental feerate of 5 sat/vb, rather than the 1 sat/vb the mempool uses.\r\n\r\n",
      "created_at" : "2023-01-24T18:07:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1402370929",
      "id" : 1402370929,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585Tlntx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402370929/reactions"
      },
      "updated_at" : "2023-01-24T18:07:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402370929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1087926603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087926603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0b280affd4c755d8f9eb809b3676389b2c2c52c0 nit: `return` could be outside the `if else`. If you touch it, there's also a typo in the commit description: `transcation`",
      "commit_id" : "0b280affd4c755d8f9eb809b3676389b2c2c52c0",
      "created_at" : "2023-01-26T14:31:56Z",
      "diff_hunk" : "@@ -281,21 +282,35 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // We cannot source new unconfirmed inputs(bip125 rule 2)\n     new_coin_control.m_min_depth = 1;\n \n-    constexpr int RANDOM_CHANGE_POSITION = -1;\n-    auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n-    if (!res) {\n-        errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n-        return Result::WALLET_ERROR;\n-    }\n+    if (recipients.size() > 0) {\n+        constexpr int RANDOM_CHANGE_POSITION = -1;\n+        auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n+        if (!res) {\n+            errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n+            return Result::WALLET_ERROR;\n+        }\n \n-    const auto& txr = *res;\n-    // Write back new fee if successful\n-    new_fee = txr.fee;\n+        const auto& txr = *res;\n+        // Write back new fee if successful\n+        new_fee = txr.fee;\n \n-    // Write back transaction\n-    mtx = CMutableTransaction(*txr.tx);\n+        // Write back transaction\n+        mtx = CMutableTransaction(*txr.tx);\n \n-    return Result::OK;\n+        return Result::OK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1087926603",
      "id" : 1087926603,
      "line" : 300,
      "node_id" : "PRRC_kwDOABII585A2HFL",
      "original_commit_id" : "0b280affd4c755d8f9eb809b3676389b2c2c52c0",
      "original_line" : 300,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : 56,
      "pull_request_review_id" : 1271164826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087926603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T14:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087926603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-16T19:59:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1433639010",
      "id" : 1433639010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585Vc5hi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1433639010/reactions"
      },
      "updated_at" : "2023-02-16T19:59:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1433639010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 4167843e0729994954317e2a4ac8a96a453bad79. The latest rebase takes the new `outputs` argument into account from #25344. It ensures they can't be combined, so that's good.",
      "created_at" : "2023-02-22T14:58:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1440197785",
      "id" : 1440197785,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585V16yZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1440197785/reactions"
      },
      "updated_at" : "2023-02-22T14:58:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1440197785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1117235969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117235969"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will `new_change_pos == change_pos` always here? Or are the outputs of the replacement re-randomized?",
      "commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "created_at" : "2023-02-24T16:02:10Z",
      "diff_hunk" : "@@ -165,9 +169,81 @@ def test_invalid_parameters(self, rbf_node, peer_node, dest_address):\n         assert_raises_rpc_error(-8, \"Invalid parameter, duplicate key: data\",\n                 rbf_node.bumpfee, rbfid, {\"outputs\": [{\"data\": \"deadbeef\"}, {\"data\": \"deadbeef\"}]})\n \n+        self.log.info(\"Test reduce_output option\")\n+        assert_raises_rpc_error(-1, \"JSON integer out of range\", rbf_node.bumpfee, rbfid, {\"reduce_output\": -1})\n+        assert_raises_rpc_error(-8, \"Change position is out of range\", rbf_node.bumpfee, rbfid, {\"reduce_output\": 2})\n+\n+        self.log.info(\"Test outputs and reduce_output cannot both be provided\")\n+        assert_raises_rpc_error(-8, \"outputs and reduce_output cannot both be specified simultaneously\", rbf_node.bumpfee, rbfid, {\"reduce_output\": 2, \"outputs\": [{dest_address: 0.1}]})\n+\n         self.clear_mempool()\n \n \n+    def test_provided_change_pos(self, rbf_node):\n+        self.log.info(\"Test the reduce_output option\")\n+\n+        change_addr = rbf_node.getnewaddress()\n+        dest_addr = rbf_node.getnewaddress()\n+        assert_equal(rbf_node.getaddressinfo(change_addr)[\"ischange\"], False)\n+        assert_equal(rbf_node.getaddressinfo(dest_addr)[\"ischange\"], False)\n+\n+        send_res = rbf_node.send(outputs=[{dest_addr: 1}], options={\"change_address\": change_addr})\n+        assert send_res[\"complete\"]\n+        txid = send_res[\"txid\"]\n+\n+        tx = rbf_node.gettransaction(txid=txid, verbose=True)\n+        assert_equal(len(tx[\"decoded\"][\"vout\"]), 2)\n+\n+        change_pos = find_vout_for_address(rbf_node, txid, change_addr)\n+        change_value = tx[\"decoded\"][\"vout\"][change_pos][\"value\"]\n+\n+        bumped = rbf_node.bumpfee(txid, {\"reduce_output\": change_pos})\n+        new_txid = bumped[\"txid\"]\n+\n+        new_tx = rbf_node.gettransaction(txid=new_txid, verbose=True)\n+        assert_equal(len(new_tx[\"decoded\"][\"vout\"]), 2)\n+        new_change_pos = find_vout_for_address(rbf_node, new_txid, change_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1117235969",
      "id" : 1117235969,
      "line" : 205,
      "node_id" : "PRRC_kwDOABII585Cl6sB",
      "original_commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "original_line" : 205,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : 57,
      "pull_request_review_id" : 1313813959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117235969/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-24T16:39:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117235969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1119397491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119397491"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a902eaf5:\r\nWhile you are here, could add the missing doc for the `@param[in] outputs` arg.",
      "commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "created_at" : "2023-02-27T22:52:53Z",
      "diff_hunk" : "@@ -43,6 +43,7 @@ bool TransactionCanBeBumped(const CWallet& wallet, const uint256& txid);\n  * @param[out] new_fee the fee that the bump transaction pays\n  * @param[out] mtx The bump transaction itself\n  * @param[in] require_mine Whether the original transaction must consist of inputs that can be spent by the wallet\n+ * @param[in] reduce_output The position of the change output to deduct the fee from in the transaction being bumped",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1119397491",
      "id" : 1119397491,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII585CuKZz",
      "original_commit_id" : "a902eaf5be4a83dff37f28a988e5f3b2425551c0",
      "original_line" : 46,
      "original_position" : 4,
      "original_start_line" : 45,
      "path" : "src/wallet/feebumper.h",
      "position" : 4,
      "pull_request_review_id" : 1316555886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119397491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 45,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-27T23:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119397491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1119402395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119402395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In https://github.com/bitcoin/bitcoin/commit/a902eaf5be4a83dff37f28a988e5f3b2425551c0:\r\n\r\nCould write it prettier:\r\n```suggestion\r\n        if (reduce_output.has_value() ? reduce_output.value() == i : OutputIsChange(wallet, output)) {\r\n```",
      "commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "created_at" : "2023-02-27T23:00:15Z",
      "diff_hunk" : "@@ -234,14 +246,16 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // is one). If outputs vector is non-empty, replace original\n     // outputs with its contents, otherwise use original outputs.\n     std::vector<CRecipient> recipients;\n-    for (const auto& output : outputs.empty() ? wtx.tx->vout : outputs) {\n-        if (!OutputIsChange(wallet, output)) {\n-            CRecipient recipient = {output.scriptPubKey, output.nValue, false};\n-            recipients.push_back(recipient);\n-        } else {\n+    const auto& tx_outs = outputs.empty() ? wtx.tx->vout : outputs;\n+    for (size_t i = 0; i < tx_outs.size(); ++i) {\n+        const CTxOut& output = tx_outs.at(i);\n+        if ((reduce_output.has_value() && reduce_output.value() == i) || (!reduce_output.has_value() && OutputIsChange(wallet, output))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1119402395",
      "id" : 1119402395,
      "line" : 252,
      "node_id" : "PRRC_kwDOABII585CuLmb",
      "original_commit_id" : "a902eaf5be4a83dff37f28a988e5f3b2425551c0",
      "original_line" : 252,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : 41,
      "pull_request_review_id" : 1316555886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119402395/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-27T23:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119402395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1124613138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1124613138"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is not contemplating the user changing the outputs for a single change output. E.g. bump tx to send coins back to yourself.\r\n\r\nThe generated `temp_mtx` uses the same outputs as the previous transaction, so the provided output is discarded. And only deduces the new fee from the previous tx outputs.\r\n\r\nPreviously, in master, we would just fail on this situation. While here, we return a tx that is not what the user wants.\r\nSo, created #27195 to solve the issue in master first.",
      "commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "created_at" : "2023-03-03T15:26:16Z",
      "diff_hunk" : "@@ -293,21 +294,35 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // We cannot source new unconfirmed inputs(bip125 rule 2)\n     new_coin_control.m_min_depth = 1;\n \n-    constexpr int RANDOM_CHANGE_POSITION = -1;\n-    auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n-    if (!res) {\n-        errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n-        return Result::WALLET_ERROR;\n-    }\n+    if (recipients.size() > 0) {\n+        constexpr int RANDOM_CHANGE_POSITION = -1;\n+        auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n+        if (!res) {\n+            errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n+            return Result::WALLET_ERROR;\n+        }\n \n-    const auto& txr = *res;\n-    // Write back new fee if successful\n-    new_fee = txr.fee;\n+        const auto& txr = *res;\n+        // Write back new fee if successful\n+        new_fee = txr.fee;\n \n-    // Write back transaction\n-    mtx = CMutableTransaction(*txr.tx);\n+        // Write back transaction\n+        mtx = CMutableTransaction(*txr.tx);\n \n-    return Result::OK;\n+        return Result::OK;\n+    } else {\n+        // The transaction only has one output, and it is either detected as change,\n+        // or selected as the one to take the fee from.\n+        // In that case, just reduce its value to meet the new feerate.\n+        new_fee = new_coin_control.m_feerate->GetFee(maxTxSize);\n+        temp_mtx.vout[0].nValue += old_fee - new_fee;\n+        if (IsDust(temp_mtx.vout[0], wallet.chain().relayDustFee())) {\n+            errors.push_back(Untranslated(\"Single output amount too small\"));\n+            return Result::MISC_ERROR;\n+        }\n+        mtx = temp_mtx;\n+        return Result::OK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1124613138",
      "id" : 1124613138,
      "line" : 324,
      "node_id" : "PRRC_kwDOABII585DCDwS",
      "original_commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "original_line" : 324,
      "original_position" : 68,
      "original_start_line" : 314,
      "path" : "src/wallet/feebumper.cpp",
      "position" : 68,
      "pull_request_review_id" : 1324059833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1124613138/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 314,
      "start_side" : "RIGHT",
      "updated_at" : "2023-03-03T15:27:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1124613138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137498953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137498953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "They will be re-randomized.",
      "commit_id" : "cac1de5aeda126880a42089294ee7ad85dbe46f0",
      "created_at" : "2023-03-15T17:29:44Z",
      "diff_hunk" : "@@ -165,9 +169,81 @@ def test_invalid_parameters(self, rbf_node, peer_node, dest_address):\n         assert_raises_rpc_error(-8, \"Invalid parameter, duplicate key: data\",\n                 rbf_node.bumpfee, rbfid, {\"outputs\": [{\"data\": \"deadbeef\"}, {\"data\": \"deadbeef\"}]})\n \n+        self.log.info(\"Test reduce_output option\")\n+        assert_raises_rpc_error(-1, \"JSON integer out of range\", rbf_node.bumpfee, rbfid, {\"reduce_output\": -1})\n+        assert_raises_rpc_error(-8, \"Change position is out of range\", rbf_node.bumpfee, rbfid, {\"reduce_output\": 2})\n+\n+        self.log.info(\"Test outputs and reduce_output cannot both be provided\")\n+        assert_raises_rpc_error(-8, \"outputs and reduce_output cannot both be specified simultaneously\", rbf_node.bumpfee, rbfid, {\"reduce_output\": 2, \"outputs\": [{dest_address: 0.1}]})\n+\n         self.clear_mempool()\n \n \n+    def test_provided_change_pos(self, rbf_node):\n+        self.log.info(\"Test the reduce_output option\")\n+\n+        change_addr = rbf_node.getnewaddress()\n+        dest_addr = rbf_node.getnewaddress()\n+        assert_equal(rbf_node.getaddressinfo(change_addr)[\"ischange\"], False)\n+        assert_equal(rbf_node.getaddressinfo(dest_addr)[\"ischange\"], False)\n+\n+        send_res = rbf_node.send(outputs=[{dest_addr: 1}], options={\"change_address\": change_addr})\n+        assert send_res[\"complete\"]\n+        txid = send_res[\"txid\"]\n+\n+        tx = rbf_node.gettransaction(txid=txid, verbose=True)\n+        assert_equal(len(tx[\"decoded\"][\"vout\"]), 2)\n+\n+        change_pos = find_vout_for_address(rbf_node, txid, change_addr)\n+        change_value = tx[\"decoded\"][\"vout\"][change_pos][\"value\"]\n+\n+        bumped = rbf_node.bumpfee(txid, {\"reduce_output\": change_pos})\n+        new_txid = bumped[\"txid\"]\n+\n+        new_tx = rbf_node.gettransaction(txid=new_txid, verbose=True)\n+        assert_equal(len(new_tx[\"decoded\"][\"vout\"]), 2)\n+        new_change_pos = find_vout_for_address(rbf_node, new_txid, change_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137498953",
      "id" : 1137498953,
      "in_reply_to_id" : 1117235969,
      "line" : 239,
      "node_id" : "PRRC_kwDOABII585DzNtJ",
      "original_commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "original_line" : 239,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : 98,
      "pull_request_review_id" : 1342040199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137498953/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T17:29:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137498953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137504055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137504055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cac1de5aeda126880a42089294ee7ad85dbe46f0",
      "created_at" : "2023-03-15T17:33:17Z",
      "diff_hunk" : "@@ -43,6 +43,7 @@ bool TransactionCanBeBumped(const CWallet& wallet, const uint256& txid);\n  * @param[out] new_fee the fee that the bump transaction pays\n  * @param[out] mtx The bump transaction itself\n  * @param[in] require_mine Whether the original transaction must consist of inputs that can be spent by the wallet\n+ * @param[in] reduce_output The position of the change output to deduct the fee from in the transaction being bumped",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137504055",
      "id" : 1137504055,
      "in_reply_to_id" : 1119397491,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DzO83",
      "original_commit_id" : "a902eaf5be4a83dff37f28a988e5f3b2425551c0",
      "original_line" : 47,
      "original_position" : 4,
      "original_start_line" : 45,
      "path" : "src/wallet/feebumper.h",
      "position" : null,
      "pull_request_review_id" : 1342046142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137504055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-15T17:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137504055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137504281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137504281"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cac1de5aeda126880a42089294ee7ad85dbe46f0",
      "created_at" : "2023-03-15T17:33:25Z",
      "diff_hunk" : "@@ -234,14 +246,16 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // is one). If outputs vector is non-empty, replace original\n     // outputs with its contents, otherwise use original outputs.\n     std::vector<CRecipient> recipients;\n-    for (const auto& output : outputs.empty() ? wtx.tx->vout : outputs) {\n-        if (!OutputIsChange(wallet, output)) {\n-            CRecipient recipient = {output.scriptPubKey, output.nValue, false};\n-            recipients.push_back(recipient);\n-        } else {\n+    const auto& tx_outs = outputs.empty() ? wtx.tx->vout : outputs;\n+    for (size_t i = 0; i < tx_outs.size(); ++i) {\n+        const CTxOut& output = tx_outs.at(i);\n+        if ((reduce_output.has_value() && reduce_output.value() == i) || (!reduce_output.has_value() && OutputIsChange(wallet, output))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137504281",
      "id" : 1137504281,
      "in_reply_to_id" : 1119402395,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DzPAZ",
      "original_commit_id" : "a902eaf5be4a83dff37f28a988e5f3b2425551c0",
      "original_line" : 252,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : null,
      "pull_request_review_id" : 1342046482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137504281/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T17:33:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137504281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137532345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137532345"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a fix, and adopted your test. The fix is simple enough to do here that I think a separate PR is unnecessary.",
      "commit_id" : "cac1de5aeda126880a42089294ee7ad85dbe46f0",
      "created_at" : "2023-03-15T17:52:42Z",
      "diff_hunk" : "@@ -293,21 +294,35 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // We cannot source new unconfirmed inputs(bip125 rule 2)\n     new_coin_control.m_min_depth = 1;\n \n-    constexpr int RANDOM_CHANGE_POSITION = -1;\n-    auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n-    if (!res) {\n-        errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n-        return Result::WALLET_ERROR;\n-    }\n+    if (recipients.size() > 0) {\n+        constexpr int RANDOM_CHANGE_POSITION = -1;\n+        auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n+        if (!res) {\n+            errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n+            return Result::WALLET_ERROR;\n+        }\n \n-    const auto& txr = *res;\n-    // Write back new fee if successful\n-    new_fee = txr.fee;\n+        const auto& txr = *res;\n+        // Write back new fee if successful\n+        new_fee = txr.fee;\n \n-    // Write back transaction\n-    mtx = CMutableTransaction(*txr.tx);\n+        // Write back transaction\n+        mtx = CMutableTransaction(*txr.tx);\n \n-    return Result::OK;\n+        return Result::OK;\n+    } else {\n+        // The transaction only has one output, and it is either detected as change,\n+        // or selected as the one to take the fee from.\n+        // In that case, just reduce its value to meet the new feerate.\n+        new_fee = new_coin_control.m_feerate->GetFee(maxTxSize);\n+        temp_mtx.vout[0].nValue += old_fee - new_fee;\n+        if (IsDust(temp_mtx.vout[0], wallet.chain().relayDustFee())) {\n+            errors.push_back(Untranslated(\"Single output amount too small\"));\n+            return Result::MISC_ERROR;\n+        }\n+        mtx = temp_mtx;\n+        return Result::OK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1137532345",
      "id" : 1137532345,
      "in_reply_to_id" : 1124613138,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DzV25",
      "original_commit_id" : "4167843e0729994954317e2a4ac8a96a453bad79",
      "original_line" : 325,
      "original_position" : 68,
      "original_start_line" : 314,
      "path" : "src/wallet/feebumper.cpp",
      "position" : null,
      "pull_request_review_id" : 1342078927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137532345/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-15T17:52:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137532345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140734813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140734813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit:\r\ndouble unneeded `()`",
      "commit_id" : "cac1de5aeda126880a42089294ee7ad85dbe46f0",
      "created_at" : "2023-03-17T21:40:07Z",
      "diff_hunk" : "@@ -234,14 +246,16 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // is one). If outputs vector is non-empty, replace original\n     // outputs with its contents, otherwise use original outputs.\n     std::vector<CRecipient> recipients;\n-    for (const auto& output : outputs.empty() ? wtx.tx->vout : outputs) {\n-        if (!OutputIsChange(wallet, output)) {\n-            CRecipient recipient = {output.scriptPubKey, output.nValue, false};\n-            recipients.push_back(recipient);\n-        } else {\n+    const auto& tx_outs = outputs.empty() ? wtx.tx->vout : outputs;\n+    for (size_t i = 0; i < tx_outs.size(); ++i) {\n+        const CTxOut& output = tx_outs.at(i);\n+        if ((reduce_output.has_value() ?  reduce_output.value() == i : OutputIsChange(wallet, output))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140734813",
      "id" : 1140734813,
      "line" : 252,
      "node_id" : "PRRC_kwDOABII585D_jtd",
      "original_commit_id" : "ffc4389022133b31918f3768aeebc714cd87e459",
      "original_line" : 252,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : 41,
      "pull_request_review_id" : 1346764360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140734813/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T22:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140734813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140761441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140761441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There still is a problem with this approach when the user sets a value for the single output.\r\n\r\nBasically, the user provided value is being discarded. We don't check if it's within the inputs amount bounds nor if need to create a change output for the remaining amount (value can be lower than the inputs amount).\r\n\r\nCurrent code instead of create a change output when the value is lower than the inputs amount, it sets the value equal to inputs total minus new fee. We should code a test for it too.\r\n\r\nThus why thought about using SFFO in 27195 to mark the output from where we want to subtract fees, so the apparent \"single output tx\" can be crafted using `CreateTransaction` instead of making an special case here.\r\n\r\nCould use that instead of using the change destination. Outputs cannot be changed if the \"reduce\" option is set.\r\n\r\nSide from that, all good about closing 27195. I made it just because it's a bug in master.",
      "commit_id" : "cac1de5aeda126880a42089294ee7ad85dbe46f0",
      "created_at" : "2023-03-17T22:15:12Z",
      "diff_hunk" : "@@ -293,21 +295,35 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // We cannot source new unconfirmed inputs(bip125 rule 2)\n     new_coin_control.m_min_depth = 1;\n \n-    constexpr int RANDOM_CHANGE_POSITION = -1;\n-    auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n-    if (!res) {\n-        errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n-        return Result::WALLET_ERROR;\n-    }\n+    if (recipients.size() > 0) {\n+        constexpr int RANDOM_CHANGE_POSITION = -1;\n+        auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n+        if (!res) {\n+            errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n+            return Result::WALLET_ERROR;\n+        }\n \n-    const auto& txr = *res;\n-    // Write back new fee if successful\n-    new_fee = txr.fee;\n+        const auto& txr = *res;\n+        // Write back new fee if successful\n+        new_fee = txr.fee;\n \n-    // Write back transaction\n-    mtx = CMutableTransaction(*txr.tx);\n+        // Write back transaction\n+        mtx = CMutableTransaction(*txr.tx);\n \n-    return Result::OK;\n+        return Result::OK;\n+    } else {\n+        // The transaction only has one output, and it is either detected as change,\n+        // or selected as the one to take the fee from.\n+        // In that case, just reduce its value to meet the new feerate.\n+        new_fee = new_coin_control.m_feerate->GetFee(maxTxSize);\n+        temp_mtx.vout[0].nValue = input_value - new_fee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140761441",
      "id" : 1140761441,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII585D_qNh",
      "original_commit_id" : "5ac20d3e7b743f261979003b48009d0aa3062e1f",
      "original_line" : 319,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : 110,
      "pull_request_review_id" : 1346764360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140761441/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T22:26:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140761441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140811067"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140811067"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, I see. Actually I've decided to just rebase this PR on top of #27195 and drop the single output exception commit, although I've kept the test.",
      "commit_id" : "c773ecf81160721021b352f612b913f40ddac859",
      "created_at" : "2023-03-17T23:19:23Z",
      "diff_hunk" : "@@ -293,21 +295,35 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // We cannot source new unconfirmed inputs(bip125 rule 2)\n     new_coin_control.m_min_depth = 1;\n \n-    constexpr int RANDOM_CHANGE_POSITION = -1;\n-    auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n-    if (!res) {\n-        errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n-        return Result::WALLET_ERROR;\n-    }\n+    if (recipients.size() > 0) {\n+        constexpr int RANDOM_CHANGE_POSITION = -1;\n+        auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n+        if (!res) {\n+            errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n+            return Result::WALLET_ERROR;\n+        }\n \n-    const auto& txr = *res;\n-    // Write back new fee if successful\n-    new_fee = txr.fee;\n+        const auto& txr = *res;\n+        // Write back new fee if successful\n+        new_fee = txr.fee;\n \n-    // Write back transaction\n-    mtx = CMutableTransaction(*txr.tx);\n+        // Write back transaction\n+        mtx = CMutableTransaction(*txr.tx);\n \n-    return Result::OK;\n+        return Result::OK;\n+    } else {\n+        // The transaction only has one output, and it is either detected as change,\n+        // or selected as the one to take the fee from.\n+        // In that case, just reduce its value to meet the new feerate.\n+        new_fee = new_coin_control.m_feerate->GetFee(maxTxSize);\n+        temp_mtx.vout[0].nValue = input_value - new_fee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140811067",
      "id" : 1140811067,
      "in_reply_to_id" : 1140761441,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D_2U7",
      "original_commit_id" : "5ac20d3e7b743f261979003b48009d0aa3062e1f",
      "original_line" : 319,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : null,
      "pull_request_review_id" : 1346825386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140811067/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T23:19:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140811067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140812610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140812610"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "c773ecf81160721021b352f612b913f40ddac859",
      "created_at" : "2023-03-17T23:20:32Z",
      "diff_hunk" : "@@ -234,14 +246,16 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // is one). If outputs vector is non-empty, replace original\n     // outputs with its contents, otherwise use original outputs.\n     std::vector<CRecipient> recipients;\n-    for (const auto& output : outputs.empty() ? wtx.tx->vout : outputs) {\n-        if (!OutputIsChange(wallet, output)) {\n-            CRecipient recipient = {output.scriptPubKey, output.nValue, false};\n-            recipients.push_back(recipient);\n-        } else {\n+    const auto& tx_outs = outputs.empty() ? wtx.tx->vout : outputs;\n+    for (size_t i = 0; i < tx_outs.size(); ++i) {\n+        const CTxOut& output = tx_outs.at(i);\n+        if ((reduce_output.has_value() ?  reduce_output.value() == i : OutputIsChange(wallet, output))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1140812610",
      "id" : 1140812610,
      "in_reply_to_id" : 1140734813,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D_2tC",
      "original_commit_id" : "ffc4389022133b31918f3768aeebc714cd87e459",
      "original_line" : 252,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : null,
      "pull_request_review_id" : 1346826486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140812610/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T23:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140812610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1144191381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144191381"
         }
      },
      "author_association" : "MEMBER",
      "body" : "k, either way is fine for me. Cool about the special case exception removal and the new test.\r\njust updated 27195 with further tests too.",
      "commit_id" : "c773ecf81160721021b352f612b913f40ddac859",
      "created_at" : "2023-03-22T03:24:26Z",
      "diff_hunk" : "@@ -293,21 +295,35 @@ Result CreateRateBumpTransaction(CWallet& wallet, const uint256& txid, const CCo\n     // We cannot source new unconfirmed inputs(bip125 rule 2)\n     new_coin_control.m_min_depth = 1;\n \n-    constexpr int RANDOM_CHANGE_POSITION = -1;\n-    auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n-    if (!res) {\n-        errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n-        return Result::WALLET_ERROR;\n-    }\n+    if (recipients.size() > 0) {\n+        constexpr int RANDOM_CHANGE_POSITION = -1;\n+        auto res = CreateTransaction(wallet, recipients, RANDOM_CHANGE_POSITION, new_coin_control, false);\n+        if (!res) {\n+            errors.push_back(Untranslated(\"Unable to create transaction.\") + Untranslated(\" \") + util::ErrorString(res));\n+            return Result::WALLET_ERROR;\n+        }\n \n-    const auto& txr = *res;\n-    // Write back new fee if successful\n-    new_fee = txr.fee;\n+        const auto& txr = *res;\n+        // Write back new fee if successful\n+        new_fee = txr.fee;\n \n-    // Write back transaction\n-    mtx = CMutableTransaction(*txr.tx);\n+        // Write back transaction\n+        mtx = CMutableTransaction(*txr.tx);\n \n-    return Result::OK;\n+        return Result::OK;\n+    } else {\n+        // The transaction only has one output, and it is either detected as change,\n+        // or selected as the one to take the fee from.\n+        // In that case, just reduce its value to meet the new feerate.\n+        new_fee = new_coin_control.m_feerate->GetFee(maxTxSize);\n+        temp_mtx.vout[0].nValue = input_value - new_fee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#discussion_r1144191381",
      "id" : 1144191381,
      "in_reply_to_id" : 1140761441,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EMvmV",
      "original_commit_id" : "5ac20d3e7b743f261979003b48009d0aa3062e1f",
      "original_line" : 319,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/wallet/feebumper.cpp",
      "position" : null,
      "pull_request_review_id" : 1351665708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26467",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144191381/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-22T03:24:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144191381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-15T13:12:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1509819974",
      "id" : 1509819974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585Z_gZG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509819974/reactions"
      },
      "updated_at" : "2023-04-15T13:12:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509819974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-01T12:52:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26467#issuecomment-1529680286",
      "id" : 1529680286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26467",
      "node_id" : "IC_kwDOABII585bLRGe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529680286/reactions"
      },
      "updated_at" : "2023-05-01T12:52:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529680286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
