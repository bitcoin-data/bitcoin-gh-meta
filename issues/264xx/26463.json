{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\n\r\n<!-- Describe the issue -->\r\n\r\nI am loading descriptors into bitcoind using the rpcclient with the function: `importdescriptors`, it automatically starts rescanning the blockchain. Now when I try to unload the wallet, bitcoin-cli will allow me to do it (wallet disappears from the `listwallet` section, but it will not abort the rescan. Thats a problem bc now when trying to reload the wallet, the wallet sqlite db is locked by bitcoind and this wallet is unusable unitl the rescan is over. `abortrescan` will not work bc the wallet is not loaded anymore according to `bitcoin-cli listwallets`. The only solution for me was to delete the wallet dir and create a new wallet with the same name. Now everything works as expected, but as soon as I want to unload the wallet again, bitcoind crashes\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\nThe `unloadwallet` function should internally abort the rescan and unload the wallet, so that it can be reloaded afterwards without waiting for the rescan. Or it should fail and leading the user to abort the rescan with `abortrescan`\r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\n* Create a descriptor wallet\r\n* Import a descriptor and unload the walllet while bitcoind is still rescanning\r\n* Now you are stuck bc abortrescan will not work bc wallet is not loaded and the only solution is to delete the wallet dir\r\n* Now Create a new wallet with the same name and import the descriptors again. When the wallet is faster synced then the old process still syncing, and you unload the wallet, bitcoind crashes\r\n\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\n` Linux 5.10.103-v8+ #1529 SMP PREEMPT Tue Mar 8 12:26:46 GMT 2022 aarch64 GNU/Linux`\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\nbitcoind v.23.0 (release binary for raspberry pi)\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\n<!-- GUI-related issue? What is your operating system and its version? If Linux, what is your desktop environment and graphical shell? -->\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n",
   "closed_at" : "2023-01-09T21:57:05Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26463/comments",
   "created_at" : "2022-11-06T15:37:17Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26463/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/26463",
   "id" : 1437445233,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26463/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585Vraxx",
   "number" : 26463,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26463/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26463/timeline",
   "title" : "[wallet] when unloading a wallet which still rescans the wallet, the command should fail but bitcoind gets in a buggy state",
   "updated_at" : "2023-01-09T21:57:05Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26463",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/90319354?v=4",
      "events_url" : "https://api.github.com/users/ziggie1984/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ziggie1984/followers",
      "following_url" : "https://api.github.com/users/ziggie1984/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ziggie1984/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ziggie1984",
      "id" : 90319354,
      "login" : "ziggie1984",
      "node_id" : "MDQ6VXNlcjkwMzE5MzU0",
      "organizations_url" : "https://api.github.com/users/ziggie1984/orgs",
      "received_events_url" : "https://api.github.com/users/ziggie1984/received_events",
      "repos_url" : "https://api.github.com/users/ziggie1984/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ziggie1984/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ziggie1984/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ziggie1984"
   }
}
