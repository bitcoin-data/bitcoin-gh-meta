[
   {
      "author_association" : "MEMBER",
      "body" : "Taproot keys are tweaked, even when there is no script present. That means that the pubkey used in the scriptPubKey isn't actually a wallet key. The signing logic corrects for the tweak at signing time.",
      "created_at" : "2022-04-11T00:46:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24822#issuecomment-1094430469",
      "id" : 1094430469,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24822",
      "node_id" : "IC_kwDOABII585BO68F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094430469/reactions"
      },
      "updated_at" : "2022-04-11T00:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094430469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa thanks for your quick reply.\r\nWith the information you posted I was able to fix the script.\r\n\r\n```c++\r\nfor (auto const& [scriptPubKey, index] : m_map_script_pub_keys)\r\n    {\r\n        std::vector<std::vector<unsigned char>> solutions;\r\n        TxoutType whichType = Solver(scriptPubKey, solutions);\r\n\r\n        // Confirm the scriptPubKey is WITNESS_V1_TAPROOT\r\n        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\r\n            return false;\r\n        }\r\n\r\n        auto xOnlyPubKey = XOnlyPubKey(solutions[0]);\r\n\r\n        std::unique_ptr<FlatSigningProvider> coin_keys = GetSigningProvider(scriptPubKey, true);\r\n\r\n        TaprootSpendData spenddata;\r\n        coin_keys->GetTaprootSpendData(xOnlyPubKey, spenddata);\r\n\r\n        if (!coin_keys || coin_keys->keys.size() != 1) {\r\n            return false;\r\n        }\r\n\r\n        auto& key = coin_keys->keys.begin()->second;\r\n\r\n        XOnlyPubKey pubkey = XOnlyPubKey(key.GetPubKey());\r\n        auto tweakedPubkeyRet = pubkey.CreateTapTweak(spenddata.merkle_root.IsNull() ? nullptr : &spenddata.merkle_root);\r\n\r\n        if (!tweakedPubkeyRet || tweakedPubkeyRet->first == pubkey) {\r\n            std::cout << \"tweak failed\" << std::endl;\r\n            return false;\r\n        }\r\n\r\n        XOnlyPubKey tweakedPubkey = tweakedPubkeyRet->first;\r\n\r\n        auto destScriptPubKey = GetScriptForDestination(WitnessV1Taproot(tweakedPubkey));\r\n        CTxDestination address;\r\n        ExtractDestination(destScriptPubKey, address);\r\n\r\n        CTxDestination address2;\r\n        ExtractDestination(scriptPubKey, address2);\r\n\r\n        std::cout << \"---> \" << index  << std::endl;\r\n        std::cout << \"---> address from PrivKey              : \" << EncodeDestination(address) << std::endl;\r\n        std::cout << \"---> address from m_map_script_pub_keys: \" << EncodeDestination(address2) << std::endl;\r\n    }\r\n```\r\n\r\nResults:\r\n```bash\r\n---> 827\r\n---> address from PrivKey              : bcrt1plmy7d5h7unq0w9e9crqmqmztnz29pnmz8j6jaw7hpm4fqt0wv59q0q4zlq\r\n---> address from m_map_script_pub_keys: bcrt1plmy7d5h7unq0w9e9crqmqmztnz29pnmz8j6jaw7hpm4fqt0wv59q0q4zlq\r\n---> 524\r\n---> address from PrivKey              : bcrt1plmv07yph7cpdylv74vxk8mqhmplrv9hucgsztggmyc00t5dz677sue0wcc\r\n---> address from m_map_script_pub_keys: bcrt1plmv07yph7cpdylv74vxk8mqhmplrv9hucgsztggmyc00t5dz677sue0wcc\r\n---> 668\r\n---> address from PrivKey              : bcrt1playljc8rhyjm0d572r405tfj3g3nfxawuqerzcke6l00f0nfmy3qgrdx86\r\n---> address from m_map_script_pub_keys: bcrt1playljc8rhyjm0d572r405tfj3g3nfxawuqerzcke6l00f0nfmy3qgrdx86\r\n---> 196\r\n---> address from PrivKey              : bcrt1pla0z8qefr0ngu7t2hx08l49j64whh60yjm6edkel5y9dln3uzxls0w2tlh\r\n---> address from m_map_script_pub_keys: bcrt1pla0z8qefr0ngu7t2hx08l49j64whh60yjm6edkel5y9dln3uzxls0w2tlh\r\n```",
      "created_at" : "2022-04-11T02:58:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24822#issuecomment-1094492159",
      "id" : 1094492159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24822",
      "node_id" : "IC_kwDOABII585BPJ__",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094492159/reactions"
      },
      "updated_at" : "2022-04-11T02:58:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094492159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   }
]
