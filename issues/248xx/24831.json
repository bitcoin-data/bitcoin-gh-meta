{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "We recently added a [`clang-tidy` job](https://github.com/bitcoin/bitcoin/blob/master/ci/test/00_setup_env_native_tidy.sh) to the CI, which generates a compilation database. We can leverage that now existing database to begin running [include-what-you-use](https://include-what-you-use.org/) over the codebase.\r\n\r\nThis PR demonstrates a few things:\r\n\r\nUsing a mapping_file to indicate fixups / includes that may differ from IWYU suggestions. In this case, I've added some fixups for glibc includes that I've [upstreamed changes for](https://github.com/include-what-you-use/include-what-you-use/pull/1026):\r\n```bash\r\n# Fixups / upstreamed changes\r\n[\r\n  { include: [ \"<bits/termios-c_lflag.h>\", private, \"<termios.h>\", public ] },\r\n  { include: [ \"<bits/termios-struct.h>\", private, \"<termios.h>\", public ] },\r\n  { include: [ \"<bits/termios-tcflow.h>\", private, \"<termios.h>\", public ] },\r\n]\r\n```\r\n\r\nUsing a pragma to indicate that we want to keep an include (even if this might not actually be the case). i.e:\r\n```cpp\r\n#if defined(HAVE_CONFIG_H)\r\n#include <config/bitcoin-config.h> // IWYU pragma: keep\r\n#endif\r\n```\r\n\r\nThe include \"fixing\" commit of this PR:\r\n* Adds missing includes.\r\n* Swaps C headers for their C++ counterparts.\r\n* Removes the pointless / unmaintainable `//for abc, xyz` comments. When usingIWYU, if anyone wants to see / generate those comments, to see why something is included, it is trivial to do so (IWYU outputs them by default). i.e:\r\n```cpp\r\n// The full include-list for compat/stdin.cpp:\r\n#include <compat/stdin.h>\r\n#include <config/bitcoin-config.h>\r\n#include <poll.h>                  // for poll, pollfd, POLLIN\r\n#include <termios.h>               // for tcgetattr, tcsetattr\r\n#include <unistd.h>                // for isatty, STDIN_FILENO\r\n```\r\n\r\nTODO:\r\n- [ ] Qt mapping_file. There is one in the IWYU repo, but it's for Qt 5.11. Needs testing.\r\n- [ ] Boost mapping_file. There is one in the IWYU repo, but it's for Boost 1.75. Needs testing.\r\n\r\nI'm not suggesting we turn this on the for entire codebase, or immediately go-nuts refactoring all includes. However I think our dependency includes are now slim enough, and our CI infrastructure in place such that we can start doing this in some capacity, and just automate away include fixups / refactorings etc.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24831/comments",
   "created_at" : "2022-04-12T10:32:23Z",
   "draft" : true,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24831/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/24831",
   "id" : 1201633359,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24831/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII5842Fzqm",
   "number" : 24831,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/24831.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24831",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/24831.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24831"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24831/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24831/timeline",
   "title" : "[POC] tidy: add include-what-you-use",
   "updated_at" : "2022-04-12T10:38:18Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24831",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   }
}
