[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Xekyo](https://github.com/bitcoin/bitcoin/pull/24845#pullrequestreview-1346690032), [achow101](https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1474452399), [S3RK](https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1480768733) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25665](https://github.com/bitcoin/bitcoin/pull/25665) (refactor: Add util::Result failure values, multiple error and warning messages by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-04-14T11:32:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1099093626",
      "id" : 1099093626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585BgtZ6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099093626/reactions"
      },
      "updated_at" : "2023-03-23T08:23:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099093626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850797804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850797804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8 \"introduce OperationResult and CallResult classes\"\r\n\r\nnit: missing newline",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T20:55:31Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult\n+{\n+private:\n+    bool m_res{false};\n+    std::optional<bilingual_str> m_error{std::nullopt};\n+\n+public:\n+    OperationResult(bool _res, const bilingual_str& _error) : m_res(_res), m_error(_error) { }\n+    OperationResult(bool _res) : m_res(_res) { }\n+\n+    bilingual_str getError() const { return (m_error ? *m_error : bilingual_str()); }\n+    bool getRes() const { return m_res; }\n+    explicit operator bool() const { return m_res; }\n+};\n+\n+inline OperationResult errorOut(const bilingual_str& errorStr)\n+{\n+    return OperationResult(false, errorStr);\n+}\n+\n+\n+template <class T>\n+class CallResult : public OperationResult\n+{\n+private:\n+    std::optional<T> m_obj_res{std::nullopt};\n+public:\n+    CallResult() : OperationResult(false) {}\n+    CallResult(T _obj) : OperationResult(true), m_obj_res(_obj) { }\n+    CallResult(const bilingual_str& error) : OperationResult(false, error) { }\n+    const std::optional<T>& getObjResult() const { return m_obj_res; }\n+};\n+\n+\n+#endif // BITCOIN_OPERATIONRESULT_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850797804",
      "id" : 850797804,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII584ytiTs",
      "original_commit_id" : "7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8",
      "original_line" : 44,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/operationresult.h",
      "position" : 44,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850797804/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850797804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850799951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850799951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8 \"introduce OperationResult and CallResult classes\"\r\n\r\nnit: We prefer to use UpperCamelCase for function names. (here and elsewhere)",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T20:58:53Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult\n+{\n+private:\n+    bool m_res{false};\n+    std::optional<bilingual_str> m_error{std::nullopt};\n+\n+public:\n+    OperationResult(bool _res, const bilingual_str& _error) : m_res(_res), m_error(_error) { }\n+    OperationResult(bool _res) : m_res(_res) { }\n+\n+    bilingual_str getError() const { return (m_error ? *m_error : bilingual_str()); }\n+    bool getRes() const { return m_res; }\n+    explicit operator bool() const { return m_res; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850799951",
      "id" : 850799951,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII584yti1P",
      "original_commit_id" : "7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : 20,
      "path" : "src/operationresult.h",
      "position" : 22,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850799951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 20,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850799951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850803298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850803298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c2ec6661cbb70a388dc67d6b4b47f2ab49b99418 \"wallet: make SelectCoins return a CallResult.\"\r\n\r\nnit: We prefer snake_case for new variables. (here and elsewhere)",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T21:04:23Z",
      "diff_hunk" : "@@ -566,15 +566,18 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vec\n             }\n         }\n         // Coin Selection failed.\n-        return std::optional<SelectionResult>();\n+        return CallResult<SelectionResult>();\n     }();\n \n-    if (!res) return std::nullopt;\n+    if (!res) {\n+        return res;\n+    }\n \n     // Add preset inputs to result\n-    res->AddInput(preset_inputs);\n+    auto resMerged = *res.getObjResult();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850803298",
      "id" : 850803298,
      "line" : 606,
      "node_id" : "PRRC_kwDOABII584ytjpi",
      "original_commit_id" : "c2ec6661cbb70a388dc67d6b4b47f2ab49b99418",
      "original_line" : 577,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 95,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850803298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850803298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850813353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850813353"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c8a43eca7c4081f8ca87be1befbbcdbfdc798a10 \"send: return proper error message for too-long-mempool-chain failure.\"\r\n\r\nI'm not a huge fan of doing all of the coin selection computation just to immediately throw away the result. It seems like there should be a better way to do this, e.g. by changing how we fill `vCoins` to be guaranteed to have a solution at this point iff long chain utxos are included.",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T21:21:52Z",
      "diff_hunk" : "@@ -557,12 +557,15 @@ CallResult<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector\n             // Try with unlimited ancestors/descendants. The transaction will still need to meet\n             // mempool ancestor/descendant policy to be accepted to mempool and broadcasted, but\n             // OutputGroups use heuristics that may overestimate ancestor/descendant counts.\n-            if (!fRejectLongChains) {\n-                if (auto r8{AttemptSelection(wallet, value_to_select,\n-                                      CoinEligibilityFilter(0, 1, std::numeric_limits<uint64_t>::max(), std::numeric_limits<uint64_t>::max(), true /* include_partial_groups */),\n-                                      vCoins, coin_selection_params)}) {\n-                    return r8;\n+            if (auto r8{AttemptSelection(wallet, value_to_select,\n+                                         CoinEligibilityFilter(0, 1, std::numeric_limits<uint64_t>::max(), std::numeric_limits<uint64_t>::max(), true /* include_partial_groups */),\n+                                         vCoins, coin_selection_params)}) {\n+                if (fRejectLongChains) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850813353",
      "id" : 850813353,
      "line" : 589,
      "node_id" : "PRRC_kwDOABII584ytmGp",
      "original_commit_id" : "c8a43eca7c4081f8ca87be1befbbcdbfdc798a10",
      "original_line" : 563,
      "original_position" : 12,
      "original_start_line" : 560,
      "path" : "src/wallet/spend.cpp",
      "position" : 12,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850813353/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850813353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850814403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850814403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 30feca7b374256ff62443b2e2f1c65dfa49bb083 \"send: move wallet CreateTransaction* flow to use OperationResult/CallResult.\"\r\n\r\nI don't think this needs to be an `OperationResult`. It really can be `CallResult<CTransactionRef>`. The original really should have just returned `CTransactionRef` anyways.",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T21:23:51Z",
      "diff_hunk" : "@@ -651,13 +651,12 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n-static bool CreateTransactionInternal(\n+static OperationResult CreateTransactionInternal(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850814403",
      "id" : 850814403,
      "line" : 686,
      "node_id" : "PRRC_kwDOABII584ytmXD",
      "original_commit_id" : "30feca7b374256ff62443b2e2f1c65dfa49bb083",
      "original_line" : 654,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 5,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850814403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850814403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r851340834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851340834"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "hmm yeah, nice point. Will cook something for it.",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-15T15:43:43Z",
      "diff_hunk" : "@@ -557,12 +557,15 @@ CallResult<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector\n             // Try with unlimited ancestors/descendants. The transaction will still need to meet\n             // mempool ancestor/descendant policy to be accepted to mempool and broadcasted, but\n             // OutputGroups use heuristics that may overestimate ancestor/descendant counts.\n-            if (!fRejectLongChains) {\n-                if (auto r8{AttemptSelection(wallet, value_to_select,\n-                                      CoinEligibilityFilter(0, 1, std::numeric_limits<uint64_t>::max(), std::numeric_limits<uint64_t>::max(), true /* include_partial_groups */),\n-                                      vCoins, coin_selection_params)}) {\n-                    return r8;\n+            if (auto r8{AttemptSelection(wallet, value_to_select,\n+                                         CoinEligibilityFilter(0, 1, std::numeric_limits<uint64_t>::max(), std::numeric_limits<uint64_t>::max(), true /* include_partial_groups */),\n+                                         vCoins, coin_selection_params)}) {\n+                if (fRejectLongChains) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r851340834",
      "id" : 851340834,
      "in_reply_to_id" : 850813353,
      "line" : 589,
      "node_id" : "PRRC_kwDOABII584yvm4i",
      "original_commit_id" : "c8a43eca7c4081f8ca87be1befbbcdbfdc798a10",
      "original_line" : 563,
      "original_position" : 12,
      "original_start_line" : 560,
      "path" : "src/wallet/spend.cpp",
      "position" : 12,
      "pull_request_review_id" : 943511008,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851340834/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-15T15:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851340834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hey, thanks for the review @achow101.\r\n\r\n> The last 2 commits should be dropped from this PR and a new PR for each one opened. They are orthogonal to the main changes here.\r\n\r\nSounds good, will move them to their own PRs. I added them here basically because I wasn't totally happy with the extra wasted computation neither, so.. thought on other ways to speed up the process.\r\n\r\n---\r\nWill tackle the code styling changes as well ð.\r\n",
      "created_at" : "2022-04-15T15:50:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1100190834",
      "id" : 1100190834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585Bk5Ry",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1100190834/reactions"
      },
      "updated_at" : "2022-04-15T15:50:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1100190834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r853350249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853350249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b2846445135f6d6b7902672cb2202dc75088a200 \"wallet: add CoinControl filtering capabilities for coins that exceed mempool restrictions.\"\r\n\r\nnit: For new variables, we prefer snake_case, without the prefix for type. So this could be just `unconf_coins`.",
      "commit_id" : "fbc130aaf6f34240d7177808789707bd68d1c38d",
      "created_at" : "2022-04-19T18:03:23Z",
      "diff_hunk" : "@@ -83,7 +83,14 @@ TxSize CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *walle\n     return CalculateMaximumSignedTxSize(tx, wallet, txouts, coin_control);\n }\n \n-void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount)\n+void AvailableCoins(const CWallet& wallet,\n+                    std::vector<COutput>& vCoins,\n+                    const CCoinControl* coinControl,\n+                    const CAmount& nMinimumAmount,\n+                    const CAmount& nMaximumAmount,\n+                    const CAmount& nMinimumSumAmount,\n+                    const uint64_t nMaximumCount,\n+                    std::vector<COutput>* vUnconfCoins)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r853350249",
      "id" : 853350249,
      "line" : 93,
      "node_id" : "PRRC_kwDOABII584y3Rdp",
      "original_commit_id" : "b2846445135f6d6b7902672cb2202dc75088a200",
      "original_line" : 93,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 12,
      "pull_request_review_id" : 946103262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853350249/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T18:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853350249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "kk, done both. You caught me doing some further changes.\r\n\r\nHave re-coded the mempool ancestors/descendants cache differently, much cleaner and less intrusive. It's now integrated into the available coin information (the changes are quite small now, it shouldn't require another PR for it but let me know what you think achow101).\r\n\r\nPlus cleaned the `CreateTransaction` changes a bit more.",
      "created_at" : "2022-04-19T21:19:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1103184961",
      "id" : 1103184961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585BwURB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103184961/reactions"
      },
      "updated_at" : "2022-04-19T21:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103184961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "You can explain more to me what's going on and what exactly you did\n\n\nwt., 19 kwi 2022, 23:19 uÅ¼ytkownik Matias Furszyfer <\n***@***.***> napisaÅ:\n\n> kk, done both. You caught me doing some further changes.\n>\n> Have re-coded the mempool ancestors/descendants cache differently, much\n> cleaner and less intrusive. It's now integrated into the available coin\n> information (the changes are quite small now, it shouldn't require another\n> PR for it but let me know what you think achow101).\n>\n> Plus cleaned the CreateTransaction changes a bit more.\n>\n> â\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1103184961>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AWTHVFRFNWKAJZX4ES4TCK3VF4PPJANCNFSM5TLGUZWQ>\n> .\n> You are receiving this because you are subscribed to this thread.Message\n> ID: ***@***.***>\n>\n",
      "created_at" : "2022-04-21T22:32:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1105825291",
      "id" : 1105825291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585B6Y4L",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1105825291/reactions"
      },
      "updated_at" : "2022-04-21T22:32:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1105825291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94796438?v=4",
         "events_url" : "https://api.github.com/users/Szatan181/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Szatan181/followers",
         "following_url" : "https://api.github.com/users/Szatan181/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Szatan181/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Szatan181",
         "id" : 94796438,
         "login" : "Szatan181",
         "node_id" : "U_kgDOBaZ6lg",
         "organizations_url" : "https://api.github.com/users/Szatan181/orgs",
         "received_events_url" : "https://api.github.com/users/Szatan181/received_events",
         "repos_url" : "https://api.github.com/users/Szatan181/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Szatan181/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Szatan181/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Szatan181"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Aside from achow101 review changes, the first part:\r\n>Have re-coded the mempool ancestors/descendants cache differently, much cleaner and less intrusive. It's now integrated into the available coin information\r\n\r\nWas the move from fbc130aa to d9b8ea6 because now the ancestors and descendants count is available inside `COutput`. Which simplified the changes greatly.\r\n\r\nAnd the second part was an unification for 76aa7d05 of the previous two `emplace_back` calls into a single one inside `AvailableCoins` and moving the ancestors/descendants getter call after the basic checks.",
      "created_at" : "2022-04-22T00:00:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1105867388",
      "id" : 1105867388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585B6jJ8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1105867388/reactions"
      },
      "updated_at" : "2022-04-22T00:19:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1105867388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r856423403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856423403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In f198d27ef7f80b6b1c03f388eae216402f1ff424 \"introduce OperationResult and CallResult classes\"\r\n\r\nSince `OperationResult` is only used by `CallResult` now, what do you think about consolidating the two classes?",
      "commit_id" : "d9b8ea62df884b0a0bca4b152f25c031de9c68d2",
      "created_at" : "2022-04-22T17:11:37Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r856423403",
      "id" : 856423403,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII584zC_vr",
      "original_commit_id" : "f198d27ef7f80b6b1c03f388eae216402f1ff424",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/operationresult.h",
      "position" : 10,
      "pull_request_review_id" : 950369220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856423403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T17:11:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856423403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r856423499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856423499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In f198d27ef7f80b6b1c03f388eae216402f1ff424 \"introduce OperationResult and CallResult classes\"\r\n\r\nThis function is no longer used.",
      "commit_id" : "d9b8ea62df884b0a0bca4b152f25c031de9c68d2",
      "created_at" : "2022-04-22T17:11:49Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult\n+{\n+private:\n+    bool m_res{false};\n+    std::optional<bilingual_str> m_error{std::nullopt};\n+\n+public:\n+    OperationResult(bool _res, const bilingual_str& _error) : m_res(_res), m_error(_error) { }\n+    OperationResult(bool _res) : m_res(_res) { }\n+\n+    bilingual_str GetError() const { return (m_error ? *m_error : bilingual_str()); }\n+    bool GetRes() const { return m_res; }\n+    explicit operator bool() const { return m_res; }\n+};\n+\n+inline OperationResult ErrorOut(const bilingual_str& error_str)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r856423499",
      "id" : 856423499,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584zC_xL",
      "original_commit_id" : "f198d27ef7f80b6b1c03f388eae216402f1ff424",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/operationresult.h",
      "position" : 25,
      "pull_request_review_id" : 950369220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856423499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T17:11:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856423499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The first 3 commits are fine (besides the comments I left above), but I'm still not sure that this is the correct approach to adding the error message. It seems like it's a ton of added complexity to have the second vector just to be able to say whether the result would have a too long mempool chain.",
      "created_at" : "2022-04-22T18:50:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1106773401",
      "id" : 1106773401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585B-AWZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1106773401/reactions"
      },
      "updated_at" : "2022-04-22T18:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1106773401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r856502567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856502567"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I left it because we can make use of it in other functions that only return a bool and the error string without the extra object. Like for example `CConnman::BindListenPort`, `Chain::broadcastTransaction` and `CWallet::SubmitTxMemoryPoolAndRelay`, `BerkeleyEnvironment::Open`, `BerkeleyDatabase::Verify` etc.\r\n\r\nI mean, having the class available would let others use it on different PRs if they are touching any similar function signature.\r\n\r\nSaying that, if you are still against merging it without a connected use-case, can just remove it and re-introduce it later when we modify any of those functions as well (or.. make an extra small commit that connects it to one of those functions just to present the use-case for it).",
      "commit_id" : "d9b8ea62df884b0a0bca4b152f25c031de9c68d2",
      "created_at" : "2022-04-22T19:10:30Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r856502567",
      "id" : 856502567,
      "in_reply_to_id" : 856423403,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII584zDTEn",
      "original_commit_id" : "f198d27ef7f80b6b1c03f388eae216402f1ff424",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/operationresult.h",
      "position" : 10,
      "pull_request_review_id" : 950481775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856502567/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T19:10:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856502567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah.. have been thinking about it too.\r\n\r\n1) The initial proposed solution was simple but came with an extra `AttemptSelection` call.\r\n\r\n2) The second one introduced the coin control unconfirmed UTXO filtering functionality, which got us two good performance improvement:\r\n-> We no longer loop, several times, over coins that will be reject by the mempool restrictions during the whole selection process.\r\n-> And we no longer lock the mempool mutex two times per available UTXO for each of the many 'AttemptSelection/GroupOutputs' calls to get the ancestors and descendants count. Now is done only once per unconfirmed tx in the mempool.\r\n\r\n    But.. introduced that ugly extra `uncof_coins` vector to `AvailableCoins`.\r\n\r\n-----------------\r\n\r\nNow.. next step forward:\r\n\r\n3) Have removed the secondary vector, and all that extra complexity, and replaced it with a simple bool `has_long_chain_of_unconf` which can be used to notify the user about the existence of a long chain of unconfirmed transactions.\r\nThen he/she can know exactly how much unconfirmed balance has calling `getbalances` after receiving the error.\r\n\r\nThen.. the last commit is just to make the change look nicer. `AvailableCoins` now will return a `CoinsResult` struct instead of receiving the `vCoins` vector reference (which was being cleared at the beginning of the method anyway).",
      "created_at" : "2022-04-22T21:21:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1106876454",
      "id" : 1106876454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585B-Zgm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1106876454/reactions"
      },
      "updated_at" : "2022-04-25T13:02:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1106876454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The last 2 commits should be dropped from this PR and a new PR for each one opened. They are orthogonal to the main changes here.\r\n\r\nJust dropped the only_spendable `CoinControl` filter option commit. Will open a new PR for it next week.",
      "created_at" : "2022-04-23T01:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1107138113",
      "id" : 1107138113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585B_ZZB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1107138113/reactions"
      },
      "updated_at" : "2022-04-23T01:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1107138113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some extra notes to check this week:\r\n\r\n- [ ] As fba930d8 + 04d8343e are moving the mempool cs lock from `SelectCoins` to `AvailableCoins` (independently from the extra locking improvements), need to check whether that has any impact on the other `AvailableCoins` function callers (not only the `CreateTransaction*` flow that already know that is fine). Because now they can be locking the mempool cs when before they were not doing it. So.. in other words, sanity check over the mutexes locking order for callers that aren't part of the flow being changed here.\r\n\r\n------\r\n\r\nThen another possible path that I'm thinking if there is not enough quorum over the changes here is move the new mempool info cache and coin control filtering capabilities to a follow-up PR and add here a straightforward, but slower and redundant, approach like:\r\n\r\n Loop over the available coins inside `CreateTransactionInternal` if the `SelectCoins` call fails to basically get the mempool info on-demand and check if there is any long-chain coin before returning the generic \"Insufficient funds\" error.\r\n\r\nWhich will correct the base problem that this PR is aiming to fix without adding the other stuff. Then, moving forward, can push the other improvements on independent PRs so they can be discussed atomically.",
      "created_at" : "2022-04-25T14:07:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1108625264",
      "id" : 1108625264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585CFEdw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108625264/reactions"
      },
      "updated_at" : "2022-04-25T16:54:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108625264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-26T18:42:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1110131171",
      "id" : 1110131171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585CK0Hj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110131171/reactions"
      },
      "updated_at" : "2022-04-26T18:42:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110131171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-17T12:06:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1128786008",
      "id" : 1128786008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585DR-hY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1128786008/reactions"
      },
      "updated_at" : "2022-05-17T12:06:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1128786008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Instead of having all of this mempool policy lookup stuff, what if we instead just had `GroupOutputs` produce all of the sets of `OutputGroup`s that we will end up using during coin selection? Then each filtered set of groups would be passed in for each `AttemptSelection`. This way, we could also pre-calculate the total value available for a given set of groups and skip `AttemptSelection`s when there is clearly not enough value for that group set. This would also let us get the too-long-mempool-chain error as we could see whether the group set that allows the long mempool chains would have enough value to potentially reach a solution.\r\n\r\nA downside of this approach would be the memory use. This would end up consuming a lot more memory as we would be making all of the group sets for each `SelectCoins` rather than for each `AttemptSelection`. However we may be able to work around that by using references, but we have to be careful as some of the coin selection algorithms modify the group set that they are given.",
      "created_at" : "2022-05-18T17:45:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1130310321",
      "id" : 1130310321,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585DXyqx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1130310321/reactions"
      },
      "updated_at" : "2022-05-18T17:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1130310321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm yeah, that is an interesting idea, great achow101 ðð¼. Will be working on it :).",
      "created_at" : "2022-05-25T20:30:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1137818561",
      "id" : 1137818561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585D0bvB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1137818561/reactions"
      },
      "updated_at" : "2022-05-25T20:30:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1137818561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Small update here:\r\nNow that #25218 was merged, the next step for this is #25685 which restructures the coin selection area further.\r\n\r\nStill, meanwhile, will be pushing the new outputs grouping changes in the coming days. Need to add proper test coverage for it first, and.. will try to decouple them from #25685 (plus update the outdated PR description), moving forward :tractor:",
      "created_at" : "2022-07-28T13:21:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1198134320",
      "id" : 1198134320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585HahQw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198134320/reactions"
      },
      "updated_at" : "2022-07-28T14:19:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198134320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1129067658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129067658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just because these UTXOs are available it doesn't mean that including them would cover required amount.\r\n\r\nFor example let's imaging you have two coins in a wallet:\r\n- 48 BTC with 6 confirmation\r\n- 1 BTC with long unconfirmed ancestry\r\n\r\nIf you try to send 50 BTC you should get \"insufficient funds\" error, but IIUC after this PR you'll get \"Unconfirmed UTXOs are available...\" which is unrelated.",
      "commit_id" : "793d63374d1b18fecac4cc94d239a24bcd52268f",
      "created_at" : "2023-03-08T07:42:51Z",
      "diff_hunk" : "@@ -711,8 +728,18 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n                 if (HasErrorMsg(res)) res_detailed_errors.emplace_back(res);\n             }\n         }\n-        // Coin Selection failed.\n-        return res_detailed_errors.empty() ? util::Result<SelectionResult>(util::Error()) : res_detailed_errors.front();\n+\n+        // Return right away if we have a detailed error\n+        if (!res_detailed_errors.empty()) return res_detailed_errors.front();\n+\n+        // Let's check if we have long-chain of unconfirmed UTXOs in the not accepted groups\n+        for (const auto& group : not_accepted_groups) {\n+            if (group.m_ancestors >= max_ancestors)\n+                return util::Result<SelectionResult>({_(\"Unconfirmed UTXOs are available, but spending them creates a chain of transactions that will be rejected by the mempool\")});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1129067658",
      "id" : 1129067658,
      "line" : 738,
      "node_id" : "PRRC_kwDOABII585DTDSK",
      "original_commit_id" : "793d63374d1b18fecac4cc94d239a24bcd52268f",
      "original_line" : 738,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 82,
      "pull_request_review_id" : 1330097283,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129067658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-08T07:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129067658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1132459068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132459068"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah good, fixed.\r\nalso, pushed an early return if the sum of the not accepted groups decreases the available amount below the target (we simply don't have enough balance after applying the filters, so no need to run the selection algos).",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-10T14:36:46Z",
      "diff_hunk" : "@@ -711,8 +728,18 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n                 if (HasErrorMsg(res)) res_detailed_errors.emplace_back(res);\n             }\n         }\n-        // Coin Selection failed.\n-        return res_detailed_errors.empty() ? util::Result<SelectionResult>(util::Error()) : res_detailed_errors.front();\n+\n+        // Return right away if we have a detailed error\n+        if (!res_detailed_errors.empty()) return res_detailed_errors.front();\n+\n+        // Let's check if we have long-chain of unconfirmed UTXOs in the not accepted groups\n+        for (const auto& group : not_accepted_groups) {\n+            if (group.m_ancestors >= max_ancestors)\n+                return util::Result<SelectionResult>({_(\"Unconfirmed UTXOs are available, but spending them creates a chain of transactions that will be rejected by the mempool\")});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1132459068",
      "id" : 1132459068,
      "in_reply_to_id" : 1129067658,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Df_Q8",
      "original_commit_id" : "793d63374d1b18fecac4cc94d239a24bcd52268f",
      "original_line" : 738,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1334978822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132459068/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-10T14:36:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132459068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @S3RK!, feedback tackled.\r\n\r\nWe now check, and return early, if there is no enough available balance after filtering groups and before running the selection algos.",
      "created_at" : "2023-03-10T14:45:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1463907731",
      "id" : 1463907731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585XQXWT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1463907731/reactions"
      },
      "updated_at" : "2023-03-10T14:45:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1463907731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-17T22:10:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1474452399",
      "id" : 1474452399,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585X4luv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1474452399/reactions"
      },
      "updated_at" : "2023-03-17T22:10:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1474452399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1141752785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1141752785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "1) I think this should respect `fRejectLongChains` flag. If user explicitly asked us to ignore long-chain constraints, then we should respect that.\r\n\r\n2) If `fRejectLongChains` flag is set (the default) then the most lenient filter has `max_ancestors/2` and `max_descendants/2`. So this condition could never be hit.\r\n\r\nIn summary I don't yet understand how one can hit the error described in #23144",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-20T08:10:59Z",
      "diff_hunk" : "@@ -692,7 +708,24 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n         }\n \n         // Group outputs and map them by coin eligibility filter\n-        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters);\n+        std::vector<OutputGroup> discarded_groups;\n+        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters, discarded_groups);\n+\n+        // Check if we still have enough balance after applying filters (some coins might be discarded)\n+        CAmount total_discarded = 0;\n+        CAmount total_unconf_long_chain = 0;\n+        for (const auto& group : discarded_groups) {\n+            total_discarded += group.GetSelectionAmount();\n+            if (group.m_ancestors >= max_ancestors || group.m_descendants >= max_descendants) total_unconf_long_chain += group.GetSelectionAmount();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1141752785",
      "id" : 1141752785,
      "line" : 719,
      "node_id" : "PRRC_kwDOABII585EDcPR",
      "original_commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "original_line" : 719,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1347985901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1141752785/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T08:11:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1141752785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1142580308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142580308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> 1. I think this should respect `fRejectLongChains` flag. If user explicitly asked us to ignore long-chain constraints, then we should respect that.\r\n\r\nIt's being respected:\r\nIf the user asked to ignore long-chain constraint (`fRejectLongChains=false`) the last filter include the coins, which means that they aren't discarded, so the `discarded_groups` vector is empty, so `total_unconf_long_chain` is zero, so the error is never hit.\r\n\r\n> 2. If `fRejectLongChains` flag is set (the default) then the most lenient filter has `max_ancestors/2` and `max_descendants/2`. So this condition could never be hit.\r\n\r\nAt the contraire, the unconfirmed coins are inside the `available_coins` struct (the user sees them as spendable), and because of the not inclusion of the last filter (due the `fRejectLongChains=true` flag), they are excluded from the created output groups and included inside the discarded groups vector, which is the one used to hit this condition.\r\n\r\n> In summary I don't yet understand how one can hit the error described in #23144\r\n\r\nThink in this way:\r\n\r\nIf the wallet reject long chains (default), the process discard coins that the user sees as spendable and tries to find a result with the remaining ones. Returning an \"Insufficient Funds\" if it's not found.\r\nThe \"discarded groups\" vector basically represents that. Coin Selection excluded coins seen as spendable by the user.\r\n",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-20T19:19:12Z",
      "diff_hunk" : "@@ -692,7 +708,24 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n         }\n \n         // Group outputs and map them by coin eligibility filter\n-        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters);\n+        std::vector<OutputGroup> discarded_groups;\n+        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters, discarded_groups);\n+\n+        // Check if we still have enough balance after applying filters (some coins might be discarded)\n+        CAmount total_discarded = 0;\n+        CAmount total_unconf_long_chain = 0;\n+        for (const auto& group : discarded_groups) {\n+            total_discarded += group.GetSelectionAmount();\n+            if (group.m_ancestors >= max_ancestors || group.m_descendants >= max_descendants) total_unconf_long_chain += group.GetSelectionAmount();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1142580308",
      "id" : 1142580308,
      "in_reply_to_id" : 1141752785,
      "line" : 719,
      "node_id" : "PRRC_kwDOABII585EGmRU",
      "original_commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "original_line" : 719,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1349249906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142580308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T19:25:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142580308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1142628251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142628251"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes you're right, I somehow managed to confuse myself about the filters. Thanks for patient explanation.\r\n\r\nStill something doesn't sit right. So if a coin is discarded because of `max_ancestors` we give this error message, but if it's discarded by the filter `max_ancestors/2` we just say insufficient funds when the coins are there they just don't meet the filters. There are also other reasons when the coins are discarded, for example unsafe utxos. Even you enable unsafe utxos, we don't allow any chains at all. Why give detailed error message in one case and not the other? Maybe we should just count all discarded coins and generalize the error message a bit?",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-20T20:11:25Z",
      "diff_hunk" : "@@ -692,7 +708,24 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n         }\n \n         // Group outputs and map them by coin eligibility filter\n-        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters);\n+        std::vector<OutputGroup> discarded_groups;\n+        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters, discarded_groups);\n+\n+        // Check if we still have enough balance after applying filters (some coins might be discarded)\n+        CAmount total_discarded = 0;\n+        CAmount total_unconf_long_chain = 0;\n+        for (const auto& group : discarded_groups) {\n+            total_discarded += group.GetSelectionAmount();\n+            if (group.m_ancestors >= max_ancestors || group.m_descendants >= max_descendants) total_unconf_long_chain += group.GetSelectionAmount();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1142628251",
      "id" : 1142628251,
      "in_reply_to_id" : 1141752785,
      "line" : 719,
      "node_id" : "PRRC_kwDOABII585EGx-b",
      "original_commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "original_line" : 719,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1349319724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142628251/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T20:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142628251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1142716211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142716211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Still something doesn't sit right. So if a coin is discarded because of max_ancestors we give this error message, but if it's discarded by the filter max_ancestors/2 we just say insufficient funds when the coins are there they just don't meet the filters\r\n\r\nno, those coins will be added to the last non-customizable filter which has `max_ancestors-1` and `max_descendants-1`.\r\n\r\n> There are also other reasons when the coins are discarded, for example unsafe utxos. Even you enable unsafe utxos, we don't allow any chains at all\r\n\r\nThe unsafe UTXO filter is just redundant, we are currently filtering unsafe UTXO inside the coins fetching process (`AvailableCoins`).\r\nIn other words, when `m_include_unsafe_inputs=false` no unsafe UTXO arrives at Coin Selection.\r\n\r\n> Why give detailed error message in one case and not the other? Maybe we should just count all discarded coins and generalize the error message a bit?\r\n\r\nThe process is already counting all discarded coins and returning early if their exclusion make the available amount go below the target. It's currently returning an \"Insufficient Funds\", but could say something different too.\r\n\r\nI made the too-long-mempool-chain error an special case because this error, alike the untrusted coins that the user can see in a different balance (the unconfirmed/untrusted one), is hidden to the user as it depends on inner mempool policies.\r\nIt's not enough for the user to set a flag to spend the unsafe coins, it needs to set another one to craft the tx with an unconfirmed output that surpasses the max descendants policy.\r\n\r\n",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-20T21:57:52Z",
      "diff_hunk" : "@@ -692,7 +708,24 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n         }\n \n         // Group outputs and map them by coin eligibility filter\n-        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters);\n+        std::vector<OutputGroup> discarded_groups;\n+        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters, discarded_groups);\n+\n+        // Check if we still have enough balance after applying filters (some coins might be discarded)\n+        CAmount total_discarded = 0;\n+        CAmount total_unconf_long_chain = 0;\n+        for (const auto& group : discarded_groups) {\n+            total_discarded += group.GetSelectionAmount();\n+            if (group.m_ancestors >= max_ancestors || group.m_descendants >= max_descendants) total_unconf_long_chain += group.GetSelectionAmount();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1142716211",
      "id" : 1142716211,
      "in_reply_to_id" : 1141752785,
      "line" : 719,
      "node_id" : "PRRC_kwDOABII585EHHcz",
      "original_commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "original_line" : 719,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1349457510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142716211/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T21:57:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142716211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1144434340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144434340"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I realised my mistake. You can resolve this and ignore my comments. I'll go over the code one more time before I ack",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-22T09:02:47Z",
      "diff_hunk" : "@@ -692,7 +708,24 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n         }\n \n         // Group outputs and map them by coin eligibility filter\n-        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters);\n+        std::vector<OutputGroup> discarded_groups;\n+        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters, discarded_groups);\n+\n+        // Check if we still have enough balance after applying filters (some coins might be discarded)\n+        CAmount total_discarded = 0;\n+        CAmount total_unconf_long_chain = 0;\n+        for (const auto& group : discarded_groups) {\n+            total_discarded += group.GetSelectionAmount();\n+            if (group.m_ancestors >= max_ancestors || group.m_descendants >= max_descendants) total_unconf_long_chain += group.GetSelectionAmount();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1144434340",
      "id" : 1144434340,
      "in_reply_to_id" : 1141752785,
      "line" : 719,
      "node_id" : "PRRC_kwDOABII585ENq6k",
      "original_commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "original_line" : 719,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 72,
      "pull_request_review_id" : 1352017767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144434340/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-22T09:02:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144434340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1145824454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1145824454"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "q: do I understand correctly with current filters `total_discarded` is always equal to `total_unconf_long_chain`?",
      "commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-23T08:18:45Z",
      "diff_hunk" : "@@ -692,7 +708,24 @@ util::Result<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, Coin\n         }\n \n         // Group outputs and map them by coin eligibility filter\n-        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters);\n+        std::vector<OutputGroup> discarded_groups;\n+        FilteredOutputGroups filtered_groups = GroupOutputs(wallet, available_coins, coin_selection_params, ordered_filters, discarded_groups);\n+\n+        // Check if we still have enough balance after applying filters (some coins might be discarded)\n+        CAmount total_discarded = 0;\n+        CAmount total_unconf_long_chain = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r1145824454",
      "id" : 1145824454,
      "line" : 716,
      "node_id" : "PRRC_kwDOABII585ES-TG",
      "original_commit_id" : "f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "original_line" : 716,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 69,
      "pull_request_review_id" : 1354054711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1145824454/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-23T08:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1145824454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK f3221d373a8623fe4808e00c7a92fbb6e0d6419b",
      "created_at" : "2023-03-23T08:23:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1480768733",
      "id" : 1480768733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585YQrzd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480768733/reactions"
      },
      "updated_at" : "2023-03-23T08:23:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480768733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   }
]
