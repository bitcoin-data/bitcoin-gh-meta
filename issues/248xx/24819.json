{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "**OS:** macOS 10.15.4\r\n**Compiler:** brew installed clang-13\r\n**Build command:**\r\n- `make clean; ./autogen.sh; CC=/usr/local/Cellar/llvm/13.0.1/bin/clang CXX=/usr/local/Cellar/llvm/13.0.1/bin/clang++ LDFLAGS=\"-fuse-ld=/usr/local/Cellar/llvm/bin/13.0.1/ld.lld\" ./configure --disable-wallet --with-sanitizers=thread; make; make check`\r\n\r\n<details>\r\n<summary>TSAN log</summary>\r\n\r\n\r\n```\r\nWARNING: ThreadSanitizer: data race (pid=85054)\r\n  Read of size 4 at 0x7fff9a2cd770 by thread T1 (mutexes: write M1762):\r\n    #0 std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long) ostream:720 (test_bitcoin:x86_64+0x100074c35)\r\n    #1 std::__1::__function::__func<$_0, std::__1::allocator<$_0>, void (std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)>::operator()(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) function.h:345 (test_bitcoin:x86_64+0x100080508)\r\n    #2 BCLog::Logger::LogPrintStr(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) logging.cpp:281 (test_bitcoin:x86_64+0x100be645b)\r\n    #3 void LogPrintf_<char const*, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int, char const*, char const* const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) logging.h:186 (test_bitcoin:x86_64+0x100aefb10)\r\n    #4 std::__1::__function::__func<CMainSignals::TransactionRemovedFromMempool(std::__1::shared_ptr<CTransaction const> const&, MemPoolRemovalReason, unsigned long long)::$_7, std::__1::allocator<CMainSignals::TransactionRemovedFromMempool(std::__1::shared_ptr<CTransaction const> const&, MemPoolRemovalReason, unsigned long long)::$_7>, void ()>::operator()() function.h:345 (test_bitcoin:x86_64+0x100af682a)\r\n    #5 SingleThreadedSchedulerClient::ProcessQueue() scheduler.cpp:177 (test_bitcoin:x86_64+0x100b8a175)\r\n    #6 std::__1::__function::__func<std::__1::__bind<void (SingleThreadedSchedulerClient::*)(), SingleThreadedSchedulerClient*>, std::__1::allocator<std::__1::__bind<void (SingleThreadedSchedulerClient::*)(), SingleThreadedSchedulerClient*> >, void ()>::operator()() function.h:345 (test_bitcoin:x86_64+0x100b8c15a)\r\n    #7 CScheduler::serviceQueue() scheduler.cpp:64 (test_bitcoin:x86_64+0x100b89454)\r\n    #8 std::__1::__function::__func<ChainTestingSetup::ChainTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&)::$_0, std::__1::allocator<ChainTestingSetup::ChainTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&)::$_0>, void ()>::operator()() function.h:345 (test_bitcoin:x86_64+0x1007bf5f8)\r\n    #9 util::TraceThread(char const*, std::__1::function<void ()>) thread.cpp:18 (test_bitcoin:x86_64+0x100c13ecf)\r\n    #10 void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void (*)(char const*, std::__1::function<void ()>), char const*, ChainTestingSetup::ChainTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&)::$_0> >(void*) thread:291 (test_bitcoin:x86_64+0x1007bf19f)\r\n\r\n  Previous write of size 4 at 0x7fff9a2cd770 by main thread (mutexes: write M455, write M132977):\r\n    #0 boost::unit_test::unit_test_log_t::operator<<(boost::unit_test::log::begin const&) unit_test_log.ipp:412 (test_bitcoin:x86_64+0x10001d2e6)\r\n    #1 boost::test_tools::tt_detail::report_assertion(boost::test_tools::assertion_result const&, boost::unit_test::lazy_ostream const&, boost::unit_test::basic_cstring<char const>, unsigned long, boost::test_tools::tt_detail::tool_level, boost::test_tools::tt_detail::check_type, unsigned long, ...) test_tools.ipp:359 (test_bitcoin:x86_64+0x100029f5e)\r\n    #2 blockencodings_tests::SimpleRoundTripTest::test_method() blockencodings_tests.cpp:101 (test_bitcoin:x86_64+0x10016b0ff)\r\n    #3 blockencodings_tests::SimpleRoundTripTest_invoker() blockencodings_tests.cpp:55 (test_bitcoin:x86_64+0x100169311)\r\n    #4 boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) function_template.hpp:117 (test_bitcoin:x86_64+0x10010017d)\r\n    #5 boost::detail::function::function_obj_invoker0<boost::detail::forward, int>::invoke(boost::detail::function::function_buffer&) function_template.hpp:137 (test_bitcoin:x86_64+0x10007d8ba)\r\n    #6 boost::execution_monitor::catch_signals(boost::function<int ()> const&) execution_monitor.ipp:901 (test_bitcoin:x86_64+0x100023379)\r\n    #7 boost::execution_monitor::execute(boost::function<int ()> const&) execution_monitor.ipp:1299 (test_bitcoin:x86_64+0x10002366a)\r\n    #8 boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::function<void ()> const&, unsigned long) unit_test_monitor.ipp:49 (test_bitcoin:x86_64+0x10001c5be)\r\n    #9 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:815 (test_bitcoin:x86_64+0x10001e993)\r\n    #10 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #11 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #12 boost::unit_test::framework::run(unsigned long, bool) framework.ipp:1721 (test_bitcoin:x86_64+0x10001b158)\r\n    #13 boost::unit_test::unit_test_main(boost::unit_test::test_suite* (*)(int, char**), int, char**) unit_test_main.ipp:250 (test_bitcoin:x86_64+0x10003447b)\r\n    #14 main unit_test_main.ipp:306 (test_bitcoin:x86_64+0x100034b1b)\r\n\r\n  Location is global 'std::__1::cout' at 0x7fff9a2cd760 (libc++.1.dylib+0x000029394770)\r\n\r\n  Mutex M1762 (0x7b2c000000b0) created at:\r\n    #0 pthread_mutex_lock <null>:2 (libclang_rt.tsan_osx_dynamic.dylib:x86_64+0x19840)\r\n    #1 std::__1::mutex::lock() <null>:2 (libc++.1.dylib:x86_64+0x36538)\r\n    #2 BasicTestingSetup::BasicTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&) setup_common.cpp:121 (test_bitcoin:x86_64+0x1007b92e6)\r\n    #3 ChainTestingSetup::ChainTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&) setup_common.cpp:151 (test_bitcoin:x86_64+0x1007ba2e2)\r\n    #4 TestingSetup::TestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&) setup_common.cpp:190 (test_bitcoin:x86_64+0x1007bab35)\r\n    #5 blockencodings_tests::SimpleRoundTripTest_invoker() blockencodings_tests.cpp:55 (test_bitcoin:x86_64+0x100168e7c)\r\n    #6 boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) function_template.hpp:117 (test_bitcoin:x86_64+0x10010017d)\r\n    #7 boost::detail::function::function_obj_invoker0<boost::detail::forward, int>::invoke(boost::detail::function::function_buffer&) function_template.hpp:137 (test_bitcoin:x86_64+0x10007d8ba)\r\n    #8 boost::execution_monitor::catch_signals(boost::function<int ()> const&) execution_monitor.ipp:901 (test_bitcoin:x86_64+0x100023379)\r\n    #9 boost::execution_monitor::execute(boost::function<int ()> const&) execution_monitor.ipp:1299 (test_bitcoin:x86_64+0x10002366a)\r\n    #10 boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::function<void ()> const&, unsigned long) unit_test_monitor.ipp:49 (test_bitcoin:x86_64+0x10001c5be)\r\n    #11 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:815 (test_bitcoin:x86_64+0x10001e993)\r\n    #12 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #13 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #14 boost::unit_test::framework::run(unsigned long, bool) framework.ipp:1721 (test_bitcoin:x86_64+0x10001b158)\r\n    #15 boost::unit_test::unit_test_main(boost::unit_test::test_suite* (*)(int, char**), int, char**) unit_test_main.ipp:250 (test_bitcoin:x86_64+0x10003447b)\r\n    #16 main unit_test_main.ipp:306 (test_bitcoin:x86_64+0x100034b1b)\r\n\r\n  Mutex M455 (0x00010f089170) created at:\r\n    #0 pthread_mutex_init <null>:2 (libclang_rt.tsan_osx_dynamic.dylib:x86_64+0xb1a5)\r\n    #1 std::__1::recursive_mutex::recursive_mutex() <null>:2 (libc++.1.dylib:x86_64+0x365db)\r\n    #2 ImageLoaderMachO::doModInitFunctions(ImageLoader::LinkContext const&) <null>:2 (dyld:x86_64+0x1b1e2)\r\n\r\n  Mutex M132977 (0x7ffee1ba44b8) created at:\r\n    #0 pthread_mutex_init <null>:2 (libclang_rt.tsan_osx_dynamic.dylib:x86_64+0xb1a5)\r\n    #1 std::__1::recursive_mutex::recursive_mutex() <null>:2 (libc++.1.dylib:x86_64+0x365db)\r\n    #2 CTxMemPool::CTxMemPool(CBlockPolicyEstimator*, int) txmempool.cpp:456 (test_bitcoin:x86_64+0x100a708fb)\r\n    #3 blockencodings_tests::SimpleRoundTripTest::test_method() blockencodings_tests.cpp:57 (test_bitcoin:x86_64+0x10016991e)\r\n    #4 blockencodings_tests::SimpleRoundTripTest_invoker() blockencodings_tests.cpp:55 (test_bitcoin:x86_64+0x100169311)\r\n    #5 boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) function_template.hpp:117 (test_bitcoin:x86_64+0x10010017d)\r\n    #6 boost::detail::function::function_obj_invoker0<boost::detail::forward, int>::invoke(boost::detail::function::function_buffer&) function_template.hpp:137 (test_bitcoin:x86_64+0x10007d8ba)\r\n    #7 boost::execution_monitor::catch_signals(boost::function<int ()> const&) execution_monitor.ipp:901 (test_bitcoin:x86_64+0x100023379)\r\n    #8 boost::execution_monitor::execute(boost::function<int ()> const&) execution_monitor.ipp:1299 (test_bitcoin:x86_64+0x10002366a)\r\n    #9 boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::function<void ()> const&, unsigned long) unit_test_monitor.ipp:49 (test_bitcoin:x86_64+0x10001c5be)\r\n    #10 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:815 (test_bitcoin:x86_64+0x10001e993)\r\n    #11 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #12 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #13 boost::unit_test::framework::run(unsigned long, bool) framework.ipp:1721 (test_bitcoin:x86_64+0x10001b158)\r\n    #14 boost::unit_test::unit_test_main(boost::unit_test::test_suite* (*)(int, char**), int, char**) unit_test_main.ipp:250 (test_bitcoin:x86_64+0x10003447b)\r\n    #15 main unit_test_main.ipp:306 (test_bitcoin:x86_64+0x100034b1b)\r\n\r\n  Thread T1 (tid=18855157, running) created by main thread at:\r\n    #0 pthread_create <null>:2 (libclang_rt.tsan_osx_dynamic.dylib:x86_64+0x9fdf)\r\n    #1 ChainTestingSetup::ChainTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&) setup_common.cpp:156 (test_bitcoin:x86_64+0x1007ba3c2)\r\n    #2 TestingSetup::TestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&) setup_common.cpp:190 (test_bitcoin:x86_64+0x1007bab35)\r\n    #3 blockencodings_tests::SimpleRoundTripTest_invoker() blockencodings_tests.cpp:55 (test_bitcoin:x86_64+0x100168e7c)\r\n    #4 boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) function_template.hpp:117 (test_bitcoin:x86_64+0x10010017d)\r\n    #5 boost::detail::function::function_obj_invoker0<boost::detail::forward, int>::invoke(boost::detail::function::function_buffer&) function_template.hpp:137 (test_bitcoin:x86_64+0x10007d8ba)\r\n    #6 boost::execution_monitor::catch_signals(boost::function<int ()> const&) execution_monitor.ipp:901 (test_bitcoin:x86_64+0x100023379)\r\n    #7 boost::execution_monitor::execute(boost::function<int ()> const&) execution_monitor.ipp:1299 (test_bitcoin:x86_64+0x10002366a)\r\n    #8 boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::function<void ()> const&, unsigned long) unit_test_monitor.ipp:49 (test_bitcoin:x86_64+0x10001c5be)\r\n    #9 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:815 (test_bitcoin:x86_64+0x10001e993)\r\n    #10 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #11 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) framework.ipp:740 (test_bitcoin:x86_64+0x10001fa1c)\r\n    #12 boost::unit_test::framework::run(unsigned long, bool) framework.ipp:1721 (test_bitcoin:x86_64+0x10001b158)\r\n    #13 boost::unit_test::unit_test_main(boost::unit_test::test_suite* (*)(int, char**), int, char**) unit_test_main.ipp:250 (test_bitcoin:x86_64+0x10003447b)\r\n    #14 main unit_test_main.ipp:306 (test_bitcoin:x86_64+0x100034b1b)\r\n\r\nSUMMARY: ThreadSanitizer: data race ostream:720 in std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\r\n```\r\n</details>\r\n\r\nI was only able to reproduce this with `make check` instead of running the test individually via `test_bitcoin`. I also tried on ubuntu:impish with clang-13 and the issue doesn't happen. It seems to be logging-related, similar to https://github.com/bitcoin/bitcoin/issues/23366. The following diff suppresses the error, but as I could only reproduce on macOS, I'm not sure if it's worth merging:\r\n```\r\ndiff --git a/test/sanitizer_suppressions/tsan b/test/sanitizer_suppressions/tsan\r\nindex 3acf575d0..35732c611 100644\r\n--- a/test/sanitizer_suppressions/tsan\r\n+++ b/test/sanitizer_suppressions/tsan\r\n@@ -40,3 +40,5 @@ race:epoll_ctl\r\n \r\n # https://github.com/bitcoin/bitcoin/issues/23366\r\n race:std::__1::ios_base::*\r\n+\r\n+race:std::__1::basic_ostream*\r\n```",
   "closed_at" : "2022-08-10T09:53:52Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
      "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
      "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/MarcoFalke",
      "id" : 6399679,
      "login" : "MarcoFalke",
      "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
      "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
      "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
      "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/MarcoFalke"
   },
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24819/comments",
   "created_at" : "2022-04-10T16:42:27Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24819/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/24819",
   "id" : 1199095089,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24819/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585HeL0x",
   "number" : 24819,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24819/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24819/timeline",
   "title" : "data race in SimpleRoundTripTest logging for macOS",
   "updated_at" : "2022-08-10T09:53:52Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24819",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
      "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
      "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Crypt-iQ",
      "id" : 15145615,
      "login" : "Crypt-iQ",
      "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
      "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
      "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
      "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Crypt-iQ"
   }
}
