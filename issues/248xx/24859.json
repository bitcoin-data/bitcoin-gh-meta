{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "In the current code, the database is created before the last validation, which checks that passphrase is set and private keys are disabled.\r\n\r\nTherefore, if this validation fails, it will result in an empty database and the user will not be able to recreate a wallet with the same name and with the correct parameters.\r\n\r\nBehavior on the master branch:\r\n```\r\n$ ./src/bitcoin-cli -regtest -named createwallet wallet_name=\"invalid_wallet_01\" disable_private_keys=true passphrase=\"passphrase\"\r\nerror code: -4\r\nerror message:\r\nPassphrase provided but private keys are disabled. A passphrase is only used to encrypt private keys, so cannot be used for wallets with private keys disabled.\r\n\r\n$ ./src/bitcoin-cli -regtest -named createwallet wallet_name=\"invalid_wallet_01\"\r\nerror code: -4\r\nerror message:\r\nWallet file verification failed. Failed to create database path '/home/w/.bitcoin/regtest/wallets/invalid_wallet'. Database already exists.\r\n```\r\n\r\nBehavior on the PR branch:\r\n```\r\n$ ./src/bitcoin-cli -regtest -named createwallet wallet_name=\"invalid_wallet_02\" disable_private_keys=true passphrase=\"passphrase\"\r\nerror code: -4\r\nerror message:\r\nPassphrase provided but private keys are disabled. A passphrase is only used to encrypt private keys, so cannot be used for wallets with private keys disabled.\r\n\r\n$ ./src/bitcoin-cli -regtest -named createwallet wallet_name=\"invalid_wallet_02\"\r\n{\r\n  \"name\": \"invalid_wallet_01\",\r\n  \"warning\": \"\"\r\n}\r\n```",
   "closed_at" : "2022-04-18T15:30:10Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24859/comments",
   "created_at" : "2022-04-15T06:50:58Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24859/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/24859",
   "id" : 1205319723,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24859/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII5842Rx2m",
   "number" : 24859,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/24859.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24859",
      "merged_at" : "2022-04-18T15:30:10Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/24859.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24859"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24859/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24859/timeline",
   "title" : "wallet: Change wallet validation order",
   "updated_at" : "2022-04-18T15:30:11Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24859",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
      "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/w0xlt/followers",
      "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/w0xlt",
      "id" : 94266259,
      "login" : "w0xlt",
      "node_id" : "U_kgDOBZ5jkw",
      "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
      "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
      "repos_url" : "https://api.github.com/users/w0xlt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/w0xlt"
   }
}
