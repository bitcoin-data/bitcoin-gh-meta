[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17369](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17369.html) (Refactor: Move encryption code between KeyMan and Wallet by achow101)\n* [#17261](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17261.html) (Make ScriptPubKeyMan an actual interface and the wallet to have multiple by achow101)\n* [#17219](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17219.html) (wallet: allow transaction without change if keypool is empty by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-04T23:26:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-549593880",
      "id" : 549593880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTU5Mzg4MA==",
      "updated_at" : "2019-11-26T19:52:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549593880",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342634238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: remove one more line",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-05T15:41:47Z",
      "diff_hunk" : "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342634238",
      "id" : 342634238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjYzNDIzOA==",
      "original_commit_id" : "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 311826649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342636404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move assert for `vchPubKey.IsValid()` as well? (I know it's deleted later, but that commit is still under discussion)",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-05T15:45:42Z",
      "diff_hunk" : "@@ -3246,16 +3246,14 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342636404",
      "id" : 342636404,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjYzNjQwNA==",
      "original_commit_id" : "763c298e7fe1858c03c178d62bd58f31d40de32b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311826649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The change seems useful, but incomplete. CTxDestination is more generic than CPubKey, which offers more flexibility with (e.g. multisig) descriptor wallets. But then I think we should use CTxDestination everywhere, so maybe:\r\n\r\nI would prefer to clean this up in a followup.",
      "created_at" : "2019-11-05T19:06:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-549972243",
      "id" : 549972243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTk3MjI0Mw==",
      "updated_at" : "2019-11-05T19:06:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549972243",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does it really matter? It's removed a few commits later anyways.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-05T19:15:39Z",
      "diff_hunk" : "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748149",
      "id" : 342748149,
      "in_reply_to_id" : 342634238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc0ODE0OQ==",
      "original_commit_id" : "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 311977188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ignoring that it's removed later, the check matters here. since the pubkey should always be valid after GetReservedDestination. Either it was fetched earlier, or it was fetched just then.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-05T19:16:54Z",
      "diff_hunk" : "@@ -3246,16 +3246,14 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748706",
      "id" : 342748706,
      "in_reply_to_id" : 342636404,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc0ODcwNg==",
      "original_commit_id" : "763c298e7fe1858c03c178d62bd58f31d40de32b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311977938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342778921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, it's a nit :-)",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-05T20:21:42Z",
      "diff_hunk" : "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342778921",
      "id" : 342778921,
      "in_reply_to_id" : 342634238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc3ODkyMQ==",
      "original_commit_id" : "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 312017276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I would love for somebody to do a novelization of this PR like I did for https://github.com/bitcoin/bitcoin/pull/17369#pullrequestreview-313636620. I think I understand what the changes here are doing, but not why they are being made. Particularly I don't understand motivation for commits:\r\n\r\n- 8b9a1ed9fb5ef64385d3881b1423059e4daaef13 Key pool: Move TopUp call (3/6)\r\n- 8fc748e8050525a4235e34f3d93f3849245177f0 Key pool: Change ReturnDestination interface to take address instead of key (4/6)\r\n- 51ed5b0d73fc1e7010fc4b1bc26b4e1946cf60b0 Key pool: Make TopUp fail if unexpected wallet flags are set (5/6)\r\n\r\nAlso unclear if Sjors comment above about \"Make TopUp fail\" https://github.com/bitcoin/bitcoin/pull/17373#pullrequestreview-311826649 needs to be addressed\r\n",
      "created_at" : "2019-11-07T22:04:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551287220",
      "id" : 551287220,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTI4NzIyMA==",
      "updated_at" : "2019-11-07T22:04:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551287220",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky I've updated the OP with something like that.",
      "created_at" : "2019-11-07T23:56:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551321055",
      "id" : 551321055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTMyMTA1NQ==",
      "updated_at" : "2019-11-07T23:56:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551321055",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the novelization.\r\n\r\n> Also unclear if Sjors comment above about \"Make TopUp fail\" [#17373 (review)](https://github.com/bitcoin/bitcoin/pull/17373#pullrequestreview-311826649) needs to be addressed\r\n\r\nI.e. descriptor wallets with `WALLET_FLAG_DISABLE_PRIVATE_KEYS` should be able to up their \"keypool\". Not too hard to change that later though.\r\n",
      "created_at" : "2019-11-08T08:37:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551436646",
      "id" : 551436646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTQzNjY0Ng==",
      "updated_at" : "2019-11-08T08:37:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551436646",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346548666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move CanGetAddresses call\" (f034e5748aa2fac9fb8c9010c806d00b2b8d79ba)\r\n\r\nMaybe say something like \"Call LegacyScriptPubKeyMan::CanGetAddresses directly instead of calling CWallet::CanGetAddresses to only query the relevant key manager\" in the commit description be clearer about what the change is supposed to do.\r\n\r\nIn case it helps anybody else, after 9b161a718f3c9d301419940cc9456f2065f8ca58 from #17261 there can more than keymanager and CWallet::CanGetAddresses will return false any of them can't generate addresses, so it wouldn't be right to call that method here.\r\n",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T21:14:02Z",
      "diff_hunk" : "@@ -3252,9 +3252,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346548666",
      "id" : 346548666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU0ODY2Ng==",
      "original_commit_id" : "f034e5748aa2fac9fb8c9010c806d00b2b8d79ba",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346554060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (35c37b59c5bb918c15aca3092b6506ef3974e50c)\r\n\r\nMaybe point out in the commit description that addresses are determined by LegacyScriptPubKeyMan::GetReservedDestination \r\ninstead of ReserveDestination::GetReservedDestination because other key manager implementations might construct them in other ways.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T21:26:59Z",
      "diff_hunk" : "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);\n+    address = GetDestinationForKey(keypool.vchPubKey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346554060",
      "id" : 346554060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU1NDA2MA==",
      "original_commit_id" : "35c37b59c5bb918c15aca3092b6506ef3974e50c",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 23,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346558726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move TopUp call\" (8b9a1ed9fb5ef64385d3881b1423059e4daaef13)\r\n\r\nSorry if this is a dumb question, because my understanding here is not great, but the PR description says this call has to be moved so \"it will work after future changes where m_spk_man is not a global thing in CWallet and is fetched based on type and internal-ness\".\r\n\r\nBut why couldn't the code here just look up the right keyman object using the type above and the internal-ness which it already knows?\r\n\r\nNot saying this shouldn't be moved, just that this doesn't seem to explain the move",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T21:37:30Z",
      "diff_hunk" : "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346558726",
      "id" : 346558726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU1ODcyNg==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346562487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move TopUp call\" (8b9a1ed9fb5ef64385d3881b1423059e4daaef13)\r\n\r\nSince aside from the call in `GetNewChangeDestination` this code is also called from `CWallet::CreateTransaction`, I'm wondering if this is a change in behavior. Is topup already called when creating transactions? Wondering if this the \"unsollicited keypool topup\" refered to by https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510903836\r\n",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T21:46:00Z",
      "diff_hunk" : "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346562487",
      "id" : 346562487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU2MjQ4Nw==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346568939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The place it is moved to does the lookup as well. It was redundant to do the lookup twice.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T22:01:29Z",
      "diff_hunk" : "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346568939",
      "id" : 346568939,
      "in_reply_to_id" : 346558726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU2ODkzOQ==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 317289718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346570868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346570868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is not a change in behavior because `TopUp` is called in `LegacyScriptPubKeyMan::ReserveKeyFromKeyPool`",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T22:06:16Z",
      "diff_hunk" : "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346570868",
      "id" : 346570868,
      "in_reply_to_id" : 346562487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU3MDg2OA==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 317292296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346570868",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T22:16:47Z",
      "diff_hunk" : "@@ -3252,9 +3252,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575149",
      "id" : 346575149,
      "in_reply_to_id" : 346548666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU3NTE0OQ==",
      "original_commit_id" : "f034e5748aa2fac9fb8c9010c806d00b2b8d79ba",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 317297747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575149",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575165"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-14T22:16:51Z",
      "diff_hunk" : "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);\n+    address = GetDestinationForKey(keypool.vchPubKey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575165",
      "id" : 346575165,
      "in_reply_to_id" : 346554060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU3NTE2NQ==",
      "original_commit_id" : "35c37b59c5bb918c15aca3092b6506ef3974e50c",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 23,
      "pull_request_review_id" : 317297772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575165",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK eb9c2601377d40c4d55798a5ffcbe8c4791b91e5\r\n\r\nNits:\r\n* you're not really selling 06d411488c1c669f00a1c947416267941dbb7f7b with the current commit message; maybe replace with what you wrote in the PR description.\r\n* maybe call `reserved_key_to_index.erase(index)` in `KeepDestination()` as well for completeness\r\n* `m_reserved_key_to_index` could be more accurately called `m_index_to_reserved_key` or even just `m_reserved_keys` (which begs the question why the keypool uses sets instead of maps, but that's for a later cleanup)",
      "created_at" : "2019-11-15T12:03:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-554334361",
      "id" : 554334361,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDMzNDM2MQ==",
      "updated_at" : "2019-11-15T12:03:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554334361",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348146744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348146744"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (863655ae1c1325d9dbb3b1e73ec82f4fe16e9425)\r\n\r\nNote (mainly for myself): #17237 moves LearnRelatedScripts \r\n\r\n`ReserveDestination::GetReservedDestination -> ReserveDestination::KeepDestination`\r\n\r\nwhile this moves it:\r\n\r\n`ReserveDestination::GetReservedDestination -> LegacyScriptPubKeyMan::GetReservedDestination`\r\n\r\nSo I guess ultimately it will be called from `LegacyScriptPubKeyMan::KeepDestination`",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T20:20:40Z",
      "diff_hunk" : "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348146744",
      "id" : 348146744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE0Njc0NA==",
      "original_commit_id" : "863655ae1c1325d9dbb3b1e73ec82f4fe16e9425",
      "original_position" : 13,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348146744",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348161590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348161590"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is not a change in behavior because `TopUp` is called in `LegacyScriptPubKeyMan::ReserveKeyFromKeyPool`\r\n\r\n:dizzy_face:\r\n\r\nSo if it's already called then why do we need to add a call here?\r\n\r\nIn any case, could we move all of this stuff (keyman lookup and topup call) inside the nIndex == -1 block? It seems less confusing to do lookup, topup, reservation all at once, and also maybe more efficient",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T20:54:24Z",
      "diff_hunk" : "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348161590",
      "id" : 348161590,
      "in_reply_to_id" : 346562487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE2MTU5MA==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348161590",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348182343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348182343"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move TopUp call\" (a175268f0e406336cc5d97a0ed458b8f4a805b91)\r\n\r\n> The place it is moved to does the lookup as well. It was redundant to do the lookup twice.\r\n\r\nOk, so \"so that it will work after future changes\" in the PR description could be clarified to \"so that it will work without an extra address type -> keyman lookup after future changes\".\r\n\r\nI'd suggest replacing this commit description something like \"Not calling TopUp in CWallet::GetNewChangeDestination is a simplification that will avoid the need to look up a key manager based on address type when the wallet get multiple key managers later. Removing the TopUp call does not change behavior because the key pool will get topped up anyway in LegacyScriptPubKeyMan::ReserveKeyFromKeyPool.\"\r\n\r\nSorry for getting stuck on this change. When I see change that looks good and safe, but I have no idea what motivated it (a hard requirement, a code cleanup, or a chance to optimize), sometimes it's hard to get past.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T21:39:29Z",
      "diff_hunk" : "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348182343",
      "id" : 348182343,
      "in_reply_to_id" : 346558726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE4MjM0Mw==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348182343",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348198405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348198405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Make TopUp fail if unexpected wallet flags are set\" (b12121d52f46ac7e8455479bc9ded100cfccc841)\r\n\r\nThere should be a code comment here to explain what's mentioned in the PR description: that the blank wallet check is needed for TopUp to return false instead of true in a wallet without any keyman objects. It would also be good to say why that's important, because on the surface it seems like a bad choice to return failure when nothing failed.\r\n\r\nRelatedly, I would love to be able to drop this commit if it isn't actually necessary or if there isn't a specific example of a bug you could imagine this check preventing. Wallet flag code is confusing and just referencing flags in random places for no apparent reason and with no explanation isn't the greatest thing.\r\n\r\nIt's one thing to add sanity checks in asserts or CHECK_NONFATAL calls, but something else to add sanity checks in real code without clear \"this condition is never expected to happen\" comments so people reading the code don't waste time trying to imagine cases where it could actually do anything.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T22:15:27Z",
      "diff_hunk" : "@@ -3049,6 +3049,9 @@ unsigned int CWallet::GetKeyPoolSize() const\n \n bool CWallet::TopUpKeyPool(unsigned int kpSize)\n {\n+    if (IsWalletFlagSet(WALLET_FLAG_BLANK_WALLET) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348198405",
      "id" : 348198405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE5ODQwNQ==",
      "original_commit_id" : "b12121d52f46ac7e8455479bc9ded100cfccc841",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348198405",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\n`assert(m_reserved_key_to_index.count(nIndex) == 0);` could be reassuring here",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T22:26:23Z",
      "diff_hunk" : "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202544",
      "id" : 348202544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwMjU0NA==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 35,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202544",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202997"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nShould there be separate map for internal / external key indexes? Or should map key be an (index_number, is_internal) pair? Otherwise how do you know the internal/external index numbers don't overlap?",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T22:27:34Z",
      "diff_hunk" : "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202997",
      "id" : 348202997,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwMjk5Nw==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202997",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348205511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348205511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nI still don't understand why there is this distinction between ReturnKey and ReturnDestination. Why not just rename ReturnKey to ReturnDestination and get rid of the awkward wrapping?\r\n\r\nPrevious: https://github.com/bitcoin/bitcoin/pull/17304#discussion_r340311958\r\n",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T22:34:17Z",
      "diff_hunk" : "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n {\n-    ReturnKey(index, internal, pubkey);\n+    ReturnKey(index, internal, m_reserved_key_to_index[index]);\n+    m_reserved_key_to_index.erase(index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348205511",
      "id" : 348205511,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwNTUxMQ==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 9,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348205511",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348206310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348206310"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nWhy doesn't this need to call m_reserved_key_to_index.erase?",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T22:36:25Z",
      "diff_hunk" : "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348206310",
      "id" : 348206310,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwNjMxMA==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 1,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348206310",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348207366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348207366"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nThis commit needs a better description. The current handwavy placeholder text doesn't explain very much. Suggest replacing it with the explanation in your PR description \"In order for ScriptPubKeyMan to be generic...\"",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T22:39:16Z",
      "diff_hunk" : "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348207366",
      "id" : 348207366,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwNzM2Ng==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 35,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319325957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348207366",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348230649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348230649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The indexes do not overlap. See https://github.com/bitcoin/bitcoin/blob/b4a1da9ef8e4b673c290d5b882527e627ae1b43a/src/wallet/scriptpubkeyman.cpp#L1079-L1093",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-19T23:56:14Z",
      "diff_hunk" : "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348230649",
      "id" : 348230649,
      "in_reply_to_id" : 348202997,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMDY0OQ==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 319433029,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348230649",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233119"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated the commit message.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:06:13Z",
      "diff_hunk" : "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233119",
      "id" : 348233119,
      "in_reply_to_id" : 346558726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzExOQ==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 319436141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233119",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> So if it's already called then why do we need to add a call here?\r\n\r\nIt's a belt-and-suspenders as not all ScriptPubKeyMans are guaranteed to do this.\r\n\r\nI've moved it inside the block.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:07:08Z",
      "diff_hunk" : "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233366",
      "id" : 348233366,
      "in_reply_to_id" : 346562487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzM2Ng==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 319436436,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233366",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looking at this change further, I don't think it's needed, so I've removed this commit.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:07:35Z",
      "diff_hunk" : "@@ -3049,6 +3049,9 @@ unsigned int CWallet::GetKeyPoolSize() const\n \n bool CWallet::TopUpKeyPool(unsigned int kpSize)\n {\n+    if (IsWalletFlagSet(WALLET_FLAG_BLANK_WALLET) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233485",
      "id" : 348233485,
      "in_reply_to_id" : 348198405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzQ4NQ==",
      "original_commit_id" : "b12121d52f46ac7e8455479bc9ded100cfccc841",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 319436579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233485",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:07:46Z",
      "diff_hunk" : "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233531",
      "id" : 348233531,
      "in_reply_to_id" : 348202544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzUzMQ==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 35,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319436633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233531",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The wrapper was for the original PR to make it clearer that things were being moved. As that no longer matters, I've added a commit to rename them.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:08:41Z",
      "diff_hunk" : "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n {\n-    ReturnKey(index, internal, pubkey);\n+    ReturnKey(index, internal, m_reserved_key_to_index[index]);\n+    m_reserved_key_to_index.erase(index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233753",
      "id" : 348233753,
      "in_reply_to_id" : 348205511,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzc1Mw==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 9,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319436907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233753",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated the commit message.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:08:52Z",
      "diff_hunk" : "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233792",
      "id" : 348233792,
      "in_reply_to_id" : 348207366,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzc5Mg==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 35,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319436959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233792",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348234425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348234425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should, and I've added it.\r\n\r\nThis wasn't necessarily a bug as it doesn't effect behavior.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T00:11:33Z",
      "diff_hunk" : "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348234425",
      "id" : 348234425,
      "in_reply_to_id" : 348206310,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzNDQyNQ==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 1,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319437786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348234425",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348360598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348360598"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: in the previous commit you renamed `nIndex` to `index`.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T09:04:53Z",
      "diff_hunk" : "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348360598",
      "id" : 348360598,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODM2MDU5OA==",
      "original_commit_id" : "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
      "original_position" : 5,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319682957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348360598",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348362355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348362355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You lost the assert (https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233531)",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T09:07:53Z",
      "diff_hunk" : "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348362355",
      "id" : 348362355,
      "in_reply_to_id" : 348202544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODM2MjM1NQ==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 35,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 319682957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348362355",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348598174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348598174"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move TopUp call\" (d195dcf841e4037a517ead16db063db9d496b42b)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233366\r\n\r\n> It's a belt-and-suspenders as not all ScriptPubKeyMans are guaranteed to do this.\r\n\r\nWould encourage adding this TopUp call in a new commit (see below), or possibly not doing it in this PR. Commit title \"Key pool: Move TopUp call\" is misleading. This isn't moving a TopUp call so much as removing a useless TopUp call in one place, and adding a new, slightly justified \"belt and suspenders\" TopUp call in a different place. \r\n\r\nSubstantively, it looks like this is a good location for the the topup. I think in general the wallet, not the key manager should be responsible for any opportunistic, unchecked topups so we don't have bugs caused by differences between key manager implementations. Also, since the wallet not the key manager is responsible for locking and unlocking, this would avoid key manager methods having different undocumented side effects depending on what wallet state they are called under.\r\n\r\nFollowing this design would lead to three small commits:\r\n- One commit removing useless topup from `CWallet::GetNewChangeDestination`.\r\n- One commit moving opportunistic topup from `LegacyScriptPubKeyMan::ReserveKeyFromKeyPool` to `ReserveDestination::GetReservedDestination` for greater key manager simplicity and goodness.\r\n- One commit moving the other opportunistic topup from `LegacyScriptPubKeyMan::GetNewDestination` to `CWallet::GetNewDestination`\r\n\r\nRelatedly, I want to emphasize how much wasted time and confusion undocumented \"belt and suspenders\" wallet code causes for me. I can understand code that does the right things, and I can understand code that does the wrong things, but when I see code checking for conditions that will never happen, or just not doing _anything_, I have 0 indication (positive or negative) code is doing what the author intended, and I waste time going back questioning fundamental assumptions to see if some inscrutable piece of code is superfluous or has some important effect in a case I never thought about. Personally, I prefer code that triggers errors or logs warnings when unexpected conditions happen instead of just silently continuing and \"working anyway\". But in cases where you prefer the belt and suspenders style, having simple \"This condition will never happen\" or \"This code should not be necessary\" comments is **hugely** helpful.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T16:28:48Z",
      "diff_hunk" : "@@ -3252,9 +3250,10 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-\n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348598174",
      "id" : 348598174,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODU5ODE3NA==",
      "original_commit_id" : "d195dcf841e4037a517ead16db063db9d496b42b",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 320101753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348598174",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348611654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348611654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Rename Keep/ReturnKey to Keep/ReturnDestination and remove the wrapper\" (1fecf5d0e681a266ea6adb6ae3c695b404cd3b94)\r\n\r\nShould be nIndex (this commit doesn't compile)",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T16:38:53Z",
      "diff_hunk" : "@@ -1098,15 +1088,15 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t index)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348611654",
      "id" : 348611654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYxMTY1NA==",
      "original_commit_id" : "1fecf5d0e681a266ea6adb6ae3c695b404cd3b94",
      "original_position" : 22,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320101753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348611654",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348622786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348622786"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (8707ba99cf78c556ddda42bf74ddcda164ec9db9)\r\n\r\nWould be good to change `[nIndex]` to `.at(nIndex)` here and move this before the inserts above. Safer throw an exception if a bad index is provided than insert nonsense into the keypool.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T16:49:00Z",
      "diff_hunk" : "@@ -1108,7 +1109,9 @@ void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, cons\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_reserved_key_to_index[nIndex];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348622786",
      "id" : 348622786,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYyMjc4Ng==",
      "original_commit_id" : "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
      "original_position" : 24,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320101753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348622786",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348626943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348626943"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (8707ba99cf78c556ddda42bf74ddcda164ec9db9)\r\n\r\nMaybe change `const CTxDestination& addr` to `const CTxDestination&` to make it more obvious the address argument is not used by this implementation.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T16:53:35Z",
      "diff_hunk" : "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)\n {\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    m_reserved_key_to_index.erase(nIndex);\n     WalletLogPrintf(\"keypool keep %d\\n\", nIndex);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t nIndex, bool fInternal, const CTxDestination& addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348626943",
      "id" : 348626943,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYyNjk0Mw==",
      "original_commit_id" : "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
      "original_position" : 15,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320101753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348626943",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've dropped this commit for now.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:31:32Z",
      "diff_hunk" : "@@ -3252,9 +3250,10 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-\n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646936",
      "id" : 348646936,
      "in_reply_to_id" : 348598174,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NjkzNg==",
      "original_commit_id" : "d195dcf841e4037a517ead16db063db9d496b42b",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 320146692,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646936",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646964"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:31:36Z",
      "diff_hunk" : "@@ -1098,15 +1088,15 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t index)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646964",
      "id" : 348646964,
      "in_reply_to_id" : 348611654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0Njk2NA==",
      "original_commit_id" : "1fecf5d0e681a266ea6adb6ae3c695b404cd3b94",
      "original_position" : 22,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320146733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646964",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646993"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:31:41Z",
      "diff_hunk" : "@@ -1108,7 +1109,9 @@ void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, cons\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_reserved_key_to_index[nIndex];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646993",
      "id" : 348646993,
      "in_reply_to_id" : 348622786,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0Njk5Mw==",
      "original_commit_id" : "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
      "original_position" : 24,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320146783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646993",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647019"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:31:44Z",
      "diff_hunk" : "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)\n {\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    m_reserved_key_to_index.erase(nIndex);\n     WalletLogPrintf(\"keypool keep %d\\n\", nIndex);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t nIndex, bool fInternal, const CTxDestination& addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647019",
      "id" : 348647019,
      "in_reply_to_id" : 348626943,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NzAxOQ==",
      "original_commit_id" : "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
      "original_position" : 15,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320146823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647019",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:31:49Z",
      "diff_hunk" : "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647055",
      "id" : 348647055,
      "in_reply_to_id" : 348360598,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NzA1NQ==",
      "original_commit_id" : "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
      "original_position" : 5,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320146872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647055",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647091"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oops fixed",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:31:55Z",
      "diff_hunk" : "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647091",
      "id" : 348647091,
      "in_reply_to_id" : 348202544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NzA5MQ==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 35,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 320146927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647091",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348658200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348658200"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as #17537",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-20T17:55:22Z",
      "diff_hunk" : "@@ -3252,9 +3250,10 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-\n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348658200",
      "id" : 348658200,
      "in_reply_to_id" : 348598174,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY1ODIwMA==",
      "original_commit_id" : "d195dcf841e4037a517ead16db063db9d496b42b",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 320161269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348658200",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@instagibbs and @meshcollider, you may be interested to review this. This is code you previously acked when it was part of #16341",
      "created_at" : "2019-11-21T15:27:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557135350",
      "id" : 557135350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzEzNTM1MA==",
      "updated_at" : "2019-11-21T15:27:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557135350",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349634553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349634553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/m_reserved_key_to_index/m_index_to_pool_key/ ? As-is I expected it to be a map from keys to index...",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-22T14:53:49Z",
      "diff_hunk" : "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349634553",
      "id" : 349634553,
      "in_reply_to_id" : 348202997,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTYzNDU1Mw==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 321597340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349634553",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349639850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349639850"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do we really want to crash if that entry doesn't exist?\r\n\r\nI guess this is supposed to never happen, since `nIndex==-1` unless it was set otherwise in `GetReservedDestination` where `m_reserved_key_to_index` is also populated.\r\n\r\n",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-22T15:03:37Z",
      "diff_hunk" : "@@ -1108,7 +1109,9 @@ void LegacyScriptPubKeyMan::ReturnDestination(int64_t nIndex, bool fInternal, co\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_reserved_key_to_index.at(nIndex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349639850",
      "id" : 349639850,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTYzOTg1MA==",
      "original_commit_id" : "b4696cd3aaadc5dfb449f7c0de295a7b2d074243",
      "original_position" : 18,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 321597340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349639850",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 42ddfe9125fce4da6738307ef3acf100daac9d75",
      "created_at" : "2019-11-22T15:37:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557580485",
      "id" : 557580485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzU4MDQ4NQ==",
      "updated_at" : "2019-11-22T15:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557580485",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-22T22:10:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557713291",
      "id" : 557713291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzcxMzI5MQ==",
      "updated_at" : "2019-11-22T22:10:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557713291",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.\r\n\r\nTo resolve some issues during the rebase, I had to change a LearnRelatedScripts into a LearnAllRelatedScripts. This shoudn't change behavior since all of the scripts were implicitly learned anyways.",
      "created_at" : "2019-11-23T04:29:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557765963",
      "id" : 557765963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1Nzc2NTk2Mw==",
      "updated_at" : "2019-11-23T04:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557765963",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 5daefe31c34e12d2a0678aa93e74e94b76d834f5\r\n\r\nYou could stick to `LearnRelatedScripts` with https://github.com/Sjors/bitcoin/commit/8b75834396b1731f36f57712ba962074b3f7c6c1 but that's not pretty.  The only way `LearnAllRelatedScripts` produces a different result from `LearnRelatedScripts` is if you reserved a key for a legacy change address. I'm a bit confused about the other code paths that could end up calling `Learn(All)RelatedScripts`, but even if we don't already, I don't see any harm in adding redundant segwit scripts for legacy change addresses.",
      "created_at" : "2019-11-23T12:32:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557794121",
      "id" : 557794121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1Nzc5NDEyMQ==",
      "updated_at" : "2019-11-23T12:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557794121",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493216"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nWould move this call outside the assert. It's bad to execute code that has side effects in an assert because in a build with NDEBUG defined it the code will be skipped. We don't support these builds currently, but we may in the future, and it's bad that the breakage caused by this could be subtle and hard to debug.\r\n\r\nAlso, running code in an assert can be bad for readability if you are used to being able to skim past logic in assert statements.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T00:38:42Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493216",
      "id" : 350493216,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5MzIxNg==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 22,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 322666939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493216",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493783"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nThis commit doesn't compile because m_reserved_key_to_index isn't defined yet.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T00:41:15Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493783",
      "id" : 350493783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5Mzc4Mw==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 22,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 322666939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493783",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495492"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nI don't like calling LearnAllRelatedScripts here. There's no reason for nonsense scripts to be added to memory, and it's crazy when wallet code just does random stuff like this with no explanation. Also I don't think this PR needs to be subtly changing behavior more than its already doing, especially without being explained or even mentioned in the commit.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T00:48:43Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495492",
      "id" : 350495492,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5NTQ5Mg==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 23,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 322666939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495492",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495953"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nSecond half of the commit message \"There is a minor change in behavior\" is now out of date and should be updated.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T00:50:38Z",
      "diff_hunk" : "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());\n-    address = GetDestinationForKey(vchPubKey, type);\n-    dest = address;\n     return true;\n }\n \n void ReserveDestination::KeepDestination()\n {\n     if (nIndex != -1) {\n         m_spk_man->KeepDestination(nIndex);\n-        m_spk_man->LearnRelatedScripts(vchPubKey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495953",
      "id" : 350495953,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5NTk1Mw==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : 28,
      "pull_request_review_id" : 322666939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495953",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350555210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350555210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see a good way to fix that. i don't really like adding the type as an argument to KeepDestination as it isn't useful in other ScriptPubKeyMans.\r\n\r\nThis also doesn't actually change anything since those scripts are already in memory as they are added via `ImplicitlyLearnRelatedScripts` which is called during key loading. This just writes them to the wallet file.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T05:58:33Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350555210",
      "id" : 350555210,
      "in_reply_to_id" : 350495492,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDU1NTIxMA==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 23,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 322744363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350555210",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350710206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350710206"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> This just writes them to the wallet file.\r\n\r\nWow, that is even worse. If you think this is a good idea please add a comment here explaining that this is doing something nonsensical because design considerations make it not possible for the `KeepDestination` function to be aware of the destination type.\r\n\r\nBut I'd encourage you to take a look at my straight refactoring of this code in https://github.com/ryanofsky/bitcoin/commits/review.17373.6-fix which doesn't change behavior, doesn't write garbage to files with no explanation, but does (yes) add a `type` context parameter to the `KeepDestination` function, exactly analogous to the `internal` context parameter passed to `ReturnDestination` function, with the understanding that the whole point of having a ScriptPubKeyMan virtual class is to have subclasses that will be implemented differently, and not every implementation will require the exact same information do to every operation.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T12:25:25Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350710206",
      "id" : 350710206,
      "in_reply_to_id" : 350495492,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDcxMDIwNg==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 23,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 322940149,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350710206",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870174"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T17:03:51Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870174",
      "id" : 350870174,
      "in_reply_to_id" : 350493216,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDg3MDE3NA==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 22,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 323144039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870174",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T17:03:55Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870216",
      "id" : 350870216,
      "in_reply_to_id" : 350493783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDg3MDIxNg==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 22,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 323144094,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870216",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see how this is at all \"nonsensical\" or \"even worse'. But whatever, I've learned my lesson from the multiple days spent stuck on `TopUp()` so it's changed.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T17:04:29Z",
      "diff_hunk" : "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870468",
      "id" : 350870468,
      "in_reply_to_id" : 350495492,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDg3MDQ2OA==",
      "original_commit_id" : "c593c2e96351677821e367a6c7aae1ca58f81ff7",
      "original_position" : 23,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 323144447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870468",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350986220"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350986220"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (094f0545d2d1309ad85eb66f107dec52746490df)\r\n\r\nCommit description \"There is a minor change in behavior\" seems out of date. Would just say \"This commit does not change behavior\".\r\n\r\nThe previous description was referring to LearnRelatedScripts call moving under the GetReservedDestination `nIndex == -1` check in the old version of this PR before #17237.\r\n\r\n\r\n",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T21:22:39Z",
      "diff_hunk" : "@@ -1091,6 +1092,7 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& ty\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    LearnRelatedScripts(pubkey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350986220",
      "id" : 350986220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDk4NjIyMA==",
      "original_commit_id" : "094f0545d2d1309ad85eb66f107dec52746490df",
      "original_position" : 21,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 62,
      "pull_request_review_id" : 323292818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350986220",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350987323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350987323"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (8e70f2b4150ca2d25f06cc65295cb27a86c49681)\r\n\r\nThis should call `m_reserved_key_to_index.erase(nIndex);` to clean up",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-26T21:25:25Z",
      "diff_hunk" : "@@ -1087,16 +1087,19 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350987323",
      "id" : 350987323,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDk4NzMyMw==",
      "original_commit_id" : "8e70f2b4150ca2d25f06cc65295cb27a86c49681",
      "original_position" : 5,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 54,
      "pull_request_review_id" : 323292818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350987323",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351328532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351328532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "as noted a few days ago, this should be renamed",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-27T14:47:19Z",
      "diff_hunk" : "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351328532",
      "id" : 351328532,
      "in_reply_to_id" : 348202997,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTMyODUzMg==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 323727636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351328532",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379175"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-27T16:15:23Z",
      "diff_hunk" : "@@ -1091,6 +1092,7 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& ty\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    LearnRelatedScripts(pubkey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379175",
      "id" : 351379175,
      "in_reply_to_id" : 350986220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTM3OTE3NQ==",
      "original_commit_id" : "094f0545d2d1309ad85eb66f107dec52746490df",
      "original_position" : 21,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 62,
      "pull_request_review_id" : 323793455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379175",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379228"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-27T16:15:27Z",
      "diff_hunk" : "@@ -1087,16 +1087,19 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379228",
      "id" : 351379228,
      "in_reply_to_id" : 350987323,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTM3OTIyOA==",
      "original_commit_id" : "8e70f2b4150ca2d25f06cc65295cb27a86c49681",
      "original_position" : 5,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 54,
      "pull_request_review_id" : 323793515,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379228",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Renamed it.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-27T16:16:08Z",
      "diff_hunk" : "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379620",
      "id" : 351379620,
      "in_reply_to_id" : 348202997,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTM3OTYyMA==",
      "original_commit_id" : "06d411488c1c669f00a1c947416267941dbb7f7b",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 323794018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379620",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/17373/commits/66b82896d5c9d40abb9e62a7035a97025aa8aad3\r\n\r\nonly changes are the ones suggested in my previous review",
      "created_at" : "2019-11-27T16:17:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-559155298",
      "id" : 559155298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1OTE1NTI5OA==",
      "updated_at" : "2019-11-27T16:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/559155298",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352074009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352074009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note to other reviewers: this assert is lost, but `GetReservedDestination` calls `ReserveKeyFromKeyPool` which throws if `!keypool.vchPubKey.IsValid()`",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-11-29T10:37:54Z",
      "diff_hunk" : "@@ -3305,31 +3305,27 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n         if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n-        vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n         address = dest;\n     }\n-    assert(vchPubKey.IsValid());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352074009",
      "id" : 352074009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjA3NDAwOQ==",
      "original_commit_id" : "5a8a2f20b4408ae71750a3254a4b74cc6d5b1bf3",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : 18,
      "pull_request_review_id" : 324640823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352074009",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352391220"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352391220"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (393315354da454eb0f9322b92ad736bd23606f97\r\n\r\nDo we need:\r\n\r\n```diff\r\n@@ -3308,6 +3308,8 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\r\n         vchPubKey = keypool.vchPubKey;\r\n         fInternal = keypool.fInternal;\r\n         address = dest;\r\n+    } else {\r\n+        dest = address;\r\n     }\r\n     assert(vchPubKey.IsValid());\r\n     return true;\r\n```\r\n\r\nIt seems like `dest` is currently left unset in the `nIndex != -1` case where previously it was always set.\r\n\r\nEDIT: Actually a better fix would probably be to undelete the previous `dest = address;` line below and pass `address` instead of `dest` to `GetReservedDestination`",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-02T01:24:36Z",
      "diff_hunk" : "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352391220",
      "id" : 352391220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjM5MTIyMA==",
      "original_commit_id" : "393315354da454eb0f9322b92ad736bd23606f97",
      "original_position" : 11,
      "path" : "src/wallet/wallet.cpp",
      "position" : 17,
      "pull_request_review_id" : 324982208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352391220",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352640636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352640636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as suggested.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-02T14:56:58Z",
      "diff_hunk" : "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352640636",
      "id" : 352640636,
      "in_reply_to_id" : 352391220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjY0MDYzNg==",
      "original_commit_id" : "393315354da454eb0f9322b92ad736bd23606f97",
      "original_position" : 11,
      "path" : "src/wallet/wallet.cpp",
      "position" : 17,
      "pull_request_review_id" : 325295800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352640636",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352703450"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352703450"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352391220\r\n\r\n> Done as suggested.\r\n\r\nNote: This change was done in the wrong commit \"Change ReturnDestination interface\" (82dbc9344c33217e01c16b27d1418f042d0d0d77) instead the suggested \"Move LearnRelated and GetDestination\" (393315354da454eb0f9322b92ad736bd23606f97), so `dest` return value is temporarily left unset by the earlier commit and then fixed again in a later unrelated commit. Would be nice to fix but not important.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-02T16:41:52Z",
      "diff_hunk" : "@@ -1091,6 +1092,7 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& ty\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    LearnRelatedScripts(pubkey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352703450",
      "id" : 352703450,
      "in_reply_to_id" : 350986220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjcwMzQ1MA==",
      "original_commit_id" : "094f0545d2d1309ad85eb66f107dec52746490df",
      "original_position" : 21,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 62,
      "pull_request_review_id" : 325375630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352703450",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352713871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352713871"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, moved it to the right commit.",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-02T16:59:47Z",
      "diff_hunk" : "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352713871",
      "id" : 352713871,
      "in_reply_to_id" : 352391220,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjcxMzg3MQ==",
      "original_commit_id" : "393315354da454eb0f9322b92ad736bd23606f97",
      "original_position" : 11,
      "path" : "src/wallet/wallet.cpp",
      "position" : 17,
      "pull_request_review_id" : 325388331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T16:59:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352713871",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352719014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352719014"
         }
      },
      "author_association" : "MEMBER",
      "body" : "future work: address vs dest clarification via renaming would be great, even just `m_dest` vs `dest`",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-02T17:09:58Z",
      "diff_hunk" : "@@ -3298,43 +3298,34 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }\n \n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, address, nIndex, keypool)) {\n             return false;\n         }\n-        vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n     }\n-    assert(vchPubKey.IsValid());\n-    address = GetDestinationForKey(vchPubKey, type);\n     dest = address;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352719014",
      "id" : 352719014,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjcxOTAxNA==",
      "original_commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "original_position" : 20,
      "path" : "src/wallet/wallet.cpp",
      "position" : 20,
      "pull_request_review_id" : 325395003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-02T17:10:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352719014",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review re-ACK 886f1731bec4393dd342403ac34069a3a4f95eea\r\n\r\n(original nit about `m_reserved_key_to_index` in 386a994b853bc5b3a2ed0d812673465b8ffa4849 description still stands, not worth losing ACKs)",
      "created_at" : "2019-12-03T11:41:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-561130581",
      "id" : 561130581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MTEzMDU4MQ==",
      "updated_at" : "2019-12-03T11:41:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561130581",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354953549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354953549"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, could avoid 2nd lookup:\r\n```\r\nauto it = find(index)\r\n...\r\nerase(it)\r\n```",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-06T17:46:20Z",
      "diff_hunk" : "@@ -1112,13 +1112,15 @@ void LegacyScriptPubKeyMan::ReturnKey(int64_t nIndex, bool fInternal, const CPub\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_index_to_reserved_key.at(nIndex);\n+        m_pool_key_to_index[pubkey_id] = nIndex;\n+        m_index_to_reserved_key.erase(nIndex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354953549",
      "id" : 354953549,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk1MzU0OQ==",
      "original_commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "original_position" : 79,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 79,
      "pull_request_review_id" : 328357774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-06T17:51:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354953549",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354954643"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354954643"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, could also avoid 2nd lookup:\r\n```\r\nauto res = emplace(nIndex, ...)\r\nassert(res.second)\r\n```",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-06T17:49:05Z",
      "diff_hunk" : "@@ -1179,6 +1181,8 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        assert(m_index_to_reserved_key.count(nIndex) == 0);\n+        m_index_to_reserved_key[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354954643",
      "id" : 354954643,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk1NDY0Mw==",
      "original_commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "original_position" : 104,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 104,
      "pull_request_review_id" : 328357774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-06T17:51:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354954643",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960510"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Leaving as is to keep ACKs",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-06T18:03:32Z",
      "diff_hunk" : "@@ -1112,13 +1112,15 @@ void LegacyScriptPubKeyMan::ReturnKey(int64_t nIndex, bool fInternal, const CPub\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_index_to_reserved_key.at(nIndex);\n+        m_pool_key_to_index[pubkey_id] = nIndex;\n+        m_index_to_reserved_key.erase(nIndex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960510",
      "id" : 354960510,
      "in_reply_to_id" : 354953549,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk2MDUxMA==",
      "original_commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "original_position" : 79,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 79,
      "pull_request_review_id" : 328366714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-06T18:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960510",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960526"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Leaving as is to keep ACKs",
      "commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "created_at" : "2019-12-06T18:03:36Z",
      "diff_hunk" : "@@ -1179,6 +1181,8 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        assert(m_index_to_reserved_key.count(nIndex) == 0);\n+        m_index_to_reserved_key[nIndex] = keypool.vchPubKey.GetID();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960526",
      "id" : 354960526,
      "in_reply_to_id" : 354954643,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk2MDUyNg==",
      "original_commit_id" : "886f1731bec4393dd342403ac34069a3a4f95eea",
      "original_position" : 104,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 104,
      "pull_request_review_id" : 328366744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-12-06T18:03:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960526",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
