{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "One thing I heard interviewing some users is that it's very common to sequence RPCs with periodic tip hash checks and restart if a new block comes in.\r\n\r\nSomething that might be helpful would be if Core could support a few different things in RPCs:\r\n\r\n1) a tip hash argument that causes failure if the passed_tip != actual_tip\r\n2) a hash argument that causes failure if the passed_tip \\not \\in header_chain\r\n\r\nanother thing that might help these types of users could be node leases whereby:\r\n\r\n1) the node is given a lease which expires e.g. N seconds after the lease is granted/no message has been sent by the leasor, and the node will not process new messages until the lease is free or let go\r\n\r\nOptionally, we could allow a distinct non expiring lease.\r\n\r\n\r\nOne might use such an API like (made up RPCs)\r\n\r\n\r\n```\r\nfinished = false\r\nwhile not finished:\r\n    try:\r\n        h <- getbestblockhash\r\n        b <- getwalletbalance h\r\n        a <- getnewaddress h\r\n        send b a\r\n        finished = true\r\n```\r\n\r\nor\r\n\r\n```\r\nL <- get_lease\r\nb <- getwalletbalance h\r\na <- getnewaddress h\r\nsend b a\r\nclear_lease L\r\n```\r\n\r\n\r\nLeasing might be better than just a blockhash argument because you can guarantee e.g. repeated calls to mempool operations are consistent. This could be problematic e.g. if a txn is in the mempool and you're trying to coordinate wallet software to detect txns paying you so that you might fee bump them with CPFP, it might disappear while your flow of txns is occuring.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24471/comments",
   "created_at" : "2022-03-04T00:08:43Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24471/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/24471",
   "id" : 1159095491,
   "labels" : [
      {
         "color" : "7cf575",
         "default" : false,
         "description" : null,
         "id" : 64583,
         "name" : "Feature",
         "node_id" : "MDU6TGFiZWw2NDU4Mw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24471/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585FFmTD",
   "number" : 24471,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24471/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24471/timeline",
   "title" : "Make all RPCs take a blockhash argument / allow rpc leasing?",
   "updated_at" : "2022-03-04T00:29:28Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24471",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
      "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
      "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/JeremyRubin",
      "id" : 886523,
      "login" : "JeremyRubin",
      "node_id" : "MDQ6VXNlcjg4NjUyMw==",
      "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
      "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
      "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/JeremyRubin"
   }
}
