[
   {
      "author_association" : "MEMBER",
      "body" : "I am also running into this locally sometimes :man_shrugging: ",
      "created_at" : "2022-05-12T13:09:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24400#issuecomment-1124974159",
      "id" : 1124974159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24400",
      "node_id" : "IC_kwDOABII585DDb5P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124974159/reactions"
      },
      "updated_at" : "2022-05-12T13:09:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124974159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I am also running into this locally sometimes\r\n\r\nSame.",
      "created_at" : "2022-05-12T13:13:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24400#issuecomment-1124978089",
      "id" : 1124978089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24400",
      "node_id" : "IC_kwDOABII585DDc2p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124978089/reactions"
      },
      "updated_at" : "2022-05-12T13:13:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124978089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Also in https://cirrus-ci.com/task/4742579576111104?logs=ci#L1059",
      "created_at" : "2022-09-20T13:55:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24400#issuecomment-1252392302",
      "id" : 1252392302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24400",
      "node_id" : "IC_kwDOABII585Kpf1u",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252392302/reactions"
      },
      "updated_at" : "2022-09-20T13:56:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252392302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/6641746820988928?logs=ci#L5124",
      "created_at" : "2022-11-29T18:20:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24400#issuecomment-1331102201",
      "id" : 1331102201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24400",
      "node_id" : "IC_kwDOABII585PVwH5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331102201/reactions"
      },
      "updated_at" : "2022-11-29T18:20:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331102201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm able to reproduce this failure but I don't understand what is causing it.\r\n\r\nI'm using `rr` (https://github.com/rr-debugger/rr) in 'chaos' mode to reproduce the failure. Chaos mode is basically randomized thread priority.\r\nAnd I execute the test in parallel batches of 5.\r\n\r\nThis patch is required to make the testsuite work with rr:\r\n\r\n<details>\r\n<summary>Diff</summary>\r\n\r\n```diff\r\ndiff --git a/test/functional/feature_backwards_compatibility.py b/test/functional/feature_backwards_compatibility.py\r\nindex 5fe4a95f6f..d66aa8d32b 100755\r\n--- a/test/functional/feature_backwards_compatibility.py\r\n+++ b/test/functional/feature_backwards_compatibility.py\r\n@@ -38,6 +38,7 @@ class BackwardsCompatibilityTest(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n         self.setup_clean_chain = True\r\n         self.num_nodes = 10\r\n+        self.disable_syscall_sandbox = True\r\n         # Add new version after each release:\r\n         self.extra_args = [\r\n             [\"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # Pre-release: use to mine blocks. noban for immediate tx relay\r\n```\r\n\r\n</details>\r\n\r\n```sh\r\nseq 100 | xargs -i -P 5 rr record --chaos python test/functional/feature_backwards_compatibility.py --legacy-wallet --timeout-factor=0\r\n```\r\n\r\nAfter only a few runs I get:\r\n\r\n> AssertionError: [node 9] Node returned non-zero exit code (-6) when stopping\r\n\r\n---\r\n\r\n```sh\r\n$ cat node9/stderr/*\r\nterminate called after throwing an instance of 'std::runtime_error'\r\n  what():  CDB: Error -30974, can't open database u1_v16\r\n\r\n$ cat node9/regtest/wallets/db.log \r\nfile u1_v16 has LSN 1/2442, past end of log at 1/460\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nfile u1_v16 has LSN 1/2442, past end of log at 1/460\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nDB_ENV->log_flush: LSN of 1/2442 past current end-of-log of 1/460\r\nDatabase environment corrupt; the wrong log files may have been removed or incompatible database files imported from another environment\r\nPANIC: DB_RUNRECOVERY: Fatal error, run database recovery\r\nu1_v16: unable to flush page: 3\r\nPANIC: fatal region error detected; run recovery\r\nPANIC: fatal region error detected; run recovery\r\nPANIC: fatal region error detected; run recovery\r\n```\r\n\r\nI've tried to use the `-detachdb=1` startup option based on this comment https://github.com/bitcoin/bitcoin/issues/1472#issuecomment-8759174 but no success.\r\n\r\nNote that there seems to be two intermittent failures: one with the legacy wallet in https://cirrus-ci.com/task/6641746820988928?logs=ci#L89 where node9 is crashing (Bitcoin Core v0.16.3) and one with the descriptor wallet in https://cirrus-ci.com/task/4695237263097856?logs=ci#L1143 where node5 is crashing.",
      "created_at" : "2022-12-07T20:10:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24400#issuecomment-1341531696",
      "id" : 1341531696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24400",
      "node_id" : "IC_kwDOABII585P9iYw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341531696/reactions"
      },
      "updated_at" : "2022-12-07T20:13:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341531696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is there a race where two nodes read/write the same wallet or the wallet is copied before fully flushed?",
      "created_at" : "2022-12-08T08:48:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24400#issuecomment-1342282165",
      "id" : 1342282165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24400",
      "node_id" : "IC_kwDOABII585QAZm1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342282165/reactions"
      },
      "updated_at" : "2022-12-08T08:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342282165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
