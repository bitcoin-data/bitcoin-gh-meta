[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r816853073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816853073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Linter unhappy\r\n```\r\n$ test/lint/lint-python.sh \r\ntest/functional/rpc_psbt.py:660:30: F821 undefined name 'ser_compact_size'\r\ntest/functional/rpc_psbt.py:661:51: F821 undefined name 'ser_compact_size'\r\n```\r\nFix:\r\n```diff\r\n--- a/test/functional/rpc_psbt.py\r\n+++ b/test/functional/rpc_psbt.py\r\n@@ -10,6 +10,7 @@ from itertools import product\r\n \r\n from test_framework.descriptors import descsum_create\r\n from test_framework.key import ECKey\r\n+from test_framework.messages import ser_compact_size\r\n from test_framework.test_framework import BitcoinTestFramework\r\n from test_framework.util import (\r\n```\r\n",
      "commit_id" : "765b1387f10c9af2ca90d7ee0bdc1a891ce293aa",
      "created_at" : "2022-03-01T15:03:45Z",
      "diff_hunk" : "@@ -655,10 +655,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig) * 4 + num scriptWitness stack items + (length of stack item + stack item) * N stack items\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r816853073",
      "id" : 816853073,
      "line" : 661,
      "node_id" : "PRRC_kwDOABII584wsDBR",
      "original_commit_id" : "2c09ad698f8da94346cc14ab1366cb7a5e727d88",
      "original_line" : 661,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 17,
      "pull_request_review_id" : 896420575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816853073/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T15:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816853073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r816962062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816962062"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe in both tests use `WITNESS_SCALE_FACTOR` if I'm not confused\r\n\r\n```diff\r\n from test_framework.key import ECKey\r\n-from test_framework.messages import ser_compact_size\r\n+from test_framework.messages import (\r\n+    ser_compact_size,\r\n+    WITNESS_SCALE_FACTOR,\r\n+)\r\n from test_framework.test_framework import BitcoinTestFramework\r\n@@ -656,11 +659,13 @@ class PSBTTest(BitcoinTestFramework):\r\n         # Calculate the input weight\r\n-        # (prevout + sequence + length of scriptSig + scriptsig) * 4 + num scriptWitness stack items + (length of stack item + stack item) * N stack items\r\n+        # (prevout + sequence + length of scriptSig + scriptsig) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items\r\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\r\n         len_scriptsig += len(ser_compact_size(len_scriptsig))\r\n         len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"])) if \"final_scriptwitness\" in psbt_in else 0\r\n-        input_weight = ((40 + len_scriptsig) * 4) + len_scriptwitness\r\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness\r\n```\r\n",
      "commit_id" : "6f6529a4ffafdab885c40422a1e57e8b49559ede",
      "created_at" : "2022-03-01T16:55:58Z",
      "diff_hunk" : "@@ -655,10 +656,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig) * 4 + num scriptWitness stack items + (length of stack item + stack item) * N stack items",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r816962062",
      "id" : 816962062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wsdoO",
      "original_commit_id" : "765b1387f10c9af2ca90d7ee0bdc1a891ce293aa",
      "original_line" : 659,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 896573285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816962062/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T17:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816962062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-03-02T06:26:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1056352552",
      "id" : 1056352552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII584-9qko",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1056352552/reactions"
      },
      "updated_at" : "2022-04-19T07:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1056352552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r817574836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817574836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "6f6529a4ffafdab885c40422a1e57e8b49559ede",
      "created_at" : "2022-03-02T10:53:17Z",
      "diff_hunk" : "@@ -655,10 +656,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig) * 4 + num scriptWitness stack items + (length of stack item + stack item) * N stack items",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r817574836",
      "id" : 817574836,
      "in_reply_to_id" : 816962062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wuzO0",
      "original_commit_id" : "765b1387f10c9af2ca90d7ee0bdc1a891ce293aa",
      "original_line" : 659,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 897410659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817574836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-02T10:53:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817574836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Running `wallet_send.py` on loop with this branch and some pprints to see the values, saw this error after a few dozen runs\r\n```\r\n2022-03-02T22:44:14.061000Z TestFramework (INFO): External outputs\r\nlen_scriptSig: 132\r\nlen_scriptwitness: 0\r\ninput_weight: 688\r\n2022-03-02T22:44:14.866000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 132, in main\r\n    self.run_test()\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/wallet_send.py\", line 569, in run_test\r\n    assert_fee_amount(testres[\"fees\"][\"base\"], testres[\"vsize\"], Decimal(0.0001))\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/util.py\", line 42, in assert_fee_amount\r\n    raise AssertionError(\"Fee of %s BTC too low! (Should be %s BTC)\" % (str(fee), str(target_fee)))\r\nAssertionError: Fee of 0.00003130 BTC too low! (Should be 0.0000314 BTC)\r\n```\r\nThe usual values I'm seeing on this branch are (see https://github.com/bitcoin/bitcoin/pull/24454#pullrequestreview-896573285 above for more detail)\r\n```\r\nlen_scriptSig: 133\r\nlen_scriptwitness: 0\r\ninput_weight: 692\r\n```\r\n",
      "created_at" : "2022-03-02T23:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1057493446",
      "id" : 1057493446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII584_CBHG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1057493446/reactions"
      },
      "updated_at" : "2022-03-02T23:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1057493446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hmm. I guess that error is now the same problem in the other direction. I've added a `+ 1` to the  calculation as an additional buffer. Running this repeatedly shows no failures in 200+ runs.",
      "created_at" : "2022-03-03T12:03:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1057974266",
      "id" : 1057974266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII584_D2f6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1057974266/reactions"
      },
      "updated_at" : "2022-03-03T12:03:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1057974266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r818948347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/818948347"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        input_weight = (40 + len_scriptsig) * WITNESS_SCALE_FACTOR + len_scriptwitness\r\n```",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-03T18:27:46Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r818948347",
      "id" : 818948347,
      "line" : 666,
      "node_id" : "PRRC_kwDOABII584w0Cj7",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 666,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 22,
      "pull_request_review_id" : 899351249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/818948347/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-03T18:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/818948347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r818948715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/818948715"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        input_weight = (40 + len_scriptsig) * WITNESS_SCALE_FACTOR + len_scriptwitness\r\n```",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-03T18:28:16Z",
      "diff_hunk" : "@@ -526,10 +530,11 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r818948715",
      "id" : 818948715,
      "line" : 537,
      "node_id" : "PRRC_kwDOABII584w0Cpr",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 537,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 22,
      "pull_request_review_id" : 899351249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/818948715/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-03T18:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/818948715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r819049543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/819049543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In both tests, for grep-ability any reason to not keep the current value of `41` instead of adding `+ 1` two lines earlier? and/or add \"41 bytes\" to the comments.\r\n\r\n```\r\n$ git grep \"41 bytes\"\r\nsrc/test/data/tx_valid.json:445:[\"41 bytes push should not be considered a witness scriptPubKey\"],\r\nsrc/test/transaction_tests.cpp:915:    t.vin.resize(2438); // size per input (empty scriptSig): 41 bytes\r\nsrc/validation.cpp:4907:        // If our average Coin size is roughly 41 bytes, checking every 120,000 coins\r\nsrc/wallet/rpc/spend.cpp:574:                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter, weight cannot be less than 165 (41 bytes (size of outpoint + sequence + empty scriptSig) * 4 (witness scaling factor)) + 1 (empty witness)\");\r\ntest/functional/test_framework/script_util.py:27:# Blank Input: 32 [PrevTxHash] + 4 [Index] + 1 [scriptSigLen] + 4 [SeqNo] = 41 bytes\r\n```\r\n",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-03T20:46:05Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r819049543",
      "id" : 819049543,
      "in_reply_to_id" : 818948347,
      "line" : 666,
      "node_id" : "PRRC_kwDOABII584w0bRH",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 666,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 22,
      "pull_request_review_id" : 899496464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/819049543/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-04T08:14:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/819049543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What is the status here? It looks like there is a comment, which may need to be replied to before merge?",
      "created_at" : "2022-03-16T14:27:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1069190181",
      "id" : 1069190181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII584_uowl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069190181/reactions"
      },
      "updated_at" : "2022-03-16T14:27:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069190181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r828080087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828080087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I prefer to keep the parentheses so that terms are more clearly grouped together.\r\n\r\n***\r\n\r\n41 is the length of an input with anempty scriptSig, but the scriptSig here is not empty. I don't think it is useful to make it 41 here for grep-ability since you would be looking at the same number but with two different meanings.\r\n\r\nThe `+ 1` here is as a buffer, not the length of an empty scriptSig.",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-16T14:32:35Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r828080087",
      "id" : 828080087,
      "in_reply_to_id" : 818948347,
      "line" : 666,
      "node_id" : "PRRC_kwDOABII584xW3_X",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 666,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 22,
      "pull_request_review_id" : 911732074,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828080087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-16T14:32:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828080087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r828080739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828080739"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I prefer to keep the parentheses so that terms are more clearly grouped together.",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-16T14:33:09Z",
      "diff_hunk" : "@@ -526,10 +530,11 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r828080739",
      "id" : 828080739,
      "in_reply_to_id" : 818948715,
      "line" : 537,
      "node_id" : "PRRC_kwDOABII584xW4Jj",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 537,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 22,
      "pull_request_review_id" : 911732985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828080739/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-16T14:33:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828080739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've replied to the comment and will not be changing this unless there are more comments.",
      "created_at" : "2022-03-16T14:33:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1069195948",
      "id" : 1069195948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII584_uqKs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069195948/reactions"
      },
      "updated_at" : "2022-03-16T14:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1069195948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r828958991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828958991"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-17T10:14:42Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\n+        input_weight = ((40 + len_scriptsig) * WITNESS_SCALE_FACTOR) + len_scriptwitness",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r828958991",
      "id" : 828958991,
      "in_reply_to_id" : 818948347,
      "line" : 666,
      "node_id" : "PRRC_kwDOABII584xaOkP",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 666,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 22,
      "pull_request_review_id" : 912916262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828958991/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-17T10:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/828958991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r834266560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834266560"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a typo, no? Surprised this runs fine - must mean it's always 0. Same with rpc_psbt.py\r\n```suggestion\r\n        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0\r\n```",
      "commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "created_at" : "2022-03-24T12:44:40Z",
      "diff_hunk" : "@@ -526,10 +530,11 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r834266560",
      "id" : 834266560,
      "line" : 536,
      "node_id" : "PRRC_kwDOABII584xueXA",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 536,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 21,
      "pull_request_review_id" : 920208242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834266560/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T12:44:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834266560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r834451041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834451041"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, fixed.\r\n\r\nThese transactions are non-segwit, so this always ends up being 0. However I think it is still important to keep these for when the address type changes.",
      "commit_id" : "9a8cf704e51961894f8d687c58195dbb31cf53f5",
      "created_at" : "2022-03-24T15:39:24Z",
      "diff_hunk" : "@@ -526,10 +530,11 @@ def run_test(self):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + ser_compact_size(len(x) // 2) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwiness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r834451041",
      "id" : 834451041,
      "in_reply_to_id" : 834266560,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xvLZh",
      "original_commit_id" : "db4f73730ce9c5f5fab8effe1746c53af065106b",
      "original_line" : 536,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : null,
      "pull_request_review_id" : 920475641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834451041/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T15:39:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834451041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added a commit that changes the descriptor to also have a segwit component so that we can the weight of `final_scriptwitness` will be calculated.",
      "created_at" : "2022-03-24T15:51:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1077778099",
      "id" : 1077778099,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII585APZaz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1077778099/reactions"
      },
      "updated_at" : "2022-03-24T15:51:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1077778099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Some background reviewers may find useful: https://bitcoin.stackexchange.com/a/77192/4948. Valid signatures were _up to_ 73 bytes (since BIP 66). But our wallet only produces _standard_ signatures, which are up to 72 bytes because they require a low S value (https://bitcoin.org/en/release/v0.11.1#test-for-lows-signatures-before-relaying). With R grinding in #13666 our signatures are always 71 bytes or less.\r\n\r\nIt's the \"or less\" part that's the problem. DER requires using the shortest possible notation for a number, which means 1 in 256 times the R value will be 1 byte shorter. Ditto for the S value. See high school math for the odds of _either_ a short R or S value. (Thank goodness BIP 340 Schnorr signatures get rid of DER encoding). So occasionally we produce signatures of 70 or even 69 bytes.\r\n\r\nAt the same time, we can't expect co-signers to go beyond what's required by consensus (ditto for external signers). So they might give us a signature of up 73 bytes. (or 72 if we do insist on standardness)\r\n\r\nAll that said, I'm still confused how this applies to our tests. Are we actually calculating the weight more \"accurately\" or are we assuming in the test that the external signature uses Bitcoin Core's convention? In the latter case, shouldn't the buffer be _negative_?",
      "created_at" : "2022-03-29T10:40:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1081711915",
      "id" : 1081711915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII585AeZ0r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1081711915/reactions"
      },
      "updated_at" : "2022-03-29T10:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1081711915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @Sjors. You reminded me that I added a similar comment to `test_dust_to_fee()` in `wallet_bumpfee.py` a couple years ago in 25e03ba1ff18ca06954786e512000648941b4dfb.\r\n```\r\n    # The DER formatting used by Bitcoin to serialize ECDSA signatures means that signatures can have a\r\n    # variable size of 70-72 bytes (or possibly even less), with most being 71 or 72 bytes. The signature\r\n    # in the witness is divided by 4 for the vsize, so this variance can take the weight across a 4-byte\r\n    # boundary. Thus expected transaction size (p2wpkh, 1 input, 2 outputs) is 140-141 vbytes, usually 141.\r\n```",
      "created_at" : "2022-03-29T10:53:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1081722459",
      "id" : 1081722459,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII585AecZb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1081722459/reactions"
      },
      "updated_at" : "2022-03-29T10:53:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1081722459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> All that said, I'm still confused how this applies to our tests. Are we actually calculating the weight more \"accurately\" or are we assuming in the test that the external signature uses Bitcoin Core's convention? In the latter case, shouldn't the buffer be _negative_?\r\n\r\nI suppose the more accurately part refers to the use of `ser_compact_size` and actually calculating the scriptWitness length correctly.\r\n\r\nBut the part that actually fixes the problem is really reducing the size of the buffer from 2 to 1. This has the desired effect for the test as `assert_fee_amount` can accept a 2 byte discrepancy, but a shorter signature would result in a 3 byte discrepancy previously.",
      "created_at" : "2022-03-29T22:21:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1082426707",
      "id" : 1082426707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII585AhIVT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082426707/reactions"
      },
      "updated_at" : "2022-03-29T22:21:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082426707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855673358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855673358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "9a8cf704e51961894f8d687c58195dbb31cf53f5: comment should be updated to say sh(wsh(pkh())) since you've changed the descriptor type",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T00:00:10Z",
      "diff_hunk" : "@@ -620,7 +620,7 @@ def test_psbt_input_keys(psbt_input, keys):\n         wallet = self.nodes[1].get_wallet_rpc(\"extfund\")\n \n         # Make a weird but signable script. sh(pkh()) descriptor accomplishes this",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855673358",
      "id" : 855673358,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zAIoO",
      "original_commit_id" : "9a8cf704e51961894f8d687c58195dbb31cf53f5",
      "original_line" : 622,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 949319541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855673358/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T00:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855673358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855673421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855673421"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same here",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T00:00:24Z",
      "diff_hunk" : "@@ -493,7 +493,7 @@ def run_test(self):\n         ext_fund = self.nodes[1].get_wallet_rpc(\"extfund\")\n \n         # Make a weird but signable script. sh(pkh()) descriptor accomplishes this\n-        desc = descsum_create(\"sh(pkh({}))\".format(privkey))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855673421",
      "id" : 855673421,
      "line" : 492,
      "node_id" : "PRRC_kwDOABII584zAIpN",
      "original_commit_id" : "9a8cf704e51961894f8d687c58195dbb31cf53f5",
      "original_line" : 496,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 16,
      "pull_request_review_id" : 949319541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855673421/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T00:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855673421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855675767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855675767"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Question, why is the `// 2` needed?",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T00:07:01Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855675767",
      "id" : 855675767,
      "line" : 665,
      "node_id" : "PRRC_kwDOABII584zAJN3",
      "original_commit_id" : "8a04a386f75d099f4b9864b0cdf7f26442b5801f",
      "original_line" : 665,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 41,
      "pull_request_review_id" : 949319541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855675767/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T00:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855675767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855692125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T01:01:00Z",
      "diff_hunk" : "@@ -620,7 +620,7 @@ def test_psbt_input_keys(psbt_input, keys):\n         wallet = self.nodes[1].get_wallet_rpc(\"extfund\")\n \n         # Make a weird but signable script. sh(pkh()) descriptor accomplishes this",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855692125",
      "id" : 855692125,
      "in_reply_to_id" : 855673358,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zANNd",
      "original_commit_id" : "9a8cf704e51961894f8d687c58195dbb31cf53f5",
      "original_line" : 622,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 949343289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692125/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T01:01:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855692155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T01:01:05Z",
      "diff_hunk" : "@@ -493,7 +493,7 @@ def run_test(self):\n         ext_fund = self.nodes[1].get_wallet_rpc(\"extfund\")\n \n         # Make a weird but signable script. sh(pkh()) descriptor accomplishes this\n-        desc = descsum_create(\"sh(pkh({}))\".format(privkey))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855692155",
      "id" : 855692155,
      "in_reply_to_id" : 855673421,
      "line" : 492,
      "node_id" : "PRRC_kwDOABII584zANN7",
      "original_commit_id" : "9a8cf704e51961894f8d687c58195dbb31cf53f5",
      "original_line" : 496,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/wallet_send.py",
      "position" : 16,
      "pull_request_review_id" : 949343321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692155/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T01:01:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855692239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`2` because it's a hex string. `//` because I want ints as the result.",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T01:01:26Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r855692239",
      "id" : 855692239,
      "in_reply_to_id" : 855675767,
      "line" : 665,
      "node_id" : "PRRC_kwDOABII584zANPP",
      "original_commit_id" : "8a04a386f75d099f4b9864b0cdf7f26442b5801f",
      "original_line" : 665,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 41,
      "pull_request_review_id" : 949343439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T01:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/855692239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T08:17:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#issuecomment-1106168761",
      "id" : 1106168761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24454",
      "node_id" : "IC_kwDOABII585B7su5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1106168761/reactions"
      },
      "updated_at" : "2022-04-22T08:17:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1106168761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r856462253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856462253"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah understood, thanks!",
      "commit_id" : "9f5ab670e7c8165f161ec44dbd95778c5515ece0",
      "created_at" : "2022-04-22T18:03:15Z",
      "diff_hunk" : "@@ -655,10 +659,11 @@ def test_psbt_input_keys(psbt_input, keys):\n                 break\n         psbt_in = dec[\"inputs\"][input_idx]\n         # Calculate the input weight\n-        # (prevout + sequence + length of scriptSig + 2 bytes buffer) * 4 + len of scriptwitness\n+        # (prevout + sequence + length of scriptSig + scriptsig + 1 byte buffer) * WITNESS_SCALE_FACTOR + num scriptWitness stack items + (length of stack item + stack item) * N stack items + 1 byte buffer\n         len_scriptsig = len(psbt_in[\"final_scriptSig\"][\"hex\"]) // 2 if \"final_scriptSig\" in psbt_in else 0\n-        len_scriptwitness = len(psbt_in[\"final_scriptwitness\"][\"hex\"]) // 2 if \"final_scriptwitness\" in psbt_in else 0\n-        input_weight = ((41 + len_scriptsig + 2) * 4) + len_scriptwitness\n+        len_scriptsig += len(ser_compact_size(len_scriptsig)) + 1\n+        len_scriptwitness = (sum([(len(x) // 2) + len(ser_compact_size(len(x) // 2)) for x in psbt_in[\"final_scriptwitness\"]]) + len(psbt_in[\"final_scriptwitness\"]) + 1) if \"final_scriptwitness\" in psbt_in else 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24454#discussion_r856462253",
      "id" : 856462253,
      "in_reply_to_id" : 855675767,
      "line" : 665,
      "node_id" : "PRRC_kwDOABII584zDJOt",
      "original_commit_id" : "8a04a386f75d099f4b9864b0cdf7f26442b5801f",
      "original_line" : 665,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 41,
      "pull_request_review_id" : 950423010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24454",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856462253/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-22T18:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856462253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
