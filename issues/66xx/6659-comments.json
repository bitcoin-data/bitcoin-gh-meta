[
   {
      "body" : "Hi!  Thanks for your interest in working on this! Have you benchmarked these changes?  We have caching in verification which I expect would moot most performance gains here. (As the transaction enters the mempool the verification cache is primed, and the transaction is a hit when it shows up in a block).\r\n\r\nOne reason we have not previously done this is because doing so imports the mempool bugs into the consensus of the system.  There have previously been bugs that, e.g. caused transactions to fail to be removed from the mempool when they should have.  Not a reason to preclude doing this, but if there isn't a performance gain over the pre-existing caching approach then the reduced isolation may not be a win.\r\n",
      "created_at" : "2015-09-11T11:39:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6659#issuecomment-139521763",
      "id" : 139521763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6659",
      "updated_at" : "2015-09-11T11:41:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139521763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Clever! Unfortunately in the big picture the tricky part about this kind of change is we don't have a clear definition (yet) of what exactly is consensus-critical validation and what isn't. The mempool code isn't written in a way to really strongly respect that, so as @gmaxwell points out it's quite possible for the mempool to have bugs in it that allow transactions into the mempool that are invalid. In fact, I fixed one such bug last December: https://github.com/bitcoin/bitcoin/pull/5253\r\n\r\nWe are working to refactor out the consensus-critical codebase/protocol definition into a separate library which will use self-contained consensus-state objects. While it's a ways off, at that point you could cache a validation success when a transaction entered the mempool against that consensus state and use that cached result later on to be 100% sure that the transaction is valid when you see it again in a block; as @gmaxwell pointed we already part of that by caching signature validation. (see https://github.com/bitcoin/bitcoin/blob/master/src/script/sigcache.cpp for details) The state of the sigcache is quite well defined - the transaction and the signatures - so being sure the state is the same when we see the signature again in a block is a lot easier.\r\n\r\nSo yeah, unfortunately even if this change was a significant speedup, we couldn't merge it yet. :( But a good way forward if you want to continue this work would be to help review the libconsensus-related changes, and help with designing a validation state API that would allow for caching intermediate states appropriately. This won't be easy, because the UTXO state is fairly large and is changed incrementally as transactions in a block are validated from beginning to end, but maybe there's some good way to split it up?",
      "created_at" : "2015-09-14T18:07:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6659#issuecomment-140162584",
      "id" : 140162584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6659",
      "updated_at" : "2015-09-14T18:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140162584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Yes, as @gmaxwell and @petertodd explain, this is too risky at this point.",
      "created_at" : "2015-09-25T14:19:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6659#issuecomment-143236127",
      "id" : 143236127,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6659",
      "updated_at" : "2015-09-25T14:19:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143236127",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
