{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "When retrieving blocks from the blockchain using bitcoind RPC commands, bitcoind will temporarily stop sending responses to RPC commands after many thousands of commands if the commands are sent in quick succession. The issue has something to do with timing, since adding a delay to retrieving blocks will make the problem go away.\n\nThis node.js code will display the issue (obviously, replace \"password\" with your bitcoind password):\n\n``` javascript\nvar rpc=require('json-rpc2');\nvar bitcoind=rpc.Client.create(8332, \"localhost\",\n  \"bitcoinrpc\", \"password\");\nvar chain=function(blockhash){\n  bitcoind.call('getblock',[blockhash],function(err,block){\n    if (err){\n      console.log(String(err));\n      if (String(err)==\"Error: Have no response object\"){\n        console.log(\"Thought so.\");\n      }\n      return;\n    }\n    console.log(block.hash, block.height);\n    if (block.nextblockhash){\n      chain(block.nextblockhash);\n    };\n  });\n};\nchain(\"000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\");\n```\n\nNote that my development machine has an SSD, and so blocks are retrieved quickly by bitcoind - it may be necessary to use an SSD to reproduce the problem.\n\nWhat this code does is to retrieve the genesis block, then get the next block, and the next block, and so on, until it has got all the blocks. Except at around 25,000 or so blocks in (different every time), it will quit when it encounters a \"no response object\" error. This error has nothing to do with node.js or json-rpc2 - it is a bitcoind error. This can be seen by running bitcoin commands from the command prompt, which result in a \"couldn't connect to server\" error, e.g.:\n\n```\n> bitcoind getblock 00000000722ecede1cc4edd52a7d416bdafd6528f630926b0021b41a6b57ba5d\nerror: couldn't connect to server\n```\n\nAfter a few seconds, bitcoind will begin responding to commads again. It doesn't crash. It just stops responding to commands for a short while.\n\nBy delaying repeated RPC commands, the above code can be fixed to run without freezing bitcoind (notice the 10ms setTimeout):\n\n``` javascript\nvar rpc=require('json-rpc2');\nvar bitcoind=rpc.Client.create(8332, \"localhost\",\n  \"bitcoinrpc\", \"password\");\nvar chain=function(blockhash){\n  bitcoind.call('getblock',[blockhash],function(err,block){\n    if (err){\n      console.log(String(err));\n      if (String(err)==\"Error: Have no response object\"){\n        console.log(\"Thought so.\");\n      }\n      return;\n    }\n    console.log(block.hash, block.height);\n    if (block.nextblockhash){\n      setTimeout(function(){\n        chain(block.nextblockhash);\n      },10);\n    };\n  });\n};\nchain(\"000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\");\n```\n",
   "closed_at" : "2016-04-28T11:19:41Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 17,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2889/comments",
   "created_at" : "2013-08-09T22:57:28Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2889/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/2889",
   "id" : 17889252,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2889/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUxNzg4OTI1Mg==",
   "number" : 2889,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Rapidly getting blocks via RPC causes bitcoind to temporarily stop responding to RPC commands",
   "updated_at" : "2018-01-22T13:49:04Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2889",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/63740?v=4",
      "events_url" : "https://api.github.com/users/ryanxcharles/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ryanxcharles/followers",
      "following_url" : "https://api.github.com/users/ryanxcharles/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ryanxcharles/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ryanxcharles",
      "id" : 63740,
      "login" : "ryanxcharles",
      "node_id" : "MDQ6VXNlcjYzNzQw",
      "organizations_url" : "https://api.github.com/users/ryanxcharles/orgs",
      "received_events_url" : "https://api.github.com/users/ryanxcharles/received_events",
      "repos_url" : "https://api.github.com/users/ryanxcharles/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ryanxcharles/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ryanxcharles/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ryanxcharles"
   }
}
