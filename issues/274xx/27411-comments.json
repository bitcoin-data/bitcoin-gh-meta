[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/27411#issuecomment-1495695976), [vasild](https://github.com/bitcoin/bitcoin/pull/27411#pullrequestreview-1370661499) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-04-03T19:56:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#issuecomment-1494893327",
      "id" : 1494893327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27411",
      "node_id" : "IC_kwDOABII585ZGkMP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1494893327/reactions"
      },
      "updated_at" : "2023-04-04T10:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1494893327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nPersonally, I have given up a little bit on fighting fingerprinting (at least I've de-prioritized it) because at this point there are so many fingerprinting techniques that we should probably either give up or figure out a way to avoid them ~entirely by design.\r\n\r\n> we could advertise our onion address to clearnet peers\r\n\r\nBut this is such an obvious fingerprint that we should address it.",
      "created_at" : "2023-04-04T10:06:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#issuecomment-1495695976",
      "id" : 1495695976,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27411",
      "node_id" : "IC_kwDOABII585ZJoJo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1495695976/reactions"
      },
      "updated_at" : "2023-04-04T10:06:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1495695976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Or why not even expand this logic to all networks and delete `CNetAddr::GetReachabilityFrom()`? That is - advertise our X address only to peers from network X (for X being any of IPv4, IPv6, Tor, I2P, CJDNS).",
      "created_at" : "2023-04-04T10:29:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#issuecomment-1495725877",
      "id" : 1495725877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27411",
      "node_id" : "IC_kwDOABII585ZJvc1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1495725877/reactions"
      },
      "updated_at" : "2023-04-04T10:29:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1495725877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165045822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165045822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You may expand commit b3261389eadf050c0de590c2d9cd69ad9f62acff `net, refactor: pass reference for peer address in GetReachabilityFrom` to remove `NET_UNKNOWN` since it is unused after that commit.",
      "commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "created_at" : "2023-04-13T06:12:50Z",
      "diff_hunk" : "@@ -725,17 +725,15 @@ std::vector<unsigned char> CNetAddr::GetAddrBytes() const\n // and only used in GetReachabilityFrom\n static const int NET_UNKNOWN = NET_MAX + 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165045822",
      "id" : 1165045822,
      "line" : 726,
      "node_id" : "PRRC_kwDOABII585FcTA-",
      "original_commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "original_line" : 726,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/netaddress.cpp",
      "position" : 2,
      "pull_request_review_id" : 1382698478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165045822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T06:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165045822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165066216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165066216"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: it is case-insensitive, so no point in using a mixture of lower case and upper case.",
      "commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "created_at" : "2023-04-13T06:34:52Z",
      "diff_hunk" : "@@ -905,4 +905,117 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+\n+BOOST_AUTO_TEST_CASE(advertise_local_address)\n+{\n+    auto CreatePeer = [](const CAddress& addr) {\n+        return std::make_unique<CNode>(/*id=*/0,\n+                                       /*sock=*/nullptr,\n+                                       addr,\n+                                       /*nKeyedNetGroupIn=*/0,\n+                                       /*nLocalHostNonceIn=*/0,\n+                                       CAddress{},\n+                                       /*pszDest=*/std::string{},\n+                                       ConnectionType::OUTBOUND_FULL_RELAY,\n+                                       /*inbound_onion=*/false);\n+    };\n+    SetReachable(NET_CJDNS, true);\n+\n+    const CService addr_empty{CNetAddr(), GetListenPort()};\n+    BOOST_REQUIRE(!addr_empty.IsValid());\n+\n+    CAddress addr_ipv4;\n+    BOOST_REQUIRE(LookupHost(\"1.2.3.4\", addr_ipv4, false));\n+    BOOST_REQUIRE(addr_ipv4.IsValid());\n+    BOOST_REQUIRE(addr_ipv4.IsIPv4());\n+\n+    CAddress addr_ipv6;\n+    BOOST_REQUIRE(LookupHost(\"1122:3344:5566:7788:9900:aabb:ccdd:eeff\", addr_ipv6, false));\n+    BOOST_REQUIRE(addr_ipv6.IsValid());\n+    BOOST_REQUIRE(addr_ipv6.IsIPv6());\n+\n+    CAddress addr_ipv6_tunnel;\n+    BOOST_REQUIRE(LookupHost(\"2002:3344:5566:7788:9900:aabb:ccdd:eeff\", addr_ipv6_tunnel, false));\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsValid());\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsIPv6());\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsRFC3964());\n+\n+    CAddress addr_teredo;\n+    BOOST_REQUIRE(LookupHost(\"2001:0000:5566:7788:9900:aabb:ccdd:eeff\", addr_teredo, false));\n+    BOOST_REQUIRE(addr_teredo.IsValid());\n+    BOOST_REQUIRE(addr_teredo.IsIPv6());\n+    BOOST_REQUIRE(addr_teredo.IsRFC4380());\n+\n+    CAddress addr_onion;\n+    BOOST_REQUIRE(addr_onion.SetSpecial(\"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"));\n+    BOOST_REQUIRE(addr_onion.IsValid());\n+    BOOST_REQUIRE(addr_onion.IsTor());\n+\n+    CAddress addr_i2p;\n+    BOOST_REQUIRE(addr_i2p.SetSpecial(\"UDHDrtrcetjm5sxzskjyr5ztpeszydbh4dpl3pl4utgqqw2v4jna.b32.I2P\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165066216",
      "id" : 1165066216,
      "line" : 955,
      "node_id" : "PRRC_kwDOABII585FcX_o",
      "original_commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "original_line" : 955,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 51,
      "pull_request_review_id" : 1382698478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165066216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T06:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165066216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165072581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165072581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: might as well ditch `addr_empty` and use\r\n\r\n```suggestion\r\n    BOOST_CHECK(!GetLocalAddress(*peer_onion).IsValid());\r\n```",
      "commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "created_at" : "2023-04-13T06:42:43Z",
      "diff_hunk" : "@@ -905,4 +905,117 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+\n+BOOST_AUTO_TEST_CASE(advertise_local_address)\n+{\n+    auto CreatePeer = [](const CAddress& addr) {\n+        return std::make_unique<CNode>(/*id=*/0,\n+                                       /*sock=*/nullptr,\n+                                       addr,\n+                                       /*nKeyedNetGroupIn=*/0,\n+                                       /*nLocalHostNonceIn=*/0,\n+                                       CAddress{},\n+                                       /*pszDest=*/std::string{},\n+                                       ConnectionType::OUTBOUND_FULL_RELAY,\n+                                       /*inbound_onion=*/false);\n+    };\n+    SetReachable(NET_CJDNS, true);\n+\n+    const CService addr_empty{CNetAddr(), GetListenPort()};\n+    BOOST_REQUIRE(!addr_empty.IsValid());\n+\n+    CAddress addr_ipv4;\n+    BOOST_REQUIRE(LookupHost(\"1.2.3.4\", addr_ipv4, false));\n+    BOOST_REQUIRE(addr_ipv4.IsValid());\n+    BOOST_REQUIRE(addr_ipv4.IsIPv4());\n+\n+    CAddress addr_ipv6;\n+    BOOST_REQUIRE(LookupHost(\"1122:3344:5566:7788:9900:aabb:ccdd:eeff\", addr_ipv6, false));\n+    BOOST_REQUIRE(addr_ipv6.IsValid());\n+    BOOST_REQUIRE(addr_ipv6.IsIPv6());\n+\n+    CAddress addr_ipv6_tunnel;\n+    BOOST_REQUIRE(LookupHost(\"2002:3344:5566:7788:9900:aabb:ccdd:eeff\", addr_ipv6_tunnel, false));\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsValid());\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsIPv6());\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsRFC3964());\n+\n+    CAddress addr_teredo;\n+    BOOST_REQUIRE(LookupHost(\"2001:0000:5566:7788:9900:aabb:ccdd:eeff\", addr_teredo, false));\n+    BOOST_REQUIRE(addr_teredo.IsValid());\n+    BOOST_REQUIRE(addr_teredo.IsIPv6());\n+    BOOST_REQUIRE(addr_teredo.IsRFC4380());\n+\n+    CAddress addr_onion;\n+    BOOST_REQUIRE(addr_onion.SetSpecial(\"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"));\n+    BOOST_REQUIRE(addr_onion.IsValid());\n+    BOOST_REQUIRE(addr_onion.IsTor());\n+\n+    CAddress addr_i2p;\n+    BOOST_REQUIRE(addr_i2p.SetSpecial(\"UDHDrtrcetjm5sxzskjyr5ztpeszydbh4dpl3pl4utgqqw2v4jna.b32.I2P\"));\n+    BOOST_REQUIRE(addr_i2p.IsValid());\n+    BOOST_REQUIRE(addr_i2p.IsI2P());\n+\n+    CService service_cjdns;\n+    BOOST_REQUIRE(LookupHost(\"fc00:3344:5566:7788:9900:aabb:ccdd:eeff\", service_cjdns, false));\n+    CAddress addr_cjdns{MaybeFlipIPv6toCJDNS(service_cjdns), NODE_NONE};\n+    BOOST_REQUIRE(addr_cjdns.IsValid());\n+    BOOST_REQUIRE(addr_cjdns.IsCJDNS());\n+\n+    const auto peer_ipv4{CreatePeer(addr_ipv4)};\n+    const auto peer_ipv6{CreatePeer(addr_ipv6)};\n+    const auto peer_ipv6_tunnel{CreatePeer(addr_ipv6_tunnel)};\n+    const auto peer_teredo{CreatePeer(addr_teredo)};\n+    const auto peer_onion{CreatePeer(addr_onion)};\n+    const auto peer_i2p{CreatePeer(addr_i2p)};\n+    const auto peer_cjdns{CreatePeer(addr_cjdns)};\n+\n+    // one local clearnet address - advertise to all but privacy peers\n+    AddLocal(addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv4) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv6) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv6_tunnel) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_teredo) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_cjdns) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_onion) == addr_empty);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165072581",
      "id" : 1165072581,
      "line" : 980,
      "node_id" : "PRRC_kwDOABII585FcZjF",
      "original_commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "original_line" : 980,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 76,
      "pull_request_review_id" : 1382698478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165072581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T06:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165072581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165073055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165073055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // local addresses from all networks\r\n```",
      "commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "created_at" : "2023-04-13T06:43:22Z",
      "diff_hunk" : "@@ -905,4 +905,117 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+\n+BOOST_AUTO_TEST_CASE(advertise_local_address)\n+{\n+    auto CreatePeer = [](const CAddress& addr) {\n+        return std::make_unique<CNode>(/*id=*/0,\n+                                       /*sock=*/nullptr,\n+                                       addr,\n+                                       /*nKeyedNetGroupIn=*/0,\n+                                       /*nLocalHostNonceIn=*/0,\n+                                       CAddress{},\n+                                       /*pszDest=*/std::string{},\n+                                       ConnectionType::OUTBOUND_FULL_RELAY,\n+                                       /*inbound_onion=*/false);\n+    };\n+    SetReachable(NET_CJDNS, true);\n+\n+    const CService addr_empty{CNetAddr(), GetListenPort()};\n+    BOOST_REQUIRE(!addr_empty.IsValid());\n+\n+    CAddress addr_ipv4;\n+    BOOST_REQUIRE(LookupHost(\"1.2.3.4\", addr_ipv4, false));\n+    BOOST_REQUIRE(addr_ipv4.IsValid());\n+    BOOST_REQUIRE(addr_ipv4.IsIPv4());\n+\n+    CAddress addr_ipv6;\n+    BOOST_REQUIRE(LookupHost(\"1122:3344:5566:7788:9900:aabb:ccdd:eeff\", addr_ipv6, false));\n+    BOOST_REQUIRE(addr_ipv6.IsValid());\n+    BOOST_REQUIRE(addr_ipv6.IsIPv6());\n+\n+    CAddress addr_ipv6_tunnel;\n+    BOOST_REQUIRE(LookupHost(\"2002:3344:5566:7788:9900:aabb:ccdd:eeff\", addr_ipv6_tunnel, false));\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsValid());\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsIPv6());\n+    BOOST_REQUIRE(addr_ipv6_tunnel.IsRFC3964());\n+\n+    CAddress addr_teredo;\n+    BOOST_REQUIRE(LookupHost(\"2001:0000:5566:7788:9900:aabb:ccdd:eeff\", addr_teredo, false));\n+    BOOST_REQUIRE(addr_teredo.IsValid());\n+    BOOST_REQUIRE(addr_teredo.IsIPv6());\n+    BOOST_REQUIRE(addr_teredo.IsRFC4380());\n+\n+    CAddress addr_onion;\n+    BOOST_REQUIRE(addr_onion.SetSpecial(\"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"));\n+    BOOST_REQUIRE(addr_onion.IsValid());\n+    BOOST_REQUIRE(addr_onion.IsTor());\n+\n+    CAddress addr_i2p;\n+    BOOST_REQUIRE(addr_i2p.SetSpecial(\"UDHDrtrcetjm5sxzskjyr5ztpeszydbh4dpl3pl4utgqqw2v4jna.b32.I2P\"));\n+    BOOST_REQUIRE(addr_i2p.IsValid());\n+    BOOST_REQUIRE(addr_i2p.IsI2P());\n+\n+    CService service_cjdns;\n+    BOOST_REQUIRE(LookupHost(\"fc00:3344:5566:7788:9900:aabb:ccdd:eeff\", service_cjdns, false));\n+    CAddress addr_cjdns{MaybeFlipIPv6toCJDNS(service_cjdns), NODE_NONE};\n+    BOOST_REQUIRE(addr_cjdns.IsValid());\n+    BOOST_REQUIRE(addr_cjdns.IsCJDNS());\n+\n+    const auto peer_ipv4{CreatePeer(addr_ipv4)};\n+    const auto peer_ipv6{CreatePeer(addr_ipv6)};\n+    const auto peer_ipv6_tunnel{CreatePeer(addr_ipv6_tunnel)};\n+    const auto peer_teredo{CreatePeer(addr_teredo)};\n+    const auto peer_onion{CreatePeer(addr_onion)};\n+    const auto peer_i2p{CreatePeer(addr_i2p)};\n+    const auto peer_cjdns{CreatePeer(addr_cjdns)};\n+\n+    // one local clearnet address - advertise to all but privacy peers\n+    AddLocal(addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv4) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv6) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv6_tunnel) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_teredo) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_cjdns) == addr_ipv4);\n+    BOOST_CHECK(GetLocalAddress(*peer_onion) == addr_empty);\n+    BOOST_CHECK(GetLocalAddress(*peer_i2p) == addr_empty);\n+    RemoveLocal(addr_ipv4);\n+\n+    // local privacy addresses - don't advertise to clearnet peers\n+    AddLocal(addr_onion);\n+    AddLocal(addr_i2p);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv4) == addr_empty);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv6) == addr_empty);\n+    BOOST_CHECK(GetLocalAddress(*peer_ipv6_tunnel) == addr_empty);\n+    BOOST_CHECK(GetLocalAddress(*peer_teredo) == addr_empty);\n+    BOOST_CHECK(GetLocalAddress(*peer_cjdns) == addr_empty);\n+    BOOST_CHECK(GetLocalAddress(*peer_onion) == addr_onion);\n+    BOOST_CHECK(GetLocalAddress(*peer_i2p) == addr_i2p);\n+    RemoveLocal(addr_onion);\n+    RemoveLocal(addr_i2p);\n+\n+    // local peers from all networks",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27411#discussion_r1165073055",
      "id" : 1165073055,
      "line" : 997,
      "node_id" : "PRRC_kwDOABII585FcZqf",
      "original_commit_id" : "6be8b6d8106210c6f44bc9c0124bfd1476d2952e",
      "original_line" : 997,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 93,
      "pull_request_review_id" : 1382698478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27411",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165073055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T06:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165073055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
