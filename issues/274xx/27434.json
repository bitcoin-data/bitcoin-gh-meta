{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Closes https://github.com/bitcoin/bitcoin/issues/8050\r\n\r\nIf we discover an invalid block on a blockchain branch with otherwise valid headers, all the child headers can be marked as INVALID_CHILD. When invalidating mainchain blocks we can easily mark all the invalid children but on a headers-only branch we just stop on the invalid block and search for the next best tip and branch to validate. On restart, during `LoadBlockIndex()` we iterate through all the headers we know about sorted by height, and that is when we normally mark these child-headers of invalid ancestors with `INVALID_CHILD`.\r\n\r\nIssue #8050 illustrates a discrepancy where a headers-only branch is not marked as invalid until the node is restarted. What we do in this PR is check for invalid ancestors while we are scanning the block index for chain tips during `rpc getchaintips` itself.\r\n\r\nI had to remove a bunch of `const` qualifiers from `getchaintips` which makes me think that modifying the block index during an RPC is just bad separation of concerns -- but it is a solution! \r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27434/comments",
   "created_at" : "2023-04-06T20:25:43Z",
   "draft" : true,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27434/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/27434",
   "id" : 1658002064,
   "labels" : [
      {
         "color" : "6060aa",
         "default" : false,
         "description" : null,
         "id" : 118379652,
         "name" : "Validation",
         "node_id" : "MDU6TGFiZWwxMTgzNzk2NTI=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27434/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585NzGiP",
   "number" : 27434,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/27434.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27434",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/27434.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27434"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27434/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27434/timeline",
   "title" : "validation: implement MaybeInvalidateFork() and call from rpc getchaintips",
   "updated_at" : "2023-04-06T20:25:48Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27434",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
      "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
      "followers_url" : "https://api.github.com/users/pinheadmz/followers",
      "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/pinheadmz",
      "id" : 2084648,
      "login" : "pinheadmz",
      "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
      "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
      "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
      "repos_url" : "https://api.github.com/users/pinheadmz/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/pinheadmz"
   }
}
