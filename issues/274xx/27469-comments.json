[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [pinheadmz](https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1510029147), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/27469#pullrequestreview-1390605733) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#27006](https://github.com/bitcoin/bitcoin/pull/27006) (reduce cs_main scope, guard block index 'nFile' under a local mutex by furszy)\n* [#26836](https://github.com/bitcoin/bitcoin/pull/26836) (wallet: finish addressbook encapsulation by furszy)\n* [#26812](https://github.com/bitcoin/bitcoin/pull/26812) (test: add end-to-end tests for CConnman and PeerManager by vasild)\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n* [#26008](https://github.com/bitcoin/bitcoin/pull/26008) (wallet: cache IsMine scriptPubKeys to improve performance of descriptor wallets by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#25722](https://github.com/bitcoin/bitcoin/pull/25722) (refactor: Use util::Result class for wallet loading by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-15T19:32:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1509938050",
      "id" : 1509938050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585Z_9OC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509938050/reactions"
      },
      "updated_at" : "2023-04-18T17:23:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509938050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK, seems like a great idea.",
      "created_at" : "2023-04-16T03:05:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1510029147",
      "id" : 1510029147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585aATdb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510029147/reactions"
      },
      "updated_at" : "2023-04-16T03:05:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510029147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168831940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168831940"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to use `int64_t`, when the block time is denoted in a type-safe  `NodeSeconds`?\r\n\r\nEdit: I guess all you need to do is switch from `...::GetBlockTime()` to `...::Time()`?",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T14:45:20Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168831940",
      "id" : 1168831940,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII585FqvXE",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : 4,
      "pull_request_review_id" : 1388285429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168831940/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-17T14:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168831940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168887852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168887852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why not a single-line `if` like you do below ?",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:19:55Z",
      "diff_hunk" : "@@ -1777,6 +1784,14 @@ bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScri\n     return true;\n }\n \n+void CWallet::FirstKeyTimeChanged(const ScriptPubKeyMan* spkm, int64_t new_birth_time)\n+{\n+    int64_t birthtime = m_birth_time.load();\n+    if (birthtime == BLANK_BIRTH_TIME || new_birth_time < birthtime) {\n+        m_birth_time = new_birth_time;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168887852",
      "id" : 1168887852,
      "line" : 1792,
      "node_id" : "PRRC_kwDOABII585Fq9As",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1792,
      "original_position" : 23,
      "original_start_line" : 1790,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168887852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1790,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168887852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168919382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168919382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`birthtime == BLANK_BIRTH_TIME ` -- doesn't this mean if a wallet has no known birthtime, it will never process any blocks?",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:37:26Z",
      "diff_hunk" : "@@ -1434,6 +1434,13 @@ void CWallet::blockConnected(const interfaces::BlockInfo& block)\n \n     m_last_block_processed_height = block.height;\n     m_last_block_processed = block.hash;\n+\n+    // No need to scan block if block was created before the\n+    // wallet birthday (as adjusted for block time variability)\n+    const int64_t birth_time = m_birth_time.load();\n+    if (birth_time == BLANK_BIRTH_TIME || block.time < birth_time - TIMESTAMP_WINDOW) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168919382",
      "id" : 1168919382,
      "line" : 1441,
      "node_id" : "PRRC_kwDOABII585FrEtW",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1441,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168919382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168919382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168946262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168946262"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`id` is now an unused function argument `LoadDescriptorScriptPubKeyMan()`. Could clean that up? Actually I'm kinda curious why we ever needed to pass `id` if the value is always derivable from the descriptor itself.",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:53:59Z",
      "diff_hunk" : "@@ -3565,17 +3592,18 @@ void CWallet::ConnectScriptPubKeyManNotifiers()\n     for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\n         spk_man->NotifyWatchonlyChanged.connect(NotifyWatchonlyChanged);\n         spk_man->NotifyCanGetAddressesChanged.connect(NotifyCanGetAddressesChanged);\n+        spk_man->NotifyFirstKeyTimeChanged.connect(std::bind(&CWallet::FirstKeyTimeChanged, this, std::placeholders::_1, std::placeholders::_2));\n     }\n }\n \n void CWallet::LoadDescriptorScriptPubKeyMan(uint256 id, WalletDescriptor& desc)\n {\n     if (IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER)) {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new ExternalSignerScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));\n     } else {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168946262",
      "id" : 1168946262,
      "line" : 3606,
      "node_id" : "PRRC_kwDOABII585FrLRW",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3606,
      "original_position" : 98,
      "original_start_line" : 3575,
      "path" : "src/wallet/wallet.cpp",
      "position" : 98,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168946262/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3575,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168946262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168949017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168949017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think adding this method is a good idea, and cleans up all the `m_spk_managers[id] = ...` which I like. I wonder if that could just be a separate commit since its just a nice refactor? And then add `FIrstKeyTimeChanged()` next",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:55:51Z",
      "diff_hunk" : "@@ -3536,6 +3555,14 @@ LegacyScriptPubKeyMan* CWallet::GetOrCreateLegacyScriptPubKeyMan()\n     return GetLegacyScriptPubKeyMan();\n }\n \n+void CWallet::AddScriptPubKeyMan(std::unique_ptr<ScriptPubKeyMan> spkm_man)\n+{\n+    const auto& spkm = m_spk_managers[spkm_man->GetID()] = std::move(spkm_man);\n+\n+    // Update birth time if needed\n+    FirstKeyTimeChanged(spkm.get(), spkm->GetTimeFirstKey());\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168949017",
      "id" : 1168949017,
      "line" : 3565,
      "node_id" : "PRRC_kwDOABII585FrL8Z",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3565,
      "original_position" : 68,
      "original_start_line" : 3558,
      "path" : "src/wallet/wallet.cpp",
      "position" : 68,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168949017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3558,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168949017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170062170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170062170"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mainly to be consistent with the chain interface, wallet and spkm sources. Timestamps are represented as `int64_t` there. E.g. the `FoundBlock` class, `findFirstBlockWithTimeAndHeight` method, the `CWallet::m_best_block_time` member, first key time, descriptor creation time etc.\r\n\r\nI think that is clear that block times are always in seconds, so the use of an arithmetic type shouldn't be much of a worry but we could switch all of them to `NodeSeconds` too (probably in another PR that does it all at once?).",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-18T13:43:10Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170062170",
      "id" : 1170062170,
      "in_reply_to_id" : 1168831940,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII585Fvbta",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : 4,
      "pull_request_review_id" : 1390158666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170062170/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:43:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170062170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170076066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170076066"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because the other one is a return statement (the flow breaks there) while this one is a setter.\r\nPlus, when the line is too long, like this one, I think that braces help readability.\r\n",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-18T13:52:43Z",
      "diff_hunk" : "@@ -1777,6 +1784,14 @@ bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScri\n     return true;\n }\n \n+void CWallet::FirstKeyTimeChanged(const ScriptPubKeyMan* spkm, int64_t new_birth_time)\n+{\n+    int64_t birthtime = m_birth_time.load();\n+    if (birthtime == BLANK_BIRTH_TIME || new_birth_time < birthtime) {\n+        m_birth_time = new_birth_time;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170076066",
      "id" : 1170076066,
      "in_reply_to_id" : 1168887852,
      "line" : 1792,
      "node_id" : "PRRC_kwDOABII585FvfGi",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1792,
      "original_position" : 23,
      "original_start_line" : 1790,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 1390179688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170076066/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1790,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:52:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170076066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170086188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170086188"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`BLANK_BIRTH_TIME` is for blank wallets. Blank wallets are wallets with no keys (no spkm exist). So it's ok to skip blocks as the wallet isn't going to find anything on them.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T13:59:42Z",
      "diff_hunk" : "@@ -1434,6 +1434,13 @@ void CWallet::blockConnected(const interfaces::BlockInfo& block)\n \n     m_last_block_processed_height = block.height;\n     m_last_block_processed = block.hash;\n+\n+    // No need to scan block if block was created before the\n+    // wallet birthday (as adjusted for block time variability)\n+    const int64_t birth_time = m_birth_time.load();\n+    if (birth_time == BLANK_BIRTH_TIME || block.time < birth_time - TIMESTAMP_WINDOW) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170086188",
      "id" : 1170086188,
      "in_reply_to_id" : 1168919382,
      "line" : 1441,
      "node_id" : "PRRC_kwDOABII585Fvhks",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1441,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 1390195288,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170086188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:59:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170086188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170098672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170098672"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The id is the db lookup key for the descriptor, and also a way to detect db corruption.\r\n\r\nWe could clean it up from here, yeah. And probably, depending on its usage, we should also think about caching it.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T14:08:20Z",
      "diff_hunk" : "@@ -3565,17 +3592,18 @@ void CWallet::ConnectScriptPubKeyManNotifiers()\n     for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\n         spk_man->NotifyWatchonlyChanged.connect(NotifyWatchonlyChanged);\n         spk_man->NotifyCanGetAddressesChanged.connect(NotifyCanGetAddressesChanged);\n+        spk_man->NotifyFirstKeyTimeChanged.connect(std::bind(&CWallet::FirstKeyTimeChanged, this, std::placeholders::_1, std::placeholders::_2));\n     }\n }\n \n void CWallet::LoadDescriptorScriptPubKeyMan(uint256 id, WalletDescriptor& desc)\n {\n     if (IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER)) {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new ExternalSignerScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));\n     } else {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170098672",
      "id" : 1170098672,
      "in_reply_to_id" : 1168946262,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fvknw",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3606,
      "original_position" : 98,
      "original_start_line" : 3575,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1390215448,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170098672/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T14:08:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170098672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124375"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124375"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ended up re-adding the id arg. So we don't calculate the spkm id twice.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T14:26:29Z",
      "diff_hunk" : "@@ -3565,17 +3592,18 @@ void CWallet::ConnectScriptPubKeyManNotifiers()\n     for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\n         spk_man->NotifyWatchonlyChanged.connect(NotifyWatchonlyChanged);\n         spk_man->NotifyCanGetAddressesChanged.connect(NotifyCanGetAddressesChanged);\n+        spk_man->NotifyFirstKeyTimeChanged.connect(std::bind(&CWallet::FirstKeyTimeChanged, this, std::placeholders::_1, std::placeholders::_2));\n     }\n }\n \n void CWallet::LoadDescriptorScriptPubKeyMan(uint256 id, WalletDescriptor& desc)\n {\n     if (IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER)) {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new ExternalSignerScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));\n     } else {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124375",
      "id" : 1170124375,
      "in_reply_to_id" : 1168946262,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fvq5X",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3606,
      "original_position" : 98,
      "original_start_line" : 3575,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1390253814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124375/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T14:26:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124551"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure, pushed.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T14:26:38Z",
      "diff_hunk" : "@@ -3536,6 +3555,14 @@ LegacyScriptPubKeyMan* CWallet::GetOrCreateLegacyScriptPubKeyMan()\n     return GetLegacyScriptPubKeyMan();\n }\n \n+void CWallet::AddScriptPubKeyMan(std::unique_ptr<ScriptPubKeyMan> spkm_man)\n+{\n+    const auto& spkm = m_spk_managers[spkm_man->GetID()] = std::move(spkm_man);\n+\n+    // Update birth time if needed\n+    FirstKeyTimeChanged(spkm.get(), spkm->GetTimeFirstKey());\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124551",
      "id" : 1170124551,
      "in_reply_to_id" : 1168949017,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fvq8H",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3565,
      "original_position" : 68,
      "original_start_line" : 3558,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1390254117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T14:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review pinheadmz.\r\n\r\n> Also I don't know if this is a problematic edge case or it could just be a good way to test but you could create a key and send BTC to it in a block, then a few blocks later import into a new descriptor and rescan. The wallet should miss the first transaction.\r\n\r\nThis PR is not modifying the rescan process. Only IBD.\r\nGuess that you provided a timestamp that is +2 hours ahead of the block time (network time variability window) or the \"now\" arg to skip rescan?",
      "created_at" : "2023-04-18T14:37:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1513272159",
      "id" : 1513272159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585aMrNf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1513272159/reactions"
      },
      "updated_at" : "2023-04-18T14:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1513272159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171716388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171716388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1a9a349a026af2865e5446091f1e072b7a845819 \"wallet: skip block scan if block was created before wallet birthday\"\r\n\r\n`CBlock` already has a `GetBlockTime()`, so I don't think it's necessary to include the time as a separate field here.\r\n\r\nHowever I'm not sure that we should be using the block's timestamp for this time rather than MTP. With the block timestamp, we could ignore a more recent block that has a timestamp older than its parent which we wouldn't ignore. That would be kinda bad.",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-19T18:28:42Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171716388",
      "id" : 1171716388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F1vkk",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1392663143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171716388/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T18:34:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171716388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171720322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171720322"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1a9a349a026af2865e5446091f1e072b7a845819 \"wallet: skip block scan if block was created before wallet birthday\"\r\n\r\n`m_birth_time` could be initialized with `std::numeric_limits<in64_t>::max()` which would remove the need to compare against `BLANK_BIRTH_TIME`.",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-19T18:32:07Z",
      "diff_hunk" : "@@ -294,6 +294,11 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // Local time that the tip block was received. Used to schedule wallet rebroadcasts.\n     std::atomic<int64_t> m_best_block_time {0};\n \n+    static const int64_t BLANK_BIRTH_TIME = -1;\n+    // First created key time. Used to skip blocks prior to this time.\n+    // 'BLANK_BIRTH_TIME' if wallet is blank.\n+    std::atomic<int64_t> m_birth_time{BLANK_BIRTH_TIME};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171720322",
      "id" : 1171720322,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F1wiC",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 300,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1392663143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171720322/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T18:34:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171720322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172623190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172623190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> CBlock already has a GetBlockTime(), so I don't think it's necessary to include the time as a separate field here.\r\n\r\nYeah, that works here. The new field was because I initially implemented this on the filters-only sync branch. Where I have no blocks, only headers and filters.\r\n\r\n> However I'm not sure that we should be using the block's timestamp for this time rather than MTP. With the block timestamp, we could ignore a more recent block that has a timestamp older than its parent which we wouldn't ignore. That would be kinda bad.\r\n\r\nHmm, wasn't the timestamp window created to extend the grace period enough so we can use the block time directly?.\r\nIn other words, MTP moves the block time an hour back, and we have a grace period of two hours. If the two hours period are a concern, to not be forced to calculate the MTP for every block, what about doubling the grace period for IBD scanning?.\r\nNormally, it would just mean checking ~12 more blocks.",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-20T13:49:21Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172623190",
      "id" : 1172623190,
      "in_reply_to_id" : 1171716388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5M9W",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1394046991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172623190/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T13:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172623190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172638173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172638173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pushed thanks",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-20T14:00:11Z",
      "diff_hunk" : "@@ -294,6 +294,11 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // Local time that the tip block was received. Used to schedule wallet rebroadcasts.\n     std::atomic<int64_t> m_best_block_time {0};\n \n+    static const int64_t BLANK_BIRTH_TIME = -1;\n+    // First created key time. Used to skip blocks prior to this time.\n+    // 'BLANK_BIRTH_TIME' if wallet is blank.\n+    std::atomic<int64_t> m_birth_time{BLANK_BIRTH_TIME};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172638173",
      "id" : 1172638173,
      "in_reply_to_id" : 1171720322,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5Qnd",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 300,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1394071638,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172638173/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T14:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172638173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per feedback, thanks achow.\r\n\r\nChanges:\r\n* Replaced `BLANK_BIRTH_TIME` constant by setting the `m_birth_time` to its max numeric value.\r\n* Tackled a block time variability concern by using the maximum time in the chain (a moving forward only timestamp) instead of the raw block time.\r\n* Extended the grace period to be twice as big as the one used in the rescan process. Even when this is not strictly needed, the rationale is to be a bit more conservative during IBD scanning because it's an automatic process with no user interaction (unlike the rescan process that is usually triggered by an user action such an import).",
      "created_at" : "2023-04-20T22:11:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1517007742",
      "id" : 1517007742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585aa7N-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517007742/reactions"
      },
      "updated_at" : "2023-04-20T22:11:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517007742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
