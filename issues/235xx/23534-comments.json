[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r750996946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/750996946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`test/functional/rpc_fundrawtransaction.py:1161:9: F841 local variable 'funded' is assigned to but never used`",
      "commit_id" : "05ef67ad94fc175518a75475dfd8964a872df9d1",
      "created_at" : "2021-11-17T08:22:34Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")\n+\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 0.00001000)\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 1)\n+\n+        self.generate(self.nodes[0], 1)\n+\n+        created = w.createrawtransaction([], [{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1.00001000}])\n+\n+        # With 15 sat/vb, the low value input is negative ev. This should still fund.\n+        funded = w.fundrawtransaction(created, {\"subtractFeeFromOutputs\":[0], \"fee_rate\": 15})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r750996946",
      "id" : 750996946,
      "line" : 1161,
      "node_id" : "PRRC_kwDOABII584sw03S",
      "original_commit_id" : "05ef67ad94fc175518a75475dfd8964a872df9d1",
      "original_line" : 1161,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 26,
      "pull_request_review_id" : 808258132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/750996946/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-17T08:22:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/750996946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r751511948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751511948"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-17T18:12:05Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")\n+\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 0.00001000)\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 1)\n+\n+        self.generate(self.nodes[0], 1)\n+\n+        created = w.createrawtransaction([], [{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1.00001000}])\n+\n+        # With 15 sat/vb, the low value input is negative ev. This should still fund.\n+        funded = w.fundrawtransaction(created, {\"subtractFeeFromOutputs\":[0], \"fee_rate\": 15})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r751511948",
      "id" : 751511948,
      "in_reply_to_id" : 750996946,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584syymM",
      "original_commit_id" : "05ef67ad94fc175518a75475dfd8964a872df9d1",
      "original_line" : 1161,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 808972173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751511948/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-17T18:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751511948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-11-18T03:01:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-972471548",
      "id" : 972471548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII58459rz8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972471548/reactions"
      },
      "updated_at" : "2022-01-11T19:50:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972471548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r753998018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753998018"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    def test_wallet_sweaping(self):\r\n        self.log.info(\"Testing that wallet sweeping works even with negative effective value.\")\r\n```",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-22T07:08:55Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r753998018",
      "id" : 753998018,
      "line" : 1148,
      "node_id" : "PRRC_kwDOABII584s8RjC",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1148,
      "original_position" : 13,
      "original_start_line" : 1147,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 13,
      "pull_request_review_id" : 812144983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753998018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1147,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-22T07:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753998018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r753998141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753998141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd add another assertion that it fails without `subtractFeeFromOutputs`",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-22T07:09:12Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")\n+\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 0.00001000)\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 1)\n+\n+        self.generate(self.nodes[0], 1)\n+\n+        created = w.createrawtransaction([], [{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1.00001000}])\n+\n+        # With 15 sat/vb, the low value input is negative ev. This should still fund.\n+        w.fundrawtransaction(created, {\"subtractFeeFromOutputs\":[0], \"fee_rate\": 15})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r753998141",
      "id" : 753998141,
      "line" : 1161,
      "node_id" : "PRRC_kwDOABII584s8Rk9",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1161,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 26,
      "pull_request_review_id" : 812144983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753998141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-22T07:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753998141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. \r\n\r\nDid a light code review and I think it's better to drop the first commit as it's not required to fix the linked bug. If you'd like to keep it, I'd suggest to make inclusion/exclusion of the change fee explicit when stetting targets for coinselection algorithms, rather than implicit `m_change_fee = 0` (it's not zero, it's just payed by recipient!).",
      "created_at" : "2021-11-22T07:19:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-975197512",
      "id" : 975197512,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5846IFVI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975197512/reactions"
      },
      "updated_at" : "2021-11-22T07:19:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975197512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/23534/commits/c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-23T08:11:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-976243212",
      "id" : 976243212,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5846MEoM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/976243212/reactions"
      },
      "updated_at" : "2021-11-23T08:11:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/976243212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11212268?v=4",
         "events_url" : "https://api.github.com/users/gruve-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gruve-p/followers",
         "following_url" : "https://api.github.com/users/gruve-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gruve-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gruve-p",
         "id" : 11212268,
         "login" : "gruve-p",
         "node_id" : "MDQ6VXNlcjExMjEyMjY4",
         "organizations_url" : "https://api.github.com/users/gruve-p/orgs",
         "received_events_url" : "https://api.github.com/users/gruve-p/received_events",
         "repos_url" : "https://api.github.com/users/gruve-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gruve-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gruve-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gruve-p"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @yurayakimenko",
      "created_at" : "2021-11-25T07:45:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-978916261",
      "id" : 978916261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5846WROl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978916261/reactions"
      },
      "updated_at" : "2021-11-25T07:45:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978916261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756659830"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756659830"
         }
      },
      "author_association" : "MEMBER",
      "body" : "positive_groups is a misnomer, perhaps rename it `non_knapsack_groups`?\r\n\r\n",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-25T08:19:34Z",
      "diff_hunk" : "@@ -384,7 +384,7 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n     std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n-    std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n+    std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, !coin_selection_params.m_subtract_fee_outputs/* positive_only */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756659830",
      "id" : 756659830,
      "line" : 387,
      "node_id" : "PRRC_kwDOABII584tGbZ2",
      "original_commit_id" : "851e73e05b7d5fcd65448cf5488c9b9ffe3138f2",
      "original_line" : 387,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 5,
      "pull_request_review_id" : 815674287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756659830/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T08:25:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756659830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756660781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756660781"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the functionality change isn't for sweeping per-se, maybe just add \"often used for sweeping\" in the comment",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-25T08:20:58Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756660781",
      "id" : 756660781,
      "in_reply_to_id" : 753998018,
      "line" : 1148,
      "node_id" : "PRRC_kwDOABII584tGbot",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1148,
      "original_position" : 13,
      "original_start_line" : 1147,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 13,
      "pull_request_review_id" : 815674287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756660781/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1147,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-25T08:25:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756660781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756662069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756662069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "assert `w` has no balance/utxos, may seem duh but it helps readability of the two wallet dance",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-25T08:22:55Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756662069",
      "id" : 756662069,
      "line" : 1151,
      "node_id" : "PRRC_kwDOABII584tGb81",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1151,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 16,
      "pull_request_review_id" : 815674287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756662069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T08:25:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756662069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756663799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756663799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can we make 15 more programmatic with respect to the 1000 sat output?",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-25T08:25:22Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")\n+\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 0.00001000)\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 1)\n+\n+        self.generate(self.nodes[0], 1)\n+\n+        created = w.createrawtransaction([], [{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1.00001000}])\n+\n+        # With 15 sat/vb, the low value input is negative ev. This should still fund.\n+        w.fundrawtransaction(created, {\"subtractFeeFromOutputs\":[0], \"fee_rate\": 15})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r756663799",
      "id" : 756663799,
      "in_reply_to_id" : 753998141,
      "line" : 1161,
      "node_id" : "PRRC_kwDOABII584tGcX3",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1161,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 26,
      "pull_request_review_id" : 815674287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756663799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T08:25:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756663799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK, if someone wants to do \"send max value possible\" we could support this as another option and choose positive only groups again.",
      "created_at" : "2021-11-25T08:28:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-978947202",
      "id" : 978947202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5846WYyC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978947202/reactions"
      },
      "updated_at" : "2021-11-25T08:28:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978947202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r757777632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757777632"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am finding this line a little a confusing, maybe something like \"Testing that sweeping transaction with \"subtract fee from outputs\" with negative effective value utxos works\". ",
      "commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "created_at" : "2021-11-27T12:40:55Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r757777632",
      "id" : 757777632,
      "in_reply_to_id" : 753998018,
      "line" : 1148,
      "node_id" : "PRRC_kwDOABII584tKsTg",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1148,
      "original_position" : 13,
      "original_start_line" : 1147,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 13,
      "pull_request_review_id" : 817130324,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757777632/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1147,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-27T12:55:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757777632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But this solution means you will end up with less bitcoins on the receiving end, doesn't it?\r\n\r\nYes.\r\n\r\n> Users _probably_ would prefer the higher amount received.\r\n\r\nI'm not sure. Subtract fee from outputs has always been \"X amount leaves the wallet\", so I think having less than that leave would be surprising? \r\n\r\n> I suppose the best UX would be to either ignore the net-negative UTXOs and simply send less than the requested amount. But that is apt to unprovably \"burn\" the dust unless we can somehow publish the dust private keys for others to sweep (but that seems dangerous and potentially ties to some centralised publisher).\r\n\r\nNegative EV UTXOs can become positive if the feerate were to drop (assuming it was high).\r\n\r\n> Second-best might be to effectively reduce the fee rate by simply refusing to pay more for these UTXOs than they're worth. But care is needed to ensure the user is aware of this and transactions don't get stuck.\r\n\r\nI think that might be dangerous, and surprising to users.\r\n\r\n> Also, any of this should only occur when trying to send the entire balance I think?\r\n\r\nI think it is reasonable for this to occur for all subtract fee from outputs sends. Maybe it should try positive only first, and if that fails, allow negative?",
      "created_at" : "2021-12-05T18:54:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-986281563",
      "id" : 986281563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5846yXZb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986281563/reactions"
      },
      "updated_at" : "2021-12-05T18:54:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986281563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604698"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This functionality is for more than just sweeping. I've changed the text to `Test that enable subtractFeeFromOutputs will include negative effective value UTXOs`.",
      "commit_id" : "b9af5331ad4f9c69d507c86d14f16bdb6d0f4c36",
      "created_at" : "2021-12-05T19:29:10Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604698",
      "id" : 762604698,
      "in_reply_to_id" : 753998018,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdGya",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1148,
      "original_position" : 13,
      "original_start_line" : 1147,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 823424906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604698/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-05T19:29:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604739"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added an `assert_raises_rpc_error`.\r\n\r\nAlso made the fee rate calculation programmatic",
      "commit_id" : "b9af5331ad4f9c69d507c86d14f16bdb6d0f4c36",
      "created_at" : "2021-12-05T19:29:37Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")\n+\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 0.00001000)\n+        self.nodes[0].sendtoaddress(w.getnewaddress(address_type=\"bech32\"), 1)\n+\n+        self.generate(self.nodes[0], 1)\n+\n+        created = w.createrawtransaction([], [{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1.00001000}])\n+\n+        # With 15 sat/vb, the low value input is negative ev. This should still fund.\n+        w.fundrawtransaction(created, {\"subtractFeeFromOutputs\":[0], \"fee_rate\": 15})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604739",
      "id" : 762604739,
      "in_reply_to_id" : 753998141,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdGzD",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1161,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 823424937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604739/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T19:29:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604838"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Named this to just `groups` and the groups that `KnapsackSolver` uses to be `knapsack_groups`. It's better for the special case to be named after the special case rather than the normal case to be named as the negation of the special case.",
      "commit_id" : "b9af5331ad4f9c69d507c86d14f16bdb6d0f4c36",
      "created_at" : "2021-12-05T19:30:38Z",
      "diff_hunk" : "@@ -384,7 +384,7 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n     std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n-    std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n+    std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, !coin_selection_params.m_subtract_fee_outputs/* positive_only */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604838",
      "id" : 762604838,
      "in_reply_to_id" : 756659830,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdG0m",
      "original_commit_id" : "851e73e05b7d5fcd65448cf5488c9b9ffe3138f2",
      "original_line" : 387,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 823425003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604838/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T19:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604838",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "b9af5331ad4f9c69d507c86d14f16bdb6d0f4c36",
      "created_at" : "2021-12-05T19:30:44Z",
      "diff_hunk" : "@@ -1143,6 +1144,21 @@ def test_feerate_rounding(self):\n         rawtx = w.createrawtransaction(inputs=[], outputs=[{self.nodes[0].getnewaddress(address_type=\"bech32\"): 1 - 0.00000202}])\n         assert_raises_rpc_error(-4, \"Insufficient funds\", w.fundrawtransaction, rawtx, {\"fee_rate\": 1.85})\n \n+    def test_sffo_with_negative_ev(self):\n+        self.log.info(\"Testing that subtract fee from outputs with negative effective value outputs still works\")\n+\n+        self.nodes[1].createwallet(\"negevsffotest\")\n+        w = self.nodes[1].get_wallet_rpc(\"negevsffotest\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r762604852",
      "id" : 762604852,
      "in_reply_to_id" : 756662069,
      "line" : 1153,
      "node_id" : "PRRC_kwDOABII584tdG00",
      "original_commit_id" : "c351e53f42c85c7ed95bde842f07554c9798dbcb",
      "original_line" : 1153,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 32,
      "pull_request_review_id" : 823425014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T19:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-09T17:09:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-990048334",
      "id" : 990048334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5847AvBO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990048334/reactions"
      },
      "updated_at" : "2021-12-09T17:09:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990048334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/23534/commits/f44c3ce31921d15dfae5375b74910b350003fbb4\r\n\r\n",
      "created_at" : "2021-12-10T01:25:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-990494113",
      "id" : 990494113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5847Cb2h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990494113/reactions"
      },
      "updated_at" : "2021-12-10T01:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990494113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nit: typo in the PR title \"negtive\" (may make it harder to find later)\r\n\r\nI typically use the \"subtract fee\" feature in combination with manual coin selection (for which this PR has no effect). That's different from the use case of emptying out a wallet. At minimum the RPC docs should warn that this will spend negative net value coins. The GUI should also warn, preferably only when this is actually the case. It can get quite expensive if a wallet has lots of dust.\r\n\r\nThe first commit is worth its own PR if this doesn't make it.",
      "created_at" : "2021-12-10T05:59:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-990641408",
      "id" : 990641408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5847C_0A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990641408/reactions"
      },
      "updated_at" : "2021-12-10T06:03:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990641408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've changed this to try negative EVs if there are no solutions with the normal groupings.",
      "created_at" : "2021-12-10T14:28:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-991018764",
      "id" : 991018764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII5847Eb8M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/991018764/reactions"
      },
      "updated_at" : "2021-12-10T14:28:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/991018764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r768300269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768300269"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about just throwing these two selections into the mix unconditionally? Would that be correct? Efficiency aside.",
      "commit_id" : "a26a64c63dd8d55d0ac972f5420f5dd27e7f53d8",
      "created_at" : "2021-12-14T04:03:33Z",
      "diff_hunk" : "@@ -403,6 +403,20 @@ std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAm\n         results.push_back(*srd_result);\n     }\n \n+    // If we didn't find any solutions, and are subtracting the fee from the outputs, we may need to include negative effective value coins.\n+    // So try BnB and SRD again with all_groups.\n+    // It is safe to do this because a solution including negative EVs will have a greater waste.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#discussion_r768300269",
      "id" : 768300269,
      "line" : 408,
      "node_id" : "PRRC_kwDOABII584ty1Tt",
      "original_commit_id" : "a26a64c63dd8d55d0ac972f5420f5dd27e7f53d8",
      "original_line" : 408,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 6,
      "pull_request_review_id" : 830994216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768300269/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-14T04:04:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768300269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I already mentioned this in person, but I find that \"subtract fee\" leads to unintuitive behavior, especially in the context of sweeping (and makes all tests a lot more complicated).\r\n\r\nIt would make more sense to me that the wallet _never_ spends UTXOs with negative effective value unless explicitly tasked to do so, since it just costs users (either sender or receiver) more fees and more blockspace for the debatable reason of not leaving any UTXOs behind. The main use-case where I see \"subtract fee from recipient\" making sense, is in the context of Coin Control, when the sender picks the inputs explicitly and doesn't want to calculate the appropriate fee manually.\r\n\r\nEspecially in the case of sweeping, I agree with Luke, that the user should prefer getting more money over using all UTXOs. If they sweep at `minFeeRate`, they're getting the optimal outcome anyway. We might want to introduce a dedicated sweep function that sends the maximum by default, and optionally can be toggled to spend all UTXOs.",
      "created_at" : "2022-01-05T16:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-1005891404",
      "id" : 1005891404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII58479K9M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1005891404/reactions"
      },
      "updated_at" : "2022-01-05T16:46:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1005891404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I already mentioned this in person, but I find that \"subtract fee\" leads to unintuitive behavior, especially in the context of sweeping (and makes all tests a lot more complicated).\r\n\r\nCould you maybe illustrate what the unintuitive behavior is with an example? The rest of your comment about \"user should get more money by default\" obviously sounds good if it doesn't have other tradeoffs.",
      "created_at" : "2022-01-05T16:56:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-1005900493",
      "id" : 1005900493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII58479NLN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1005900493/reactions"
      },
      "updated_at" : "2022-01-05T16:56:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1005900493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The main use-case where I see \"subtract fee from recipient\" making sense, is in the context of Coin Control, when the sender picks the inputs explicitly and doesn't want to calculate the appropriate fee manually.\r\n\r\nAnd that scenario could be considered sweeping as well. Sweeping can be generalized to \"spend UTXOs XYZ fully with all value going to one output\" where XYZ could be all UTXOs in the wallet, or a preset input list.\r\n\r\n> Especially in the case of sweeping, I agree with Luke, that the user should prefer getting more money over using all UTXOs. If they sweep at `minFeeRate`, they're getting the optimal outcome anyway. We might want to introduce a dedicated sweep function that sends the maximum by default, and optionally can be toggled to spend all UTXOs.\r\n\r\nI think it is unintuitive and not very good UX to not spend uneconomical UTXOs in a sweep. I think that users would expect a sweep function to spend all UTXOs regardless, and it would be surprising if sweeping a wallet left behind any balance, even uneconomical.\r\n\r\n> Could you maybe illustrate what the unintuitive behavior is with an example?\r\n\r\nI'm not sure about unintuitive, but subtractFeeFromOutputs definitely causes a lot of headaches in coin selection code, so getting rid of it would greatly simplify a lot of it. It would certainly make the logic much easier to follow.\r\n\r\n***\r\n\r\nFor some historical context, #5831 added subtractFeeFromAmount (which was a rebase of #4331) and that points to 2 issues where the proposed use case is sweeping.",
      "created_at" : "2022-01-05T17:52:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-1005944759",
      "id" : 1005944759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII58479X-3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1005944759/reactions"
      },
      "updated_at" : "2022-01-05T17:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1005944759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this in favor of introducing sendall to solve the problem.",
      "created_at" : "2022-03-10T14:21:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23534#issuecomment-1064115704",
      "id" : 1064115704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23534",
      "node_id" : "IC_kwDOABII584_bR34",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064115704/reactions"
      },
      "updated_at" : "2022-03-10T14:21:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064115704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
