[
   {
      "author_association" : "MEMBER",
      "body" : "Couple corrections:\r\n\r\n>the latter triggered in case of stale tip due to block variance to seek a better chain by rotating our outbound peers if we already reach an outbound limit (EvictExtraOutboundPeers).\r\n\r\nThe reason we have a stale tip check that triggers seeking extra outbound peers is in case we are partitioned off the honest network, not because we want to do something different in the case of normal block variance.\r\n\r\nBlock-relay only peers were introduced in #15759.\r\n\r\nI mentioned here (https://github.com/bitcoin/bitcoin/pull/19724#discussion_r480327555) that the documentation was an oversight while working on #15759.  See comment https://github.com/bitcoin/bitcoin/pull/15759#pullrequestreview-281092623, specifically this part: \r\n\r\n>Reworked the outbound eviction logic so that we'll evict block-relay-only peers that fail the nMinimumChainWork test, but protect them otherwise.\r\n\r\nSo that was the intended behavior and what I think the reviewers of the PR understood as well; in my opinion the simplest fix is to correct the comments in the code to reflect that.",
      "created_at" : "2020-09-03T22:50:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19863#issuecomment-686802795",
      "id" : 686802795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19863",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NjgwMjc5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-03T22:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686802795",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Clarified in #19871, let me know if modified comment captures your original intent.\r\n\r\n> The reason we have a stale tip check that triggers seeking extra outbound peers is in case we are partitioned off the honest network, not because we want to do something different in the case of normal block variance.\r\n\r\nThanks, I confused the conditions under which stale tip logic may trigger (block variance) with its design goal. To resume, if I understand well, there is 3 internal sources of eviction for outbound peers ?\r\n* bad/lagging chain logic (`ConsiderEviction`)\r\n* stale tip logic (`EvictExtraOutboundPeers`)\r\n* minimum chain-work (net_processing.cpp, L2002, in `ProcessHeadersMessage`)\r\n\r\nI guess the difference between lagging and stale tip logics, is the former to prune out slow/buggy peers based on a _relative_ comparison between their and our tip and the latter to actively seek a moving-forward chain in case of partition based on a required minimal frequency of block announcement ?",
      "created_at" : "2020-09-04T13:57:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19863#issuecomment-687162306",
      "id" : 687162306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19863",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzE2MjMwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T13:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687162306",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   }
]
