[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483413754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483413754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: \r\n- copyright header\r\n- redundant empty lines here\r\n- also i think we want this file under `src/util`",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T06:29:04Z",
      "diff_hunk" : "@@ -0,0 +1,27 @@\n+\n+\n+#ifndef BITCOIN_TRACE_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483413754",
      "id" : 483413754,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQxMzc1NA==",
      "original_commit_id" : "1b4286c6ac2bad95d546e3c12eb4f3b3f5a80160",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/trace.h",
      "position" : null,
      "pull_request_review_id" : 482390242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483413754",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483414033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483414033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why create a span just to take its data field?",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T06:29:50Z",
      "diff_hunk" : "@@ -3890,6 +3891,12 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    TRACE4(PeerLogicValidation, ProcessMessages,\n+           pfrom->addr.ToString().c_str(),\n+           msg.m_command.c_str(),\n+           MakeUCharSpan(msg.m_recv).data(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483414033",
      "id" : 483414033,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQxNDAzMw==",
      "original_commit_id" : "1b4286c6ac2bad95d546e3c12eb4f3b3f5a80160",
      "original_line" : 3897,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 482390588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483414033",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, thanks for working on this, I think this is a great way to have more visibility into internal metrics (for diagnosing issues, and statistics), without intrusive changes, or having to hand-roll all kind of custom tooling.",
      "created_at" : "2020-09-04T06:37:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-686945746",
      "id" : 686945746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Njk0NTc0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T06:37:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686945746",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK: more tooling for allowing visibility into internals for power users is good. I don't think this Linux only improvement removes the need for #19509 at all: I would use both in different contexts :)",
      "created_at" : "2020-09-04T06:53:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-686952856",
      "id" : 686952856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Njk1Mjg1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T09:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686952856",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20487 (draft: Add syscall sandboxing using seccomp-bpf (Linux secure computing mode) by practicalswift)\n* #16546 (External signer support - Wallet Box edition by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-09-04T08:26:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687005177",
      "id" : 687005177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzAwNTE3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T12:57:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687005177",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483652414"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483652414"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Think I copied this over from the peer logging PR and didn't simplify. Will fix.",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T14:31:29Z",
      "diff_hunk" : "@@ -3890,6 +3891,12 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    TRACE4(PeerLogicValidation, ProcessMessages,\n+           pfrom->addr.ToString().c_str(),\n+           msg.m_command.c_str(),\n+           MakeUCharSpan(msg.m_recv).data(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483652414",
      "id" : 483652414,
      "in_reply_to_id" : 483414033,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY1MjQxNA==",
      "original_commit_id" : "1b4286c6ac2bad95d546e3c12eb4f3b3f5a80160",
      "original_line" : 3897,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 482701101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483652414",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, will review/test.",
      "created_at" : "2020-09-04T14:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687197225",
      "id" : 687197225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzE5NzIyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T14:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687197225",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jonatack thanks! you need `systemtap-sdt-dev` if you're on debian-like which I still need to add to the build. This just provides the sdt header file.",
      "created_at" : "2020-09-04T14:54:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687199010",
      "id" : 687199010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzE5OTAxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T14:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687199010",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @jonatack thanks! you need `systemtap-sdt-dev` if you're on debian-like which I still need to add to the build. This just provides the sdt header file.\r\n\r\nThanks for the heads-up! which probably saved me some time even though you mentioned it in the PR description. Done: `sudo apt install systemtap-sdt-dev`",
      "created_at" : "2020-09-04T14:58:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687201538",
      "id" : 687201538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzIwMTUzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T14:58:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687201538",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483767263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483767263"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ENABLE_TRACING` is probably intended be provided a configure option (e.g. `--enable-ebpf`) later on?",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T17:44:15Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_TRACE_H\n+#define BITCOIN_UTIL_TRACE_H\n+\n+#if /* !defined(ENABLE_TRACING) || */ defined(WIN32)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483767263",
      "id" : 483767263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc2NzI2Mw==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/trace.h",
      "position" : null,
      "pull_request_review_id" : 482842592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483767263",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483768868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483768868"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "correct. I think having runtime probes would be neat to have in release builds, then you could tap into them in production. This shouldn't be a problem since traces are basically no-ops if there are no probes attached. This is what linux does of course. perhaps it would be a thing you could explicitly disable if you wanted to, or if configure couldn't find the sdt header.",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T17:48:15Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_TRACE_H\n+#define BITCOIN_UTIL_TRACE_H\n+\n+#if /* !defined(ENABLE_TRACING) || */ defined(WIN32)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483768868",
      "id" : 483768868,
      "in_reply_to_id" : 483767263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc2ODg2OA==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/trace.h",
      "position" : null,
      "pull_request_review_id" : 482844641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483768868",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483770317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483770317"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "although it's not technically a no-op if the macro arg does some amount of work, like serializing an ip address to a string. so trace invocations shouldn't try to serialize anything or do heavy work. you can always write parsers on the bpf side.",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T17:51:47Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_TRACE_H\n+#define BITCOIN_UTIL_TRACE_H\n+\n+#if /* !defined(ENABLE_TRACING) || */ defined(WIN32)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483770317",
      "id" : 483770317,
      "in_reply_to_id" : 483767263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc3MDMxNw==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/trace.h",
      "position" : null,
      "pull_request_review_id" : 482846511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483770317",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483774808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483774808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> correct. I think having runtime probes would be neat to have in release builds,\r\n\r\nAgree, I'm fine with enabling it by default when the prerequisites are installed (and the platform is Linux),\r\n\r\n> although it's not technically a no-op if the macro arg does some amount of work,\r\n\r\nYes, this is something to be careful with. The `LogPrintf`macro avoids this by evaluating its arguments only when debugging is enabled.\r\nBut I think in most cases it's not a problem, we'll only want to trace values that are readily available anyway.",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T18:02:12Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_TRACE_H\n+#define BITCOIN_UTIL_TRACE_H\n+\n+#if /* !defined(ENABLE_TRACING) || */ defined(WIN32)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483774808",
      "id" : 483774808,
      "in_reply_to_id" : 483767263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc3NDgwOA==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/trace.h",
      "position" : null,
      "pull_request_review_id" : 482852392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483774808",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could list the probe points in gdb:\r\n```\r\n(gdb) info probes\r\nType Provider            Name            Where              Semaphore Object                                     \r\nstap CChainState         ConnectBlock    0x0000000000294636           /â¦/bitcoin/src/bitcoind \r\nstap CConnman            PushMessage     0x000000000009ab40           /â¦/bitcoin/src/bitcoind \r\nstap PeerLogicValidation ProcessMessages 0x00000000000d1387           /â¦/bitcoin/bitcoin/src/bitcoind \r\n```\r\n\r\n> $ sudo bpftrace netmsg.bt -o nettrace.txt -c \"./src/bitcoind -datadir=/run/bitcoin \"\r\n\r\nIs it really necessary to run this as root?\r\nI read @eklitzke's [blog post](https://eklitzke.org/how-sytemtap-userspace-probes-work) back in the day and he doesn't use it there. But it looks like he uses a different tool, `stap` instead of `bpftrace`.\r\n\r\nEdit: yes it is necessary to run `bpftrace` as root,because it uses some privileged kernel functionality. It's probably not necessary to run bitcoind as root though.",
      "created_at" : "2020-09-04T18:21:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687308403",
      "id" : 687308403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzMwODQwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T18:31:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687308403",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm trying the first example, but it complains about a missing function `buf`. Any idea? Maybe too old bptrace version?\r\n```\r\n# uname -r\r\n5.4.0-42-generic\r\n# bpftrace --version\r\nbpftrace v0.9.4\r\n# bpftrace -p $(cat ~user/.bitcoin/bitcoind.pid) ../network-messages.bt \r\n../network-messages.bt:13:11-14: ERROR: Unknown function: buf\r\n  $data = buf(arg1,arg2);\r\n          ~~~\r\n```",
      "created_at" : "2020-09-04T18:41:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687317120",
      "id" : 687317120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzMxNzEyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T18:41:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687317120",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\"Wladimir J. van der Laan\" <notifications@github.com> writes:\n\n> I'm trying the first example, but it complains about a missing function `buf`. Any idea? Maybe too old bptrace version?\n\nyeah buf is a new thing from bpftrace 0.11 and bcc 0.16.0, you can just\nremove that if you're testing.\n\nbpftrace is a pretty high level thing, you can write lower level bpf\nprograms with bcc, I haven't tried that yet but it looks like its more\npowerful. bpftrace is great for simple stuff though.\n",
      "created_at" : "2020-09-04T18:58:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687324727",
      "id" : 687324727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzMyNDcyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T18:58:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687324727",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Edit: yes it is necessary to run bpftrace as root,because it uses some privileged kernel functionality. It's probably not necessary to run bitcoind as root though.\r\n\r\nright, you can run bitcoin without root and then attach to it with bpftrace afterwards.",
      "created_at" : "2020-09-04T19:04:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687327650",
      "id" : 687327650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzMyNzY1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T19:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687327650",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Could list the probe points in gdb\r\n\r\nI wasn't sure how we should name the probes, right now I just have the mapped to class::method but perhaps they could be more abstract like `validation:connect_block`, `net:push_message`, `net:process_message` ?",
      "created_at" : "2020-09-04T19:08:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687329421",
      "id" : 687329421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzMyOTQyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T19:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687329421",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> yeah buf is a new thing from bpftrace 0.11 and bcc 0.16.0, you can just remove that if you're testing.\r\n\r\nGood to know! I've built bpftrace [from git](https://github.com/iovisor/bpftrace) and it works now (which is version `bpftrace v0.11.0`, a lot newer!), thanks.\r\n\r\n> I wasn't sure how we should name the probes, right now I just have the mapped to class::method but perhaps they could be more abstract like validation:connect_block, net:push_message, net:process_message ?\r\n\r\nI think I prefer that. It has the probe point name describe more accurately the action taken and data that is traced.\r\nWe'll want to list and document these at some point.\r\n\r\n> Other ideas: tracepoints for lock contention, threads, what else?\r\n\r\n I think these would be good to have too:\r\n\r\n- Peer connected\r\n- Peer disconnected\r\n\r\nBTW: is it possible to do binary logging with `bpftrace` or `bcc`? (e.g. to provide a similar output to #19509). Or is it always text?\r\n",
      "created_at" : "2020-09-04T19:24:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687336319",
      "id" : 687336319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzMzNjMxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-04T20:01:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687336319",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483810283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483810283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we'll want to add the peer id as well here (same for outgoing)",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-04T19:30:19Z",
      "diff_hunk" : "@@ -3890,6 +3891,12 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    TRACE4(PeerLogicValidation, ProcessMessages,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483810283",
      "id" : 483810283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxMDI4Mw==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 3894,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 482897499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483810283",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "For some extra inspiration with regard to tracepoints, we might want to look at the [statoshi diff](https://github.com/jlopp/statoshi/compare/1b90a7b61a37d450bbe5b485dcc9b8c591567e0d..28b88353a78ae19e3c5379bbda6b72f4fef65a8c).\r\n(I think we can convert most of the statsd use to tracepoints, or sets of two tracepoints in the case of timing ones)",
      "created_at" : "2020-09-05T12:13:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687602059",
      "id" : 687602059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzYwMjA1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-05T12:14:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687602059",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483969369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483969369"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added a commit that detects sys/sdt.h and enables tracing if it finds it",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-05T17:12:46Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_TRACE_H\n+#define BITCOIN_UTIL_TRACE_H\n+\n+#if /* !defined(ENABLE_TRACING) || */ defined(WIN32)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483969369",
      "id" : 483969369,
      "in_reply_to_id" : 483767263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2OTM2OQ==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/trace.h",
      "position" : null,
      "pull_request_review_id" : 483067431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483969369",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483969394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483969394"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-09-05T17:13:02Z",
      "diff_hunk" : "@@ -3890,6 +3891,12 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    TRACE4(PeerLogicValidation, ProcessMessages,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483969394",
      "id" : 483969394,
      "in_reply_to_id" : 483810283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2OTM5NA==",
      "original_commit_id" : "629d119f90d7a302415ffc8089524a3dc0a50893",
      "original_line" : 3894,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 483067453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483969394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think I prefer that. It has the probe point name describe more accurately the action taken and data that is traced.\r\n\r\ndone, renamed to `net:process_message,push_message` and `net:connect_block`\r\n\r\n> BTW: is it possible to do binary logging with bpftrace or bcc? (e.g. to provide a similar output to #19509). Or is it always text?\r\n\r\nI haven't been able to figure that out with bpftrace but I'm going to try put together a bcc examples of this. Perhaps we should have a `docs/tracing.md` that documents the tracepoints with some examples? We could also start collecting bpftrace or bcc scripts somewhere, not sure what the best place for those would be. For now a bunch of bpftrace one liner examples in some docs would be neat.",
      "created_at" : "2020-09-05T17:29:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687639341",
      "id" : 687639341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzYzOTM0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-05T17:48:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687639341",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I haven't been able to figure that out with bpftrace but I'm going to try put together a bcc examples of this. Perhaps we should have a docs/tracing.md that documents the tracepoints with some examples?\r\n\r\nGreat idea. It definitely makes sense to document this well so that people know how to use it. eBPF use with applications is not that common yet, we can assume people to just know.\r\n\r\nHaving a directory or repository of ready-to-use scripts for common statistics ways to dump/analyse data makes sense too. I also think the Python binary log analysis tooling from #19509 can be useful, even if we don't merge that dumping method.\r\n",
      "created_at" : "2020-09-06T12:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687777273",
      "id" : 687777273,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzc3NzI3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-06T12:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687777273",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "So this is pretty incredible: We may only need to use static traces in a few places. For things like ConnectBlock we can use uprobes (no code changes required!):\r\n\r\n```\r\n$ objdump -CtT src/bitcoind | grep ConnectBlock\r\n00000000002db020 g     F .text\t0000000000002a66              CChainState::ConnectBlock(CBlock const&, BlockValidationState&, CBlockIndex*, CCoinsViewCache&, CChainParams const&, bool)\r\n```\r\n\r\n```\r\n$ sudo bpftrace -e '\r\n\r\nstruct CBlockIndex { u8 *hash; struct CBlockIndex *pprev; struct CBlockIndex *pskip; int height; };\r\n\r\nuprobe:./src/bitcoind:\"CChainState::ConnectBlock(CBlock const&, BlockValidationState&, CBlockIndex*, CCoinsViewCache&, CChainParams const&, bool)\" \r\n{ \r\n  printf(\"connect block %d\\n\", ((struct CBlockIndex *)arg3)->height); \r\n}\r\n'\r\n```\r\n\r\n```\r\nconnect block 7796\r\nconnect block 7797\r\nconnect block 7798\r\nconnect block 7799\r\nconnect block 7800\r\nconnect block 7801\r\n...\r\n```\r\n\r\nð¤¯",
      "created_at" : "2020-09-08T22:07:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-689162173",
      "id" : 689162173,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTE2MjE3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-08T22:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689162173",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "That's neat!\r\n\r\nBut I think the nice thing about documented static probes is that it relies less on the specific code structure and more on conceptual events. This would allow for e.g. collecting statistics (things like statoshi) with a (semi) stable interface, without constantly rebasing.",
      "created_at" : "2020-10-27T10:03:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-717128433",
      "id" : 717128433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzEyODQzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-27T10:03:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717128433",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> That's neat!\n>\n> But I think the nice thing about documented static probes is that it\n> relies less on the specific code structure and more on conceptual\n> events. This would allow for e.g. collecting statistics (things like\n> statoshi) with a (semi) stable interface, without constantly rebasing.\n\nyup agreed, uprobes are a neat trick, but semi-stable static probes that\nyou can depend on in scripts would be much more useful to build on top\nof. uprobes are a nice supplement/fallback in case a static probe is not\navailable.\n",
      "created_at" : "2020-10-27T16:28:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-717364757",
      "id" : 717364757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzM2NDc1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-27T16:28:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717364757",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased version here: https://github.com/laanwj/bitcoin/tree/usdt-probes",
      "created_at" : "2020-12-07T11:01:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-739844681",
      "id" : 739844681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTg0NDY4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-07T11:01:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739844681",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r537416867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537416867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure we want to pass the sanitized packet type to the probe here or simply the raw data.\r\n\r\nEdit: Nah, I guess anyone that wants the raw data already has a pointer to the packet, which is passed too. It's extra information.",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-12-07T11:02:29Z",
      "diff_hunk" : "@@ -2838,7 +2839,10 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     size_t nMessageSize = msg.data.size();\n-    LogPrint(BCLog::NET, \"sending %s (%d bytes) peer=%d\\n\",  SanitizeString(msg.m_type), nMessageSize, pnode->GetId());\n+    auto sanitizedType = SanitizeString(msg.m_type);\n+\n+    LogPrint(BCLog::NET, \"sending %s (%d bytes) peer=%d\\n\", sanitizedType, nMessageSize, pnode->GetId());\n+    TRACE4(net, push_message, sanitizedType.c_str(), msg.data, nMessageSize, pnode->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r537416867",
      "id" : 537416867,
      "line" : 2980,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQxNjg2Nw==",
      "original_commit_id" : "83171997dcb5eed1c8ec08e077482f9cf2b9acb5",
      "original_line" : 2980,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 546040919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-07T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/537416867",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've also made a start with documentation `doc/tracing.md`: https://github.com/laanwj/bitcoin/blob/35cad1adbf2bdf98d437e499ea10904d967b0083/doc/tracing.md",
      "created_at" : "2020-12-07T11:43:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-739866407",
      "id" : 739866407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTg2NjQwNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-07T11:43:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739866407",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj writes:\n> I'm not sure we want to pass the sanitized packet type to the probe here or simply the raw data.\n\nI'm not super familiar with the network packet format, is this easy to\npull from the raw data? If so we probably don't need it. I wasn't really\nhappy with the current binary capabilities of bpftrace but I imagine\nthis will get better over time once the tooling matures.\n\n> Rebased version here: https://github.com/laanwj/bitcoin/tree/usdt-probes\n\nThanks for moving this along. I reviewed the range diff and looks ok.\n\n> I've also made a start with documentation doc/tracing.md: https://github.com/laanwj/bitcoin/blob/35cad1adbf2bdf98d437e499ea10904d967b0083/doc/tracing.md\n\nAmazing, thank you!\n",
      "created_at" : "2020-12-07T16:33:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-740030527",
      "id" : 740030527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MDAzMDUyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-07T16:33:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/740030527",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm not super familiar with the network packet format, is this easy to\r\npull from the raw data?\r\n\r\nYea the header is very simple, given that eBPF is used for complex packet fltering and pre-processing setups I'm a bit surprised the binary handling capabilities are still a weak point but it should be able to handle it:\r\n```\r\n0â¦3    u8[4]  Start characters\r\n4â¦15   u8[20] Type (zero padded text)\r\n16â¦19  u32    Size in bytes\r\n20     u8     Checksum\r\n```",
      "created_at" : "2020-12-08T15:56:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-740707424",
      "id" : 740707424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MDcwNzQyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-08T15:56:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/740707424",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r538535858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/538535858"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I would prefer to rearrange the arguments to `push_message` to be in the same order as process_message (eg move node_id up front before `msgtype_str`):\r\n```\r\nnet:push_message(int node_id, char* msgtype_str, uint8_t* tx_data, size_t tx_size)\r\n```",
      "commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "created_at" : "2020-12-08T16:00:54Z",
      "diff_hunk" : "@@ -0,0 +1,201 @@\n+Tracing\n+=======\n+\n+To make it possible to have more detailed logging for troubleshooting, or for keeping track of detailed statistics, Bitcoin Core makes use of so-called eBPF tracepoints.\n+\n+The linux kernel can hook into these tracepoints at runtime, but when disabled they have little to no performance impact. Traces can pass data which can be printed externally via tools such as `bpftrace`.\n+\n+Viewing all tracepoints\n+-----------------------\n+\n+To view all available probes in a binary, use `info probes` in `gdb`:\n+\n+```\n+$ gdb src/bitcoind\n+â¦\n+(gdb) info probes\n+Type Provider   Name            Where              Semaphore Object                                     \n+stap net        process_message 0x00000000000d48f1           /â¦/bitcoin/src/bitcoind \n+stap net        push_message    0x000000000009db8b           /â¦/bitcoin/src/bitcoind \n+stap validation connect_block   0x00000000002adbe6           /â¦/bitcoin/src/bitcoind\n+â¦\n+```\n+\n+Tracepoint documentation\n+------------------------\n+\n+The current tracepoints are listed here.\n+\n+### net\n+\n+- `net:process_message(char* addr_str, int node_id, char* msgtype_str, uint8_t* rx_data, size_t rx_size)`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#discussion_r538535858",
      "id" : 538535858,
      "line" : 31,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUzNTg1OA==",
      "original_commit_id" : "d283230e5e0b07ddeef375b7fd0a325ccab78fa9",
      "original_line" : 31,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "doc/tracing.md",
      "position" : 31,
      "pull_request_review_id" : 547378413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19866",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-08T16:01:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/538535858",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this is ready to go out of draft and get review for the build system changes. It adds the basic infrastructure for tracing. Further tracepoints and examples can be added in later PRs.",
      "created_at" : "2020-12-08T16:14:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-740723892",
      "id" : 740723892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MDcyMzg5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-08T16:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/740723892",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think this is ready to go out of draft and get review for the build\n> system changes. It adds the basic infrastructure for tracing. Further\n> tracepoints and examples can be added in later PRs.\n\nok I'll push just those for now\n",
      "created_at" : "2020-12-08T23:56:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-741265027",
      "id" : 741265027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MTI2NTAyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-08T23:56:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741265027",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Given that eBPF is used for complex packet fltering and pre-processing\n> setups I'm a bit surprised the binary handling capabilities are still\n> a weak point\n\nThis was really a comment on the bpftrace tool, not the capabilities of\nebpf itself. You can always write a C/BCC file and load the low level\nprobes that way, but I'm lazy and haven't tried that yet.\n",
      "created_at" : "2020-12-09T00:05:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-741278887",
      "id" : 741278887,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MTI3ODg4Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-09T00:05:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741278887",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I remember when you posted about this on Twitter.\r\nExciting...\r\nConcept ACK\r\n",
      "created_at" : "2020-12-09T01:55:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-741435527",
      "id" : 741435527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MTQzNTUyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-09T01:55:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/741435527",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/152159?v=4",
         "events_url" : "https://api.github.com/users/RandyMcMillan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RandyMcMillan/followers",
         "following_url" : "https://api.github.com/users/RandyMcMillan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RandyMcMillan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RandyMcMillan",
         "id" : 152159,
         "login" : "RandyMcMillan",
         "node_id" : "MDQ6VXNlcjE1MjE1OQ==",
         "organizations_url" : "https://api.github.com/users/RandyMcMillan/orgs",
         "received_events_url" : "https://api.github.com/users/RandyMcMillan/received_events",
         "repos_url" : "https://api.github.com/users/RandyMcMillan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RandyMcMillan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RandyMcMillan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RandyMcMillan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> You can always write a C/BCC file and load the low level probes that way, but I'm lazy and haven't tried that yet.\r\n\r\nYes, that would be interesting. But yes, we can experiment with that later, `bpftrace` is the most user friendly way to use this so it's good to document it first.\r\n\r\nTested ACK 22eb7930a6ae021438aa0b8e750170534944f296",
      "created_at" : "2020-12-10T12:36:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-742494974",
      "id" : 742494974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MjQ5NDk3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-10T12:36:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/742494974",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested ACK 22eb7930a6ae021438aa0b8e750170534944f296\r\n\r\nPlayed around with the IBD example and added a `TRACE1(validation, mempool_added, fee)` to `MemPoolAccept::AcceptSingleTransaction` to log the fee of incoming transactions via bpftrace. I agree with the earlier [discussion](https://github.com/bitcoin/bitcoin/pull/19866#discussion_r483774808) on enabling it by default if prerequisites are installed.\r\n\r\nI did try to extend the IBD example to log the hash of the connected block, but haven't had any luck getting this to work with bpftrace yet. Might try with `bcc` later.",
      "created_at" : "2020-12-29T23:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-752269725",
      "id" : 752269725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjI2OTcyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-29T23:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752269725",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "0xB10C <notifications@github.com> writes:\n> I did try to extend the IBD example to log the hash of the connected\n> block, but haven't had any luck getting this to work with bpftrace\n> yet. Might try with `bcc` later.\n\nI had the same experience. perhaps it will be easier once bpftrace has\nbetter tooling and more control around printing arbitrary data. This\nfeature was only added recently:\n\nhttps://github.com/iovisor/bpftrace/pull/1107\n",
      "created_at" : "2020-12-30T11:57:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-752476414",
      "id" : 752476414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjQ3NjQxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-30T11:57:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752476414",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Example [bcc](https://github.com/iovisor/bcc) python script for [block-connected](https://github.com/0xB10C/bitcoin/commit/522b86b12abb535ded8273f8de7bb728e55bbbe4) printing the block height and hash via USDT probes:\r\n\r\n<details>\r\n  <summary>click me for code.py and output.txt</summary>\r\n  \r\n```python\r\nfrom __future__ import print_function\r\nfrom bcc import BPF, USDT\r\nimport sys\r\nfrom datetime import datetime\r\n\r\nif len(sys.argv) < 2:\r\n    print(\"USAGE:\", sys.argv[0], \"path/to/bitcoind\")\r\n    exit()\r\npath = sys.argv[1]\r\ndebug = False\r\n\r\nbpf_text = \"\"\"\r\n#include <uapi/linux/ptrace.h>\r\nstruct connect_block_t\r\n{\r\n    u32 height;\r\n    u8 hash[32];\r\n};\r\nBPF_PERF_OUTPUT(connected_blocks);\r\nint do_trace(struct pt_regs *ctx) {\r\n    struct connect_block_t cb = {};\r\n    bpf_usdt_readarg(1, ctx, &cb.height);\r\n    bpf_usdt_readarg_p(2, ctx, &cb.hash, sizeof(cb.hash));\r\n    connected_blocks.perf_submit(ctx, &cb, sizeof(cb));\r\n    return 0;\r\n};\r\n\"\"\"\r\n\r\nu = USDT(path=str(path))\r\nu.enable_probe(probe=\"connect_block\", fn_name=\"do_trace\")\r\n\r\nif debug:\r\n    print(u.get_text())\r\n\r\nb = BPF(text=bpf_text, usdt_contexts=[u])\r\n\r\ndef print_connected_blocks(cpu, data, size):\r\n    event = b[\"connected_blocks\"].event(data)\r\n    height = event.height\r\n    hash_bytes = bytearray(event.hash)\r\n    hash_bytes.reverse()\r\n    hash = hash_bytes.hex()\r\n    print(datetime.now(), \"height:\", height, \"hash:\", hash)\r\n\r\nb[\"connected_blocks\"].open_perf_buffer(print_connected_blocks)\r\n\r\nwhile 1:\r\n    try:\r\n        b.perf_buffer_poll()\r\n    except KeyboardInterrupt:\r\n        exit()\r\n```\r\n\r\nOutput on testnet:\r\n```\r\n2020-12-31 12:05:40.634456 height: 1901575 hash: 0000000000000012e5bad3eb72856bc8cee92b4da47c7d0ee49db1463345a1f8\r\n2020-12-31 12:10:11.215210 height: 1901576 hash: 00000000000000107e1cef35dc0557a49f5642b0b9b289ebc1cee454797ed1c3\r\n2020-12-31 12:14:00.349253 height: 1901577 hash: 0000000000000004c7abf45ba560c28e7bfa39c19e28284f8a640e33ee4069d1\r\n2020-12-31 12:17:02.398484 height: 1901578 hash: 00000000000000027b2f88e8cc4e4b0f8a7ad9d0142f282d272827201875e7c4\r\n2020-12-31 12:17:17.796756 height: 1901579 hash: 000000000000001a64e5d01f08c3183165fa2d8225d881081c4b80bb1ffba5b8\r\n2020-12-31 12:18:40.852506 height: 1901580 hash: 0000000000000010da1398d31de9d46eac62caf2a2c4ae1f7b91041ba612a0ae\r\n```\r\n</details>\r\n\r\nor [gist](https://gist.github.com/0xB10C/03c3451258a323f7a2341d155923496d)",
      "created_at" : "2020-12-31T12:02:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-752938795",
      "id" : 752938795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19866",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjkzODc5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-31T12:02:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752938795",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   }
]
