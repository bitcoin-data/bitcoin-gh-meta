{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "One user reported the issue on Bitcoin SE: https://bitcoin.stackexchange.com/questions/100437/bitcoin-cli-0-19-1-wallet-not-sending-from-addresses-with-closest-amount\r\n\r\n_UTXO A_ : 0.5 BTC\r\n_UTXO B-Z_ : 0.5 BTC\r\n\r\n_UTXO B-Z_ are selected instead of _UTXO A_ as the input for the transaction if I try to pay someone 0.5 BTC or more. Size of transaction is increased so user has to pay _more fees_. \r\n\r\n**Expected behavior**\r\n\r\n_UTXO A_ should be selected as input automatically which will decrease the size of transaction and fees.\r\n\r\n**To reproduce**\r\n\r\nI tried to reproduce the issue by following below steps:\r\n\r\n1. Create 850 addresses in bitcoin core: `for ($i=1; $i -le 850; $i++) {.\\bitcoin-cli.exe getnewaddress}`\r\n\r\n2. Add random amounts similar to the transaction mentioned by user in the issue: `81e681e4d7ed58a7645b3d8ae38c584e14954c359e3db8788b5ef645d65e9e64`\r\n\r\n   CSV file with address and amounts: https://mega.nz/file/ixsyjDYC#19Ff2qZP7LQjCvhz4ISF84uESPBesWrZmMVngJWGMOk\r\n\r\n3. Create, Sign and Broadcast a transaction to one of the address in my bitcoin core wallet using above CSV file from electrum wallet\r\n\r\n   Tx: https://blockstream.info/testnet/tx/b5c6c6dd204420020795fbf356d4db85a9398dbd99e575c72b76ec5f8d8d78e2\r\n\r\n4. Send 0.54 BTC in one more transaction to my bitcoin core wallet: \r\n\r\n   https://blockstream.info/testnet/tx/37675b6d44d1fe1b8095349f5d08d12197cee76504a0da6b0ab99fb29a4fa176\r\n\r\n5. Finally we have a similar setup in bitcoin core to reproduce the issue. Try to send 0.49 BTC to some address and very small amounts to few other addresses by creating a transaction in bitcoin core wallet as the user did in tx mentioned on SE: https://i.imgur.com/utWKiZN.png\r\n\r\n    https://i.imgur.com/WtduQx8.png\r\n\r\n6. If I do not use \"coin control features\" and inputs are selected automatically:\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/101463156-12823200-3963-11eb-84e6-b0dc22d50019.png)\r\n\r\n7. If use \"coin control features\" and select [UTXO with 0.54 BTC](https://i.imgur.com/0sBn3wE.png):\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/101463464-77d62300-3963-11eb-9605-e55f1addcf8a.png)\r\n\r\n**System information**\r\n\r\nBitcoin Core v 0.20.0\r\n\r\n**Additional information**\r\n\r\nStill trying to understand how [Coin Selection Algorithm](https://bitcoin.stackexchange.com/questions/1077/what-is-the-coin-selection-algorithm) works, why it didn't select `tb1qztazgd5665j9q0ww7qw24ms42gny6vc2h3z5yg` as input automatically and how can we fix this.\r\n\r\nThe user has mentioned on SE: \r\n> I have a feeling that coin control favors more inputs with less combined \"change\" over less inputs with more combined change. In this case the change address (3BF5VhQgnabWMsB8QhVrBoWD6is2XMKuQs) received 0.00008051 BTC, where the input with the closest full amount amount would have resulted in (0.02544158 - tx fee) in change\r\n",
   "closed_at" : "2021-10-07T13:53:02Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
      "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
      "followers_url" : "https://api.github.com/users/prayank23/followers",
      "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/prayank23",
      "id" : 13405205,
      "login" : "prayank23",
      "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
      "organizations_url" : "https://api.github.com/users/prayank23/orgs",
      "received_events_url" : "https://api.github.com/users/prayank23/received_events",
      "repos_url" : "https://api.github.com/users/prayank23/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/prayank23"
   },
   "comments" : 15,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20598/comments",
   "created_at" : "2020-12-08T09:22:22Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20598/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/20598",
   "id" : 759274112,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20598/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU3NTkyNzQxMTI=",
   "number" : 20598,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20598/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20598/timeline",
   "title" : "Coin selection algorithm not working as expected resulting in more fees",
   "updated_at" : "2021-10-07T13:53:03Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20598",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
      "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
      "followers_url" : "https://api.github.com/users/prayank23/followers",
      "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/prayank23",
      "id" : 13405205,
      "login" : "prayank23",
      "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
      "organizations_url" : "https://api.github.com/users/prayank23/orgs",
      "received_events_url" : "https://api.github.com/users/prayank23/received_events",
      "repos_url" : "https://api.github.com/users/prayank23/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/prayank23"
   }
}
