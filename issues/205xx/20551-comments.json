[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20012 (rpc: Remove duplicate name and argNames from CRPCCommand by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-03T02:40:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-737625207",
      "id" : 737625207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNzYyNTIwNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-03T02:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/737625207",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-03T03:58:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-737649840",
      "id" : 737649840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNzY0OTg0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-03T03:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/737649840",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This still hasn't addressed the review comment here: https://github.com/bitcoin/bitcoin/pull/12674#issuecomment-377004019 from 2.5 years ago.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/19315 adds this functionality in the correct way, and doesn't break the outbound connection counting logic.",
      "created_at" : "2020-12-03T10:18:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-737836038",
      "id" : 737836038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNzgzNjAzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-03T10:18:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/737836038",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">This still hasn't addressed the review comment here: #12674 (comment) from 2.5 years ago.\r\n\r\nThere is nothing to address. It is the expected behaviour.",
      "created_at" : "2020-12-03T16:07:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-738106828",
      "id" : 738106828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczODEwNjgyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-03T16:07:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738106828",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't understand the context for these proposed changes (why no PR description?), and the changes are problematic as they stand. For example, passing `ConnectionType::INBOUND` to `OpenNetworkConnection` immediately hits an assertion error, because it doesn't conceptually make sense (how does a node open an inbound connection?).  ",
      "created_at" : "2020-12-03T18:43:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-738211959",
      "id" : 738211959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczODIxMTk1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-03T18:43:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738211959",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">I don't understand the context for these proposed changes \r\n\r\nTwo use cases I'm aware of:\r\n\r\n- Tests\r\n- Connecting to a node without giving that node special privileges\r\n\r\n> and the changes are problematic as they stand. For example, passing ConnectionType::INBOUND to OpenNetworkConnection immediately hits an assertion error, because it doesn't conceptually make sense (how does a node open an inbound connection?).\r\n\r\nI would expect it to simply treat it as an inbound connection (but yes, the bug needs to be fixed - not sure the best way, any suggestions?).",
      "created_at" : "2020-12-03T18:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-738215882",
      "id" : 738215882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczODIxNTg4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-03T18:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738215882",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think #19315 handles tests more thoroughly than this (given that PR actually makes the tests use the functionality).\r\n\r\nFor mainnet, I don't think `feeler` or `addrfetch` connections would have much benefit, and `block-relay-only` connections should already be maintained where possible via #17428 and trying to manually tweak them probably doesn't make much sense. I think that mostly leaves privileged-vs-non-priviliged, ie `manual` vs `outbound-full-relay` which seems plausible.\r\n\r\nIs there actually any reason why `onetry` shouldn't always be `outbound-full-relay` instead of `manual`? If you actually want to preserve the connection, then reconnecting if it drops out seems like a must, but onetry doesn't do that.\r\n\r\nMatt's point stands though -- creating an additional `OUTBOUND_FULL_RELAY` connection will make `semOutbound` inconsistent with the `nOutboundFullRelay` count in `ThreadOpenConnections` which leads to misbehaviour. I think it's along the lines of repeatedly opening a 9th outbound connection, then closing an outbound connection because it only wants to keep 8 around, but there might be some further nuance to it.",
      "created_at" : "2020-12-04T17:32:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-738914133",
      "id" : 738914133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczODkxNDEzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-04T17:32:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/738914133",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've made this a draft, because it's not ready for review. \r\n\r\nYou need to add a PR description, which addresses any outstanding questions & explains the motivation for this change. Does it fix a bug, if so which one, does it need backporting? Even if you don't think there is anything new information to add from #12674, you should at least be pointing out that there was a previous PR, and associated discussion. I'm not really sure why a new PR was required over #12674.\r\n\r\nPlease rebase the branch so it will actually compile and the CI will run. There's also at least [one bug](https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-738211959) that needs fixing.\r\n\r\nAs much as you don't seem to believe that [issues raised](https://github.com/bitcoin/bitcoin/pull/12674#issuecomment-377004019) in the previous version of this PR are relevant, clearly you need to better explain why that is the case. This is the kind of thing you'd summarize and make clear in the PR description, rather than leaving it empty and making reviewers chase down the changes history, just to have them re-asked the same questions as in previous PR.",
      "created_at" : "2020-12-06T03:39:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-739449856",
      "id" : 739449856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTQ0OTg1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-06T03:39:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739449856",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree with Luke-jr that it's weird that onetry gets privileged treatment.\r\n\r\nWhen I split addnodes into their own connection pool I would have probably treated onetrys like ordinary automatic connections if I'd even given the matter any thought. If I did give it thought perhaps I didn't do it because it's not instantly obvious how to handle the outbound connection limit.  I think under the original behaviour of onetry (and the original purpose of it, to help a node that was having problems getting good peers get a good peer so that it could learn peers) that if outbounds were full that the onetry would just do nothing. I think that behaviour is still defensible, but I simultaneously see how it could be a little surprising.\r\n\r\nI agree with aj that the default behaviour of onetry should just be like an automatic connection.  If that were accomplished (correctly) then I think there would be little need for other additions.\r\n\r\nI don't think exposing connection types directly is a good change, except perhaps as some kind of hidden testing feature:  Their meaning depends on complex/subtle internal behaviour that will change from release to release.  Also being able to handle a user introduced connection of arbitrary type may require excessive generality for little gain.  I also doubt that exotic usage of addnode types is likely to get adequate testing or review-- so this is a functionality that I would expect to bitrot, or-- to the extent that it's useful at all-- have its usefulness broken by future developers that don't understand the usage (or just by accident, because it's not being used at all by people who review the software).\r\n",
      "created_at" : "2020-12-06T04:20:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-739452525",
      "id" : 739452525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTQ1MjUyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-06T04:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739452525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the following would allow `onetry` to be a normal outbound-full-relay connection while keeping the maximums correctly limited. If there's already 8 outbounds, this will use the \"feeler\" slot to bump that up to 9 outbounds, and sometime later one outbound will be evicted -- probably the one you just added unless a new block appears in the meantime. If desired, you could call `disconnectnode Y; addnode X onetry` to reduce to 7 outbounds first so that you'll likely keep the onetry.\r\n\r\n```diff\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -543,7 +543,9 @@ private:\r\n      */\r\n     ServiceFlags nLocalServices;\r\n \r\n+public: // hax0r\r\n     std::unique_ptr<CSemaphore> semOutbound;\r\n+private:\r\n     std::unique_ptr<CSemaphore> semAddnode;\r\n     int nMaxConnections;\r\n \r\n--- a/src/rpc/net.cpp\r\n+++ b/src/rpc/net.cpp\r\n@@ -301,8 +301,12 @@ static RPCHelpMan addnode()\r\n \r\n     if (strCommand == \"onetry\")\r\n     {\r\n+        CSemaphoreGrant grant(*node.connman->semOutbound, true);\r\n+        if (!grant) {\r\n+            throw JSONRPCError(RPC_CLIENT_NODE_NOT_ADDED, \"Error: No free outbound connection slots.\");\r\n+        }\r\n         CAddress addr;\r\n-        node.connman->OpenNetworkConnection(addr, false, nullptr, strNode.c_str(), ConnectionType::MANUAL);\r\n+        node.connman->OpenNetworkConnection(addr, false, &grant, strNode.c_str(), ConnectionType::OUTBOUND_FULL_RELAY);\r\n         return NullUniValue;\r\n     }\r\n```\r\n\r\nConceivably could also make `-connect` be outbound-full-relay connections rather than manual -- though given if you drop one of them for misbehaving you won't try reconnecting to anywhere else, that might be a bad idea. If you did do that though, it would mean `OpenNetworkConnection` could be changed to accept a `CSemaphoreGrant&` instead of a pointer, removing some special cases. (EDIT: grant, not semaphore)",
      "created_at" : "2020-12-07T06:58:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-739713625",
      "id" : 739713625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTcxMzYyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-07T07:01:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739713625",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ajtowns I like that.",
      "created_at" : "2020-12-12T20:21:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-743822880",
      "id" : 743822880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzgyMjg4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T20:21:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743822880",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Now that #19315 is merged, a simpler patch is:\r\n\r\n```diff\r\n     if (strCommand == \"onetry\")\r\n     {\r\n-        CAddress addr;\r\n-        node.connman->OpenNetworkConnection(addr, false, nullptr, strNode.c_str(), ConnectionType::MANUAL);\r\n+        const auto conn_type = ConnectionType::OUTBOUND_FULL_RELAY;\r\n+        if (!node.connman->AddConnection(strNode, conn_type)) {\r\n+            throw JSONRPCError(RPC_CLIENT_NODE_CAPACITY_REACHED, strprintf(\"Error: Already at capacity for %s.\", ConnectionTypeAsString(conn_type)));\r\n+        }\r\n         return NullUniValue;\r\n     }\r\n```\r\n\r\nNote that this approach fails the attempt if `existing_connections >= max_connections`, so will just give an immediate error if you already have 8 outbounds and attempt a onetry, rather than using the feeler slot.",
      "created_at" : "2021-01-13T08:04:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-759277783",
      "id" : 759277783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1OTI3Nzc4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-13T08:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759277783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns Your patch forgets to update the docs:\r\n\r\n```diff\r\ndiff --git a/src/net.h b/src/net.h\r\nindex 4f1a6b89a9..03c2f4dba6 100644\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -939,7 +939,7 @@ public:\r\n     std::vector<AddedNodeInfo> GetAddedNodeInfo();\r\n \r\n     /**\r\n-     * Attempts to open a connection. Currently only used from tests.\r\n+     * Attempts to open a connection.\r\n      *\r\n      * @param[in]   address     Address of node to try connecting to\r\n      * @param[in]   conn_type   ConnectionType::OUTBOUND or ConnectionType::BLOCK_RELAY\r\n",
      "created_at" : "2021-01-13T09:23:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-759319942",
      "id" : 759319942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1OTMxOTk0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-13T09:23:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759319942",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Since this was just for tests, `addconnection` serves the same purpose in theory. Closing.",
      "created_at" : "2021-07-06T23:30:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-875150573",
      "id" : 875150573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NTE1MDU3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T23:30:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875150573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Since this was just for tests, `addconnection` serves the same purpose in theory. Closing.\r\n\r\nbut only when in regtest mode.... why not in regular mode also?",
      "created_at" : "2021-09-04T19:49:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-913030653",
      "id" : 913030653,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "IC_kwDOABII5842a739",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-04T19:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913030653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't have a use case for that. If you want to pursue that, I suggest just opening up `addconnection` to non-regtest instead.",
      "created_at" : "2021-09-04T20:26:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20551#issuecomment-913036066",
      "id" : 913036066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20551",
      "node_id" : "IC_kwDOABII5842a9Mi",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-04T20:26:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913036066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
