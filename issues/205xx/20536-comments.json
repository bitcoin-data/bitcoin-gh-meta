[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #17526 (Use Single Random Draw In addition to knapsack as coin selection fallback by achow101)\n* #17331 (Use effective values throughout coin selection by achow101)\n* #17211 (Allow fundrawtransaction and walletcreatefundedpsbt to take external inputs by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-11-30T23:11:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#issuecomment-736110966",
      "id" : 736110966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20536",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNjExMDk2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-30T23:11:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736110966",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2020-12-06T00:50:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#issuecomment-739437453",
      "id" : 739437453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20536",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTQzNzQ1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-06T00:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739437453",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/60179867?v=4",
         "events_url" : "https://api.github.com/users/decryp2kanon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/decryp2kanon/followers",
         "following_url" : "https://api.github.com/users/decryp2kanon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/decryp2kanon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/decryp2kanon",
         "id" : 60179867,
         "login" : "decryp2kanon",
         "node_id" : "MDQ6VXNlcjYwMTc5ODY3",
         "organizations_url" : "https://api.github.com/users/decryp2kanon/orgs",
         "received_events_url" : "https://api.github.com/users/decryp2kanon/received_events",
         "repos_url" : "https://api.github.com/users/decryp2kanon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/decryp2kanon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/decryp2kanon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/decryp2kanon"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, thanks for adding a test.",
      "created_at" : "2020-12-17T17:51:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#issuecomment-747597239",
      "id" : 747597239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20536",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NzU5NzIzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T17:51:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/747597239",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548350384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548350384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "do we need both the checks because this could end up being `-1`?",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-24T02:10:38Z",
      "diff_hunk" : "@@ -3068,7 +3068,8 @@ bool CWallet::CreateTransactionInternal(\n         tx = MakeTransactionRef(std::move(txNew));\n \n         // Limit size\n-        if (GetTransactionWeight(*tx) > MAX_STANDARD_TX_WEIGHT)\n+        if ((sign && GetTransactionWeight(*tx) > MAX_STANDARD_TX_WEIGHT) ||\n+            (!sign && tx_sizes.second > MAX_STANDARD_TX_WEIGHT))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548350384",
      "id" : 548350384,
      "line" : 3072,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM1MDM4NA==",
      "original_commit_id" : "3e69939b78d0143d514c5d9b6c6a9844c9bb901c",
      "original_line" : 3072,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 558303514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-24T17:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548350384",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548351069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548351069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "spacing nit: `recipient.fundrawtransaction ,rawtx`",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-24T02:13:56Z",
      "diff_hunk" : "@@ -907,5 +908,25 @@ def test_subtract_fee_with_presets(self):\n         signedtx = self.nodes[0].signrawtransactionwithwallet(fundedtx['hex'])\n         self.nodes[0].sendrawtransaction(signedtx['hex'])\n \n+    def test_transaction_too_large(self):\n+        self.log.info(\"Test fundrawtx where BnB solution would result in a too large transaction, but Knapsack would not\")\n+\n+        self.nodes[0].createwallet(\"large\")\n+        wallet = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        recipient = self.nodes[0].get_wallet_rpc(\"large\")\n+        outputs = {}\n+        rawtx = recipient.createrawtransaction([], {wallet.getnewaddress(): 147.99899260})\n+\n+        # Make 1500 0.1 BTC outputs\n+        # The amount that we target for funding is in the BnB range when these outputs are used.\n+        # However if these outputs are selected, the transaction will end up being too large, so it shouldn't use BnB and instead fallback to Knapsack\n+        for i in range(0, 1500):\n+            outputs[recipient.getnewaddress()] = 0.1\n+        wallet.sendmany(\"\", outputs)\n+        self.nodes[0].generate(10)\n+\n+        # Currently, the only solution is to select most of the coins just made, however this will result in a transaction that is too large\n+        assert_raises_rpc_error(-4, \"Transaction too large\", recipient.fundrawtransaction ,rawtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548351069",
      "id" : 548351069,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM1MTA2OQ==",
      "original_commit_id" : "32015724c593faf1b36d169f3c61463a8762f040",
      "original_line" : 929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 558304165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-24T17:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548351069",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548351258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548351258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find it confusing the test claims it will have a successful knapsack run then doesn't?",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-24T02:14:53Z",
      "diff_hunk" : "@@ -907,5 +908,25 @@ def test_subtract_fee_with_presets(self):\n         signedtx = self.nodes[0].signrawtransactionwithwallet(fundedtx['hex'])\n         self.nodes[0].sendrawtransaction(signedtx['hex'])\n \n+    def test_transaction_too_large(self):\n+        self.log.info(\"Test fundrawtx where BnB solution would result in a too large transaction, but Knapsack would not\")\n+\n+        self.nodes[0].createwallet(\"large\")\n+        wallet = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        recipient = self.nodes[0].get_wallet_rpc(\"large\")\n+        outputs = {}\n+        rawtx = recipient.createrawtransaction([], {wallet.getnewaddress(): 147.99899260})\n+\n+        # Make 1500 0.1 BTC outputs\n+        # The amount that we target for funding is in the BnB range when these outputs are used.\n+        # However if these outputs are selected, the transaction will end up being too large, so it shouldn't use BnB and instead fallback to Knapsack\n+        for i in range(0, 1500):\n+            outputs[recipient.getnewaddress()] = 0.1\n+        wallet.sendmany(\"\", outputs)\n+        self.nodes[0].generate(10)\n+\n+        # Currently, the only solution is to select most of the coins just made, however this will result in a transaction that is too large",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548351258",
      "id" : 548351258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM1MTI1OA==",
      "original_commit_id" : "32015724c593faf1b36d169f3c61463a8762f040",
      "original_line" : 928,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 558304370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-24T17:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548351258",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548646701"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548646701"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I have both checks here because the estimate is an overestimate, so I would prefer to use the accurate weight when possible, i.e. when the transaction is signed.",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-24T17:37:06Z",
      "diff_hunk" : "@@ -3068,7 +3068,8 @@ bool CWallet::CreateTransactionInternal(\n         tx = MakeTransactionRef(std::move(txNew));\n \n         // Limit size\n-        if (GetTransactionWeight(*tx) > MAX_STANDARD_TX_WEIGHT)\n+        if ((sign && GetTransactionWeight(*tx) > MAX_STANDARD_TX_WEIGHT) ||\n+            (!sign && tx_sizes.second > MAX_STANDARD_TX_WEIGHT))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548646701",
      "id" : 548646701,
      "in_reply_to_id" : 548350384,
      "line" : 3072,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODY0NjcwMQ==",
      "original_commit_id" : "3e69939b78d0143d514c5d9b6c6a9844c9bb901c",
      "original_line" : 3072,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 558692148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-24T17:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548646701",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548648709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548648709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-24T17:40:02Z",
      "diff_hunk" : "@@ -907,5 +908,25 @@ def test_subtract_fee_with_presets(self):\n         signedtx = self.nodes[0].signrawtransactionwithwallet(fundedtx['hex'])\n         self.nodes[0].sendrawtransaction(signedtx['hex'])\n \n+    def test_transaction_too_large(self):\n+        self.log.info(\"Test fundrawtx where BnB solution would result in a too large transaction, but Knapsack would not\")\n+\n+        self.nodes[0].createwallet(\"large\")\n+        wallet = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        recipient = self.nodes[0].get_wallet_rpc(\"large\")\n+        outputs = {}\n+        rawtx = recipient.createrawtransaction([], {wallet.getnewaddress(): 147.99899260})\n+\n+        # Make 1500 0.1 BTC outputs\n+        # The amount that we target for funding is in the BnB range when these outputs are used.\n+        # However if these outputs are selected, the transaction will end up being too large, so it shouldn't use BnB and instead fallback to Knapsack\n+        for i in range(0, 1500):\n+            outputs[recipient.getnewaddress()] = 0.1\n+        wallet.sendmany(\"\", outputs)\n+        self.nodes[0].generate(10)\n+\n+        # Currently, the only solution is to select most of the coins just made, however this will result in a transaction that is too large\n+        assert_raises_rpc_error(-4, \"Transaction too large\", recipient.fundrawtransaction ,rawtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548648709",
      "id" : 548648709,
      "in_reply_to_id" : 548351069,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODY0ODcwOQ==",
      "original_commit_id" : "32015724c593faf1b36d169f3c61463a8762f040",
      "original_line" : 929,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 558692580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-24T17:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548648709",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548649167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548649167"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The fallback to knapsack behavior hasn't been implemented yet, so the only thing that should happen is we get an error. Originally this was part of a branch that did that fallback, but I removed it because I didn't like how it was implemented. I've updated the comment to reflect this.",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-24T17:40:49Z",
      "diff_hunk" : "@@ -907,5 +908,25 @@ def test_subtract_fee_with_presets(self):\n         signedtx = self.nodes[0].signrawtransactionwithwallet(fundedtx['hex'])\n         self.nodes[0].sendrawtransaction(signedtx['hex'])\n \n+    def test_transaction_too_large(self):\n+        self.log.info(\"Test fundrawtx where BnB solution would result in a too large transaction, but Knapsack would not\")\n+\n+        self.nodes[0].createwallet(\"large\")\n+        wallet = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        recipient = self.nodes[0].get_wallet_rpc(\"large\")\n+        outputs = {}\n+        rawtx = recipient.createrawtransaction([], {wallet.getnewaddress(): 147.99899260})\n+\n+        # Make 1500 0.1 BTC outputs\n+        # The amount that we target for funding is in the BnB range when these outputs are used.\n+        # However if these outputs are selected, the transaction will end up being too large, so it shouldn't use BnB and instead fallback to Knapsack\n+        for i in range(0, 1500):\n+            outputs[recipient.getnewaddress()] = 0.1\n+        wallet.sendmany(\"\", outputs)\n+        self.nodes[0].generate(10)\n+\n+        # Currently, the only solution is to select most of the coins just made, however this will result in a transaction that is too large",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r548649167",
      "id" : 548649167,
      "in_reply_to_id" : 548351258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODY0OTE2Nw==",
      "original_commit_id" : "32015724c593faf1b36d169f3c61463a8762f040",
      "original_line" : 928,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 558692694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-24T17:40:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548649167",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems strictly better, simple, plus test coverage.\r\n\r\nACK https://github.com/bitcoin/bitcoin/pull/20536/commits/48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2020-12-26T09:51:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#issuecomment-751339808",
      "id" : 751339808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20536",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTMzOTgwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-26T09:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751339808",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r583264220"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583264220"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have noticed that this codebase often uses unnamed fields in a specific order rather than named fields. Wouldn't it be advantageous to define transfer objects that have named fields to be more explicit in what is retrieved from response objects?",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2021-02-25T23:02:35Z",
      "diff_hunk" : "@@ -1594,14 +1594,15 @@ bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScri\n     return true;\n }\n \n-int64_t CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, bool use_max_sig)\n+// Returns pair of vsize and weight\n+std::pair<int64_t, int64_t> CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, bool use_max_sig)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r583264220",
      "id" : 583264220,
      "line" : 1598,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MzI2NDIyMA==",
      "original_commit_id" : "51e2cd322cfc7271af309e3a2243448a2ec0cad4",
      "original_line" : 1598,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 599116342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-25T23:23:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583264220",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r583270983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583270983"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd find it more intuitive if this were two separate methods to get vsize and weight rather than the unnamed pair of values.",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2021-02-25T23:17:46Z",
      "diff_hunk" : "@@ -1610,13 +1611,16 @@ int64_t CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wall\n }\n \n // txouts needs to be in the order of tx.vin\n-int64_t CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, const std::vector<CTxOut>& txouts, bool use_max_sig)\n+std::pair<int64_t, int64_t> CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, const std::vector<CTxOut>& txouts, bool use_max_sig)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r583270983",
      "id" : 583270983,
      "line" : 1614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MzI3MDk4Mw==",
      "original_commit_id" : "51e2cd322cfc7271af309e3a2243448a2ec0cad4",
      "original_line" : 1614,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 599116342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-25T23:23:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583270983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r587708194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587708194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For something like this, I feel like it is overkill to introduce a struct or class for these, especially since it is used in only one place.",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2021-03-04T18:19:54Z",
      "diff_hunk" : "@@ -1594,14 +1594,15 @@ bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScri\n     return true;\n }\n \n-int64_t CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, bool use_max_sig)\n+// Returns pair of vsize and weight\n+std::pair<int64_t, int64_t> CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, bool use_max_sig)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r587708194",
      "id" : 587708194,
      "in_reply_to_id" : 583264220,
      "line" : 1598,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzcwODE5NA==",
      "original_commit_id" : "51e2cd322cfc7271af309e3a2243448a2ec0cad4",
      "original_line" : 1598,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 604411941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-04T18:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587708194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r587708440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587708440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did these as a single function because it's the same calculation.",
      "commit_id" : "48a0319babb409cf486a9eb7c776810f70b06cb2",
      "created_at" : "2021-03-04T18:20:16Z",
      "diff_hunk" : "@@ -1610,13 +1611,16 @@ int64_t CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wall\n }\n \n // txouts needs to be in the order of tx.vin\n-int64_t CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, const std::vector<CTxOut>& txouts, bool use_max_sig)\n+std::pair<int64_t, int64_t> CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, const std::vector<CTxOut>& txouts, bool use_max_sig)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20536#discussion_r587708440",
      "id" : 587708440,
      "in_reply_to_id" : 583270983,
      "line" : 1614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzcwODQ0MA==",
      "original_commit_id" : "51e2cd322cfc7271af309e3a2243448a2ec0cad4",
      "original_line" : 1614,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 604412261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20536",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-04T18:20:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587708440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
