[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Useful.\n",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-10-31T07:29:32Z",
      "diff_hunk" : "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);\n+            std::vector<uint256> vOrphanErase;\n+            for(unsigned int i = 0; i < txChanged.size(); i++) {\n+                const CTransaction& tx = std::get<0>(txChanged[i]);\n+                // Which orphan pool entries must we evict?\n+                for (size_t j = 0; j < tx.vin.size(); j++) {\n+                    auto itByPrev = mapOrphanTransactionsByPrev.find(tx.vin[j].prevout);\n+                    if (itByPrev == mapOrphanTransactionsByPrev.end()) continue;\n+                    for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n+                        const CTransaction& orphanTx = (*mi)->second.tx;\n+                        const uint256& orphanHash = orphanTx.GetHash();\n+                        vOrphanErase.push_back(orphanHash);\n+                    }\n+                }\n+            }\n+            // Erase orphan transactions include or precluded by this block\n+            if (vOrphanErase.size()) {\n+                int nErased = 0;\n+                BOOST_FOREACH(uint256 &orphanHash, vOrphanErase) {\n+                    nErased += EraseOrphanTx(orphanHash);\n+                }\n+                LogPrint(\"mempool\", \"Erased %d orphan tx included or conflicted by block\\n\", nErased);\n+            }\n+        }\n+\n         // Notifications/callbacks that can run without cs_main\n         if(connman)\n             connman->SetBestHeight(nNewHeight);\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693873",
      "id" : 85693873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1NjkzODcz",
      "original_commit_id" : "b4c3c3bd8984a38718f315803382c924ed8ce987",
      "original_line" : null,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 6394273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693873/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I hope we can separate nodestate and other message-processing related variables from cs_main...\n",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-10-31T07:30:12Z",
      "diff_hunk" : "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85693912",
      "id" : 85693912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1NjkzOTEy",
      "original_commit_id" : "b4c3c3bd8984a38718f315803382c924ed8ce987",
      "original_line" : null,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 6394312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693912/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85693912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85830368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85830368"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@sipa Absolutely, I'm planning on doing that after the dust settles here, unless @TheBlueMatt already has it queued up. I'm planning on moving lots of what's currently in CNode to CNodeState, so breaking out the locks is a prerequisite for that.\n",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-10-31T20:52:34Z",
      "diff_hunk" : "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85830368",
      "id" : 85830368,
      "in_reply_to_id" : 85693912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1ODMwMzY4",
      "original_commit_id" : "b4c3c3bd8984a38718f315803382c924ed8ce987",
      "original_line" : null,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 6523007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85830368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85830368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85848973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85848973"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dont have it queued up, but, indeed, thats an obvious change after we split main.cpp.\n",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-10-31T22:47:28Z",
      "diff_hunk" : "@@ -3068,10 +3048,38 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        // Remove orphan transactions with cs_main\n+        {\n+            LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r85848973",
      "id" : 85848973,
      "in_reply_to_id" : 85693912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg1ODQ4OTcz",
      "original_commit_id" : "b4c3c3bd8984a38718f315803382c924ed8ce987",
      "original_line" : null,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 6540194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85848973/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85848973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing for now. Will rebase on #9075 when its merged.\n",
      "created_at" : "2016-11-03T19:22:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-258247466",
      "id" : 258247466,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI1ODI0NzQ2Ng==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258247466/reactions"
      },
      "updated_at" : "2016-11-03T19:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258247466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on #9075...this now forms the last pull before main.cpp is split clean in two :).\n",
      "created_at" : "2016-11-18T03:29:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261440177",
      "id" : 261440177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MTQ0MDE3Nw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261440177/reactions"
      },
      "updated_at" : "2016-11-18T03:29:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261440177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/8930/commits/2dd652afe577a09d6f70db0e79b8f6c0706dd1b4\n",
      "created_at" : "2016-11-18T15:08:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261554103",
      "id" : 261554103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MTU1NDEwMw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261554103/reactions"
      },
      "updated_at" : "2016-11-18T15:08:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261554103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "What is the rationale behind this refactoring please? What future changes is it enabling? Or what is it fixing?",
      "created_at" : "2016-11-21T09:33:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261888265",
      "id" : 261888265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MTg4ODI2NQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261888265/reactions"
      },
      "updated_at" : "2016-11-21T09:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261888265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@rebroad \r\n\r\n> This further decouples \"main\" and \"net\" processing logic by moving\r\n> orphan processing out of the chain-connecting cs_main lock and\r\n> into its own cs_main lock, beside all of the other chain callbacks.\r\n\r\nDecoupling unrelated logic to be able to split up main into validation and network handling parts.",
      "created_at" : "2016-11-21T12:45:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-261927435",
      "id" : 261927435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MTkyNzQzNQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261927435/reactions"
      },
      "updated_at" : "2016-11-21T12:45:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261927435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt  One thing we don't currently do, but probably should, is try to reaccept orphan transactions to the mempool if their missing inputs appear in a block.  After this PR, would you suggest we just do that inside `PeerLogicValidation::SyncTransaction()`, or would that be problematic?",
      "created_at" : "2016-11-22T14:26:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262253884",
      "id" : 262253884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MjI1Mzg4NA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262253884/reactions"
      },
      "updated_at" : "2016-11-22T14:26:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262253884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK. You could get rid of the BOOST_FOREACH along the way, if you wish.",
      "created_at" : "2016-11-22T22:53:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262390333",
      "id" : 262390333,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MjM5MDMzMw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262390333/reactions"
      },
      "updated_at" : "2016-11-22T22:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262390333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar that seems reasonable, yea. Not for this PR, though, indeed.",
      "created_at" : "2016-11-23T00:28:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262406615",
      "id" : 262406615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MjQwNjYxNQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262406615/reactions"
      },
      "updated_at" : "2016-11-23T00:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262406615",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK",
      "created_at" : "2016-11-23T00:41:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262408500",
      "id" : 262408500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MjQwODUwMA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262408500/reactions"
      },
      "updated_at" : "2016-11-23T00:41:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262408500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89385868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89385868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't this check against CMainSignals::SYNC_TRANSACTION_NOT_IN_BLOCK?",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-23T19:35:24Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89385868",
      "id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5Mzg1ODY4",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9931937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89385868/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89385868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89390068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89390068"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmmmmm...good point...for corectness I'll add that check to this PR, but I think we probably actually want to remove it in a future one since I believe it would allow us to clean up orphan cleanup logic in the ::TX message handling logic.",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-23T20:01:00Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89390068",
      "id" : 89390068,
      "in_reply_to_id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5MzkwMDY4",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9936096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89390068/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89390068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89391701"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89391701"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep, makes sense. But for now, it can at least be a short-circuit for returning without locking cs_main (not sure if there's any unlocked caller who would benefit, though).",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-23T20:11:30Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89391701",
      "id" : 89391701,
      "in_reply_to_id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5MzkxNzAx",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9937673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89391701/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89391701",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89394235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89394235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-23T20:29:53Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89394235",
      "id" : 89394235,
      "in_reply_to_id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5Mzk0MjM1",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9940068,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89394235/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-23T20:29:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89394235",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-23T22:50:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#issuecomment-262649070",
      "id" : 262649070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8930",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI2MjY0OTA3MA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262649070/reactions"
      },
      "updated_at" : "2016-11-23T22:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262649070",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89827185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89827185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt Your comment confuses me a bit.  Wouldn't this be broken without that check?",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-28T16:55:51Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89827185",
      "id" : 89827185,
      "in_reply_to_id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5ODI3MTg1",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 10360626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89827185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-28T16:55:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89827185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "node_id" : "MDQ6VXNlcjQzNjAzNDk=",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89854552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89854552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@morcos it was a reference to the fact that we might want to remove orphan transactions which conflict with txn which were added to mempool, instead of doing that work in the ::TX message handling. I believe without the check they would step all over each other, but this could be fixed in the future.",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-28T19:04:52Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89854552",
      "id" : 89854552,
      "in_reply_to_id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5ODU0NTUy",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 10386347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89854552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-28T19:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89854552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89856523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89856523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, nice to move all logic to this function. \r\nBut for now, we don't actually remove orphan txs which conflict with things accepted to mempool.  We could, however, move recursive processing of orphan txs that depended on mempool accepted txs here, I agree.\r\nAlso there are other places SyncTransaction is called, such as for disconnected block txs, where it would be incorrect to remove orphan txs which conflict with txs from disconnected blocks.\r\nIn any case, the code is correct now, I just want to be sure we think about all the ways SyncTransaction is called when we change it in the future.",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-11-28T19:12:22Z",
      "diff_hunk" : "@@ -4744,6 +4724,30 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r89856523",
      "id" : 89856523,
      "in_reply_to_id" : 89385868,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg5ODU2NTIz",
      "original_commit_id" : "2dd652afe577a09d6f70db0e79b8f6c0706dd1b4",
      "original_line" : null,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 10388218,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89856523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-11-28T19:12:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89856523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "node_id" : "MDQ6VXNlcjQzNjAzNDk=",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r93639603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93639603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why create vOrphanErase at all? Why not simply run the EraseOrphanTx() here instead?",
      "commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "created_at" : "2016-12-22T15:13:31Z",
      "diff_hunk" : "@@ -4744,6 +4724,34 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn) : connman(connmanI\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n }\n \n+void PeerLogicValidation::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, int nPosInBlock) {\n+    if (nPosInBlock == CMainSignals::SYNC_TRANSACTION_NOT_IN_BLOCK)\n+        return;\n+\n+    LOCK(cs_main);\n+\n+    std::vector<uint256> vOrphanErase;\n+    // Which orphan pool entries must we evict?\n+    for (size_t j = 0; j < tx.vin.size(); j++) {\n+        auto itByPrev = mapOrphanTransactionsByPrev.find(tx.vin[j].prevout);\n+        if (itByPrev == mapOrphanTransactionsByPrev.end()) continue;\n+        for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n+            const CTransaction& orphanTx = (*mi)->second.tx;\n+            const uint256& orphanHash = orphanTx.GetHash();\n+            vOrphanErase.push_back(orphanHash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8930#discussion_r93639603",
      "id" : 93639603,
      "line" : 4741,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkzNjM5NjAz",
      "original_commit_id" : "d2b88f97a1235057290f9e8ca0bf11437ba919f8",
      "original_line" : null,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/main.cpp",
      "position" : 59,
      "pull_request_review_id" : 14171502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8930",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93639603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-12-22T15:13:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93639603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
